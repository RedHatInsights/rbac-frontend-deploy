(self.webpackChunkrbac=self.webpackChunkrbac||[]).push([[4792],{84414:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});var s=a(62012),n=a(64756);const r=e=>{const t=(0,s.useNavigate)();return(a,s)=>t((0,n.n)(a,e),s)}},19862:(e,t,a)=>{"use strict";a.d(t,{R:()=>i,A:()=>l});var s=a(71079);const n=(0,a(75465).i$)();async function r(e){return await n.getResourceTypes(e)}async function o(e){return await n.getResource(e)}const l=e=>({type:s.s6,payload:r(e)}),i=e=>({type:s.ZX,payload:o(e)})},10357:(e,t,a)=>{"use strict";a.d(t,{Z:()=>v});var s=a(28416),n=a.n(s),r=a(45697),o=a.n(r),l=a(76429),i=a(67850),c=a(48880),u=a(74219),d=a(57820),m=a(16396),p=a(4853);const f="modal-form",g=e=>n().createElement(p.l,{...e,id:f}),b=({saveLabel:e,cancelLabel:t})=>{const{onCancel:a}=(0,c.default)();return n().createElement(l.Z,null,(({pristine:s,invalid:r,validating:o,submitting:l})=>n().createElement("div",{className:"pf-v5-c-form"},n().createElement(d.W,{className:"pf-v5-u-mt-0"},n().createElement(m.Button,{ouiaId:"primary-save-button",variant:"primary",form:f,type:"submit",isDisabled:s||o||l||r},e),n().createElement(m.Button,{ouiaId:"secondary-cancel-button",variant:"link",onClick:a,id:"cancel-modal"},t)))))};b.propTypes={saveLabel:o().node,cancelLabel:o().node},b.defaultProps={saveLabel:"Save",cancelLabel:"Cancel"};const y=({ModalProps:e,saveLabel:t,cancelLabel:a,alert:s,...r})=>n().createElement(u.Modal,{role:"dialog",...e,footer:n().createElement(b,{saveLabel:t,cancelLabel:a})},s?.(),n().createElement(i.ZP,{...r,showFormControls:!1,FormWrapper:g}));y.propTypes={ModalProps:o().object,...b.propTypes};const v=y},73479:(e,t,a)=>{"use strict";a.d(t,{Z:()=>T});var s=a(28416),n=a.n(s),r=a(45697),o=a.n(r),l=a(16987),i=a(31055),c=a(96486),u=a(48880),d=a(76429),m=a(25387),p=a(2550);const f=({dirtyFieldsSinceLastSubmit:e,submitSucceeded:t,pristine:a})=>{const{onCancel:s}=(0,u.default)(),r=(0,c.isEmpty)(e)||!t&&a,o=(0,m.YB)();return n().createElement(l.ActionGroup,{className:"pf-v5-u-mt-0"},n().createElement(i.Button,{ouiaId:"primary-submit-button",type:"submit",isDisabled:r,variant:"primary"},o.formatMessage(p.Z.save)),n().createElement(i.Button,{ouiaId:"secondary-cancel-button",variant:"link",onClick:()=>s()},o.formatMessage(p.Z.cancel)))};f.propTypes={dirtyFieldsSinceLastSubmit:o().shape({[o().string]:o().oneOfType([o().string,o().number,o().bool])}),submitSucceeded:o().bool,pristine:o().bool,onCancel:o().func};const g=e=>n().createElement(d.Z,{subscription:{pristine:!0,submitSucceeded:!0,dirtyFieldsSinceLastSubmit:!0}},(t=>n().createElement(f,{...t,...e})));var b=a(67850),y=a(65412),v=a(75747),E=a(51912),M=a(96354);const R=({formTemplateProps:e,...t})=>n().createElement(E.Z,{componentMapper:{[M.Z.TEXT_FIELD]:y.Z,[M.Z.TEXTAREA]:v.Z},FormTemplate:t=>n().createElement(b.ZP,{...e,...t,FormButtons:g}),...t});R.propTypes={formTemplateProps:o().object};const T=R},45030:(e,t,a)=>{"use strict";a.d(t,{R:()=>f});var s=a(28416),n=a.n(s),r=a(45697),o=a.n(r),l=a(94229),i=a(31055),c=a(18444),u=a(70214),d=a.n(u),m=a(25387),p=a(2550);const f=({type:e,isOpen:t,onModalCancel:a,onModalConfirm:s,customTitle:r,customDescription:o,customPrimaryButtonTitle:u,customSecondaryButtonTitle:f})=>{const g=(0,m.YB)();return n().createElement(l.Modal,{"data-testid":"warning-modal",title:n().createElement("span",{className:"rbac-c-wizard__cancel-warning-header"},n().createElement(c.Icon,{size:"lg",className:"pf-v5-u-mr-md"},n().createElement(d(),{className:"rbac-c-wizard__cancel-warning-header--icon"})),r||g.formatMessage(p.Z.exitItemCreation,{item:e})),variant:l.ModalVariant.small,className:"rbac rbac-c-wizard__cancel-warning",isOpen:t,onClose:a,actions:[n().createElement(i.Button,{ouiaId:"primary-exit-button",key:"confirm",variant:"primary",onClick:s},u??g.formatMessage(p.Z.exit)),n().createElement(i.Button,{ouiaId:"secondary-cancel-button",key:"cancel",variant:"link",onClick:a},f??g.formatMessage(p.Z.stay))]},n().createElement("span",null,o||g.formatMessage(p.Z.discardedInputsWarning)," "))};f.propTypes={type:o().string,customTitle:o().node,customDescription:o().node,customPrimaryButtonTitle:o().string,customSecondaryButtonTitle:o().string,isOpen:o().bool,onModalCancel:o().func,onModalConfirm:o().func}},74517:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>I});var s=a(28416),n=a.n(s),r=a(45697),o=a.n(r),l=a(96354),i=a(73479),c=a(62012),u=a(86706),d=a(13563),m=a(19862),p=a(8340),f=a(45030),g=a(15950),b=a(94229),y=a(74503),v=a(84414),E=a(10357),M=a(5904),R=a(48880),T=a(25387),Z=a(2550);const h=({ModalProps:e,...t})=>{const a=(0,T.YB)(),s=(0,R.default)().getState().values;return n().createElement(E.Z,{...t,ModalProps:{...e,onClose:()=>e.onClose(s)},alert:s["dual-list-select"]?void 0:()=>n().createElement("div",{className:"rbac-m-resource-definitions"},n().createElement(M.Alert,{className:"pf-v5-c-modal__alert",variant:"danger",isInline:!0,title:a.formatMessage(Z.Z.defineAtLeastOneResource)}))})};h.propTypes={ModalProps:o().object};const L=h;var C=a(42348),S=a.n(C);const P={changedResources:void 0,cancelWarningVisible:!1,resourcesPath:void 0,loadingStateVisible:!0};function B(e,t){if("update"===t.type)return{...e,...t.payload};throw new Error}const w=(e,t,a)=>{const s=(0,T.YB)();return{fields:[{component:l.Z.DUAL_LIST_SELECT,name:"dual-list-select",leftTitle:s.formatMessage(Z.Z.resourcesAvailable),rightTitle:s.formatMessage(Z.Z.resourcesDefined),filterOptionsTitle:s.formatMessage(Z.Z.filterByResource),filterValueTitle:s.formatMessage(Z.Z.filterByResource),options:[...t&&e?a:[]],validate:[{type:"validate-resources"}],isSearchable:!0}]}},k={"validate-resources":()=>e=>e&&e.length>0?void 0:"At least one resource must be defined for this permission"},D=({cancelRoute:e})=>{const t=(0,T.YB)(),{roleId:a,permissionId:r}=(0,c.useParams)(),o=(0,v.Z)(),l=(0,u.useDispatch)(),[E,M]=(0,s.useReducer)(B,P),{definedResources:R,role:h}=(0,u.useSelector)((e=>({role:e.roleReducer.selectedRole,definedResources:e.roleReducer.selectedRole?.access?S()(e.roleReducer.selectedRole.access.filter((e=>e.permission===r)).map((e=>e.resourceDefinitions.map((e=>e.attributeFilter.value))))):[],isRecordLoading:e.roleReducer.isRecordLoading})),u.shallowEqual),{resourceTypes:C,isLoading:D,isLoadingResources:I,resources:F}=(0,u.useSelector)((e=>(({costReducer:{resourceTypes:e,isLoading:t,loadingResources:a,resources:s}},n)=>({resourceTypes:e.data,resources:s[n]?{resourcesPath:s[n]}:s,isLoading:t,isLoadingResources:a>0}))(e,E.resourcesPath)),u.shallowEqual);(0,s.useEffect)((()=>{l((0,m.A)())}),[r]),(0,s.useEffect)((()=>{if(!D){let e=C.find((e=>e.value===r.split(":")?.[1]))?.path;e&&(M({type:"update",payload:{resourcesPath:e.split("/")[5]}}),l((0,m.R)(e)))}}),[C]);const V=()=>o(e,{replace:!0}),A=e=>{e["dual-list-select"]===R?V():M({type:"update",payload:{changedResources:e["dual-list-select"],cancelWarningVisible:!0}})},N=(e=>Object.entries(e).reduce(((e,[t,a])=>[...e,...a.map((e=>({value:e.value,path:t,label:e.value})))]),[]))(F);return n().createElement(n().Fragment,null,n().createElement(f.R,{customTitle:t.formatMessage(Z.Z.exitEditResourceDefinitions),customDescription:t.formatMessage(Z.Z.changesWillBeLost),isOpen:E.cancelWarningVisible,onModalCancel:()=>M({type:"update",payload:{cancelWarningVisible:!1}}),onModalConfirm:V}),(D||I)&&E.loadingStateVisible?n().createElement(b.Modal,{variant:b.ModalVariant.large,className:"rbac-m-resource-definitions",isOpen:!0,title:t.formatMessage(Z.Z.editResourceDefinitions),onClose:()=>{M({type:"update",payload:{loadingStateVisible:!1}}),V()}},n().createElement(y.Bullseye,null,n().createElement(g.Spinner,null))):n().createElement(i.Z,{schema:w(F,E.resourcesPath,N),componentMapper:p.ZP,initialValues:{"dual-list-select":E.changedResources||R||[]},onSubmit:t=>{M({type:"update",payload:{changedResources:t["dual-list-select"]}});const s={permission:r,resourceDefinitions:[{attributeFilter:{key:`cost-management.${r.split(":")?.[1]}`,operation:1===t["dual-list-select"].length?"equal":"in",value:1===t["dual-list-select"].length?t["dual-list-select"][0]:t["dual-list-select"]}}]};l((0,d.ul)(a,{...h,access:[...h.access.filter((e=>e.permission!==r)),s]}),!0).then((()=>{l((0,d.fp)(a)),o(e)}))},onCancel:e=>A(e),validatorMapper:k,FormTemplate:e=>n().createElement(L,{...e,ModalProps:{onClose:A,isOpen:!E.cancelWarningVisible,variant:"large",title:t.formatMessage(Z.Z.editResourceDefinitions),description:t.formatMessage(Z.Z.editPermissionsUsingArrows)}})}))};D.propTypes={cancelRoute:o().string.isRequired};const I=D},82472:()=>{},97890:()=>{},17657:()=>{},22972:()=>{},43389:()=>{},65088:()=>{},70347:()=>{},78752:()=>{},25238:()=>{},49854:()=>{},87234:()=>{}}]);
//# sourceMappingURL=../sourcemaps/4792.a0e4400a2336400b32f5c09744c72b56.js.map