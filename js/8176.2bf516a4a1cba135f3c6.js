"use strict";(self.webpackChunkrbac=self.webpackChunkrbac||[]).push([[8176,6710],{31721:(e,t,s)=>{s.r(t),s.d(t,{AddRolePermissionWizardContext:()=>$,default:()=>K,mapperExtension:()=>j});var r=s(44914),n=s.n(r),a=s(69733),o=s(5556),i=s.n(o),c=s(6442),l=s(67655),m=s(79371),p=s(63537),u=s(42655),d=s(41939),f=s(74459),g=s(8582),E=s(11882),A=s(76260),v=s(79300),y=s(40748),x=s(7248),T=s(81558),h=s(40335);var b=s(79994),M=s(55086),S=s(60123),I=s.n(S),k=s(58471),C=s(49573);const F=({currentRoleID:e})=>{const t=(0,c.A)(),s=(0,a.useDispatch)();return n().createElement(n().Fragment,null,n().createElement(M.EmptyState,null,n().createElement(M.EmptyStateHeader,{titleText:n().createElement(n().Fragment,null,t.formatMessage(h.A.permissionsAddedSuccessfully)),icon:n().createElement(M.EmptyStateIcon,{color:"green",icon:I()}),headingLevel:"h4"}),n().createElement(M.EmptyStateBody,null),n().createElement(M.EmptyStateFooter,null,n().createElement(k.A,{to:C.A["role-detail"].link.replace(":roleId",e)},n().createElement(b.Button,{onClick:()=>s((0,g.rM)(e))},t.formatMessage(h.A.exit))))))},w=F;F.propTypes={currentRoleID:i().string.isRequired};var G=s(79255),D=s(18390),P=s(1621),V=s(71436),N=s(29068);const R=({formFields:e})=>{const{submitting:t}=(0,r.useContext)($);return t?n().createElement(V.Bullseye,null,n().createElement(N.Spinner,{size:"xl"})):n().createElement("div",{className:"rbac"},[[{...e?.[0]?.[0]}]])};R.propTypes={formFields:i().array};const z=R;var L=s(25970),B=s(87683),O=s(18857),W=s(67169),H=s(1481),_=s(72245),q=s(44419);const Q=e=>n().createElement(p.Ay,{...e,showFormControls:!1}),j={"add-permissions-table":E.A,"inventory-groups-role":D.A,"cost-resources":G.A,review:()=>{const e=(0,c.A)(),t=(0,T.default)(),{"role-name":s,"role-description":r,"add-permissions-table":a,"resource-definitions":o,"has-cost-resources":i}=t.getState().values;return n().createElement(v.Stack,{hasGutter:!0},n().createElement(v.StackItem,null,n().createElement(y.TextContent,null,n().createElement(x.Title,{headingLevel:"h1",size:"xl",className:"pf-v5-u-mb-sm"},e.formatMessage(h.A.reviewDetails)))),n().createElement(v.StackItem,{className:"rbac-l-stack__item-summary"},n().createElement(A.Grid,{hasGutter:!0},n().createElement(A.GridItem,{span:3},n().createElement(y.Text,{className:"pf-v5-c-title",component:y.TextVariants.h6},e.formatMessage(h.A.roleName))),n().createElement(A.GridItem,{span:9},n().createElement(y.Text,{component:y.TextVariants.p},s)),n().createElement(A.GridItem,{span:3},n().createElement(y.Text,{className:"pf-v5-c-title",component:y.TextVariants.h6},e.formatMessage(h.A.roleDescription))),n().createElement(A.GridItem,{span:9},n().createElement(y.Text,{component:y.TextVariants.p},r)),n().createElement(A.GridItem,{span:3},n().createElement(y.Text,{className:"pf-v5-c-title",component:y.TextVariants.h6},e.formatMessage(h.A.addedPermissions))),n().createElement(A.GridItem,{span:9},n().createElement(y.TextContent,{component:y.TextVariants.p},a.map(((e,t)=>n().createElement(y.Text,{key:t}," ",e.uuid," "))))),i&&n().createElement(n().Fragment,null,n().createElement(A.GridItem,{span:3},n().createElement(y.Text,{className:"pf-v5-c-title",component:y.TextVariants.h6},e.formatMessage(h.A.resourceDefinitions))),n().createElement(A.GridItem,{span:9},n().createElement(y.TextContent,{component:y.TextVariants.p},o.map((({resources:e})=>e.map(((e,t)=>n().createElement(y.Text,{key:t}," ",e," ")))))))))))}},$=(0,r.createContext)({success:!1,submitting:!1,error:void 0}),J=({role:e})=>{const t=(0,c.A)(),[s,o]=(0,r.useState)(!1),[i,p]=(0,r.useState)(""),E=(0,q.A)(),A=(0,a.useDispatch)(),v=(0,f.useFlag)("platform.rbac.groups-to-workspaces-rename"),[y,x]=(0,r.useState)({success:!1,submitting:!1,error:void 0,hideForm:!1}),T=(0,r.useRef)(document.createElement("div")),b=(0,r.useMemo)((()=>((e,t)=>{const s=(0,B.MT)(),r=(0,O.E)({locale:L.H,messages:W},s);return{fields:[{component:"wizard",name:"wizard",isDynamic:!0,inModal:!0,showTitles:!0,crossroads:["role-type"],title:r.formatMessage(h.A.addPermissions),container:e,fields:[{name:"add-permissions",title:r.formatMessage(h.A.addPermissions),StepTemplate:P.A,nextStep:({values:e})=>(0,H.Q)("add-permissions",e),fields:[{component:"add-permissions-table",name:"add-permissions-table"}]},{name:"inventory-groups-role",title:r.formatMessage(t?h.A.workspacesAccessTitle:h.A.inventoryGroupsAccessTitle),StepTemplate:_.A,nextStep:({values:e})=>(0,H.Q)("inventory-groups-role",e),fields:[{component:"plain-text",name:"text-description",label:n().createElement("p",null,r.formatMessage(t?h.A.workspacesAccessDescription:h.A.inventoryGroupsAccessDescription))},{component:"inventory-groups-role",name:"inventory-groups-role",validate:[(e=[])=>e?.every((({groups:e,permission:t})=>e?.length>0&&t))?void 0:r.formatMessage(h.A.assignAtLeastOneInventoryGroup)]}]},{name:"cost-resources-definition",title:r.formatMessage(h.A.defineCostResources),nextStep:"review",fields:[{component:"plain-text",name:"text-description",label:n().createElement("p",null,r.formatMessage(h.A.applyCostPermissionText))},{component:"cost-resources",name:"cost-resources",validate:[(e=[])=>e.every((({resources:e})=>e&&e.length>0))?void 0:r.formatMessage(h.A.assignAtLeastOneResource)]}]},{name:"review",title:r.formatMessage(h.A.reviewDetails),StepTemplate:z,fields:[{component:"review",name:"review"}]}]}]}})(T.current,v)),[]);(0,r.useEffect)((()=>{p(e.uuid)})),(0,r.useEffect)((()=>{T.current.hidden=s}),[s]);const M=()=>{E(C.A["role-detail"].link.replace(":roleId",e.uuid))};return n().createElement($.Provider,{value:{...y,setWizardError:e=>x((t=>({...t,error:e}))),setWizardSuccess:e=>x((t=>({...t,success:e}))),setHideForm:e=>x((t=>({...t,hideForm:e}))),rolePermissions:e.access}},n().createElement(d.A,{title:t.formatMessage(h.A.exitItemAdding,{item:t.formatMessage(h.A.permissions).toLocaleLowerCase()}),isOpen:s,onClose:()=>o(!1),confirmButtonLabel:t.formatMessage(h.A.discard),onConfirm:M},t.formatMessage(h.A.discardedInputsWarning)),y.hideForm?y.success?n().createElement(l.s,{title:t.formatMessage(h.A.addPermissions),isOpen:!0,steps:[{name:"success",component:n().createElement(w,{currentRoleID:i}),isFinishedStep:!0}],onClose:M}):null:n().createElement(m.A,{container:T,schema:b,subscription:{values:!0},FormTemplate:Q,initialValues:{"role-uuid":e.uuid,"role-type":"create","role-name":e.display_name,"role-description":e.description},componentMapper:{...u.Ay,...j},onSubmit:async t=>{const{"add-permissions-table":s,"cost-resources":r=[],"inventory-groups-role":n=[]}=t,a=[...e.access.map((e=>e.permission)),...s.map((e=>e.uuid))],o={...e,access:[...s.reduce(((e,{uuid:t,requires:s})=>[...e,...[t,...s.filter((e=>!a.includes(e)))].map((e=>({permission:e,resourceDefinitions:[...r,...n]?.find((t=>t.permission===e))?e.includes("inventory")?[{attributeFilter:{key:"group.id",operation:"in",value:n?.find((t=>t.permission===e))?.groups?.map((e=>e?.id))}}]:e.includes("cost-management")?[{attributeFilter:{key:`cost-management.${e.split(":")[1]}`,operation:"in",value:r?.find((t=>t.permission===e)).resources}}]:[]:[]})))]),e.access)],accessCount:e.accessCount+s.length};x((e=>({...e,submitting:!0}))),A((0,g.S0)(i,o)).then((()=>x((e=>({...e,submitting:!1,success:!0,hideForm:!0}))))).catch((()=>{x((e=>({...e,submitting:!1,success:!1,hideForm:!0}))),E(C.A["role-detail"].link.replace(":roleId",e.uuid))}))},onCancel:e=>{e&&e["add-permissions-table"]?.length>0?o(!0):M()}}))};J.defaultProps={role:{}},J.propTypes={role:i().object};const K=J}}]);
//# sourceMappingURL=../sourcemaps/8176.9f322748adc79be5e764860f785eb8bb.js.map