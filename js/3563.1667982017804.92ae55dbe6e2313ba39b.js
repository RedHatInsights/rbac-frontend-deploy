"use strict";(self.webpackChunkinsights_rbac_frontend=self.webpackChunkinsights_rbac_frontend||[]).push([[3563,7664],{79995:(e,t)=>{t.U6={name:"--pf-global--breakpoint--xs",value:"0",var:"var(--pf-global--breakpoint--xs)"},t.ZP=t.U6},97857:(e,t,r)=>{r.r(t),r.d(t,{default:()=>je});var n=r(93433),a=r(4942),o=r(29439),i=r(92950),s=r.n(i),l=r(86896),c=r(28216),u=r(334),d=r(1936),f=r(76857),p=r(64107),m=r(11107),g=r(28090),v=r(38376),y=r(30060),b=r(13063),h=r(44873),Z=r(15608),E=r(4682),O=r(93436),R=r(93327),w=r(94124),P=function(e){return e.reduce((function(e,t){return[].concat((0,n.Z)(e),[{cells:[t]}])}),[])},j=r(39173),M=r(19571),k=r(61338),S=r(87462),_=r(45697),D=r.n(_),L=r(96354),C=r(36457),x=r(29215),I=r(46966),B=r(73943),F=r(45987),T=r(40483),V=r(48880),A=r(30893),N=["ModalProps"];function W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?W(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var q=function(e){var t=e.ModalProps,r=(0,F.Z)(e,N),n=(0,l.Z)(),a=(0,V.default)().getState().values;return s().createElement(T.Z,(0,S.Z)({},r,{ModalProps:z(z({},t),{},{onClose:function(){return t.onClose(a)}}),alert:a["dual-list-select"]?void 0:function(){return s().createElement("div",{className:"rbac-m-resource-definitions"},s().createElement(f.Alert,{className:"pf-c-modal__alert",variant:"danger",isInline:!0,title:n.formatMessage(A.Z.defineAtLeastOneResource)}))}}))};q.propTypes={ModalProps:D().object};const G=q;var H=r(42348),U=r.n(H);function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function X(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var K={changedResources:void 0,cancelWarningVisible:!1,resourcesPath:void 0,loadingStateVisible:!0};function J(e,t){if("update"===t.type)return X(X({},e),t.payload);throw new Error}var Y=function(e,t,r){var a=(0,l.Z)();return{fields:[{component:L.Z.DUAL_LIST_SELECT,name:"dual-list-select",leftTitle:a.formatMessage(A.Z.resourcesAvailable),rightTitle:a.formatMessage(A.Z.resourcesDefined),filterOptionsTitle:a.formatMessage(A.Z.filterByResource),filterValueTitle:a.formatMessage(A.Z.filterByResource),options:(0,n.Z)(t&&e?r:[]),validate:[{type:"validate-resources"}],isSearchable:!0}]}},$={"validate-resources":function(){return function(e){return e&&e.length>0?void 0:"At least one resource must be defined for this permission"}}},ee=function(e){var t=e.cancelRoute,r=(0,l.Z)(),a=(0,u.useRouteMatch)(E.Z["role-detail-permission-edit"].path),d=(0,u.useRouteMatch)(a).params,p=d.permissionId,m=d.roleId,v=(0,u.useHistory)(),y=v.replace,b=v.push,h=(0,c.useDispatch)(),Z=(0,i.useReducer)(J,K),O=(0,o.Z)(Z,2),R=O[0],w=O[1],P=(0,c.useSelector)((function(e){var t;return{role:e.roleReducer.selectedRole,definedResources:null!==(t=e.roleReducer.selectedRole)&&void 0!==t&&t.access?U()(e.roleReducer.selectedRole.access.filter((function(e){return e.permission===p})).map((function(e){return e.resourceDefinitions.map((function(e){return e.attributeFilter.value}))}))):[],isRecordLoading:e.roleReducer.isRecordLoading}}),c.shallowEqual),j=P.definedResources,M=P.role,k=(0,c.useSelector)((function(e){return function(e,t){var r=e.costReducer,n=r.resourceTypes,a=r.isLoading,o=r.loadingResources,i=r.resources;return{resourceTypes:n.data,resources:i[t]?{resourcesPath:i[t]}:i,isLoading:a,isLoadingResources:o>0}}(e,R.resourcesPath)}),c.shallowEqual),_=k.resourceTypes,D=k.isLoading,L=k.isLoadingResources,F=k.resources;(0,i.useEffect)((function(){h((0,x.A)())}),[p]),(0,i.useEffect)((function(){if(!D){var e,t=null===(e=_.find((function(e){var t;return e.value===(null===(t=p.split(":"))||void 0===t?void 0:t[1])})))||void 0===e?void 0:e.path;t&&(w({type:"update",payload:{resourcesPath:t.split("/")[5]}}),h((0,x.R)(t)))}}),[_]);var T=function(){return y(t)},V=function(e){e["dual-list-select"]===j?T():w({type:"update",payload:{changedResources:e["dual-list-select"],cancelWarningVisible:!0}})},N=function(e){return Object.entries(e).reduce((function(e,t){var r=(0,o.Z)(t,2),a=r[0],i=r[1];return[].concat((0,n.Z)(e),(0,n.Z)(i.map((function(e){return{value:e.value,path:a,label:e.value}}))))}),[])}(F);return s().createElement(s().Fragment,null,s().createElement(B.R,{customTitle:r.formatMessage(A.Z.exitEditResourceDefinitions),customDescription:r.formatMessage(A.Z.changesWillBeLost),isOpen:R.cancelWarningVisible,onModalCancel:function(){return w({type:"update",payload:{cancelWarningVisible:!1}})},onConfirmCancel:T}),(D||L)&&R.loadingStateVisible?s().createElement(f.Modal,{variant:f.ModalVariant.large,className:"rbac-m-resource-definitions",isOpen:!0,title:r.formatMessage(A.Z.editResourceDefinitions),onClose:function(){w({type:"update",payload:{loadingStateVisible:!1}}),T()}},s().createElement(f.Bullseye,null,s().createElement(f.Spinner,null))):s().createElement(C.Z,{schema:Y(F,R.resourcesPath,N),componentMapper:I.ZP,initialValues:{"dual-list-select":R.changedResources||j||[]},onSubmit:function(e){var r;w({type:"update",payload:{changedResources:e["dual-list-select"]}});var a={permission:p,resourceDefinitions:[{attributeFilter:{key:"cost-management.".concat(null===(r=p.split(":"))||void 0===r?void 0:r[1]),operation:1===e["dual-list-select"].length?"equal":"in",value:1===e["dual-list-select"].length?e["dual-list-select"][0]:e["dual-list-select"]}}]};h((0,g.ul)(m,X(X({},M),{},{access:[].concat((0,n.Z)(M.access.filter((function(e){return e.permission!==p}))),[a])})),!0).then((function(){h((0,g.fp)(m)),b(t)}))},onCancel:function(e){return V(e)},validatorMapper:$,FormTemplate:function(e){return s().createElement(G,(0,S.Z)({},e,{ModalProps:{onClose:V,isOpen:!R.cancelWarningVisible,variant:"large",title:r.formatMessage(A.Z.editResourceDefinitions),description:r.formatMessage(A.Z.editPermissionsUsingArrows)}}))}}))};ee.propTypes={cancelRoute:D().string.isRequired};const te=ee;var re=r(85564),ne=r.n(re);function ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const ie=function(){var e=(0,l.Z)(),t=(0,i.useState)({pagination:oe(oe({},k.he),{},{filter:""})}),r=(0,o.Z)(t,2),n=r[0],a=r[1],d=n.pagination,p=n.filter,y=(0,c.useDispatch)(),b=(0,u.useParams)(),h=b.roleId,Z=b.permissionId,O=(0,c.useSelector)((function(e){var t,r,n,a,o;return{role:e.roleReducer.selectedRole,permission:e.roleReducer.selectedRole.access?oe({},null===(t=e.roleReducer.selectedRole)||void 0===t?void 0:t.access.find((function(e){return e.permission===Z}))):{},isRecordLoading:e.roleReducer.isRecordLoading,rolesPagination:(null===(r=e.roleReducer)||void 0===r||null===(n=r.roles)||void 0===n?void 0:n.pagination)||k.he,rolesFilters:(null===(a=e.roleReducer)||void 0===a||null===(o=a.roles)||void 0===o?void 0:o.filters)||{}}}),c.shallowEqual),R=O.role,S=O.permission,_=O.isRecordLoading,D=O.rolesPagination,L=O.rolesFilters;(0,i.useEffect)((function(){y((0,g.fp)(h))}),[h]),(0,i.useEffect)((function(){a(oe(oe({},n),{},{pagination:oe(oe({},n.pagination),{},{count:R.access?R.access.length:0})}))}),[R]);var C=S.resourceDefinitions?ne()(S.resourceDefinitions.map((function(e){return e.attributeFilter.value}))).filter((function(e){return!p||e.includes(p)})):[],x=function(){return s().createElement(i.Fragment,null,s().createElement(u.Route,{exact:!0,path:E.Z["role-detail-permission-edit"].path},s().createElement(te,{cancelRoute:E.Z["role-detail-permission"].path.replace(":roleId",h).replace(":permissionId",Z)})))};return s().createElement(i.Fragment,null,s().createElement(v.Q,{breadcrumbs:[{title:e.formatMessage(A.Z.roles),to:(0,m.zk)(x.roles,D,L)},{title:_?void 0:R&&(R.display_name||R.name),to:"/roles/detail/".concat(h)},{title:Z,isActive:!0}]},s().createElement(f.Level,null,s().createElement(f.LevelItem,null,s().createElement(j.Z,{title:Z||s().createElement(M.h2,null),className:"rbac-page-header__title"})))),s().createElement("section",{className:"pf-c-page__main-section rbac-c-role__permissions"},s().createElement(f.TextContent,null,s().createElement(f.Text,{component:f.TextVariants.h1},e.formatMessage(A.Z.definedResources))),s().createElement(w.f,{columns:[{}],createRows:P,data:C.slice(d.offset,d.offset+d.limit),filterValue:p,fetchData:function(e){var t=e.limit,r=e.offset,o=e.name;return a(oe(oe({},n),{},{filter:o,pagination:oe(oe({},n.pagination),{},{limit:t,offset:r})}))},isCompact:!0,routes:x,setFilterValue:function(e){var t=e.name;return a(oe(oe({},n),{},{filter:t}))},toolbarButtons:function(){return R.system?[]:[s().createElement(i.Fragment,{key:"edit-resource-definitions"},s().createElement(u.Link,{to:"/roles/detail/".concat(h,"/permission/").concat(Z,"/edit")},s().createElement(f.Button,{variant:"primary","aria-label":"Edit"},e.formatMessage(A.Z.edit))))]},isLoading:_,pagination:oe(oe({},d),{},{count:C.length}),titlePlural:e.formatMessage(A.Z.resources).toLowerCase(),titleSingular:e.formatMessage(A.Z.resource).toLowerCase(),hideHeader:!0,tableId:"role-resource-definitions"})))};var se=r(26794),le=r(92758),ce=r(79995),ue=r(60144),de=r(78236),fe=r(92732),pe=r(63242),me=r(40472);const ge={xs:parseInt(ce.ZP.value.replace("px","")),sm:parseInt(ue.default.value.replace("px","")),md:parseInt(de.default.value.replace("px","")),lg:parseInt(fe.default.value.replace("px","")),xl:parseInt(pe.default.value.replace("px","")),"2xl":parseInt(me.default.value.replace("px",""))},ve=function(){for(var e,t=window.innerWidth,r=0,n=Object.entries(ge);r<n.length;r++){var a=n[r],o=a[0];if(a[1]>=t)break;e=o}return e};var ye=r(94184),be=r.n(ye),he=["className","row"],Ze=function(e){var t=e.className,r=e.row,n=(0,F.Z)(e,he);return s().createElement(d.RowWrapper,(0,S.Z)({className:be()(t,{"rbac-c-role-default":r.system}),row:r},n))};Ze.propTypes={row:D().shape({system:D().bool}),className:D().string};const Ee=Ze;function Oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Re(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var we=(0,i.lazy)((function(){return r.e(8607).then(r.bind(r,68607))})),Pe=function(e){var t=e.roleReducer,r=t.roles,n=t.isLoading;return{roles:r.data,filters:r.filters,meta:r.pagination,isLoading:n}};const je=function(){var e,t,r,w,P=(0,i.useContext)(se.Z),j=P.orgAdmin,M=P.userAccessAdministrator,S=(0,i.useState)([]),_=(0,o.Z)(S,2),D=_[0],L=_[1],C=(0,l.Z)(),x=(0,c.useDispatch)(),I=(0,i.useRef)(null),B=(0,u.useHistory)(),F=(e=(0,i.useState)((function(){return ve()})),t=e[0],r=e[1],w=(0,i.useRef)(t),(0,i.useEffect)((function(){function e(){var e=ve();e!==w.current&&(w.current=e,r(e))}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),t),T=(0,c.useSelector)(Pe,c.shallowEqual),V=T.roles,N=T.filters,W=T.meta,z=T.isLoading,q=[{title:C.formatMessage(A.Z.name),key:"display_name",transforms:[(0,d.cellWidth)(20),d.sortable]},{title:C.formatMessage(A.Z.description)},{title:C.formatMessage(A.Z.permissions),transforms:[d.nowrap]},{title:C.formatMessage(A.Z.groups),transforms:[d.nowrap]},{title:C.formatMessage(A.Z.lastModified),key:"modified",transforms:[d.nowrap,d.sortable]}],G=function(e){return x((0,g.Kt)(Re(Re({},e),{},{inModal:!1})))},H=(0,i.useState)(Re(Re({},j?k.HE:k.he),W)),U=(0,o.Z)(H,2),Q=U[0],X=U[1],K=(0,i.useState)(N.display_name||""),J=(0,o.Z)(K,2),Y=J[0],$=J[1],ee=(0,i.useState)({index:0,direction:"asc"}),te=(0,o.Z)(ee,2),re=te[0],ne=te[1],ae="".concat("desc"===(null==re?void 0:re.direction)?"-":"").concat(q[null==re?void 0:re.index].key);(0,i.useEffect)((function(){var e=(0,k.rj)(B,Q);X(e);var t=(0,le.aX)(B,["display_name"],{display_name:Y}).display_name;$(t),insights.chrome.appNavClick({id:"roles",secondaryNav:!0}),G(Re(Re({},e),{},{orderBy:ae,filters:{display_name:t}}))}),[]),(0,i.useEffect)((function(){$(N.display_name),X(W)}),[N,W]),(0,i.useEffect)((function(){W.redirected&&(0,k.oG)(B,W.limit,W.offset)}),[W.redirected]),(0,i.useEffect)((function(){(0,k.Zc)(B)||(0,k.oG)(B,Q.limit,Q.offset),(null==Y?void 0:Y.length)>0&&!(0,le.qF)(B,["display_name"])&&(0,le.aX)(B,["display_name"],{display_name:Y})}));var oe=function(){return s().createElement(i.Suspense,{fallback:s().createElement(i.Fragment,null)},s().createElement(u.Route,{exact:!0,path:E.Z["add-role"].path},s().createElement(we,{pagination:Q,orderBy:ae,filters:{display_name:Y}})),s().createElement(u.Route,{exact:!0,path:E.Z["remove-role"].path},!z&&s().createElement(b.Z,{routeMatch:E.Z["remove-role"].path,afterSubmit:function(){L([]),G(Re(Re({},Q),{},{offset:0,orderBy:ae,filters:{display_name:Y}}))},cancelRoute:(0,m.zk)(E.Z.roles.path,Q,N),submitRoute:(0,m.zk)(E.Z.roles.path,Re(Re({},Q),{},{offset:0}),N)})),s().createElement(u.Route,{exact:!0,path:E.Z["edit-role"].path},!z&&s().createElement(O.Z,{afterSubmit:function(){return G(Re(Re({},Q),{},{offset:0,orderBy:ae,filters:{display_name:Y}}))},routeMatch:E.Z["edit-role"].path,cancelRoute:(0,m.zk)(E.Z.roles.path,Q,N),submitRoute:(0,m.zk)(E.Z.roles.path,Re(Re({},Q),{},{offset:0}),N)})))},ce=function(){return[{title:C.formatMessage(A.Z.edit),onClick:function(e,t,r){return B.push("/roles/edit/".concat(r.uuid))}},{title:C.formatMessage(A.Z.delete),onClick:function(e,t,r){return B.push("/roles/remove/".concat(r.uuid))}}]},ue=function(){return j||M?[s().createElement(u.Link,{to:E.Z["add-role"].path,key:"add-role",className:"rbac-m-hide-on-sm"},s().createElement(f.Button,{ouiaId:"create-role-button",variant:"primary","aria-label":"Create role"},C.formatMessage(A.Z.createRole)))].concat((0,n.Z)(function(e){return(null==ge?void 0:ge[e])<=ge.sm}(F)?[{label:C.formatMessage(A.Z.createRole),onClick:function(){B.push(E.Z["add-role"].path)}}]:[]),[{label:C.formatMessage(A.Z.edit),props:{isDisabled:!(1===D.length)},onClick:function(){return B.push("/roles/edit/".concat(D[0].uuid))}},{label:C.formatMessage(A.Z.delete),props:{isDisabled:!D.length>0},onClick:function(){B.push("/roles/remove/".concat(D.map((function(e){return e.uuid}))))}}]):[]},de=function(e){L((function(t){return e(t).filter((function(e){var t=e.platform_default,r=e.admin_default,n=e.system;return!(t||r||n)})).map((function(e){return{uuid:e.uuid,label:e.name}}))}))},fe=function(e,t){return e.reduce((function(e,r){var a,o=r.uuid,l=r.display_name,c=r.name,d=r.description,f=r.system,g=r.accessCount,v=r.groups_in_count,y=r.modified;return[].concat((0,n.Z)(e),[{uuid:o,system:f,disableSelection:!!f,selected:Boolean(null==t||null===(a=t.find)||void 0===a?void 0:a.call(t,(function(e){return e.uuid===o}))),cells:[s().createElement(i.Fragment,{key:"".concat(o,"-name")},s().createElement(u.Link,{to:"/roles/detail/".concat(o)},l||c)),d,s().createElement(i.Fragment,{key:"".concat(o,"-accessCount")},s().createElement(u.Link,{to:"/roles/detail/".concat(o)},g)),v,s().createElement(i.Fragment,{key:"".concat(o,"-modified")},s().createElement(p.Z,{date:y,type:(0,m.mh)(y)}))]}])}),[])}(V,D);return s().createElement(u.Switch,null,s().createElement(R.Z,{pageAction:"role-detail-permission",path:E.Z["role-detail-permission"].path},s().createElement(ie,null)),s().createElement(R.Z,{pageAction:"role-detail",path:E.Z["role-detail"].path},s().createElement(Z.Z,{onDelete:function(){return $("")}})),s().createElement(R.Z,{pageAction:"roles-list",path:E.Z.roles.path,render:function(){return s().createElement(f.Stack,{className:"rbac-c-roles"},s().createElement(f.StackItem,null,s().createElement(v.Q,null,s().createElement(v.y,{title:C.formatMessage(A.Z.roles)}))),s().createElement(f.StackItem,null,s().createElement(h.Z,{type:"content",id:"tab-roles"},s().createElement(y.M,{isSelectable:j||M,checkedRows:D,textFilterRef:I,setCheckedItems:de,actionResolver:ce,sortBy:re,columns:q,areActionsDisabled:function(e){return!!e.system},rowWrapper:Ee,rows:fe,data:V,filterValue:Y,fetchData:function(e){var t=e.name,r=e.count,n=e.limit,a=e.offset,o=e.orderBy;return(0,k.oG)(B,n,a),(0,le.MS)(B,{display_name:t}),G((0,m.jl)({count:r,limit:n,offset:a,orderBy:o,filters:{display_name:t}}))},setFilterValue:function(e){var t=e.name;return $(void 0===t?"":t)},isLoading:!z&&0===(null==V?void 0:V.length)&&0===(null==Y?void 0:Y.length)||z,pagination:Q,routes:oe,ouiaId:"roles-table",titlePlural:C.formatMessage(A.Z.roles).toLowerCase(),titleSingular:C.formatMessage(A.Z.role).toLowerCase(),toolbarButtons:ue,filterPlaceholder:C.formatMessage(A.Z.name).toLowerCase(),tableId:"roles",testRoles:!0,onSort:function(e,t,r){var n="".concat("desc"===r?"-":"").concat(q[t].key);ne({index:t,direction:r}),function(e){var t=e.name,r=e.count,n=e.limit,a=e.offset,o=e.orderBy;(0,k.oG)(B,n,a),(0,le.MS)(B,{display_name:t}),G((0,m.jl)({count:r,limit:n,offset:a,orderBy:o,filters:{display_name:t}}))}(Re(Re({},Q),{},{offset:0,orderBy:n},(null==N?void 0:N.length)>0?Re({},N.reduce((function(e,t){return Re(Re({},e),{},(0,a.Z)({},t.key,t.value))}),{})):{name:Y}))}}))))}}))}}}]);
//# sourceMappingURL=../sourcemaps/3563.b397142fd0f73bb3d9c656784923a5ed.js.map