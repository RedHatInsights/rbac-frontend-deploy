(self.webpackChunkinsights_rbac_frontend=self.webpackChunkinsights_rbac_frontend||[]).push([[480],{58434:(e,t,n)=>{(t=n(23645)(!1)).push([e.id,".pf-c-form .pf-c-form__group .pf-c-radio{padding-bottom:8px}.pf-c-form .pf-c-form__group .pf-c-radio:last-child{padding-bottom:0px}.pf-c-select__menu .ins-c-select__scrollable-section{max-height:365px;overflow:auto}.ins-c-rbac-add-permission-title{display:block}.pf-c-wizard__main-body .ins-c-rbac-seleted-chips{padding-bottom:var(--pf-global--spacer--md)}.pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group{background-color:var(--pf-global--BackgroundColor--100)}.pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip{background-color:var(--pf-global--palette--blue-50);border-radius:var(--pf-global--BorderRadius--lg)}.pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip .pf-c-chip__text{font-size:var(--pf-global--FontSize--sm)}.pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip::before{border-style:none}@media only screen and (max-width: 815px){.ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content{padding:0px}.ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:30em}}@media only screen and (max-width: 895px){.ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:32em}}@media only screen and (min-width: 992px){.ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content{padding:0px}.ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:25em}}@media only screen and (min-width: 1055px){.ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:32em}}@media only screen and (min-width: 1150px){.ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:35em}}.ins-c-rbac-cost-resource-select .pf-c-select__menu .pf-c-select__menu-item:nth-child(3) .pf-c-check__input{display:none}.ins-c-rbac-cost-resource-select .pf-c-select__menu .pf-c-select__menu-item:nth-child(3) .pf-c-check__label{color:var(--pf-global--link--Color)}.ins-c-rbac-disabled-row{background-color:var(--pf-global--disabled-color--300)}\n",""]),e.exports=t},85901:(e,t,n)=>{(t=n(23645)(!1)).push([e.id,".ins-c-rbac__sticky .ins-c-rbac__sticky--title{margin-bottom:var(--pf-global--spacer--sm);border-bottom:1px solid var(--pf-global--palette--black-300)}.ins-c-rbac__sticky .ins-c-rbac__sticky--title .pf-l-grid__item{font-weight:var(--pf-global--FontWeight--bold);margin-bottom:var(--pf-global--spacer--sm) !important}.ins-c-rbac__sticky .ins-c-rbac__sticky--data{max-height:240px;overflow:auto;-ms-overflow-style:none;scrollbar-width:none}.ins-c-rbac__sticky .data::-webkit-scrollbar{display:none}.ins-c-rbac__gutter-sm{margin-bottom:var(--pf-global--spacer--sm)}.ins-c-rbac__gutter-md{margin-bottom:var(--pf-global--spacer--md)}\n",""]),e.exports=t},59480:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AddRoleWizardContext:()=>Qe,default:()=>nt,mapperExtension:()=>et});var r=n(319),o=n.n(r),i=n(59713),a=n.n(i),c=n(63038),s=n.n(c),l=n(6479),u=n.n(l),p=n(67154),d=n.n(p),m=n(80150),f=n.n(m),b=n(45697),v=n.n(b),y=n(70983),h=n(71355),g=n(98917),E=n(81554),_=n(74837),x=n(77583),O=n(21899),w=n(26391),k=n(68340),S=n(68774),P=n(60485),j=n(47173),C=n(37377),R=n(58860),D=n(55795);function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}n(66765);var L=function(e){var t,n,r,i=e.formFields,a=(0,R.Z)(),c=(0,m.useState)(a.getState().values["add-permissions-table"]||[]),l=s()(c,2),u=l[0],p=l[1],d=(null===(t=a.getState().values)||void 0===t||null===(n=t["copy-base-role"])||void 0===n||null===(r=n.applications)||void 0===r?void 0:r.filter((function(e){return!(null==u?void 0:u.find((function(t){return t.uuid.includes(e)})))})))||[],b=i[0][0];return f().createElement(f().Fragment,null,u.length>0?f().createElement("div",{className:"ins-c-rbac-seleted-chips"},f().createElement(w.Z,{categoryName:"Selected permissions"},u.reduce((function(e,t){return[t].concat(o()(e))}),[]).map((function(e){var t=e.uuid;return f().createElement(O.A,{key:t,color:"blue",isTruncated:!0,onClick:function(){return p(u.filter((function(e){return e.uuid!==t})))}},t)})))):null,f().createElement(P.D,{headingLevel:"h1",size:"xl",className:"ins-c-rbac-add-permission-title"},"Add permissions"),f().createElement(S.D,null,f().createElement(k.x,null,"Select permissions to add to your role",0!==d.length&&f().createElement(C.J,{headerContent:"Custom roles only support granular permissions",bodyContent:"Wildcard permissions (for example, approval:*:*) aren’t included in this table and can’t be added to your custom role."},f().createElement(j.zx,{variant:"link"},"Why am I not seeing all of my permissions? ",f().createElement(D.ZP,null))))),[[F(F({},b),{},{props:F(F({},b.props),{},{selectedPermissions:u,setSelectedPermissions:p})})]])};L.propTypes={formFields:v().array};const N=L;var T=n(50008),z=n.n(T),Z=n(27361),A=n.n(Z),M=function(e){var t=e.nextStep,n=e.valid,r=e.handleNext,o=e.nextLabel,i=e.getState,a=e.handleSubmit,c=e.submitLabel;return f().createElement(j.zx,{variant:"primary",type:"button",isDisabled:!n||i().validating,onClick:function(){return t?r(function(e,t){var n,r;return(null===(n={string:e,function:e({values:t().values})})||void 0===n?void 0:n[z()(e)])||(null===(r=e.stepMapper)||void 0===r?void 0:r[A()(t().values,e.when)])}(t,i)):a()}},t?o:c)};M.propTypes={nextStep:v().oneOfType([v().string,v().func,v().object]),handleSubmit:v().func.isRequired,submitLabel:v().node.isRequired,valid:v().bool,handleNext:v().func.isRequired,nextLabel:v().node.isRequired,getState:v().func.isRequired};var W=function(e){var t=e.disableBack,n=e.handlePrev,r=e.nextStep,o=e.handleNext,i=e.buttonLabels,a=i.cancel,c=i.submit,s=i.back,l=i.next,u=(0,R.Z)(),p=(0,m.useContext)(Qe),b=p.success,v=p.error,y=p.submitting;return b||void 0===v||v||y?null:f().createElement(m.Fragment,null,f().createElement(M,d()({},u,{handleNext:o,nextStep:r,nextLabel:l,submitLabel:c})),f().createElement(j.zx,{type:"button",variant:"secondary",isDisabled:t,onClick:n},s),f().createElement(j.zx,{type:"button",variant:"link",onClick:u.onCancel},a))};W.propTypes={disableBack:v().bool,handlePrev:v().func.isRequired,handleNext:v().func.isRequired,nextStep:v().oneOfType([v().string,v().shape({when:v().string.isRequired,stepMapper:v().object.isRequired}),v().func]),buttonLabels:v().shape({submit:v().node.isRequired,cancel:v().node.isRequired,back:v().node.isRequired,next:v().node.isRequired}).isRequired};const B=W;var I=n(52643),Y=n(2372),V=n(87757),H=n.n(V),$=n(48926),K=n.n($),G=n(45139),J=n(39379),Q=function(){var e=K()(H().mark((function e(t){var n,r;return H().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.next=4,(0,G.vd)({limit:10,offset:0,name:t,nameMatch:"exact"}).catch((function(e){console.error(e)}));case 4:if(!((null==(r=e.sent)||null===(n=r.data)||void 0===n?void 0:n.length)>0)){e.next=7;break}throw"Name has already been taken";case 7:return e.abrupt("return",void 0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=(0,J.Z)(Q),X=function(e){var t=e.name,n=(0,R.Z)();return(0,m.useEffect)((function(){return setTimeout((function(){return n.change(t,"1")})),function(){return n.change(t,"")}}),[]),null},ee=(n(66963),n(9947)),te=n(38424),ne=n(75106),re=n(18004),oe=n(43047);const ie=function(){var e=(0,m.useContext)(re.Z).jumpToStep,t=(0,m.useContext)(Qe).setWizardError;return f().createElement(ee.u,{variant:ee.I.large},f().createElement(te.k,{color:"red",icon:oe.ZP}),f().createElement(P.D,{headingLevel:"h4",size:"lg"},"Role name already taken"),f().createElement(ne.B,null,"Please return to Step 1: Create role and choose a unique role name for your custom role."),f().createElement(j.zx,{onClick:function(){t(void 0),e(0)},variant:"primary"},"Return to Step 1"))};function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var se=function(e){var t,n=e.formFields,r=(0,m.useContext)(Qe),o=r.submitting,i=r.error,a=r.setWizardError,c=(0,R.Z)().getState;return(0,m.useEffect)((function(){a(void 0),Q(c().values["role-name"]).then((function(){return a(!1)})).catch((function(){return a(!0)}))}),[]),void 0===i||o?f().createElement(I.b,null,f().createElement(Y.$,{size:"xl"})):!0===i?f().createElement(ie,null):f().createElement(f().Fragment,null,f().createElement(P.D,{headingLevel:"h1",size:"xl",className:"ins-c-rbac__gutter-sm"},"Review details"),f().createElement(S.D,{className:"ins-c-rbac__gutter-md"},f().createElement(k.x,null,"Review and confirm the details for your role, or click Back to revise.")),[[ce({},null==n||null===(t=n[0])||void 0===t?void 0:t[0])]])};se.propTypes={formFields:v().array};const le=se;var ue=n(89531),pe=n(2485),de=n(35293),me=n(68778),fe=n(47194);const be=function(){var e=(0,m.useContext)(Qe).setHideForm;return f().createElement(ee.u,{variant:ee.I.large},f().createElement(te.k,{color:"green",icon:me.ZP}),f().createElement(P.D,{headingLevel:"h4",size:"lg"},"You have successfully created a new role"),f().createElement(ne.B,null),f().createElement(j.zx,{component:function(e){return f().createElement(fe.Link,d()({to:"/roles"},e))},variant:"primary"},"Exit"),f().createElement(de.i,null,f().createElement(j.zx,{onClick:function(){e(!1)},variant:"link"},"Create another role"),f().createElement(j.zx,{component:function(e){return f().createElement(fe.Link,d()({to:"/groups"},e))},variant:"link"},"Add role to group")))};var ve=n(92504),ye=n(43547),he=n(17721),ge=n(12830),Ee=n(8785),_e=n(12460),xe=["",{title:"Name",key:"display_name",transforms:[_e.sortable]},"Description"],Oe=function(e){var t=e.roleReducer,n=t.rolesForWizard,r=t.isLoading;return{roles:n.data,pagination:n.meta,isLoading:r}};var we=n(18573),ke=n.n(we),Se=n(55004),Pe=n(26701),je=n(35224),Ce=function(e){var t=e.row,n=u()(e,["row"]);return t.disableSelection?f().createElement(je.u,{content:f().createElement("div",null,"To add this permission to your role and define specific resources for it, at least one data source must be connected."," ",f().createElement("a",{href:"./settings/sources"},"Configure sources for Cost Management")),exitDelay:1500,entryDelay:1500},f().createElement(_e.RowWrapper,d()({className:"ins-c-rbac-disabled-row",row:t},n))):f().createElement(_e.RowWrapper,d()({row:t},n))};function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Ce.propTypes={props:v().object,row:v().object};var qe=["Application","Resource type","Operation"],Fe=function(e){var t=e.permissionReducer,n=t.permission,r=t.isLoading,o=t.options,i=o.application,a=o.operation,c=o.resource,s=t.expandSplats,l=t.isLoadingExpandSplats,u=e.roleReducer,p=u.isRecordLoading,d=u.selectedRole,m=e.costReducer.resourceTypes;return{permissions:n.data.map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.application,n=e.resource_type,r=e.verb,o=e.permission;return{application:t,resource:n,operation:r,uuid:o}})),pagination:n.meta,isLoading:r||p,baseRole:d,applicationOptions:i.data.filter((function(e){return"*"!==e})),resourceOptions:c.data.filter((function(e){return"*"!==e})),operationOptions:a.data.filter((function(e){return"*"!==e})),expandedPermissions:s.data.map((function(e){return e.permission})),isLoadingExpandSplats:l,resourceTypes:m.data}},Le=function(e){var t=e.selectedPermissions,n=e.setSelectedPermissions,r=u()(e,["selectedPermissions","setSelectedPermissions"]),i=(0,y.useDispatch)(),c=function(e){return i((0,Se.Hk)(e))},l=function(e){return i((0,Se.Qi)(e))},p=(0,y.useSelector)(Fe,y.shallowEqual),b=p.permissions,v=p.isLoading,h=p.pagination,g=p.baseRole,E=p.applicationOptions,_=p.resourceOptions,x=p.operationOptions,O=p.expandedPermissions,w=p.isLoadingExpandSplats,k=p.resourceTypes,S=(0,Ee.Z)(r).input,P=(0,R.Z)(),j=(0,m.useState)({applications:[],resources:[],operations:[]}),C=s()(j,2),D=C[0],q=C[1],F=P.getState().values["role-type"],L=(0,m.useState)(!1),N=s()(L,2),T=N[0],z=N[1],Z=(0,m.useState)(""),A=s()(Z,2),M=A[0],W=A[1],B=(0,m.useState)(),I=s()(B,2),Y=I[0],V=I[1],H=function(e){return k.find((function(t){var n;return t.value===(null===(n=e.split(":"))||void 0===n?void 0:n[1])}))},$=(0,m.useCallback)(ke()((function(e){var t=e.applications,n=e.resources,r=e.operations;return l({field:"application",limit:50,application:t.join(),resourceType:n.join(),verb:r.join()})}),3e3),[]),K=(0,m.useCallback)(ke()((function(e){var t=e.applications,n=e.resources,r=e.operations;return l({field:"resource_type",limit:50,application:t.join(),resourceType:n.join(),verb:r.join()})}),3e3),[]),G=(0,m.useCallback)(ke()((function(e){var t=e.applications,n=e.resources,r=e.operations;return l({field:"verb",limit:50,application:t.join(),resourceType:n.join(),verb:r.join()})}),3e3),[]);(0,m.useEffect)((function(){var e,t=null===(e=P.getState().values["copy-base-role"])||void 0===e?void 0:e.uuid;return"copy"===F&&t&&i((0,ue.fp)(t)),i((0,Pe.A)()),P.change("has-cost-resources",!1),c(h),l({field:"application",limit:50}),l({field:"resource_type",limit:50}),l({field:"verb",limit:50}),function(){return i((0,Se.AL)())}}),[]),(0,m.useEffect)((function(){K(D),G(D)}),[D.applications]),(0,m.useEffect)((function(){$(D),G(D)}),[D.resources]),(0,m.useEffect)((function(){$(D),K(D)}),[D.operations]),(0,m.useEffect)((function(){S.onChange(t)}),[t]),(0,m.useEffect)((function(){var e;if(!(!g||"copy"!==F||P.getState().values["base-permissions-loaded"]||t.length>0||(null===(e=P.getState().values["copy-base-role"])||void 0===e?void 0:e.uuid)!==(null==g?void 0:g.uuid)||w||v)){var r=(null==g?void 0:g.access)||[];if(0===O.length&&void 0===w){var a=o()(new Set(r.map((function(e){return e.permission.split(":")[0]}))));i((0,Se.tL)({application:a.join()}))}else{var c=r.map((function(e){return e.permission.replace("*",".*")}));n((function(){return O.filter((function(e){return"cost-management"!==e.split(":")[0]||0!==(H(e)||{count:0}).count})).filter((function(e){return c.some((function(t){return e.match(t)}))})).map((function(e){return{uuid:e}}))})),P.change("base-permissions-loaded",!0)}}}),[b,g]);var J=function(e){return e.reduce((function(e,t){return{0:De(De({},null==e?void 0:e[0]),{},a()({},t,!0))}}),{0:{}})},Q={applications:o()(E).filter((function(e){return e.includes(M)})).map((function(e){return{label:e,value:e}})),resources:o()(_).filter((function(e){return e.includes(M)})).map((function(e){return{label:e,value:e}})),operations:o()(x).filter((function(e){return e.includes(M)})).map((function(e){return{label:e,value:e}}))},U={label:f().createElement("div",null," No results found"),isDisabled:!0},X=Q[Object.keys(Q)[Y||0]].length>10;return f().createElement("div",{className:"ins-c-rbac-permissions-table"},f().createElement(he.M,d()({columns:qe,isSelectable:!0,isCompact:!0,borders:!1,createRows:function(e){return e.map((function(e){var n=e.application,r=e.resource,o=e.operation,i=e.uuid;return{uuid:"".concat(n,":").concat(r,":").concat(o),cells:[{title:n},r,o],selected:Boolean(t&&t.find((function(e){return e.uuid===i}))),disableSelection:"cost-management"===n&&0===(H(i)||{count:0}).count}}))},data:b,filterValue:"",noData:0===(null==b?void 0:b.length),noDataDescription:["Adjust your filters and try again. Note: Applications that only have wildcard           permissions (for example, patch:*:*) aren’t included in this table and can’t be           added to your custom role."],fetchData:function(e){var t=e.limit,n=e.offset,r=e.applications,o=e.resources,i=e.operations;c({limit:t,offset:n,application:(r||D.applications).join(),resourceType:(o||D.resources).join(),verb:(i||D.operations).join()})},setFilterValue:function(e){var t=e.applications,n=e.resources,r=e.operations;q(De(De(De(De({},D),t?{applications:t}:D.applications),n?{resources:n}:D.resources),r?{operations:r}:D.operations))},isLoading:v||w,pagination:De(De({},h),{},{count:h.count}),checkedRows:t,setCheckedItems:function(e){n(e(t).map((function(e){return{uuid:e.uuid}})))},titlePlural:"permissions",titleSingular:"permission",showMoreTitle:T?"See less":"See more",onFilter:function(e){return W(e)},onShowMore:X?function(){z((function(){return!T}))}:void 0,onChange:function(e,t){W(""),V(t)},value:Y,filters:[{key:"applications",value:D.applications,placeholder:"Filter by application",type:"group",selected:J(D.applications),groups:[{type:Q.applications.length>0?"checkbox":"plain",items:Q.applications.length>0?o()(Q.applications).slice(0,T?void 0:10):[U]}]},{key:"resources",value:D.resources,placeholder:"Filter by resource type",type:"group",selected:J(D.resources),groups:[{type:Q.resources.length>0?"checkbox":"plain",items:Q.resources.length>0?o()(Q.resources).slice(0,T?void 0:10):[U]}]},{key:"operations",value:D.operations,placeholder:"Filter by operation",type:"group",selected:J(D.operations),groups:[{type:Q.operations.length>0?"checkbox":"plain",items:Q.operations.length>0?o()(Q.operations).slice(0,T?void 0:10):[U]}]}],isFilterable:!0,rowWrapper:Ce},r)))};Le.propTypes={selectedPermissions:v().array,setSelectedPermissions:v().func};const Ne=Le;var Te=n(49739),ze=n(83826),Ze=n(50693),Ae=n(16475),Me=function(e,t){return f().createElement("div",{className:"ins-c-rbac__sticky"},f().createElement(Ze.r,{className:"ins-c-rbac__sticky--title"},e.map((function(t){return f().createElement(Ae.P,{span:12/e.length,key:t},t)}))),f().createElement(Ze.r,{className:"ins-c-rbac__sticky--data"},t.map((function(t){return t.cells.map((function(t){return f().createElement(Ae.P,{span:12/e.length,key:t},t)}))}))))};var We=n(2644),Be=n(92694),Ie=n(64403),Ye=n(59775);function Ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function He(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $e=function(e){var t=e.costReducer,n=t.resourceTypes,r=t.isLoading,o=t.loadingResources,i=t.resources;return{resourceTypes:n.data,resources:i,isLoading:r,isLoadingResources:o>0}},Ke=function(e,t){var n=e[t.key];switch(t.type){case"toggle":return He(He({},e),{},a()({},t.key,He(He({},n),{},{isOpen:!n.isOpen})));case"select":return He(He({},e),{},a()({},t.key,He(He({},n),{},{selected:n.selected.includes(t.selection)?n.selected.filter((function(e){return e!==t.selection})):[].concat(o()(n.selected),[t.selection])})));case"selectAll":return He(He({},e),{},a()({},t.key,He(He({},n),{},{selected:n.options.map((function(e){return e.value}))})));case"clear":return He(He({},e),{},a()({},t.key,He(He({},n),{},{selected:[]})));case"setOptions":return He(He({},e),{},a()({},t.key,He(He({},n),{},{options:t.options,filteredOptions:t.options})));case"setFilter":return He(He({},e),{},a()({},t.key,He(He({},n),{},{filteredOptions:n.options.filter((function(e){return e.value.includes(t.filtervalue)}))})));default:return e}};function Ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qe=(0,m.createContext)({success:!1,submitting:!1,error:void 0}),Ue=function(e){return f().createElement(E.ZP,d()({},e,{showFormControls:!1}))},Xe=function(e){var t=e.Content,n=u()(e,["Content"]);return f().createElement(t,n)};Xe.propTypes={Content:v().elementType.isRequired};var et={"base-role-table":function(e){var t=(0,y.useDispatch)(),n=function(e){return t((0,ue.hs)(e))},r=(0,m.useState)(""),o=s()(r,2),i=o[0],a=o[1],c=(0,y.useSelector)(Oe,y.shallowEqual),l=c.roles,u=c.pagination,p=(0,Ee.Z)(e).input,d=(0,R.Z)();return(0,m.useEffect)((function(){n({limit:50,offset:0,itemCount:0,orderBy:"display_name"})}),[]),f().createElement("div",null,f().createElement(ye.b,{variant:"info",isInline:!0,title:"Only granular permissions will be copied into a custom role         (for example, approval:requests:read). Wildcard permissions will not         be copied into a custom role (for example, approval:*:read).\n        "}),f().createElement(he.M,{columns:xe,createRows:function(e){return e.map((function(e){return{cells:[{title:f().createElement(ve.Y,{id:"".concat(e.uuid,"-radio"),name:"".concat(e.name,"-radio"),"aria-label":"".concat(e.name,"-radio"),ouiaId:"".concat(e.name,"-radio"),value:e.uuid,isChecked:p.value.uuid===e.uuid,onChange:function(){d.batch((function(){p.onChange(e),d.change("role-copy-name","Copy of ".concat(e.display_name||e.name)),d.change("role-copy-description",e.description),d.change("add-permissions-table",[]),d.change("base-permissions-loaded",!1)}))}}),props:{className:"pf-c-table__check"}},e.display_name||e.name,e.description]}}))},data:l,fetchData:function(e){return n((0,ge.jl)(e))},filterValue:i,setFilterValue:function(e){var t=e.name;return a(t)},isLoading:!1,pagination:u,titlePlural:"roles",titleSingular:"role",filterPlaceholder:"role name",ouiaId:"roles-table",isCompact:!0}))},"add-permissions-table":Ne,"cost-resources":function(e){var t=(0,y.useDispatch)(),n=(0,y.useSelector)($e,y.shallowEqual),r=n.resourceTypes,i=n.isLoading,c=n.isLoadingResources,l=n.resources,u=(0,Ee.Z)(e).input,p=(0,R.Z)(),d=p.getState().values["add-permissions-table"].filter((function(e){return e.uuid.split(":")[0].includes("cost-management")})),b=(0,m.useReducer)(Ke,d.reduce((function(e,t){return He(He({},e),{},a()({},t.uuid,{selected:[],options:[],filteredOptions:[],isOpen:!1}))}),{})),v=s()(b,2),h=v[0],g=v[1];return(0,m.useEffect)((function(){(p.getState().values["resource-definitions"]||[]).map((function(e){var t=e.permission;return e.resources.map((function(e){return d.includes(t)&&g({type:"select",selection:e,key:t})}))})),t((0,Pe.A)(undefined)),p.change("has-cost-resources",!0)}),[]),(0,m.useEffect)((function(){i||o()(new Set(d.map((function(e){var t;return null===(t=r.find((function(t){var n;return t.value===(null===(n=e.uuid.split(":"))||void 0===n?void 0:n[1])})))||void 0===t?void 0:t.path})))).filter((function(e){return e})).map((function(e){return n=e,t((0,Pe.R)(n));var n}))}),[r]),(0,m.useEffect)((function(){c||d.map((function(e){return g({type:"setOptions",key:e.uuid,options:l[(t=e.uuid,null===(n=r.find((function(e){var n;return e.value===(null===(n=t.split(":"))||void 0===n?void 0:n[1])})))||void 0===n||null===(o=n.path.split("/"))||void 0===o?void 0:o[5])]||[]});var t,n,o}))}),[c]),(0,m.useEffect)((function(){var e=Object.entries(h).map((function(e){var t=s()(e,2);return{permission:t[0],resources:t[1].selected}}));u.onChange(e),p.change("resource-definitions",e)}),[h]),f().createElement(Ze.r,{hasGutter:!0},f().createElement(Ae.P,{md:4,className:"ins-m-hide-on-sm"},f().createElement(k.x,{component:k.q.h4,className:"ins-c-rbac__bold-text"},"Cost management permissions")),f().createElement(Ae.P,{md:8,className:"ins-m-hide-on-sm"},f().createElement(k.x,{component:k.q.h4,className:"ins-c-rbac__bold-text"},"Resource definitions")),d.map((function(e){var t=e.uuid,n=h[t].filteredOptions;return f().createElement(f().Fragment,null,f().createElement(Ae.P,{md:4,sm:12},f().createElement(Ye.c,{label:t,isRequired:!0})),f().createElement(Ae.P,{md:8,sm:12},f().createElement(We.P,{className:"ins-c-rbac-cost-resource-select",variant:Ie.TM.checkbox,typeAheadAriaLabel:"Select a state",onToggle:function(e){g({type:"setFilter",key:t,filtervalue:""}),function(e,t){g({type:"toggle",key:e,isOpen:t})}(t,e)},onSelect:function(e,r){!function(e,t,n,r){g(n?{type:"selectAll",selection:t,key:r}:{type:"select",selection:t,key:r})}(0,r,r==="Select All (".concat(n.length,")"),t)},onClear:function(){return g({type:"clear",key:t})},selections:h[t].selected,isOpen:h[t].isOpen,onFilter:function(e){return g({type:"setFilter",key:t,filtervalue:e.target.value})},"aria-labelledby":t,placeholderText:"Select resources",hasInlineFilter:!0},[f().createElement(Be.$,{key:0,value:"Select All (".concat(n.length,")")})].concat(o()(n.map((function(e,t){return f().createElement(Be.$,{key:t+1,value:e.value})})))))))})))},review:function(){var e=(0,R.Z)().getState().values,t=e["role-name"],n=e["role-description"],r=e["role-copy-name"],o=e["role-copy-description"],i=e["add-permissions-table"],a=e["resource-definitions"],c=e["has-cost-resources"],s=e["role-type"],l=i.map((function(e){return{cells:e.uuid.split(":")}})),u=(a||[]).map((function(e){return{cells:[e.permission,e.resources.join(", ")]}}));return f().createElement(f().Fragment,null,f().createElement(Te.K,null,f().createElement(ze.v,{className:"ins-c-rbac__summary"},f().createElement(Ze.r,null,f().createElement(Ae.P,{sm:12,md:2},f().createElement(k.x,{component:k.q.h4,className:"ins-c-rbac__bold-text"},"Name")),f().createElement(Ae.P,{sm:12,md:10},f().createElement(k.x,{component:k.q.p},"create"===s?t:r))),f().createElement(Ze.r,null,f().createElement(Ae.P,{sm:12,md:2},f().createElement(k.x,{component:k.q.h4,className:"ins-c-rbac__bold-text"},"Description")),f().createElement(Ae.P,{sm:12,md:10},f().createElement(k.x,{component:k.q.p},"create"===s?n:o))),f().createElement(Ze.r,null,f().createElement(Ae.P,{sm:12,md:2},f().createElement(k.x,{component:k.q.h4,className:"ins-c-rbac__bold-text"},"Permissions")),f().createElement(Ae.P,{sm:12,md:10},Me(["Application","Resource type","Operation"],l))),c&&f().createElement(Ze.r,null,f().createElement(Ae.P,{sm:12,md:2},f().createElement(k.x,{component:k.q.h4,className:"ins-c-rbac__bold-text"},"Resource definitions")),f().createElement(Ae.P,{sm:12,md:10},Me(["Permission","Resource definitions"],u))))))},description:Xe,"type-selector":function(e){var t=(0,Ee.Z)(e).input,n=(0,R.Z)(),r=(0,m.useState)(n.getState().values["role-type"]),o=s()(r,2),i=o[0],a=o[1],c=function(e){a(e),t.onChange(e),n.change("add-permissions-table",[]),n.change("base-permissions-loaded",!1)};return f().createElement("div",null,f().createElement(ve.Y,{isChecked:"create"===i,name:"role-type-create",onChange:function(){return c("create")},label:"Create a role from scratch",id:"role-type-create",value:"create"}),f().createElement(ve.Y,{isChecked:"copy"===i,name:"role-type-copy",onChange:function(){return c("copy")},label:"Copy an existing role",id:"role-type-copy",value:"copy"}))}},tt=function(e){var t=e.history.push,n=(0,y.useDispatch)(),r=(0,m.useState)({success:!1,submitting:!1,error:void 0,hideForm:!1}),i=s()(r,2),a=i[0],c=i[1],l=(0,m.useState)(!1),u=s()(l,2),p=u[0],d=u[1],b=(0,m.useRef)(document.createElement("div")),v=(0,m.useState)({}),E=s()(v,2),O=E[0],w=E[1];(0,m.useEffect)((function(){w(function(e){return{fields:[{component:"wizard",name:"wizzard",isDynamic:!0,inModal:!0,showTitles:!0,title:"Create role",container:e,fields:[{title:"Create role",name:"step-1",nextStep:{when:"role-type",stepMapper:{copy:"name-and-description",create:"add-permissions"}},fields:[{component:"type-selector",name:"role-type",isRequired:!0,validate:[{type:"required"}]},{component:"text-field",name:"role-name",type:"text",label:"Role name",isRequired:!0,condition:{when:"role-type",is:"create"},validate:[U,{type:"required"},{type:"max-length",threshold:150}]},{component:"text-field",name:"role-description",type:"text",label:"Role description",condition:{when:"role-type",is:"create"}},{component:"base-role-table",name:"copy-base-role",label:"Base role",isRequired:!0,condition:{when:"role-type",is:"copy"},validate:[{type:"required"}]},{condition:{when:"role-type",is:"create"},component:"description",name:"fixasyncvalidation",Content:X},{condition:{when:"role-type",is:"copy"},component:"description",name:"fixasyncvalidation2",Content:X}]},{title:"Name and description",name:"name-and-description",nextStep:"add-permissions",fields:[{component:"text-field",name:"role-copy-name",type:"text",label:"Role name",isRequired:!0,validate:[U,{type:"required"},{type:"max-length",threshold:150}]},{component:"text-field",name:"role-copy-description",type:"text",label:"Role description"}]},{name:"add-permissions",title:"Add permissions",StepTemplate:N,nextStep:function(e){var t=e.values;return t&&t["add-permissions-table"]&&t["add-permissions-table"].some((function(e){return e.uuid.split(":")[0].includes("cost-management")}))?"cost-resources-definition":"review"},fields:[{component:"add-permissions-table",name:"add-permissions-table"}]},{name:"cost-resources-definition",title:"Define Cost Management resources",nextStep:"review",fields:[{component:"plain-text",name:"text-description",label:f().createElement("p",null,"Specify where you would like to apply each cost permission selected in the previous step, using the dropdown below.")},{component:"cost-resources",name:"cost-resources",validate:[function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).every((function(e){return e.resources.length>0}))?void 0:"You need to assign at least one resource to each permission."}]}]},{name:"review",title:"Review details",buttons:B,StepTemplate:le,fields:[{component:"review",name:"review"}]}]}]}}(b.current))}),[]),(0,m.useEffect)((function(){b.current.hidden=p}),[p]);var k=function(){a.success||n((0,h.wN)({variant:"warning",title:"Creating role was canceled by the user",dismissDelay:8e3,dismissable:!1})),t("/roles")};return f().createElement(Qe.Provider,{value:Je(Je({},a),{},{setWizardError:function(e){return c((function(t){return Je(Je({},t),{},{error:e})}))},setWizardSuccess:function(e){return c((function(t){return Je(Je({},t),{},{success:e})}))},setHideForm:function(e){return c((function(t){return Je(Je({},t),{},{hideForm:e})}))}})},f().createElement(pe.R,{type:"role",isOpen:p,onModalCancel:function(){return d(!1)},onConfirmCancel:k}),a.hideForm?f().createElement(x.e,{title:"Create role",isOpen:!0,onClose:function(){return t("/roles")},steps:[{name:"success",component:f().createElement(be,null),isFinishedStep:!0}]}):f().createElement(g.Z,{schema:O,container:b,subscription:{values:!0},FormTemplate:Ue,componentMapper:Je(Je({},_.ZP),et),onSubmit:function(e){var t=e["role-name"],r=e["role-description"],i=e["role-copy-name"],a=e["role-copy-description"],s=e["add-permissions-table"],l=e["cost-resources"],u=e["role-type"];c((function(e){return Je(Je({},e),{},{submitting:!0})}));var p={applications:o()(new Set(s.map((function(e){return e.uuid.split(":")[0]})))),description:("create"===u?r:a)||null,name:"create"===u?t:i,access:s.map((function(e){var t=e.uuid;return{permission:t,resourceDefinitions:(null==l?void 0:l.find((function(e){return e.permission===t})))?[{attributeFilter:{key:"cost-management.".concat(t.split(":")[1]),operation:"in",value:null==l?void 0:l.find((function(e){return e.permission===t})).resources}}]:[]}}))};return n((0,ue.fA)(p)).then((function(){c((function(e){return Je(Je({},e),{},{submitting:!1,success:!0,hideForm:!0})})),n((0,ue.Kt)())}))},onCancel:function(e){Boolean(e&&e["role-name"]||e["role-description"]||e["copy-base-role"])?d(!0):k()}}))};tt.propTypes={history:v().shape({push:v().func.isRequired}).isRequired};const nt=tt},66765:(e,t,n)=>{var r=n(93379),o=n(58434);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.id,o,""]]);var i=r(o,{insert:"head",singleton:!1});if(!o.locals||e.hot.invalidate){var a=o.locals;e.hot.accept(58434,(function(){"string"==typeof(o=(o=n(58434)).__esModule?o.default:o)&&(o=[[e.id,o,""]]),function(e,t){if(!e&&t||e&&!t)return!1;var n;for(n in e)if(e[n]!==t[n])return!1;for(n in t)if(!e[n])return!1;return!0}(a,o.locals)?(a=o.locals,i(o)):e.hot.invalidate()}))}e.hot.dispose((function(){i()})),e.exports=o.locals||{}},66963:(e,t,n)=>{var r=n(93379),o=n(85901);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.id,o,""]]);var i=r(o,{insert:"head",singleton:!1});if(!o.locals||e.hot.invalidate){var a=o.locals;e.hot.accept(85901,(function(){"string"==typeof(o=(o=n(85901)).__esModule?o.default:o)&&(o=[[e.id,o,""]]),function(e,t){if(!e&&t||e&&!t)return!1;var n;for(n in e)if(e[n]!==t[n])return!1;for(n in t)if(!e[n])return!1;return!0}(a,o.locals)?(a=o.locals,i(o)):e.hot.invalidate()}))}e.hot.dispose((function(){i()})),e.exports=o.locals||{}}}]);
//# sourceMappingURL=480.cb194b4ebd999140718c.js.map