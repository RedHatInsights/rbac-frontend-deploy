"use strict";(self.webpackChunkinsights_rbac_frontend=self.webpackChunkinsights_rbac_frontend||[]).push([[514],{61514:(e,t,r)=>{r.r(t),r.d(t,{default:()=>me});var n=r(93433),o=r(29439),i=r(4942),a=r(92950),l=r.n(a),s=r(28216),c=r(334),u=r(6877),d=r(58788),f=r(64107),p=r(11107),m=function(e){return e.reduce((function(e,t){var r=t.uuid,o=t.display_name,i=t.name,s=t.description,u=t.system,d=t.accessCount,m=t.groups_in_count,b=t.modified;return[].concat((0,n.Z)(e),[{uuid:r,system:u,cells:[l().createElement(a.Fragment,{key:"".concat(r,"-name")},l().createElement(c.Link,{to:"/roles/detail/".concat(r)},o||i)),s,l().createElement(a.Fragment,{key:"".concat(r,"-accessCount")},l().createElement(c.Link,{to:"/roles/detail/".concat(r)},d)),m,l().createElement(a.Fragment,{key:"".concat(r,"-modified")},l().createElement(f.Z,{date:b,type:(0,p.mh)(b)}))]}])}),[])},b=r(28090),y=r(38376),g=r(41800),v=r(13063),h=r(54213),E=r(15608),O=r(4682),R=r(88040),Z=r(93327),P=function(e){return e.reduce((function(e,t){return[].concat((0,n.Z)(e),[{cells:[t]}])}),[])},j=r(39173),w=r(19571),k=r(61338),S=r(87462),_=r(45697),D=r.n(_),L=r(96354),C=r(36457),F=r(29215),M=r(76349),T=r(73943),I=r(45987),V=r(40483),A=r(48880),x=["ModalProps"];function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var B=function(e){var t=e.ModalProps,r=(0,I.Z)(e,x),n=(0,A.default)().getState().values;return l().createElement(V.Z,(0,S.Z)({},r,{ModalProps:q(q({},t),{},{onClose:function(){return t.onClose(n)}}),alert:n["dual-list-select"]?void 0:function(){return l().createElement("div",{className:"rbac-m-resource-definitions"},l().createElement(d.Alert,{className:"pf-c-modal__alert",variant:"danger",isInline:!0,title:"At least one resource must be defined for this permission"}))}}))};B.propTypes={ModalProps:D().object};const z=B;var W=r(42348),G=r.n(W);function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var X={changedResources:void 0,cancelWarningVisible:!1,resourcesPath:void 0,loadingStateVisible:!0};function K(e,t){if("update"===t.type)return Q(Q({},e),t.payload);throw new Error}var U=function(e,t,r){return{fields:[{component:L.Z.DUAL_LIST_SELECT,name:"dual-list-select",leftTitle:"Resources available for the permission",rightTitle:"Resources defined for the permission",filterOptionsTitle:"Filter by resource...",filterValueTitle:"Filter by resource...",options:(0,n.Z)(t&&e?r:[]),validate:[{type:"validate-resources"}]}]}},J={"validate-resources":function(){return function(e){return e&&e.length>0?void 0:"At least one resource must be defined for this permission"}}},Y=function(e){var t=e.cancelRoute,r=(0,c.useRouteMatch)(O.Z["role-detail-permission-edit"]),i=(0,c.useRouteMatch)(r).params,u=i.permissionId,f=i.roleId,p=(0,c.useHistory)(),m=p.replace,y=p.push,g=(0,s.useDispatch)(),v=(0,a.useReducer)(K,X),h=(0,o.Z)(v,2),E=h[0],R=h[1],Z=(0,s.useSelector)((function(e){var t;return{role:e.roleReducer.selectedRole,definedResources:null!==(t=e.roleReducer.selectedRole)&&void 0!==t&&t.access?G()(e.roleReducer.selectedRole.access.filter((function(e){return e.permission===u})).map((function(e){return e.resourceDefinitions.map((function(e){return e.attributeFilter.value}))}))):[],isRecordLoading:e.roleReducer.isRecordLoading}}),s.shallowEqual),P=Z.definedResources,j=Z.role,w=(0,s.useSelector)((function(e){return function(e,t){var r=e.costReducer,n=r.resourceTypes,o=r.isLoading,i=r.loadingResources,a=r.resources;return{resourceTypes:n.data,resources:a[t]?{resourcesPath:a[t]}:a,isLoading:o,isLoadingResources:i>0}}(e,E.resourcesPath)}),s.shallowEqual),k=w.resourceTypes,_=w.isLoading,D=w.isLoadingResources,L=w.resources;(0,a.useEffect)((function(){g((0,F.A)())}),[u]),(0,a.useEffect)((function(){if(!_){var e,t=null===(e=k.find((function(e){var t;return e.value===(null===(t=u.split(":"))||void 0===t?void 0:t[1])})))||void 0===e?void 0:e.path;t&&(R({type:"update",payload:{resourcesPath:t.split("/")[5]}}),g((0,F.R)(t)))}}),[k]);var I=function(){return m(t)},V=function(e){e["dual-list-select"]===P?I():R({type:"update",payload:{changedResources:e["dual-list-select"],cancelWarningVisible:!0}})},A=function(e){return Object.entries(e).reduce((function(e,t){var r=(0,o.Z)(t,2),i=r[0],a=r[1];return[].concat((0,n.Z)(e),(0,n.Z)(a.map((function(e){return{value:e.value,path:i,label:e.value}}))))}),[])}(L);return l().createElement(l().Fragment,null,l().createElement(T.R,{customTitle:"Exit edit resource definitions?",customDescription:"All changes will be lost.",isOpen:E.cancelWarningVisible,onModalCancel:function(){return R({type:"update",payload:{cancelWarningVisible:!1}})},onConfirmCancel:I}),(_||D)&&E.loadingStateVisible?l().createElement(d.Modal,{className:"rbac-m-resource-definitions",isOpen:!0,title:"Edit resource definitions",onClose:function(){R({type:"update",payload:{loadingStateVisible:!1}}),I()}},l().createElement(d.Spinner,null)):l().createElement(C.Z,{schema:U(L,E.resourcesPath,A),componentMapper:M.ZP,initialValues:{"dual-list-select":E.changedResources||P||[]},onSubmit:function(e){var r;R({type:"update",payload:{changedResources:e["dual-list-select"]}});var o={permission:u,resourceDefinitions:[{attributeFilter:{key:"cost-management.".concat(null===(r=u.split(":"))||void 0===r?void 0:r[1]),operation:1===e["dual-list-select"].length?"equal":"in",value:1===e["dual-list-select"].length?e["dual-list-select"][0]:e["dual-list-select"]}}]};g((0,b.ul)(f,Q(Q({},j),{},{access:[].concat((0,n.Z)(j.access.filter((function(e){return e.permission!==u}))),[o])})),!0).then((function(){g((0,b.fp)(f)),y(t)}))},onCancel:function(e){return V(e)},validatorMapper:J,FormTemplate:function(e){return l().createElement(z,(0,S.Z)({},e,{ModalProps:{onClose:V,isOpen:!E.cancelWarningVisible,variant:"large",title:"Edit resource definitions",description:"Give or remove permissions to specific resources using the arrows below."}}))}}))};Y.propTypes={cancelRoute:D().string.isRequired};const $=Y;var ee=r(85564),te=r.n(ee);function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const oe=function(){var e=(0,a.useState)({pagination:ne(ne({},k.he),{},{filter:""})}),t=(0,o.Z)(e,2),r=t[0],n=t[1],i=r.pagination,u=r.filter,f=(0,s.useDispatch)(),m=(0,c.useParams)(),v=m.roleId,h=m.permissionId,E=(0,s.useSelector)((function(e){var t,r,n,o,i;return{role:e.roleReducer.selectedRole,permission:e.roleReducer.selectedRole.access?ne({},null===(t=e.roleReducer.selectedRole)||void 0===t?void 0:t.access.find((function(e){return e.permission===h}))):{},isRecordLoading:e.roleReducer.isRecordLoading,rolesPagination:(null===(r=e.roleReducer)||void 0===r||null===(n=r.roles)||void 0===n?void 0:n.pagination)||k.he,rolesFilters:(null===(o=e.roleReducer)||void 0===o||null===(i=o.roles)||void 0===i?void 0:i.filters)||{}}}),s.shallowEqual),R=E.role,Z=E.permission,S=E.isRecordLoading,_=E.rolesPagination,D=E.rolesFilters;(0,a.useEffect)((function(){f((0,b.fp)(v))}),[v]),(0,a.useEffect)((function(){n(ne(ne({},r),{},{pagination:ne(ne({},r.pagination),{},{count:R.access?R.access.length:0})}))}),[R]);var L=Z.resourceDefinitions?te()(Z.resourceDefinitions.map((function(e){return e.attributeFilter.value}))).filter((function(e){return!u||e.includes(u)})):[],C=function(){return l().createElement(a.Fragment,null,l().createElement(c.Route,{exact:!0,path:O.Z["role-detail-permission-edit"]},l().createElement($,{cancelRoute:O.Z["role-detail-permission"].replace(":roleId",v).replace(":permissionId",h)})))};return l().createElement(a.Fragment,null,l().createElement(y.Q,{breadcrumbs:[{title:"Roles",to:(0,p.zk)(C.roles,_,D)},{title:S?void 0:R&&(R.display_name||R.name),to:"/roles/detail/".concat(v)},{title:h,isActive:!0}]},l().createElement(d.Level,null,l().createElement(d.LevelItem,null,l().createElement(j.Z,{title:h||l().createElement(w.h2,null),className:"rbac-page-header__title"})))),l().createElement("section",{className:"pf-c-page__main-section rbac-c-role__permissions"},l().createElement(d.TextContent,null,l().createElement(d.Text,{component:d.TextVariants.h1},"Defined resources")),l().createElement(g.M,{columns:[{}],createRows:P,data:L.slice(i.offset,i.offset+i.limit),filterValue:u,fetchData:function(e){var t=e.limit,o=e.offset,i=e.name;return n(ne(ne({},r),{},{filter:i,pagination:ne(ne({},r.pagination),{},{limit:t,offset:o})}))},isCompact:!0,routes:C,setFilterValue:function(e){var t=e.name;return n(ne(ne({},r),{},{filter:t}))},toolbarButtons:function(){return R.system?[]:[l().createElement(a.Fragment,{key:"edit-resource-definitions"},l().createElement(c.Link,{to:"/roles/detail/".concat(v,"/permission/").concat(h,"/edit")},l().createElement(d.Button,{variant:"primary","aria-label":"Edit"},"Edit")))]},isLoading:S,pagination:ne(ne({},i),{},{count:L.length}),titlePlural:"resources",titleSingular:"resource",hideHeader:!0,tableId:"role-resource-definitions"})))};var ie=r(92758),ae=r(78596),le=r(11549),se=r(26794);function ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ce(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var de=(0,a.lazy)((function(){return Promise.all([r.e(705),r.e(607)]).then(r.bind(r,68607))})),fe=[{title:"Name",key:"display_name",transforms:[(0,u.cellWidth)(20),u.sortable]},{title:"Description"},{title:"Permissions",transforms:[u.nowrap]},{title:"Groups",transforms:[u.nowrap]},{title:"Last modified",key:"modified",transforms:[u.nowrap,u.sortable]}],pe=function(e){var t=e.roleReducer,r=t.roles,n=t.isLoading;return{roles:r.data,filters:r.filters,meta:r.pagination,isLoading:n}};const me=function(){var e=(0,s.useDispatch)(),t=(0,c.useHistory)().push,r=(0,s.useSelector)(pe,s.shallowEqual),i=r.roles,u=r.isLoading,f=r.filters,P=r.meta,j=function(t){return e((0,b.Kt)(ue(ue({},t),{},{inModal:!1})))},w=(0,c.useHistory)(),S=(0,a.useContext)(se.Z),_=S.userAccessAdministrator,D=S.orgAdmin,L=(0,a.useState)(P),C=(0,o.Z)(L,2),F=C[0],M=C[1],T=(0,a.useState)(f.display_name||""),I=(0,o.Z)(T,2),V=I[0],A=I[1],x=(0,ae.Z)();(0,a.useEffect)((function(){var e=(0,k.rj)(w,F);M(e);var t=(0,ie.aX)(w,["display_name"],{display_name:V}).display_name;A(t),insights.chrome.appNavClick({id:"roles",secondaryNav:!0}),j(ue(ue({},e),{},{filters:{display_name:t}}))}),[]),(0,a.useEffect)((function(){A(f.display_name),M(P)}),[f,P]),(0,a.useEffect)((function(){P.redirected&&(0,k.oG)(w,P.limit,P.offset)}),[P.redirected]),(0,a.useEffect)((function(){(0,k.Zc)(w)||(0,k.oG)(w,F.limit,F.offset),(null==V?void 0:V.length)>0&&!(0,ie.qF)(w,["display_name"])&&(0,ie.aX)(w,["display_name"],{display_name:V})}));var N=function(){return l().createElement(a.Suspense,{fallback:l().createElement(a.Fragment,null)},l().createElement(c.Route,{exact:!0,path:O.Z["add-role"]},l().createElement(de,{pagination:F,filters:{display_name:V}})),l().createElement(c.Route,{exact:!0,path:O.Z["remove-role"]},!u&&l().createElement(v.Z,{afterSubmit:function(){return j(ue(ue({},F),{},{offset:0,filters:{display_name:V}}))},routeMatch:O.Z["remove-role"],cancelRoute:(0,p.zk)(O.Z.roles,F,f),submitRoute:(0,p.zk)(O.Z.roles,ue(ue({},F),{},{offset:0}),f)})),l().createElement(c.Route,{exact:!0,path:O.Z["edit-role"]},!u&&l().createElement(R.Z,{afterSubmit:function(){return j(ue(ue({},F),{},{offset:0,filters:{display_name:V}}))},routeMatch:O.Z["edit-role"],cancelRoute:(0,p.zk)(O.Z.roles,F,f),submitRoute:(0,p.zk)(O.Z.roles,ue(ue({},F),{},{offset:0}),f)})))},q=function(e){return e.system?[]:[{title:"Edit",onClick:function(e,r,n){return t("/roles/edit/".concat(n.uuid))}},{title:"Delete",onClick:function(e,r,n){return t("/roles/remove/".concat(n.uuid))}}]},B=function(){return D||_?[l().createElement(c.Link,{to:O.Z["add-role"],key:"add-role",className:"rbac-m-hide-on-sm"},l().createElement(d.Button,{ouiaId:"create-role-button",variant:"primary","aria-label":"Create role"},"Create role"))].concat((0,n.Z)((0,le.Z)(x)?[{label:"Create role",onClick:function(){w.push(O.Z["add-role"])}}]:[])):[]};return l().createElement(c.Switch,null,l().createElement(Z.Z,{pageAction:"role-detail-permission",path:O.Z["role-detail-permission"]},l().createElement(oe,null)),l().createElement(Z.Z,{pageAction:"role-detail",path:O.Z["role-detail"]},l().createElement(E.Z,{onDelete:function(){return A("")}})),l().createElement(Z.Z,{pageAction:"roles-list",path:O.Z.roles,render:function(){return l().createElement(d.Stack,{className:"rbac-c-roles"},l().createElement(d.StackItem,null,l().createElement(y.Q,null,l().createElement(y.y,{title:"Roles"}))),l().createElement(d.StackItem,null,l().createElement(h.Z,{type:"content",id:"tab-roles"},l().createElement(g.M,{actionResolver:q,sortBy:{index:0,direction:"asc"},columns:fe,createRows:m,data:i,filterValue:V,fetchData:function(e){var t=e.name,r=e.count,n=e.limit,o=e.offset,i=e.orderBy;return(0,k.oG)(w,n,o),(0,ie.MS)(w,{display_name:t}),j((0,p.jl)({count:r,limit:n,offset:o,orderBy:i,filters:{display_name:t}}))},setFilterValue:function(e){var t=e.name;return A(t)},isLoading:!u&&0===(null==i?void 0:i.length)&&0===(null==V?void 0:V.length)||u,pagination:F,routes:N,ouiaId:"roles-table",titlePlural:"roles",titleSingular:"role",toolbarButtons:B,filterPlaceholder:"name",tableId:"roles"}))))}}))}}}]);
//# sourceMappingURL=../sourcemaps/514.85e7fc8fe29650d4bf50d64fad292a01.js.map