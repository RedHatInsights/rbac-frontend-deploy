(self.webpackChunkinsights_rbac_frontend=self.webpackChunkinsights_rbac_frontend||[]).push([[565],{26701:(e,t,r)=>{"use strict";r.d(t,{R:()=>m,A:()=>f});var n=r(84887),i=r(87757),o=r.n(i),a=r(48926),c=r.n(a),s=(0,r(63717).i$)();function l(e){return u.apply(this,arguments)}function u(){return(u=c()(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.getResourceTypes(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e){return p.apply(this,arguments)}function p(){return(p=c()(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.getResource(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var f=function(e){return{type:n.s6,payload:l(e)}},m=function(e){return{type:n.ZX,payload:d(e)}}},67565:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Re});var n=r(59713),i=r.n(n),o=r(63038),a=r.n(o),c=r(80150),s=r.n(c),l=r(70983),u=r(47194),d=r(12460),p=r(47173),f=r(49739),m=r(83826),g=r(319),b=r.n(g),y=r(89478),v=function(e){return e.reduce((function(e,t){var r=t.uuid,n=t.display_name,i=t.name,o=t.description,a=t.system,l=t.accessCount,d=t.groups_in_count,p=t.modified;return[].concat(b()(e),[{uuid:r,system:a,cells:[s().createElement(c.Fragment,{key:"".concat(r,"-name")},s().createElement(u.Link,{to:"/roles/detail/".concat(r)},n||i)),o,s().createElement(c.Fragment,{key:"".concat(r,"-accessCount")},s().createElement(u.Link,{to:"/roles/detail/".concat(r)},l)),d,s().createElement(c.Fragment,{key:"".concat(r,"-modified")},s().createElement(y.t,{date:p,type:"relative"}))]}])}),[])},h=r(12830),E=r(89531),O=r(37671),j=r(17721),R=r(60843),P=r(31158),w=r(93537),_=r(60306),D=r(95155),S=r(6562),k=r(68774),L=r(68340),C=r(48140),M=r(86050),F=function(e){return e.reduce((function(e,t){return[].concat(b()(e),[{cells:[t]}])}),[])},T=r(84049),V=r(55917),x=r(71410),Z=r(67154),I=r.n(Z),A=r(45697),N=r.n(A),q=r(87242),B=r(72389),W=r(26701),H=r(74837),z=r(2485),J=r(2372),$=r(80236),G=r(6479),K=r.n(G),Q=r(44241),U=r(43547),X=r(58860);function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r(86667);var te=function(e){var t=e.ModalProps,r=K()(e,["ModalProps"]),n=(0,X.Z)().getState().values;return s().createElement(Q.Z,I()({},r,{ModalProps:ee(ee({},t),{},{onClose:function(){return t.onClose(n)}}),alert:n["dual-list-select"]?void 0:function(){return s().createElement("div",{className:"ins-m-resource-definitions"},s().createElement(U.b,{className:"pf-c-modal__alert",variant:"danger",isInline:!0,title:"At least one resource must be defined for this permission"}))}}))};te.propTypes={ModalProps:N().object};const re=te;var ne=r(42348),ie=r.n(ne);function oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ce={changedResources:void 0,cancelWarningVisible:!1,resourcesPath:void 0,loadingStateVisible:!0};function se(e,t){switch(t.type){case"update":return ae(ae({},e),t.payload);default:throw new Error}}var le=function(e,t,r){return{fields:[{component:q.Z.DUAL_LIST_SELECT,name:"dual-list-select",leftTitle:"Resources available for the permission",rightTitle:"Resources defined for the permission",filterOptionsTitle:"Filter by resource...",filterValueTitle:"Filter by resource...",options:b()(t&&e?r:[]),validate:[{type:"validate-resources"}]}]}},ue={"validate-resources":function(){return function(e){return e&&e.length>0?void 0:"At least one resource must be defined for this permission"}}},de=function(e){var t=e.cancelRoute,r=(0,u.useRouteMatch)(_._j.nu),n=(0,u.useRouteMatch)(r).params,i=n.permissionId,o=n.roleId,d=(0,u.useHistory)(),p=d.replace,f=d.push,m=(0,l.useDispatch)(),g=(0,c.useReducer)(se,ce),y=a()(g,2),v=y[0],h=y[1],O=(0,l.useSelector)((function(e){var t;return{role:e.roleReducer.selectedRole,definedResources:(null===(t=e.roleReducer.selectedRole)||void 0===t?void 0:t.access)?ie()(e.roleReducer.selectedRole.access.filter((function(e){return e.permission===i})).map((function(e){return e.resourceDefinitions.map((function(e){return e.attributeFilter.value}))}))):[],isRecordLoading:e.roleReducer.isRecordLoading}}),l.shallowEqual),j=O.definedResources,R=O.role,P=(0,l.useSelector)((function(e){return function(e,t){var r=e.costReducer,n=r.resourceTypes,i=r.isLoading,o=r.loadingResources,a=r.resources;return{resourceTypes:n.data,resources:a[t]?{resourcesPath:a[t]}:a,isLoading:i,isLoadingResources:o>0}}(e,v.resourcesPath)}),l.shallowEqual),w=P.resourceTypes,D=P.isLoading,S=P.isLoadingResources,k=P.resources;(0,c.useEffect)((function(){m((0,W.A)())}),[i]),(0,c.useEffect)((function(){if(!D){var e,t=null===(e=w.find((function(e){var t;return e.value===(null===(t=i.split(":"))||void 0===t?void 0:t[1])})))||void 0===e?void 0:e.path;t&&(h({type:"update",payload:{resourcesPath:t.split("/")[5]}}),m((0,W.R)(t)))}}),[w]);var L=function(){return p(t)},C=function(e){e["dual-list-select"]===j?L():h({type:"update",payload:{changedResources:e["dual-list-select"],cancelWarningVisible:!0}})},M=function(e){return Object.entries(e).reduce((function(e,t){var r=a()(t,2),n=r[0],i=r[1];return[].concat(b()(e),b()(i.map((function(e){return{value:e.value,path:n,label:e.value}}))))}),[])}(k);return s().createElement(s().Fragment,null,s().createElement(z.R,{customTitle:"Exit edit resource definitions?",customDescription:"All changes will be lost.",isOpen:v.cancelWarningVisible,onModalCancel:function(){return h({type:"update",payload:{cancelWarningVisible:!1}})},onConfirmCancel:L}),(D||S)&&v.loadingStateVisible?s().createElement($.u,{className:"ins-m-resource-definitions",isOpen:!0,title:"Edit resource definitions",onClose:function(){h({type:"update",payload:{loadingStateVisible:!1}}),L()}},s().createElement(J.$,null)):s().createElement(B.Z,{schema:le(k,v.resourcesPath,M),componentMapper:H.ZP,initialValues:{"dual-list-select":v.changedResources||j||[]},onSubmit:function(e){var r;h({type:"update",payload:{changedResources:e["dual-list-select"]}});var n={permission:i,resourceDefinitions:[{attributeFilter:{key:"cost-management.".concat(null===(r=i.split(":"))||void 0===r?void 0:r[1]),operation:1===e["dual-list-select"].length?"equal":"in",value:1===e["dual-list-select"].length?e["dual-list-select"][0]:e["dual-list-select"]}}]};m((0,E.ul)(o,ae(ae({},R),{},{access:[].concat(b()(R.access.filter((function(e){return e.permission!==i}))),[n])})),!0).then((function(){m((0,E.fp)(o)),f(t)}))},onCancel:function(e){return C(e)},validatorMapper:ue,FormTemplate:function(e){return s().createElement(re,I()({},e,{ModalProps:{onClose:C,isOpen:!v.cancelWarningVisible,variant:"large",title:"Edit resource definitions",description:"Give or remove permissions to specific resources using the arrows below."}}))}}))};de.propTypes={routeMatch:N().string.isRequired,cancelRoute:N().string.isRequired,resources:N().array,resourcesPath:N().string};const pe=de;var fe=r(85564),me=r.n(fe);function ge(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ge(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const ye=function(){var e=(0,c.useState)({pagination:be(be({},x.he),{},{filter:""})}),t=a()(e,2),r=t[0],n=t[1],i=r.pagination,o=r.filter,d=(0,l.useDispatch)(),f=(0,u.useParams)(),m=f.roleId,g=f.permissionId,b=(0,l.useSelector)((function(e){var t;return{role:e.roleReducer.selectedRole,permission:e.roleReducer.selectedRole.access?be({},null===(t=e.roleReducer.selectedRole)||void 0===t?void 0:t.access.find((function(e){return e.permission===g}))):{},isRecordLoading:e.roleReducer.isRecordLoading}}),l.shallowEqual),y=b.role,v=b.permission,h=b.isRecordLoading;(0,c.useEffect)((function(){d((0,E.fp)(m))}),[m]),(0,c.useEffect)((function(){n(be(be({},r),{},{pagination:be(be({},r.pagination),{},{count:y.access?y.access.length:0})}))}),[y]);var R=v.resourceDefinitions?me()(v.resourceDefinitions.map((function(e){return e.attributeFilter.value}))).filter((function(e){return!o||e.includes(o)})):[];return s().createElement(c.Fragment,null,s().createElement(O.Q,{breadcrumbs:[{title:"Roles",to:"/roles"},{title:h?void 0:y&&(y.display_name||y.name),to:"/roles/detail/".concat(m)},{title:g,isActive:!0}]},s().createElement(C.a,null,s().createElement(M.Z,null,s().createElement(T.PageHeaderTitle,{title:g||s().createElement(V.h2,null),className:"ins-rbac-page-header__title"})))),s().createElement("section",{className:"pf-c-page__main-section ins-c-role__permissions"},s().createElement(k.D,null,s().createElement(L.x,{component:L.q.h1},"Defined resources")),s().createElement(j.M,{columns:[{}],createRows:F,data:R.slice(i.offset,i.offset+i.limit),filterValue:o,fetchData:function(e){var t=e.limit,i=e.offset,o=e.name;return n(be(be({},r),{},{filter:o,pagination:be(be({},r.pagination),{},{limit:t,offset:i})}))},isCompact:!0,routes:function(){return s().createElement(c.Fragment,null,s().createElement(u.Route,{exact:!0,path:_._j.nu},s().createElement(pe,{cancelRoute:_._j.T0.replace(":roleId",m).replace(":permissionId",g)})))},setFilterValue:function(e){var t=e.name;return n(be(be({},r),{},{filter:t}))},toolbarButtons:function(){return y.system?[]:[s().createElement(c.Fragment,{key:"edit-resource-definitions"},s().createElement(u.Link,{to:"/roles/detail/".concat(m,"/permission/").concat(g,"/edit")},s().createElement(p.zx,{variant:"primary","aria-label":"Edit"},"Edit")))]},isLoading:h,pagination:be(be({},i),{},{count:R.length}),titlePlural:"resources",titleSingular:"resource",hideHeader:!0})))};function ve(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function he(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ve(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ee=(0,c.lazy)((function(){return Promise.all([r.e(410),r.e(480)]).then(r.bind(r,59480))})),Oe=[{title:"Name",key:"display_name",transforms:[(0,d.cellWidth)(20),d.sortable]},{title:"Description"},{title:"Permissions",transforms:[d.nowrap]},{title:"Groups",transforms:[d.nowrap]},{title:"Last modified",key:"modified",transforms:[d.nowrap,d.sortable]}],je=function(e){var t=e.roleReducer,r=t.roles,n=t.isLoading;return{roles:r.data,pagination:r.meta,userIdentity:r.identity,isLoading:n}};const Re=function(){var e=(0,c.useState)(""),t=a()(e,2),r=t[0],n=t[1],i=(0,l.useDispatch)(),o=(0,u.useHistory)().push,d=(0,l.useSelector)(je,l.shallowEqual),g=d.roles,b=d.isLoading,y=d.pagination,k=d.userIdentity,L=function(e){return i((0,E.Kt)(e))};(0,c.useEffect)((function(){insights.chrome.appNavClick({id:"roles",secondaryNav:!0}),L(he(he({},y),{},{name:r}))}),[]);var C=function(){return s().createElement(c.Suspense,{fallback:s().createElement(c.Fragment,null)},insights.chrome.isBeta()&&s().createElement(u.Route,{exact:!0,path:_._j.EM,component:Ee}),s().createElement(u.Route,{exact:!0,path:_._j.fV},!b&&s().createElement(R.Z,{routeMatch:_._j.fV,cancelRoute:_._j.uJ,afterSubmit:function(){return L(he(he({},y),{},{name:r}))}})),s().createElement(u.Route,{exact:!0,path:_._j.ld},!b&&s().createElement(D.Z,{afterSubmit:function(){return L(he(he({},y),{},{name:r}))},routeMatch:_._j.ld,cancelRoute:_._j.uJ})))},M=function(e){return e.system?[]:[{title:"Edit",onClick:function(e,t,r){return o("/roles/edit/".concat(r.uuid))}},{title:"Delete",onClick:function(e,t,r){return o("/roles/remove/".concat(r.uuid))}}]},F=function(){var e;return[insights.chrome.isBeta()&&(null==k||null===(e=k.user)||void 0===e?void 0:e.is_org_admin)?{label:"Create role",onClick:function(){o(_._j.EM)}}:void 0].filter((function(e){return e}))};return s().createElement(u.Switch,null,s().createElement(S.Z,{pageAction:"role-detail-permission",path:_._j.T0},s().createElement(ye,null)),s().createElement(S.Z,{pageAction:"role-detail",path:_._j.Fh},s().createElement(w.Z,null)),s().createElement(S.Z,{pageAction:"roles-list",path:_._j.uJ,render:function(){return s().createElement(f.K,null,s().createElement(m.v,null,s().createElement(O.Q,null,s().createElement(O.y,{title:"Roles"}))),s().createElement(m.v,null,s().createElement(P.$,{type:"content",id:"tab-roles"},s().createElement(j.M,{dedicatedAction:insights.chrome.isBeta()&&(null==k||null===(e=k.user)||void 0===e?void 0:e.is_org_admin)?s().createElement(u.Link,{to:_._j.EM},s().createElement(p.zx,{ouiaId:"create-role-button",variant:"primary","aria-label":"Create role",className:"pf-m-visible-on-md"},"Create role")):void 0,actionResolver:M,sortBy:{index:0,direction:"asc"},columns:Oe,createRows:v,data:g,filterValue:r,fetchData:function(e){return L((0,h.jl)(e))},setFilterValue:function(e){var t=e.name;return n(t)},isLoading:b,pagination:y,routes:C,ouiaId:"roles-table",titlePlural:"roles",titleSingular:"role",toolbarButtons:F,filterPlaceholder:"name"}))));var e}}))}}}]);
//# sourceMappingURL=565.517e624440b716259d9d.js.map