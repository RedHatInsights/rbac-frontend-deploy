(self.webpackChunkinsights_rbac_frontend=self.webpackChunkinsights_rbac_frontend||[]).push([[514],{61514:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>pe});var n=r(85061),i=r(28481),o=r(96156),a=r(92950),l=r.n(a),c=r(45237),s=r(334),u=r(6877),d=r(97066),f=r(64107),p=function(e){return e.reduce((function(e,t){var r=t.uuid,i=t.display_name,o=t.name,c=t.description,u=t.system,d=t.accessCount,p=t.groups_in_count,m=t.modified;return[].concat((0,n.Z)(e),[{uuid:r,system:u,cells:[l().createElement(a.Fragment,{key:"".concat(r,"-name")},l().createElement(s.Link,{to:"/roles/detail/".concat(r)},i||o)),c,l().createElement(a.Fragment,{key:"".concat(r,"-accessCount")},l().createElement(s.Link,{to:"/roles/detail/".concat(r)},d)),p,l().createElement(a.Fragment,{key:"".concat(r,"-modified")},l().createElement(f.Z,{date:m,type:"relative"}))]}])}),[])},m=r(11107),y=r(28090),b=r(38376),g=r(41800),v=r(13063),h=r(54213),E=r(95311),O=r(60306),j=r(88040),R=r(93327),P=function(e){return e.reduce((function(e,t){return[].concat((0,n.Z)(e),[{cells:[t]}])}),[])},_=r(39173),w=r(19571),Z=r(61338),k=r(22122),S=r(45697),D=r.n(S),L=r(96354),C=r(36457),M=r(29215),F=r(76349),T=r(73943),I=r(81253),V=r(40483),A=r(48880),N=["ModalProps"];function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var B=function(e){var t=e.ModalProps,r=(0,I.Z)(e,N),n=(0,A.default)().getState().values;return l().createElement(V.Z,(0,k.Z)({},r,{ModalProps:q(q({},t),{},{onClose:function(){return t.onClose(n)}}),alert:n["dual-list-select"]?void 0:function(){return l().createElement("div",{className:"rbac-m-resource-definitions"},l().createElement(d.Alert,{className:"pf-c-modal__alert",variant:"danger",isInline:!0,title:"At least one resource must be defined for this permission"}))}}))};B.propTypes={ModalProps:D().object};const z=B;var W=r(42348),G=r.n(W);function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Q={changedResources:void 0,cancelWarningVisible:!1,resourcesPath:void 0,loadingStateVisible:!0};function X(e,t){switch(t.type){case"update":return H(H({},e),t.payload);default:throw new Error}}var K=function(e,t,r){return{fields:[{component:L.Z.DUAL_LIST_SELECT,name:"dual-list-select",leftTitle:"Resources available for the permission",rightTitle:"Resources defined for the permission",filterOptionsTitle:"Filter by resource...",filterValueTitle:"Filter by resource...",options:(0,n.Z)(t&&e?r:[]),validate:[{type:"validate-resources"}]}]}},U={"validate-resources":function(){return function(e){return e&&e.length>0?void 0:"At least one resource must be defined for this permission"}}},Y=function(e){var t=e.cancelRoute,r=(0,s.useRouteMatch)(O._j.nu),o=(0,s.useRouteMatch)(r).params,u=o.permissionId,f=o.roleId,p=(0,s.useHistory)(),m=p.replace,b=p.push,g=(0,c.useDispatch)(),v=(0,a.useReducer)(X,Q),h=(0,i.Z)(v,2),E=h[0],j=h[1],R=(0,c.useSelector)((function(e){var t;return{role:e.roleReducer.selectedRole,definedResources:null!==(t=e.roleReducer.selectedRole)&&void 0!==t&&t.access?G()(e.roleReducer.selectedRole.access.filter((function(e){return e.permission===u})).map((function(e){return e.resourceDefinitions.map((function(e){return e.attributeFilter.value}))}))):[],isRecordLoading:e.roleReducer.isRecordLoading}}),c.shallowEqual),P=R.definedResources,_=R.role,w=(0,c.useSelector)((function(e){return function(e,t){var r=e.costReducer,n=r.resourceTypes,i=r.isLoading,o=r.loadingResources,a=r.resources;return{resourceTypes:n.data,resources:a[t]?{resourcesPath:a[t]}:a,isLoading:i,isLoadingResources:o>0}}(e,E.resourcesPath)}),c.shallowEqual),Z=w.resourceTypes,S=w.isLoading,D=w.isLoadingResources,L=w.resources;(0,a.useEffect)((function(){g((0,M.A)())}),[u]),(0,a.useEffect)((function(){if(!S){var e,t=null===(e=Z.find((function(e){var t;return e.value===(null===(t=u.split(":"))||void 0===t?void 0:t[1])})))||void 0===e?void 0:e.path;t&&(j({type:"update",payload:{resourcesPath:t.split("/")[5]}}),g((0,M.R)(t)))}}),[Z]);var I=function(){return m(t)},V=function(e){e["dual-list-select"]===P?I():j({type:"update",payload:{changedResources:e["dual-list-select"],cancelWarningVisible:!0}})},A=function(e){return Object.entries(e).reduce((function(e,t){var r=(0,i.Z)(t,2),o=r[0],a=r[1];return[].concat((0,n.Z)(e),(0,n.Z)(a.map((function(e){return{value:e.value,path:o,label:e.value}}))))}),[])}(L);return l().createElement(l().Fragment,null,l().createElement(T.R,{customTitle:"Exit edit resource definitions?",customDescription:"All changes will be lost.",isOpen:E.cancelWarningVisible,onModalCancel:function(){return j({type:"update",payload:{cancelWarningVisible:!1}})},onConfirmCancel:I}),(S||D)&&E.loadingStateVisible?l().createElement(d.Modal,{className:"rbac-m-resource-definitions",isOpen:!0,title:"Edit resource definitions",onClose:function(){j({type:"update",payload:{loadingStateVisible:!1}}),I()}},l().createElement(d.Spinner,null)):l().createElement(C.Z,{schema:K(L,E.resourcesPath,A),componentMapper:F.ZP,initialValues:{"dual-list-select":E.changedResources||P||[]},onSubmit:function(e){var r;j({type:"update",payload:{changedResources:e["dual-list-select"]}});var i={permission:u,resourceDefinitions:[{attributeFilter:{key:"cost-management.".concat(null===(r=u.split(":"))||void 0===r?void 0:r[1]),operation:1===e["dual-list-select"].length?"equal":"in",value:1===e["dual-list-select"].length?e["dual-list-select"][0]:e["dual-list-select"]}}]};g((0,y.ul)(f,H(H({},_),{},{access:[].concat((0,n.Z)(_.access.filter((function(e){return e.permission!==u}))),[i])})),!0).then((function(){g((0,y.fp)(f)),b(t)}))},onCancel:function(e){return V(e)},validatorMapper:U,FormTemplate:function(e){return l().createElement(z,(0,k.Z)({},e,{ModalProps:{onClose:V,isOpen:!E.cancelWarningVisible,variant:"large",title:"Edit resource definitions",description:"Give or remove permissions to specific resources using the arrows below."}}))}}))};Y.propTypes={routeMatch:D().string.isRequired,cancelRoute:D().string.isRequired,resources:D().array,resourcesPath:D().string};const $=Y;var ee=r(85564),te=r.n(ee);function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const ie=function(){var e=(0,a.useState)({pagination:ne(ne({},Z.he),{},{filter:""})}),t=(0,i.Z)(e,2),r=t[0],n=t[1],o=r.pagination,u=r.filter,f=(0,c.useDispatch)(),p=(0,s.useParams)(),v=p.roleId,h=p.permissionId,E=(0,c.useSelector)((function(e){var t,r,n,i,o;return{role:e.roleReducer.selectedRole,permission:e.roleReducer.selectedRole.access?ne({},null===(t=e.roleReducer.selectedRole)||void 0===t?void 0:t.access.find((function(e){return e.permission===h}))):{},isRecordLoading:e.roleReducer.isRecordLoading,rolesPagination:(null===(r=e.roleReducer)||void 0===r||null===(n=r.roles)||void 0===n?void 0:n.pagination)||Z.he,rolesFilters:(null===(i=e.roleReducer)||void 0===i||null===(o=i.roles)||void 0===o?void 0:o.filters)||{}}}),c.shallowEqual),j=E.role,R=E.permission,k=E.isRecordLoading,S=E.rolesPagination,D=E.rolesFilters;(0,a.useEffect)((function(){f((0,y.fp)(v))}),[v]),(0,a.useEffect)((function(){n(ne(ne({},r),{},{pagination:ne(ne({},r.pagination),{},{count:j.access?j.access.length:0})}))}),[j]);var L=R.resourceDefinitions?te()(R.resourceDefinitions.map((function(e){return e.attributeFilter.value}))).filter((function(e){return!u||e.includes(u)})):[],C=function(){return l().createElement(a.Fragment,null,l().createElement(s.Route,{exact:!0,path:O._j.nu},l().createElement($,{cancelRoute:O._j.T0.replace(":roleId",v).replace(":permissionId",h)})))};return l().createElement(a.Fragment,null,l().createElement(b.Q,{breadcrumbs:[{title:"Roles",to:(0,m.zk)(C.roles,S,D)},{title:k?void 0:j&&(j.display_name||j.name),to:"/roles/detail/".concat(v)},{title:h,isActive:!0}]},l().createElement(d.Level,null,l().createElement(d.LevelItem,null,l().createElement(_.Z,{title:h||l().createElement(w.h2,null),className:"rbac-page-header__title"})))),l().createElement("section",{className:"pf-c-page__main-section rbac-c-role__permissions"},l().createElement(d.TextContent,null,l().createElement(d.Text,{component:d.TextVariants.h1},"Defined resources")),l().createElement(g.M,{columns:[{}],createRows:P,data:L.slice(o.offset,o.offset+o.limit),filterValue:u,fetchData:function(e){var t=e.limit,i=e.offset,o=e.name;return n(ne(ne({},r),{},{filter:o,pagination:ne(ne({},r.pagination),{},{limit:t,offset:i})}))},isCompact:!0,routes:C,setFilterValue:function(e){var t=e.name;return n(ne(ne({},r),{},{filter:t}))},toolbarButtons:function(){return j.system?[]:[l().createElement(a.Fragment,{key:"edit-resource-definitions"},l().createElement(s.Link,{to:"/roles/detail/".concat(v,"/permission/").concat(h,"/edit")},l().createElement(d.Button,{variant:"primary","aria-label":"Edit"},"Edit")))]},isLoading:k,pagination:ne(ne({},o),{},{count:L.length}),titlePlural:"resources",titleSingular:"resource",hideHeader:!0,tableId:"role-resource-definitions"})))};var oe=r(92758),ae=r(78596),le=r(11549);function ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ce(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ue=(0,a.lazy)((function(){return Promise.all([r.e(705),r.e(287)]).then(r.bind(r,13287))})),de=[{title:"Name",key:"display_name",transforms:[(0,u.cellWidth)(20),u.sortable]},{title:"Description"},{title:"Permissions",transforms:[u.nowrap]},{title:"Groups",transforms:[u.nowrap]},{title:"Last modified",key:"modified",transforms:[u.nowrap,u.sortable]}],fe=function(e){var t=e.roleReducer,r=t.roles,n=t.isLoading;return{roles:r.data,filters:r.filters,meta:r.pagination,userIdentity:r.identity,isLoading:n}};const pe=function(){var e=(0,c.useDispatch)(),t=(0,s.useHistory)().push,r=(0,c.useSelector)(fe,c.shallowEqual),o=r.roles,u=r.isLoading,f=r.filters,P=r.meta,_=r.userIdentity,w=function(t){return e((0,y.Kt)(se(se({},t),{},{inModal:!1})))},k=(0,s.useHistory)(),S=(0,a.useState)(P),D=(0,i.Z)(S,2),L=D[0],C=D[1],M=(0,a.useState)(f.display_name||""),F=(0,i.Z)(M,2),T=F[0],I=F[1],V=(0,ae.Z)();(0,a.useEffect)((function(){var e=(0,Z.rj)(k,L);C(e);var t=(0,oe.aX)(k,["display_name"],{display_name:T}).display_name;I(t),insights.chrome.appNavClick({id:"roles",secondaryNav:!0}),w(se(se({},e),{},{filters:{display_name:t}}))}),[]),(0,a.useEffect)((function(){I(f.display_name),C(P)}),[f,P]),(0,a.useEffect)((function(){P.redirected&&(0,Z.oG)(k,P.limit,P.offset)}),[P.redirected]),(0,a.useEffect)((function(){(0,Z.Zc)(k)||(0,Z.oG)(k,L.limit,L.offset),(null==T?void 0:T.length)>0&&!(0,oe.qF)(k,["display_name"])&&(0,oe.aX)(k,["display_name"],{display_name:T})}));var A=function(){return l().createElement(a.Suspense,{fallback:l().createElement(a.Fragment,null)},l().createElement(s.Route,{exact:!0,path:O._j.EM},l().createElement(ue,{pagination:L,filters:{display_name:T}})),l().createElement(s.Route,{exact:!0,path:O._j.fV},!u&&l().createElement(v.Z,{afterSubmit:function(){return w(se(se({},L),{},{offset:0,filters:{display_name:T}}))},routeMatch:O._j.fV,cancelRoute:(0,m.zk)(O._j.uJ,L,f),submitRoute:(0,m.zk)(O._j.uJ,se(se({},L),{},{offset:0}),f)})),l().createElement(s.Route,{exact:!0,path:O._j.ld},!u&&l().createElement(j.Z,{afterSubmit:function(){return w(se(se({},L),{},{offset:0,filters:{display_name:T}}))},routeMatch:O._j.ld,cancelRoute:(0,m.zk)(O._j.uJ,L,f),submitRoute:(0,m.zk)(O._j.uJ,se(se({},L),{},{offset:0}),f)})))},N=function(e){return e.system?[]:[{title:"Edit",onClick:function(e,r,n){return t("/roles/edit/".concat(n.uuid))}},{title:"Delete",onClick:function(e,r,n){return t("/roles/remove/".concat(n.uuid))}}]},x=function(){var e;return null!=_&&null!==(e=_.user)&&void 0!==e&&e.is_org_admin?[l().createElement(s.Link,{to:O._j.EM,key:"add-role",className:"ins-m-hide-on-sm"},l().createElement(d.Button,{ouiaId:"create-role-button",variant:"primary","aria-label":"Create role"},"Create role"))].concat((0,n.Z)((0,le.Z)(V)?[{label:"Create role",onClick:function(){k.push(O._j.EM)}}]:[])):[]};return l().createElement(s.Switch,null,l().createElement(R.Z,{pageAction:"role-detail-permission",path:O._j.T0},l().createElement(ie,null)),l().createElement(R.Z,{pageAction:"role-detail",path:O._j.Fh},l().createElement(E.Z,{onDelete:function(){return I("")}})),l().createElement(R.Z,{pageAction:"roles-list",path:O._j.uJ,render:function(){return l().createElement(d.Stack,{className:"rbac-c-roles"},l().createElement(d.StackItem,null,l().createElement(b.Q,null,l().createElement(b.y,{title:"Roles"}))),l().createElement(d.StackItem,null,l().createElement(h.Z,{type:"content",id:"tab-roles"},l().createElement(g.M,{actionResolver:N,sortBy:{index:0,direction:"asc"},columns:de,createRows:p,data:o,filterValue:T,fetchData:function(e){var t=e.name,r=e.count,n=e.limit,i=e.offset,o=e.orderBy;return(0,Z.oG)(k,n,i),(0,oe.MS)(k,{display_name:t}),w((0,m.jl)({count:r,limit:n,offset:i,orderBy:o,filters:{display_name:t}}))},setFilterValue:function(e){var t=e.name;return I(t)},isLoading:!u&&0===(null==o?void 0:o.length)&&0===(null==T?void 0:T.length)||u,pagination:L,routes:A,ouiaId:"roles-table",titlePlural:"roles",titleSingular:"role",toolbarButtons:x,filterPlaceholder:"name",tableId:"roles"}))))}}))}}}]);
//# sourceMappingURL=../sourcemaps/514.a8901b72cb675627d9338b84622b0872.js.map