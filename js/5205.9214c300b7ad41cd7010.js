(self.webpackChunkrbac=self.webpackChunkrbac||[]).push([[5205],{55218:(e,t,a)=>{"use strict";a.d(t,{Z:()=>l});var s=a(28416),n=a.n(s),r=a(80236),o=a(47173),i=a(93149);const l=e=>{var{isOpen:t,onConfirm:a,onClose:l,children:c,confirmButtonLabel:u="Confirm",cancelButtonLabel:d="Cancel",variant:p=r.v.small,titleIconVariant:m="warning",withCheckbox:f=!1,checkboxLabel:b="I understand that this action cannot be undone",confirmButtonVariant:y=o.Wu.primary}=e,g=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(a[s[n]]=e[s[n]])}return a}(e,["isOpen","onConfirm","onClose","children","confirmButtonLabel","cancelButtonLabel","variant","titleIconVariant","withCheckbox","checkboxLabel","confirmButtonVariant"]);const[v,h]=(0,s.useState)(!1);return n().createElement(r.u,Object.assign({variant:p,isOpen:t,onClose:l,onEscapePress:l,titleIconVariant:m,actions:[n().createElement(o.zx,{ouiaId:"primary-confirm-button",key:"confirm",variant:y,onClick:a,isDisabled:f&&!v},u),n().createElement(o.zx,{ouiaId:"secondary-cancel-button",key:"cancel",variant:o.Wu.link,onClick:l},d)]},g),c,f?n().createElement(i.X,{isChecked:v,onChange:()=>h(!v),label:b,id:"warning-modal-check",className:"pf-v5-u-mt-lg"}):null)}},29693:(e,t,a)=>{"use strict";a.d(t,{C$:()=>u,pj:()=>c,xk:()=>l});var s=a(85564),n=a.n(s),r=a(75465);const o=(0,r.zX)(),i=(0,r.bD)(),l=async({name:e,perPage:t,page:a,options:s}={})=>await o.apiResourceTypeGetResourceTypeGroupsList(e,t,a,s),c=async e=>await i.apiGroupGetGroupsById(e),u=e=>e?n()(e.map((e=>e.attributeFilter.value))):[]},84414:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});var s=a(62012),n=a(64756);const r=e=>{const t=(0,s.useNavigate)();return(a,s)=>t((0,n.n)(a,e),s)}},19862:(e,t,a)=>{"use strict";a.d(t,{P:()=>l,b:()=>i});var s=a(71079);const n=(0,a(75465).i$)();async function r(e){return await n.getResourceTypes(e)}async function o(e){return await n.getResource(e)}const i=e=>({type:s.PN,payload:r(e)}),l=e=>({type:s.S9,payload:o(e)})},66254:(e,t,a)=>{"use strict";a.d(t,{M:()=>o,f:()=>r});var s=a(71079),n=a(29693);const r=(e,t)=>({type:s.YS,meta:{permissions:e,config:t},payload:n.xk(t)}),o=e=>({type:s.WV,meta:{groupsIds:e},payload:n.pj(e.filter((e=>e?.length>0)))})},10357:(e,t,a)=>{"use strict";a.d(t,{Z:()=>v});var s=a(28416),n=a.n(s),r=a(45697),o=a.n(r),i=a(76429),l=a(67850),c=a(48880),u=a(74219),d=a(57820),p=a(16396),m=a(4853);const f="modal-form",b=e=>n().createElement(m.l,{...e,id:f}),y=({saveLabel:e,cancelLabel:t})=>{const{onCancel:a}=(0,c.default)();return n().createElement(i.Z,null,(({pristine:s,invalid:r,validating:o,submitting:i})=>n().createElement("div",{className:"pf-v5-c-form"},n().createElement(d.W,{className:"pf-v5-u-mt-0"},n().createElement(p.Button,{ouiaId:"primary-save-button",variant:"primary",form:f,type:"submit",isDisabled:s||o||i||r},e),n().createElement(p.Button,{ouiaId:"secondary-cancel-button",variant:"link",onClick:a,id:"cancel-modal"},t)))))};y.propTypes={saveLabel:o().node,cancelLabel:o().node},y.defaultProps={saveLabel:"Save",cancelLabel:"Cancel"};const g=({ModalProps:e,saveLabel:t,cancelLabel:a,alert:s,...r})=>n().createElement(u.Modal,{role:"dialog",...e,footer:n().createElement(y,{saveLabel:t,cancelLabel:a})},s?.(),n().createElement(l.ZP,{...r,showFormControls:!1,FormWrapper:b}));g.propTypes={ModalProps:o().object,...y.propTypes};const v=g},73479:(e,t,a)=>{"use strict";a.d(t,{Z:()=>L});var s=a(28416),n=a.n(s),r=a(45697),o=a.n(r),i=a(16987),l=a(31055),c=a(96486),u=a(48880),d=a(76429),p=a(25387),m=a(2550);const f=({dirtyFieldsSinceLastSubmit:e,submitSucceeded:t,pristine:a})=>{const{onCancel:s}=(0,u.default)(),r=(0,c.isEmpty)(e)||!t&&a,o=(0,p.YB)();return n().createElement(i.ActionGroup,{className:"pf-v5-u-mt-0"},n().createElement(l.Button,{ouiaId:"primary-submit-button",type:"submit",isDisabled:r,variant:"primary"},o.formatMessage(m.Z.save)),n().createElement(l.Button,{ouiaId:"secondary-cancel-button",variant:"link",onClick:()=>s()},o.formatMessage(m.Z.cancel)))};f.propTypes={dirtyFieldsSinceLastSubmit:o().shape({[o().string]:o().oneOfType([o().string,o().number,o().bool])}),submitSucceeded:o().bool,pristine:o().bool,onCancel:o().func};const b=e=>n().createElement(d.Z,{subscription:{pristine:!0,submitSucceeded:!0,dirtyFieldsSinceLastSubmit:!0}},(t=>n().createElement(f,{...t,...e})));var y=a(67850),g=a(65412),v=a(75747),h=a(51912),E=a(96354);const R=({formTemplateProps:e,...t})=>n().createElement(h.Z,{componentMapper:{[E.Z.TEXT_FIELD]:g.Z,[E.Z.TEXTAREA]:v.Z},FormTemplate:t=>n().createElement(y.ZP,{...e,...t,FormButtons:b}),...t});R.propTypes={formTemplateProps:o().object};const L=R},74517:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>D});var s=a(28416),n=a.n(s),r=a(45697),o=a.n(r),i=a(96354),l=a(73479),c=a(42348),u=a.n(c),d=a(25387),p=a(62012),m=a(86706),f=a(13563),b=a(19862),y=a(66254),g=a(29693),v=a(8340),h=a(55218),E=a(15950),R=a(94229),L=a(74503),Z=a(84414),C=a(10357),T=a(5904),S=a(48880),M=a(2550);const P=({ModalProps:e,...t})=>{const a=(0,d.YB)(),s=(0,S.default)().getState().values;return n().createElement(C.Z,{...t,ModalProps:{...e,onClose:()=>e.onClose(s)},alert:s["dual-list-select"]?void 0:()=>n().createElement("div",{className:"rbac-m-resource-definitions"},n().createElement(T.Alert,{className:"pf-v5-c-modal__alert",variant:"danger",isInline:!0,title:a.formatMessage(M.Z.defineAtLeastOneResource)}))})};P.propTypes={ModalProps:o().object};const k=P;var B=a(60966);const O={changedResources:void 0,cancelWarningVisible:!1,resourcesPath:void 0,loadingStateVisible:!0};function w(e,t){if("update"===t.type)return{...e,...t.payload};throw new Error}const I=(e,t,a,s)=>{const n=(0,d.YB)();return{fields:[{component:i.Z.DUAL_LIST_SELECT,name:"dual-list-select",leftTitle:n.formatMessage(M.Z.resourcesAvailable),rightTitle:n.formatMessage(M.Z.resourcesDefined),filterOptionsTitle:n.formatMessage(M.Z.filterByResource),filterValueTitle:n.formatMessage(M.Z.filterByResource),options:[...(t||s)&&e?a:[]],validate:[{type:"validate-resources"}],isSearchable:!0,...s?{getValueFromNode:e=>e.props["data-value"]}:{}}]}},V={"validate-resources":()=>e=>e&&e.length>0?void 0:"At least one resource must be defined for this permission"},F=({cancelRoute:e})=>{const t=(0,d.YB)(),{roleId:a,permissionId:r}=(0,p.useParams)(),o=(0,Z.Z)(),i=(0,m.useDispatch)(),[c,C]=(0,s.useReducer)(w,O),T=(0,s.useMemo)((()=>(0,B.Rt)(r)),[r]),{resourceTypes:S,isLoading:P,isLoadingResources:F,resources:D,isLoadingInventory:j,inventoryGroups:x}=(0,m.useSelector)((e=>(({costReducer:{resourceTypes:e,isLoading:t,loadingResources:a,resources:s},inventoryReducer:{resourceTypes:n,isLoading:r}},o)=>({resourceTypes:e.data,resources:s[o]?{resourcesPath:s[o]}:s,isLoading:t,isLoadingResources:a>0,isLoadingInventory:r,inventoryGroups:n}))(e,c.resourcesPath)),m.shallowEqual),{definedResources:A,role:W}=(0,m.useSelector)((e=>({role:e.roleReducer.selectedRole,definedResources:e.roleReducer.selectedRole?.access?u()(e.roleReducer.selectedRole.access.filter((e=>e.permission===r)).map((e=>e.resourceDefinitions.map((e=>{const t=e.attributeFilter.value;return T?Array.isArray(t)?t.map((e=>String(e))):String(t):e.attributeFilter.value}))))):[],isRecordLoading:e.roleReducer.isRecordLoading})),m.shallowEqual);(0,s.useEffect)((()=>{T&&i((0,y.f)([r]))||i((0,b.b)())}),[r]),(0,s.useEffect)((()=>{if(!P){let e=S.find((e=>e.value===r.split(":")?.[1]))?.path;e&&(C({type:"update",payload:{resourcesPath:e.split("/")[5]}}),i((0,b.P)(e)))}}),[S]);const N=()=>o(e,{replace:!0}),G=e=>{e["dual-list-select"]===A?N():C({type:"update",payload:{changedResources:e["dual-list-select"],cancelWarningVisible:!0}})},_=((e,t)=>(0,B.Rt)(t)?[...(0,B._T)(t)?[n().createElement(d._H,{key:"ungrouped","data-value":"null",...M.Z.ungroupedSystems})]:[],...Object.values(e||{}).map((e=>n().createElement("span",{key:e.id,"data-value":e.id},e.name)))]:Object.entries(e).reduce(((e,[t,a])=>[...e,...a.map((e=>({value:e.value,path:t,label:e.value})))]),[]))(T?x[r]:D,r);return n().createElement(n().Fragment,null,n().createElement(h.Z,{title:t.formatMessage(M.Z.exitEditResourceDefinitions),isOpen:c.cancelWarningVisible,onClose:()=>C({type:"update",payload:{cancelWarningVisible:!1}}),onConfirm:N,"data-testid":"warning-modal",confirmButtonLabel:t.formatMessage(M.Z.discard)},t.formatMessage(M.Z.changesWillBeLost)),(P||F||j)&&c.loadingStateVisible?n().createElement(R.Modal,{variant:R.ModalVariant.large,className:"rbac-m-resource-definitions",isOpen:!0,title:t.formatMessage(M.Z.editResourceDefinitions),onClose:()=>{C({type:"update",payload:{loadingStateVisible:!1}}),N()}},n().createElement(L.Bullseye,null,n().createElement(E.Spinner,null))):n().createElement(l.Z,{schema:I(D,c.resourcesPath,_,T),componentMapper:v.ZP,initialValues:{"dual-list-select":c.changedResources||A||[]},onSubmit:t=>{C({type:"update",payload:{changedResources:t["dual-list-select"]}});const s=t["dual-list-select"].map((e=>"null"===e?null:e)),n={permission:r,resourceDefinitions:[{attributeFilter:{key:T?"group.id":`cost-management.${r.split(":")?.[1]}`,operation:1===s.length?"equal":"in",value:1===s.length?s[0]:s}}]};i((0,f.ul)(a,{...W,access:[...W.access.filter((e=>e.permission!==r)),n]}),!0).then((()=>{i((0,f.fp)(a)).then((({value:e})=>{T&&i((0,y.M)((0,g.C$)(e?.access?.find((e=>e.permission===r))?.resourceDefinitions)))})),o(e)}))},onCancel:e=>G(e),validatorMapper:V,FormTemplate:e=>n().createElement(k,{...e,ModalProps:{onClose:G,isOpen:!c.cancelWarningVisible,variant:"large",title:t.formatMessage(M.Z.editResourceDefinitions),description:t.formatMessage(M.Z.editPermissionsUsingArrows)}})}))};F.propTypes={cancelRoute:o().string.isRequired};const D=F},60966:(e,t,a)=>{"use strict";a.d(t,{Hg:()=>i,Rt:()=>n,_T:()=>r,u3:()=>o});var s=a(2550);const n=e=>e.split(":")[0].includes("inventory"),r=e=>n(e)&&e.split(":")[1].includes("hosts"),o=e=>e.split(":")[0].includes("cost-management"),i=(e,t,a)=>{let n=e.filter(Boolean);return r(t)&&e.includes(null)&&n.unshift(a.formatMessage(s.Z.ungroupedSystems)),n.reduce(((e,t)=>[...e,{cells:[t]}]),[])}},82472:()=>{},97890:()=>{},17657:()=>{},22972:()=>{},43389:()=>{},65088:()=>{},70347:()=>{},78752:()=>{},25238:()=>{},87234:()=>{}}]);
//# sourceMappingURL=../sourcemaps/5205.4d394e332f8414206d86702cc7b0ce8d.js.map