/*! For license information please see 6292.a2f5495479fec4900c7b.js.LICENSE.txt */
"use strict";(self.webpackChunkinsights_rbac_frontend=self.webpackChunkinsights_rbac_frontend||[]).push([[6292,7664],{77782:(e,t,r)=>{r.r(t),r.d(t,{AddRolePermissionWizardContext:()=>J,default:()=>Q,mapperExtension:()=>H});var n=r(71002),o=r(93433),i=r(15861),a=r(4942),s=r(29439),c=r(87462),u=r(92950),l=r.n(u),p=r(50533),f=r(45697),m=r.n(f),d=r(86896),h=r(25864),v=r(93025),y=r(67850),g=r(47836),E=r(73943),b=r(28090),w=r(16544),x=r(48880),Z=r(30893);var O=r(68778),j=r(65126),T=r(4682),L=function(e){var t=e.currentRoleID,r=(0,d.Z)(),n=(0,p.useDispatch)();return l().createElement(l().Fragment,null,l().createElement(h.EmptyState,null,l().createElement(h.EmptyStateIcon,{color:"green",icon:O.ZP}),l().createElement(h.Title,{headingLevel:"h4",size:"lg"},r.formatMessage(Z.Z.permissionsAddedSuccessfully)),l().createElement(h.EmptyStateBody,null),l().createElement(j.Z,{to:T.Z["role-detail"].link.replace(":roleId",t)},l().createElement(h.Button,{onClick:function(){return n((0,b.fp)(t))}},r.formatMessage(Z.Z.exit)))))};const P=L;L.propTypes={currentRoleID:m().string.isRequired};var S=r(91710),k=r(80709),M=r(27979);function G(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?G(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var I=function(e){var t,r=e.formFields;return(0,u.useContext)(J).submitting?l().createElement(h.Bullseye,null,l().createElement(h.Spinner,{size:"xl"})):l().createElement("div",{className:"rbac"},[[_({},null==r||null===(t=r[0])||void 0===t?void 0:t[0])]])};I.propTypes={formFields:m().array};const D=I;var F=r(28412),C=r(82644),N=r(29558),z=r(2034),R=r(9599),V=r(58854),A=r(93736);function W(){W=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),a=new O(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=l(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),i}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p={};function f(){}function m(){}function d(){}var h={};c(h,i,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(j([])));y&&y!==t&&r.call(y,i)&&(h=y);var g=d.prototype=f.prototype=Object.create(h);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function o(i,a,s,c){var u=l(e[i],e,a);if("throw"!==u.type){var p=u.arg,f=p.value;return f&&"object"==(0,n.Z)(f)&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){o("next",e,s,c)}),(function(e){o("throw",e,s,c)})):t.resolve(f).then((function(e){p.value=e,s(p)}),(function(e){return o("throw",e,s,c)}))}c(u.arg)}var i;this._invoke=function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=l(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function Z(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function j(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return m.prototype=d,c(g,"constructor",d),c(d,"constructor",m),m.displayName=c(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},E(b.prototype),c(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(g),c(g,s,"Generator"),c(g,i,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(Z),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),Z(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;Z(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:j(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Y=function(e){return l().createElement(y.ZP,(0,c.Z)({},e,{showFormControls:!1}))},H={"add-permissions-table":w.Z,"inventory-groups-role":k.Z,"cost-resources":S.Z,review:function(){var e=(0,d.Z)(),t=(0,x.default)().getState().values,r=t["role-name"],n=t["role-description"],o=t["add-permissions-table"],i=t["resource-definitions"],a=t["has-cost-resources"];return l().createElement(h.Stack,{hasGutter:!0},l().createElement(h.StackItem,null,l().createElement(h.TextContent,null,l().createElement(h.Title,{headingLevel:"h1",size:"xl",className:"pf-u-mb-sm"},e.formatMessage(Z.Z.reviewDetails)))),l().createElement(h.StackItem,{className:"rbac-l-stack__item-summary"},l().createElement(h.Grid,{hasGutter:!0},l().createElement(h.GridItem,{span:3},l().createElement(h.Text,{className:"pf-c-title",component:h.TextVariants.h6},e.formatMessage(Z.Z.roleName))),l().createElement(h.GridItem,{span:9},l().createElement(h.Text,{component:h.TextVariants.p},r)),l().createElement(h.GridItem,{span:3},l().createElement(h.Text,{className:"pf-c-title",component:h.TextVariants.h6},e.formatMessage(Z.Z.roleDescription))),l().createElement(h.GridItem,{span:9},l().createElement(h.Text,{component:h.TextVariants.p},n)),l().createElement(h.GridItem,{span:3},l().createElement(h.Text,{className:"pf-c-title",component:h.TextVariants.h6},e.formatMessage(Z.Z.addedPermissions))),l().createElement(h.GridItem,{span:9},l().createElement(h.TextContent,{component:h.TextVariants.p},o.map((function(e,t){return l().createElement(h.Text,{key:t}," ",e.uuid," ")})))),a&&l().createElement(l().Fragment,null,l().createElement(h.GridItem,{span:3},l().createElement(h.Text,{className:"pf-c-title",component:h.TextVariants.h6},e.formatMessage(Z.Z.resourceDefinitions))),l().createElement(h.GridItem,{span:9},l().createElement(h.TextContent,{component:h.TextVariants.p},i.map((function(e){return e.resources.map((function(e,t){return l().createElement(h.Text,{key:t}," ",e," ")}))}))))))))}},J=(0,u.createContext)({success:!1,submitting:!1,error:void 0}),K=function(e){var t=e.role,r=(0,d.Z)(),n=(0,u.useState)(!1),a=(0,s.Z)(n,2),c=a[0],f=a[1],m=(0,u.useState)(""),y=(0,s.Z)(m,2),w=y[0],x=y[1],O=(0,A.Z)(),j=(0,p.useDispatch)(),L=(0,u.useState)({success:!1,submitting:!1,error:void 0,hideForm:!1}),S=(0,s.Z)(L,2),k=S[0],G=S[1],_=(0,u.useRef)(document.createElement("div")),I=(0,u.useMemo)((function(){return function(e){var t=(0,C.Sn)(),r=(0,N.d)({locale:F.S,messages:z},t);return{fields:[{component:"wizard",name:"wizard",isDynamic:!0,inModal:!0,showTitles:!0,crossroads:["role-type"],title:r.formatMessage(Z.Z.addPermissions),container:e,fields:[{name:"add-permissions",title:r.formatMessage(Z.Z.addPermissions),StepTemplate:M.Z,nextStep:function(e){var t=e.values;return(0,R.j)("add-permissions",t)},fields:[{component:"add-permissions-table",name:"add-permissions-table"}]},{name:"inventory-groups-role",title:r.formatMessage(Z.Z.inventoryGroupsAccessTitle),StepTemplate:V.Z,nextStep:function(e){var t=e.values;return(0,R.j)("inventory-groups-role",t)},fields:[{component:"plain-text",name:"text-description",label:l().createElement("p",null,r.formatMessage(Z.Z.inventoryGroupsAccessDescription))},{component:"inventory-groups-role",name:"inventory-groups-role",validate:[function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return null!=e&&e.every((function(e){var t=e.groups,r=e.permission;return(null==t?void 0:t.length)>0&&r}))?void 0:r.formatMessage(Z.Z.assignAtLeastOneInventoryGroup)}]}]},{name:"cost-resources-definition",title:r.formatMessage(Z.Z.defineCostResources),nextStep:"review",fields:[{component:"plain-text",name:"text-description",label:l().createElement("p",null,r.formatMessage(Z.Z.applyCostPermissionText))},{component:"cost-resources",name:"cost-resources",validate:[function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).every((function(e){var t=e.resources;return t&&t.length>0}))?void 0:r.formatMessage(Z.Z.assignAtLeastOneResource)}]}]},{name:"review",title:r.formatMessage(Z.Z.reviewDetails),StepTemplate:D,fields:[{component:"review",name:"review"}]}]}]}}(_.current)}),[]);(0,u.useEffect)((function(){x(t.uuid)})),(0,u.useEffect)((function(){_.current.hidden=c}),[c]);var B=function(){O(T.Z["role-detail"].link.replace(":roleId",t.uuid))},K=function(){var e=(0,i.Z)(W().mark((function e(r){var n,i,a,s,c,u,l;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r["add-permissions-table"],i=r["cost-resources"],a=void 0===i?[]:i,s=r["inventory-groups-role"],c=void 0===s?[]:s,u=[].concat((0,o.Z)(t.access.map((function(e){return e.permission}))),(0,o.Z)(n.map((function(e){return e.uuid})))),l=q(q({},t),{},{access:(0,o.Z)(n.reduce((function(e,t){var r=t.uuid,n=t.requires;return[].concat((0,o.Z)(e),(0,o.Z)([r].concat((0,o.Z)(n.filter((function(e){return!u.includes(e)})))).map((function(e){var t,r,n;return{permission:e,resourceDefinitions:null!==(t=[].concat((0,o.Z)(a),(0,o.Z)(c)))&&void 0!==t&&t.find((function(t){return t.permission===e}))?e.includes("inventory")?[{attributeFilter:{key:"group.id",operation:"in",value:null==c||null===(r=c.find((function(t){return t.permission===e})))||void 0===r||null===(n=r.groups)||void 0===n?void 0:n.map((function(e){return null==e?void 0:e.id}))}}]:e.includes("cost-management")?[{attributeFilter:{key:"cost-management.".concat(e.split(":")[1]),operation:"in",value:null==a?void 0:a.find((function(t){return t.permission===e})).resources}}]:[]:[]}}))))}),t.access)),accessCount:t.accessCount+n.length}),G((function(e){return q(q({},e),{},{submitting:!0})})),j((0,b.ul)(w,l)).then((function(){return G((function(e){return q(q({},e),{},{submitting:!1,success:!0,hideForm:!0})}))})).catch((function(){G((function(e){return q(q({},e),{},{submitting:!1,success:!1,hideForm:!0})})),O(T.Z["role-detail"].link.replace(":roleId",t.uuid))}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return l().createElement(J.Provider,{value:q(q({},k),{},{setWizardError:function(e){return G((function(t){return q(q({},t),{},{error:e})}))},setWizardSuccess:function(e){return G((function(t){return q(q({},t),{},{success:e})}))},setHideForm:function(e){return G((function(t){return q(q({},t),{},{hideForm:e})}))},rolePermissions:t.access})},l().createElement(E.R,{type:r.formatMessage(Z.Z.permission).toLocaleLowerCase(),isOpen:c,onModalCancel:function(){return f(!1)},onModalConfirm:B}),k.hideForm?k.success?l().createElement(h.Wizard,{title:r.formatMessage(Z.Z.addPermissions),isOpen:!0,steps:[{name:"success",component:new P({currentRoleID:w}),isFinishedStep:!0}],onClose:B}):null:l().createElement(v.Z,{container:_,schema:I,subscription:{values:!0},FormTemplate:Y,initialValues:{"role-uuid":t.uuid,"role-type":"create","role-name":t.display_name,"role-description":t.description},componentMapper:q(q({},g.ZP),H),onSubmit:K,onCancel:function(e){var t;e&&(null===(t=e["add-permissions-table"])||void 0===t?void 0:t.length)>0?f(!0):B()}}))};K.defaultProps={role:{}},K.propTypes={role:m().object};const Q=K}}]);
//# sourceMappingURL=../sourcemaps/6292.c1d209f73da10d235ecd4142737a16fa.js.map