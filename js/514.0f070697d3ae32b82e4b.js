"use strict";(self.webpackChunkinsights_rbac_frontend=self.webpackChunkinsights_rbac_frontend||[]).push([[514],{61514:(e,t,r)=>{r.r(t),r.d(t,{default:()=>pe});var n=r(93433),o=r(29439),i=r(4942),a=r(92950),l=r.n(a),s=r(45237),c=r(334),u=r(6877),d=r(97066),f=r(64107),p=r(11107),m=function(e){return e.reduce((function(e,t){var r=t.uuid,o=t.display_name,i=t.name,s=t.description,u=t.system,d=t.accessCount,m=t.groups_in_count,y=t.modified;return[].concat((0,n.Z)(e),[{uuid:r,system:u,cells:[l().createElement(a.Fragment,{key:"".concat(r,"-name")},l().createElement(c.Link,{to:"/roles/detail/".concat(r)},o||i)),s,l().createElement(a.Fragment,{key:"".concat(r,"-accessCount")},l().createElement(c.Link,{to:"/roles/detail/".concat(r)},d)),m,l().createElement(a.Fragment,{key:"".concat(r,"-modified")},l().createElement(f.Z,{date:y,type:(0,p.mh)(y)}))]}])}),[])},y=r(28090),b=r(38376),g=r(41800),v=r(13063),h=r(54213),E=r(15608),O=r(4682),R=r(88040),P=r(93327),Z=function(e){return e.reduce((function(e,t){return[].concat((0,n.Z)(e),[{cells:[t]}])}),[])},j=r(39173),w=r(19571),_=r(61338),k=r(87462),S=r(45697),D=r.n(S),L=r(96354),C=r(36457),F=r(29215),M=r(76349),I=r(73943),T=r(45987),V=r(40483),A=r(48880),N=["ModalProps"];function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var B=function(e){var t=e.ModalProps,r=(0,T.Z)(e,N),n=(0,A.default)().getState().values;return l().createElement(V.Z,(0,k.Z)({},r,{ModalProps:q(q({},t),{},{onClose:function(){return t.onClose(n)}}),alert:n["dual-list-select"]?void 0:function(){return l().createElement("div",{className:"rbac-m-resource-definitions"},l().createElement(d.Alert,{className:"pf-c-modal__alert",variant:"danger",isInline:!0,title:"At least one resource must be defined for this permission"}))}}))};B.propTypes={ModalProps:D().object};const z=B;var W=r(42348),G=r.n(W);function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var X={changedResources:void 0,cancelWarningVisible:!1,resourcesPath:void 0,loadingStateVisible:!0};function K(e,t){switch(t.type){case"update":return Q(Q({},e),t.payload);default:throw new Error}}var U=function(e,t,r){return{fields:[{component:L.Z.DUAL_LIST_SELECT,name:"dual-list-select",leftTitle:"Resources available for the permission",rightTitle:"Resources defined for the permission",filterOptionsTitle:"Filter by resource...",filterValueTitle:"Filter by resource...",options:(0,n.Z)(t&&e?r:[]),validate:[{type:"validate-resources"}]}]}},J={"validate-resources":function(){return function(e){return e&&e.length>0?void 0:"At least one resource must be defined for this permission"}}},Y=function(e){var t=e.cancelRoute,r=(0,c.useRouteMatch)(O.Z["role-detail-permission-edit"]),i=(0,c.useRouteMatch)(r).params,u=i.permissionId,f=i.roleId,p=(0,c.useHistory)(),m=p.replace,b=p.push,g=(0,s.useDispatch)(),v=(0,a.useReducer)(K,X),h=(0,o.Z)(v,2),E=h[0],R=h[1],P=(0,s.useSelector)((function(e){var t;return{role:e.roleReducer.selectedRole,definedResources:null!==(t=e.roleReducer.selectedRole)&&void 0!==t&&t.access?G()(e.roleReducer.selectedRole.access.filter((function(e){return e.permission===u})).map((function(e){return e.resourceDefinitions.map((function(e){return e.attributeFilter.value}))}))):[],isRecordLoading:e.roleReducer.isRecordLoading}}),s.shallowEqual),Z=P.definedResources,j=P.role,w=(0,s.useSelector)((function(e){return function(e,t){var r=e.costReducer,n=r.resourceTypes,o=r.isLoading,i=r.loadingResources,a=r.resources;return{resourceTypes:n.data,resources:a[t]?{resourcesPath:a[t]}:a,isLoading:o,isLoadingResources:i>0}}(e,E.resourcesPath)}),s.shallowEqual),_=w.resourceTypes,S=w.isLoading,D=w.isLoadingResources,L=w.resources;(0,a.useEffect)((function(){g((0,F.A)())}),[u]),(0,a.useEffect)((function(){if(!S){var e,t=null===(e=_.find((function(e){var t;return e.value===(null===(t=u.split(":"))||void 0===t?void 0:t[1])})))||void 0===e?void 0:e.path;t&&(R({type:"update",payload:{resourcesPath:t.split("/")[5]}}),g((0,F.R)(t)))}}),[_]);var T=function(){return m(t)},V=function(e){e["dual-list-select"]===Z?T():R({type:"update",payload:{changedResources:e["dual-list-select"],cancelWarningVisible:!0}})},A=function(e){return Object.entries(e).reduce((function(e,t){var r=(0,o.Z)(t,2),i=r[0],a=r[1];return[].concat((0,n.Z)(e),(0,n.Z)(a.map((function(e){return{value:e.value,path:i,label:e.value}}))))}),[])}(L);return l().createElement(l().Fragment,null,l().createElement(I.R,{customTitle:"Exit edit resource definitions?",customDescription:"All changes will be lost.",isOpen:E.cancelWarningVisible,onModalCancel:function(){return R({type:"update",payload:{cancelWarningVisible:!1}})},onConfirmCancel:T}),(S||D)&&E.loadingStateVisible?l().createElement(d.Modal,{className:"rbac-m-resource-definitions",isOpen:!0,title:"Edit resource definitions",onClose:function(){R({type:"update",payload:{loadingStateVisible:!1}}),T()}},l().createElement(d.Spinner,null)):l().createElement(C.Z,{schema:U(L,E.resourcesPath,A),componentMapper:M.ZP,initialValues:{"dual-list-select":E.changedResources||Z||[]},onSubmit:function(e){var r;R({type:"update",payload:{changedResources:e["dual-list-select"]}});var o={permission:u,resourceDefinitions:[{attributeFilter:{key:"cost-management.".concat(null===(r=u.split(":"))||void 0===r?void 0:r[1]),operation:1===e["dual-list-select"].length?"equal":"in",value:1===e["dual-list-select"].length?e["dual-list-select"][0]:e["dual-list-select"]}}]};g((0,y.ul)(f,Q(Q({},j),{},{access:[].concat((0,n.Z)(j.access.filter((function(e){return e.permission!==u}))),[o])})),!0).then((function(){g((0,y.fp)(f)),b(t)}))},onCancel:function(e){return V(e)},validatorMapper:J,FormTemplate:function(e){return l().createElement(z,(0,k.Z)({},e,{ModalProps:{onClose:V,isOpen:!E.cancelWarningVisible,variant:"large",title:"Edit resource definitions",description:"Give or remove permissions to specific resources using the arrows below."}}))}}))};Y.propTypes={routeMatch:D().string.isRequired,cancelRoute:D().string.isRequired,resources:D().array,resourcesPath:D().string};const $=Y;var ee=r(85564),te=r.n(ee);function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const oe=function(){var e=(0,a.useState)({pagination:ne(ne({},_.he),{},{filter:""})}),t=(0,o.Z)(e,2),r=t[0],n=t[1],i=r.pagination,u=r.filter,f=(0,s.useDispatch)(),m=(0,c.useParams)(),v=m.roleId,h=m.permissionId,E=(0,s.useSelector)((function(e){var t,r,n,o,i;return{role:e.roleReducer.selectedRole,permission:e.roleReducer.selectedRole.access?ne({},null===(t=e.roleReducer.selectedRole)||void 0===t?void 0:t.access.find((function(e){return e.permission===h}))):{},isRecordLoading:e.roleReducer.isRecordLoading,rolesPagination:(null===(r=e.roleReducer)||void 0===r||null===(n=r.roles)||void 0===n?void 0:n.pagination)||_.he,rolesFilters:(null===(o=e.roleReducer)||void 0===o||null===(i=o.roles)||void 0===i?void 0:i.filters)||{}}}),s.shallowEqual),R=E.role,P=E.permission,k=E.isRecordLoading,S=E.rolesPagination,D=E.rolesFilters;(0,a.useEffect)((function(){f((0,y.fp)(v))}),[v]),(0,a.useEffect)((function(){n(ne(ne({},r),{},{pagination:ne(ne({},r.pagination),{},{count:R.access?R.access.length:0})}))}),[R]);var L=P.resourceDefinitions?te()(P.resourceDefinitions.map((function(e){return e.attributeFilter.value}))).filter((function(e){return!u||e.includes(u)})):[],C=function(){return l().createElement(a.Fragment,null,l().createElement(c.Route,{exact:!0,path:O.Z["role-detail-permission-edit"]},l().createElement($,{cancelRoute:O.Z["role-detail-permission"].replace(":roleId",v).replace(":permissionId",h)})))};return l().createElement(a.Fragment,null,l().createElement(b.Q,{breadcrumbs:[{title:"Roles",to:(0,p.zk)(C.roles,S,D)},{title:k?void 0:R&&(R.display_name||R.name),to:"/roles/detail/".concat(v)},{title:h,isActive:!0}]},l().createElement(d.Level,null,l().createElement(d.LevelItem,null,l().createElement(j.Z,{title:h||l().createElement(w.h2,null),className:"rbac-page-header__title"})))),l().createElement("section",{className:"pf-c-page__main-section rbac-c-role__permissions"},l().createElement(d.TextContent,null,l().createElement(d.Text,{component:d.TextVariants.h1},"Defined resources")),l().createElement(g.M,{columns:[{}],createRows:Z,data:L.slice(i.offset,i.offset+i.limit),filterValue:u,fetchData:function(e){var t=e.limit,o=e.offset,i=e.name;return n(ne(ne({},r),{},{filter:i,pagination:ne(ne({},r.pagination),{},{limit:t,offset:o})}))},isCompact:!0,routes:C,setFilterValue:function(e){var t=e.name;return n(ne(ne({},r),{},{filter:t}))},toolbarButtons:function(){return R.system?[]:[l().createElement(a.Fragment,{key:"edit-resource-definitions"},l().createElement(c.Link,{to:"/roles/detail/".concat(v,"/permission/").concat(h,"/edit")},l().createElement(d.Button,{variant:"primary","aria-label":"Edit"},"Edit")))]},isLoading:k,pagination:ne(ne({},i),{},{count:L.length}),titlePlural:"resources",titleSingular:"resource",hideHeader:!0,tableId:"role-resource-definitions"})))};var ie=r(92758),ae=r(78596),le=r(11549);function se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ce(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?se(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ue=(0,a.lazy)((function(){return Promise.all([r.e(705),r.e(287)]).then(r.bind(r,13287))})),de=[{title:"Name",key:"display_name",transforms:[(0,u.cellWidth)(20),u.sortable]},{title:"Description"},{title:"Permissions",transforms:[u.nowrap]},{title:"Groups",transforms:[u.nowrap]},{title:"Last modified",key:"modified",transforms:[u.nowrap,u.sortable]}],fe=function(e){var t=e.roleReducer,r=t.roles,n=t.isLoading;return{roles:r.data,filters:r.filters,meta:r.pagination,userIdentity:r.identity,isLoading:n}};const pe=function(){var e=(0,s.useDispatch)(),t=(0,c.useHistory)().push,r=(0,s.useSelector)(fe,s.shallowEqual),i=r.roles,u=r.isLoading,f=r.filters,Z=r.meta,j=r.userIdentity,w=function(t){return e((0,y.Kt)(ce(ce({},t),{},{inModal:!1})))},k=(0,c.useHistory)(),S=(0,a.useState)(Z),D=(0,o.Z)(S,2),L=D[0],C=D[1],F=(0,a.useState)(f.display_name||""),M=(0,o.Z)(F,2),I=M[0],T=M[1],V=(0,ae.Z)();(0,a.useEffect)((function(){var e=(0,_.rj)(k,L);C(e);var t=(0,ie.aX)(k,["display_name"],{display_name:I}).display_name;T(t),insights.chrome.appNavClick({id:"roles",secondaryNav:!0}),w(ce(ce({},e),{},{filters:{display_name:t}}))}),[]),(0,a.useEffect)((function(){T(f.display_name),C(Z)}),[f,Z]),(0,a.useEffect)((function(){Z.redirected&&(0,_.oG)(k,Z.limit,Z.offset)}),[Z.redirected]),(0,a.useEffect)((function(){(0,_.Zc)(k)||(0,_.oG)(k,L.limit,L.offset),(null==I?void 0:I.length)>0&&!(0,ie.qF)(k,["display_name"])&&(0,ie.aX)(k,["display_name"],{display_name:I})}));var A=function(){return l().createElement(a.Suspense,{fallback:l().createElement(a.Fragment,null)},l().createElement(c.Route,{exact:!0,path:O.Z["add-role"]},l().createElement(ue,{pagination:L,filters:{display_name:I}})),l().createElement(c.Route,{exact:!0,path:O.Z["remove-role"]},!u&&l().createElement(v.Z,{afterSubmit:function(){return w(ce(ce({},L),{},{offset:0,filters:{display_name:I}}))},routeMatch:O.Z["remove-role"],cancelRoute:(0,p.zk)(O.Z.roles,L,f),submitRoute:(0,p.zk)(O.Z.roles,ce(ce({},L),{},{offset:0}),f)})),l().createElement(c.Route,{exact:!0,path:O.Z["edit-role"]},!u&&l().createElement(R.Z,{afterSubmit:function(){return w(ce(ce({},L),{},{offset:0,filters:{display_name:I}}))},routeMatch:O.Z["edit-role"],cancelRoute:(0,p.zk)(O.Z.roles,L,f),submitRoute:(0,p.zk)(O.Z.roles,ce(ce({},L),{},{offset:0}),f)})))},N=function(e){return e.system?[]:[{title:"Edit",onClick:function(e,r,n){return t("/roles/edit/".concat(n.uuid))}},{title:"Delete",onClick:function(e,r,n){return t("/roles/remove/".concat(n.uuid))}}]},x=function(){var e;return null!=j&&null!==(e=j.user)&&void 0!==e&&e.is_org_admin?[l().createElement(c.Link,{to:O.Z["add-role"],key:"add-role",className:"ins-m-hide-on-sm"},l().createElement(d.Button,{ouiaId:"create-role-button",variant:"primary","aria-label":"Create role"},"Create role"))].concat((0,n.Z)((0,le.Z)(V)?[{label:"Create role",onClick:function(){k.push(O.Z["add-role"])}}]:[])):[]};return l().createElement(c.Switch,null,l().createElement(P.Z,{pageAction:"role-detail-permission",path:O.Z["role-detail-permission"]},l().createElement(oe,null)),l().createElement(P.Z,{pageAction:"role-detail",path:O.Z["role-detail"]},l().createElement(E.Z,{onDelete:function(){return T("")}})),l().createElement(P.Z,{pageAction:"roles-list",path:O.Z.roles,render:function(){return l().createElement(d.Stack,{className:"rbac-c-roles"},l().createElement(d.StackItem,null,l().createElement(b.Q,null,l().createElement(b.y,{title:"Roles"}))),l().createElement(d.StackItem,null,l().createElement(h.Z,{type:"content",id:"tab-roles"},l().createElement(g.M,{actionResolver:N,sortBy:{index:0,direction:"asc"},columns:de,createRows:m,data:i,filterValue:I,fetchData:function(e){var t=e.name,r=e.count,n=e.limit,o=e.offset,i=e.orderBy;return(0,_.oG)(k,n,o),(0,ie.MS)(k,{display_name:t}),w((0,p.jl)({count:r,limit:n,offset:o,orderBy:i,filters:{display_name:t}}))},setFilterValue:function(e){var t=e.name;return T(t)},isLoading:!u&&0===(null==i?void 0:i.length)&&0===(null==I?void 0:I.length)||u,pagination:L,routes:A,ouiaId:"roles-table",titlePlural:"roles",titleSingular:"role",toolbarButtons:x,filterPlaceholder:"name",tableId:"roles"}))))}}))}}}]);
//# sourceMappingURL=../sourcemaps/514.3f062512b099723be567aa6dbf2caa9d.js.map