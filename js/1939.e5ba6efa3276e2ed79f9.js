(self.webpackChunkrbac=self.webpackChunkrbac||[]).push([[1939,459],{55218:(e,t,o)=>{"use strict";o.d(t,{Z:()=>l});var a=o(28416),r=o.n(a),n=o(80236),s=o(47173),i=o(93149);const l=e=>{var{isOpen:t,onConfirm:o,onClose:l,children:c,confirmButtonLabel:p="Confirm",cancelButtonLabel:m="Cancel",variant:d=n.v.small,titleIconVariant:u="warning",withCheckbox:f=!1,checkboxLabel:g="I understand that this action cannot be undone",confirmButtonVariant:b=s.Wu.primary}=e,v=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(o[a[r]]=e[a[r]])}return o}(e,["isOpen","onConfirm","onClose","children","confirmButtonLabel","cancelButtonLabel","variant","titleIconVariant","withCheckbox","checkboxLabel","confirmButtonVariant"]);const[h,y]=(0,a.useState)(!1);return r().createElement(n.u,Object.assign({variant:d,isOpen:t,onClose:l,onEscapePress:l,titleIconVariant:u,actions:[r().createElement(s.zx,{ouiaId:"primary-confirm-button",key:"confirm",variant:b,onClick:o,isDisabled:f&&!h},p),r().createElement(s.zx,{ouiaId:"secondary-cancel-button",key:"cancel",variant:s.Wu.link,onClick:l},m)]},v),c,f?r().createElement(i.X,{isChecked:h,onChange:()=>y(!h),label:g,id:"warning-modal-check",className:"pf-v5-u-mt-lg"}):null)}},30120:(e,t,o)=>{"use strict";o.d(t,{a:()=>i});var a=o(65353),r=o(28416),n=o(62165),s=o(75587);const i=e=>{var{id:t="",children:o=null,className:i="",isOpen:l=!1,"aria-label":c="Actions",parentRef:p=null,getMenuRef:m=null,isActive:d=!1,isPlain:u=!1,isDisabled:f=!1,bubbleEvent:g=!1,onToggle:b=(()=>{}),ref:v}=e,h=(0,a.__rest)(e,["id","children","className","isOpen","aria-label","parentRef","getMenuRef","isActive","isPlain","isDisabled","bubbleEvent","onToggle","ref"]);return r.createElement(s.Z,Object.assign({id:t,className:i,isOpen:l,"aria-label":c,parentRef:p,getMenuRef:m,isActive:d,isPlain:u,isDisabled:f,onToggle:b,bubbleEvent:g},h),r.createElement(n.default,null))};i.displayName="KebabToggle"},19993:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>a}),o(70347);const a={backdrop:"pf-v5-c-backdrop",backdropOpen:"pf-v5-c-backdrop__open"}},62702:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>a}),o(25238);const a={button:"pf-v5-c-button",modalBox:"pf-v5-c-modal-box",modalBoxBody:"pf-v5-c-modal-box__body",modalBoxClose:"pf-v5-c-modal-box__close",modalBoxDescription:"pf-v5-c-modal-box__description",modalBoxFooter:"pf-v5-c-modal-box__footer",modalBoxHeader:"pf-v5-c-modal-box__header",modalBoxHeaderMain:"pf-v5-c-modal-box__header-main",modalBoxTitle:"pf-v5-c-modal-box__title",modalBoxTitleIcon:"pf-v5-c-modal-box__title-icon",modalBoxTitleText:"pf-v5-c-modal-box__title-text",modifiers:{sm:"pf-m-sm",md:"pf-m-md",lg:"pf-m-lg",alignTop:"pf-m-align-top",danger:"pf-m-danger",warning:"pf-m-warning",success:"pf-m-success",custom:"pf-m-custom",info:"pf-m-info",help:"pf-m-help",icon:"pf-m-icon"},themeDark:"pf-v5-theme-dark"}},63456:(e,t,o)=>{"use strict";o.d(t,{Z:()=>c});var a=o(85893),r=o(94184),n=o.n(r),s=o(28416);const i=o.n(s)().createContext("light");var l=function(){return l=Object.assign||function(e){for(var t,o=1,a=arguments.length;o<a;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},l.apply(this,arguments)};const c=function(e){var t=e.className,o=e.children,r=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(o[a[r]]=e[a[r]])}return o}(e,["className","children"]),s=n()(t,"pf-v5-l-page-header","pf-v5-c-page-header","pf-v5-l-page__main-section","pf-v5-c-page__main-section");return(0,a.jsx)(i.Consumer,{children:function(e){var t,i;void 0===e&&(e="light");var c=n()(((t={})["pf-m-".concat(e,"-200")]="dark"===e,t),((i={})["pf-m-light"]="light"===e,i));return(0,a.jsx)("section",l({},r,{className:"".concat(s," ").concat(c),"widget-type":"InsightsPageHeader",children:o}))}})}},84414:(e,t,o)=>{"use strict";o.d(t,{Z:()=>n});var a=o(62012),r=o(64756);const n=e=>{const t=(0,a.useNavigate)();return(o,a)=>t((0,r.n)(o,e),a)}},82617:(e,t,o)=>{"use strict";o.d(t,{Z:()=>m});var a=o(28416),r=o.n(a),n=o(45697),s=o.n(n),i=o(62012),l=o(75629),c=o(12849);const p=e=>e?r().createElement(l.Breadcrumb,null,Object.values(e).map(((e,t)=>e.title?r().createElement(l.BreadcrumbItem,{key:e.title,isActive:e.isActive},e.to&&r().createElement(i.NavLink,{end:!0,to:e.to},e.title)||e.title):r().createElement(c.Vj,{key:t})))):null;p.propTypes={breadcrumbs:s().object};const m=p},2086:(e,t,o)=>{"use strict";o.d(t,{Q:()=>u,y:()=>f});var a=o(28416),r=o.n(a),n=o(45697),s=o.n(n),i=o(64380),l=o(86304),c=o(12849),p=o(82617),m=o(63456),d=o(39173);const u=({children:e,breadcrumbs:t})=>r().createElement(a.Fragment,null,t&&r().createElement("section",{className:"pf-v5-c-page__main-breadcrumb"},r().createElement(p.Z,{...t})),r().createElement(m.Z,{className:"rbac-page-header"},e));u.propTypes={children:s().oneOfType([s().arrayOf(s().node),s().node]).isRequired,breadcrumbs:s().array,paddingBottom:s().bool},u.defaultProps={paddingBottom:!1};const f=({title:e,renderTitleTag:t,description:o,children:n})=>r().createElement(a.Fragment,null,r().createElement(l.Flex,null,r().createElement(l.FlexItem,{className:"pf-v5-u-mb-sm"},r().createElement(d.Z,{title:e||r().createElement(c.h2,null),className:"rbac-page-header__title"})),r().createElement(l.FlexItem,{alignSelf:{modifier:"alignSelfCenter"}},t&&t())),o&&r().createElement(i.TextContent,{className:"rbac-page-header__description"},"string"==typeof o?r().createElement(i.Text,{component:i.TextVariants.p},o):o),n);f.propTypes={title:s().node,renderTitleTag:s().func,description:s().node,children:s().oneOfType([s().node,s().arrayOf(s().node)])}},16920:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>te});var a=o(28416),r=o.n(a),n=o(45697),s=o.n(n),i=o(25387),l=o(62012),c=o(86706),p=o(31055),m=o(91848),d=o(64380),u=o(85044),f=o(79332),g=o(30120),b=o(39173),v=o(55140),h=o(84414),y=o(13563),E=o(2086),Z=o(77044),k=o(12849),_=o(75614),I=o(29301),M=o(74982),O=o(86379),x=o(1082),R=o(12913),T=o(55218),P=o(64756),B=o(97246),L=o(62410),C=o(85564),w=o.n(C),N=o(2550),S=o(14289);const D=(e,t,o,n,s=[])=>o.reduce(((o,{resourceDefinitions:i,permission:l,modified:c})=>{const[p,m,d]=l.split(":");return[...o,{uuid:l,cells:[p,m,d,...e?[(l.includes("cost-management")||l.includes("inventory"))&&i.length>0?r().createElement(a.Fragment,{key:"resource-definitions"},r().createElement(P.Z,{to:S.Z["role-detail-permission"].link.replace(":roleId",t).replace(":permissionId",l)},w()(i.map((e=>e.attributeFilter.value))).length)):r().createElement("span",{className:"rbac-c-text__disabled"},n.formatMessage(N.Z.notApplicable))]:[],r().createElement(a.Fragment,{key:`${p}-modified`},r().createElement(L.Z,{date:c,type:(0,I.mh)(c)}))],selected:Boolean(s?.find((({uuid:e})=>e===l)))}]}),[]),j={pagination:M.he,selectedPermissions:[],showRemoveModal:!1,confirmDelete:()=>null,deleteInfo:{},filters:{applications:[],resources:[],operations:[]},isToggled:!1,resources:[],operations:[]},A="SET_PAGINATION",F="SELECT_PERMISSIONS",V="SHOW_REMOVE_MODAL",G="SUBMIT_REMOVE_MODAL",W="INITIATE_REMOVE_PERMISSION",z="SET_FILTERS",H="SET_TOGGLED",K="INITIALIZE_ROLE",Q={[A]:(e,t)=>({...e,pagination:{...e.pagination,...t}}),[F]:(e,{selection:t})=>({...e,selectedPermissions:t}),[V]:(e,{showRemoveModal:t})=>({...e,showRemoveModal:t}),[G]:e=>({...e,selectedPermissions:[],showRemoveModal:!1}),[W]:(e,{confirmDelete:t,deleteInfo:o})=>({...e,confirmDelete:t,showRemoveModal:!0,deleteInfo:o}),[z]:(e,t)=>({...e,filters:{...e.filters,...t}}),[H]:e=>({...e,isToggled:!e.isToggled}),[K]:(e,{count:t,...o})=>({...e,...o,pagination:{...e.pagination,count:t}})},q=(e,{type:t,...o})=>Q[t]?Q[t](e,o):e,U=(e,t,o)=>r().createElement(i._H,{...o?N.Z.permissionsWillNotBeGrantedThroughRole:N.Z.permissionWillNotBeGrantedThroughRole,values:{b:e=>r().createElement("b",null,e),...o?{permissions:e}:{permission:e},role:t.name}}),$=({cantAddPermissions:e,isLoading:t})=>{const o=(0,i.YB)(),{role:n,isRecordLoading:s}=(0,c.useSelector)((e=>({role:e.roleReducer.selectedRole,isRecordLoading:e.roleReducer.isRecordLoading})),c.shallowEqual),l=(0,h.Z)(),[{pagination:m,selectedPermissions:d,showRemoveModal:u,confirmDelete:f,deleteInfo:g,filters:b,isToggled:v,resources:E,operations:Z},k]=(0,a.useReducer)(q,j),[_,I]=(0,a.useState)(!0),M=(0,c.useDispatch)(),L=[{title:o.formatMessage(N.Z.application)},{title:o.formatMessage(N.Z.resourceType)},{title:o.formatMessage(N.Z.operation)},{title:o.formatMessage(N.Z.resourceDefinitions),transforms:[(0,O.u)({popover:o.formatMessage(N.Z.resourceDefinitionsApplyToCostAndInventory),ariaLabel:o.formatMessage(N.Z.resourceDefinitionsApplyToCostAndInventory)})]},{title:o.formatMessage(N.Z.lastModified),transforms:[(0,x.d)(15)]}],C=e?[""]:["To configure user access to applications,","add at least one permission to this role.",""];(0,a.useEffect)((()=>{if(Object.keys(n||{}).length>0){const{resources:e,operations:t}=Object.entries(n.access.reduce((({resources:e,operations:t},{permission:o})=>{const[,a,r]=o.split(":");return{resources:e.includes(a)?e:[...e,a],operations:t.includes(r)?t:[...t,r]}}),{resources:[],operations:[]})).reduce(((e,[t,o])=>({...e,[t]:o.map((e=>({label:e,value:e})))})),{});k({type:K,resources:e,operations:t,count:n.access?n.access.length:0})}I(n?.access?.find((e=>e.permission.includes("cost-management")||e.permission.includes("inventory"))))}),[n]);const w=n&&n.access?(n.access||[]).filter((({permission:e})=>{const[t,o,a]=e.split(":"),{applications:r,resources:n,operations:s}=b;return(!(r.length>0)||r.includes(t))&&(!(n.length>0)||n.includes(o))&&(!(s.length>0)||s.includes(a))})).map((e=>({uuid:e.permission,...e,modified:n.modified}))):[],Q=e=>{const t=e.reduce(((e,t)=>[...e,t.uuid]),[]);return M((0,y.lq)(n,t)).then((()=>{M((0,y.fp)(n.uuid)),k({type:F,selection:[]})}))},$=e=>e.reduce(((e,t)=>({"":{...e?.[""],[t]:!0}})),{"":{}}),Y={label:r().createElement("div",null," ",o.formatMessage(N.Z.noResultsFound)),isDisabled:!0},X={access:[],applications:[],...n},J=Object.values({applications:X.applications,operations:Z,resources:E}).find((e=>e.length>10)),ee=w.slice(m.offset,m.offset+m.limit);return r().createElement("section",{className:"pf-v5-c-page__main-section rbac-c-role__permissions"},r().createElement(T.Z,{title:g.title,isOpen:u,confirmButtonLabel:g.confirmButtonLabel,confirmButtonVariant:p.ButtonVariant.danger,onClose:()=>k({type:V,showRemoveModal:!1}),onConfirm:()=>{f(),k({type:G})},"aria-label":"Remove role permissions modal"},g.text),t?r().createElement(R.Z,{rows:m.limit,columns:L.map((e=>e.title))}):r().createElement(B.M,{columns:_?L:L.filter((e=>e.title!==o.formatMessage(N.Z.resourceDefinitions))),rows:D(_,n?.uuid,ee,o,d),actionResolver:n.system?void 0:()=>[{title:o.formatMessage(N.Z.remove),onClick:(e,t,a)=>k({type:W,confirmDelete:()=>Q([a]),deleteInfo:{title:o.formatMessage(N.Z.removePermissionQuestion),text:U(a.uuid,n,!1),confirmButtonLabel:o.formatMessage(N.Z.removePermission)}})}],data:ee,filterValue:"",ouiaId:"role-permissions-table",fetchData:({limit:e,offset:t})=>k({type:A,limit:e,offset:t}),isSelectable:!n.system,setCheckedItems:e=>{k({type:F,selection:e(d).map((({uuid:e})=>({uuid:e})))})},checkedRows:d,onShowMore:J?()=>{k({type:H})}:void 0,setFilterValue:({applications:e,resources:t,operations:o})=>{k({type:z,...e?{applications:e}:b.applications,...t?{resources:t}:b.resources,...o?{operations:o}:b.operations})},toolbarButtons:()=>e?[]:[r().createElement(P.Z,{to:S.Z["role-add-permission"].link.replace(":roleId",n.uuid),key:"role-add-permission",className:"rbac-m-hide-on-sm"},r().createElement(p.Button,{variant:"primary","aria-label":"Add Permission"},o.formatMessage(N.Z.addPermissions))),{label:o.formatMessage(N.Z.addPermission),props:{className:"rbac-m-hide-on-md"},onClick:()=>{l(S.Z["role-add-permission"].link.replace(":roleId",n.uuid))}},{label:o.formatMessage(N.Z.remove),props:{isDisabled:!d.length>0},onClick:()=>{const e=d.length>1;k({type:W,confirmDelete:()=>Q([...d]),deleteInfo:{title:o.formatMessage(e?N.Z.removePermissionsQuestion:N.Z.removePermissionQuestion),text:U(e?d.length:d[0].uuid,n,d.length>1),confirmButtonLabel:o.formatMessage(e?N.Z.removePermissions:N.Z.removePermission)}})}}],isLoading:s,pagination:{...m,count:w.length},titlePlural:o.formatMessage(N.Z.permissions),titleSingular:o.formatMessage(N.Z.permission),emptyProps:{title:o.formatMessage(N.Z.noRolePermissions),description:C},filters:[{key:"applications",value:0===b.applications.length?"":b.applications,placeholder:o.formatMessage(N.Z.filterByKey,{key:o.formatMessage(N.Z.application).toLowerCase()}),type:"group",selected:$(b.applications),groups:[{type:X.applications.length>0?"checkbox":"plain",items:X.applications.length>0?X.applications.slice(0,v?void 0:10).map((e=>({label:e,value:e}))):[Y]}]},{key:"resources",value:0===b.resources.length?"":b.resources,placeholder:o.formatMessage(N.Z.filterByKey,{key:o.formatMessage(N.Z.resourceType).toLowerCase()}),type:"group",selected:$(b.resources),groups:[{type:E.length>0?"checkbox":"plain",items:E.length>0?E.slice(0,v?void 0:10):[Y]}]},{key:"operations",value:0===b.operations.length?"":b.operations,placeholder:o.formatMessage(N.Z.filterByKey,{key:o.formatMessage(N.Z.operation).toLowerCase()}),type:"group",selected:$(b.operations),groups:[{type:Z.length>0?"checkbox":"plain",items:Z.length>0?Z.slice(0,v?void 0:10):[Y]}]}],tableId:"role-permissions"}))};$.propTypes={cantAddPermissions:s().bool,isLoading:s().bool};const Y=$;var X=o(66180),J=o(82617);const ee=({onDelete:e})=>{const t=(0,i.YB)(),o=(0,v.Z)(),n=(0,h.Z)(),[s,O]=(0,a.useState)(!1),[x,R]=(0,a.useState)(!1),{roleId:T,groupId:B}=(0,l.useParams)(),{role:L,group:C,isLoading:w,rolesPagination:D,rolesFilters:j,groupsPagination:A,groupsFilters:F,systemGroupUuid:V}=(0,c.useSelector)((e=>({role:e.roleReducer.selectedRole,isLoading:e.roleReducer.isRecordLoading,...B&&{group:e.groupReducer.selectedGroup},systemGroupUuid:e.groupReducer.systemGroup?.uuid,rolesPagination:e.roleReducer?.roles?.pagination||M.he,rolesFilters:e.roleReducer?.roles?.filters||{},groupsPagination:e.groupReducer?.groups?.pagination||M.he,groupsFilters:e.groupReducer?.groups?.filters||{}})),c.shallowEqual),G=(0,c.useSelector)((e=>{const{roleReducer:{error:t}}=e;return t!==I.VG})),W=(0,c.useSelector)((e=>{const{groupReducer:{error:t}}=e;return t!==I.VG})),z=(0,c.useDispatch)(),H=()=>{if(z((0,y.fp)(T)),B)if(B!==_.Cn)z((0,Z.yi)(B));else{if(V)return z((0,Z.nV)(V,{})),o.appObjectId(V),()=>o.appObjectId(void 0);z((0,Z.WD)({chrome:o}))}};(0,a.useEffect)((()=>(H(),o.appObjectId(T),()=>o.appObjectId(void 0))),[T,B,V]),(0,a.useEffect)((()=>{0===L?.accessCount&&""!==L?.external_tenant&&""!==L?.external_role_id&&L?.system&&R(!0)}),[L]);const K=()=>[B?{title:t.formatMessage(N.Z.groups),to:(0,I.zk)((0,P.n)(S.Z.groups.link),A,F)}:{title:t.formatMessage(N.Z.roles),to:(0,I.zk)((0,P.n)(S.Z.roles.link),D,j)},...W&&B&&(B===_.Cn?V:W)?C?[{title:C&&C.name,to:(0,P.n)(S.Z["group-detail-roles"].link).replace(":groupId",B),isLoading:C&&C.loaded}]:[void 0]:W||!B?[]:[{title:t.formatMessage(N.Z.invalidGroup),isActive:!0}],...W||!B?[{title:w?void 0:G?L?.display_name||L?.name:t.formatMessage(N.Z.invalidRole),isActive:!0}]:[]],Q=!w&&L?L.display_name||L.name:void 0,q=!w&&L?L.description:void 0,U=[r().createElement(u.h,{component:r().createElement(P.Z,{onClick:()=>O(!1),to:S.Z["role-detail-edit"].link.replace(":roleId",T)},t.formatMessage(N.Z.edit)),key:"edit-role"}),r().createElement(u.h,{component:r().createElement(P.Z,{onClick:e,to:S.Z["role-detail-remove"].link.replace(":roleId",T)},t.formatMessage(N.Z.delete)),className:"rbac-c-role__action",key:"delete-role"})];return r().createElement(a.Fragment,null,!W&&B||!G?r().createElement(a.Fragment,null,r().createElement("section",{className:"pf-v5-c-page__main-breadcrumb pf-v5-u-pb-md"},r().createElement(J.Z,{...K()})),r().createElement(X.Z,{title:(W?"Role":"Group")+" not found",description:[`${W?"Role":"Group"} with ID ${W?T:B} does not exist.`],actions:[r().createElement(p.Button,{key:"back-button",className:"pf-v5-u-mt-xl",ouiaId:"back-button",variant:"primary","aria-label":"Back to previous page",onClick:()=>n(-1)},t.formatMessage(N.Z.backToPreviousPage))]})):r().createElement(a.Fragment,null,r().createElement(E.Q,{breadcrumbs:K()},r().createElement(m.Level,null,r().createElement(m.LevelItem,null,r().createElement(b.Z,{title:Q||r().createElement(k.h2,null),className:"rbac-page-header__title"})),!w&&L&&!L.system&&r().createElement(m.LevelItem,null,r().createElement(f.L,{ouiaId:"role-title-actions-dropdown",toggle:r().createElement(g.a,{onToggle:(e,t)=>O(t),id:"role-actions-dropdown"}),isOpen:s,isPlain:!0,position:"right",dropdownItems:U}))),q&&r().createElement(d.TextContent,{className:"rbac-page-header__description"},r().createElement(d.Text,{component:"p"},q))),r().createElement(Y,{cantAddPermissions:x,isLoading:w||!L}),r().createElement(a.Suspense,null,r().createElement(l.Outlet,{context:{[S.Z["role-detail-remove"].path]:{afterSubmit:()=>{z((0,y.Kt)({...D,offset:0,filters:j,usesMetaInURL:!0,chrome:o}))},cancelRoute:S.Z["role-detail"].link.replace(":roleId",T),submitRoute:(0,I.zk)(S.Z.roles.link,{...D,offset:0},j),isLoading:w},[S.Z["role-detail-edit"].path]:{afterSubmit:H,cancelRoute:S.Z["role-detail"].link.replace(":roleId",T),isLoading:w},[S.Z["role-add-permission"].path]:{isOpen:!0,role:L}}}))))};ee.propTypes={onDelete:s().func};const te=ee},70347:()=>{},30187:()=>{},25238:()=>{}}]);
//# sourceMappingURL=../sourcemaps/1939.99ed21362064bb851f68aa7ff9b91d6f.js.map