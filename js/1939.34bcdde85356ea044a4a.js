(self.webpackChunkrbac=self.webpackChunkrbac||[]).push([[1939,459],{55218:(e,t,o)=>{"use strict";o.d(t,{Z:()=>l});var a=o(28416),n=o.n(a),r=o(80236),s=o(47173),i=o(93149);const l=e=>{var{isOpen:t,onConfirm:o,onClose:l,children:c,confirmButtonLabel:p="Confirm",cancelButtonLabel:m="Cancel",variant:d=r.v.small,titleIconVariant:u="warning",withCheckbox:f=!1,checkboxLabel:g="I understand that this action cannot be undone",confirmButtonVariant:b=s.Wu.primary,ouiaId:v="WarningModal"}=e,h=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(o[a[n]]=e[a[n]])}return o}(e,["isOpen","onConfirm","onClose","children","confirmButtonLabel","cancelButtonLabel","variant","titleIconVariant","withCheckbox","checkboxLabel","confirmButtonVariant","ouiaId"]);const[y,E]=(0,a.useState)(!1);return n().createElement(r.u,Object.assign({variant:d,isOpen:t,onClose:l,onEscapePress:l,titleIconVariant:u,actions:[n().createElement(s.zx,{ouiaId:`${v}-confirm-button`,key:"confirm",variant:b,onClick:()=>{null==o||o(),E(!1)},isDisabled:f&&!y},p),n().createElement(s.zx,{ouiaId:`${v}-cancel-button`,key:"cancel",variant:s.Wu.link,onClick:l},m)],ouiaId:v},h),c,f?n().createElement(i.X,{isChecked:y,onChange:(e,t)=>E(t),label:g,id:"warning-modal-check",className:"pf-v5-u-mt-lg",ouiaId:`${v}-confirm-checkbox`}):null)}},30120:(e,t,o)=>{"use strict";o.d(t,{a:()=>i});var a=o(65353),n=o(28416),r=o(62165),s=o(75587);const i=e=>{var{id:t="",children:o=null,className:i="",isOpen:l=!1,"aria-label":c="Actions",parentRef:p=null,getMenuRef:m=null,isActive:d=!1,isPlain:u=!1,isDisabled:f=!1,bubbleEvent:g=!1,onToggle:b=(()=>{}),ref:v}=e,h=(0,a.__rest)(e,["id","children","className","isOpen","aria-label","parentRef","getMenuRef","isActive","isPlain","isDisabled","bubbleEvent","onToggle","ref"]);return n.createElement(s.Z,Object.assign({id:t,className:i,isOpen:l,"aria-label":c,parentRef:p,getMenuRef:m,isActive:d,isPlain:u,isDisabled:f,onToggle:b,bubbleEvent:g},h),n.createElement(r.default,null))};i.displayName="KebabToggle"},19993:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>a}),o(70347);const a={backdrop:"pf-v5-c-backdrop",backdropOpen:"pf-v5-c-backdrop__open"}},62702:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>a}),o(25238);const a={button:"pf-v5-c-button",modalBox:"pf-v5-c-modal-box",modalBoxBody:"pf-v5-c-modal-box__body",modalBoxClose:"pf-v5-c-modal-box__close",modalBoxDescription:"pf-v5-c-modal-box__description",modalBoxFooter:"pf-v5-c-modal-box__footer",modalBoxHeader:"pf-v5-c-modal-box__header",modalBoxHeaderMain:"pf-v5-c-modal-box__header-main",modalBoxTitle:"pf-v5-c-modal-box__title",modalBoxTitleIcon:"pf-v5-c-modal-box__title-icon",modalBoxTitleText:"pf-v5-c-modal-box__title-text",modifiers:{sm:"pf-m-sm",md:"pf-m-md",lg:"pf-m-lg",alignTop:"pf-m-align-top",danger:"pf-m-danger",warning:"pf-m-warning",success:"pf-m-success",custom:"pf-m-custom",info:"pf-m-info",help:"pf-m-help",icon:"pf-m-icon"},themeDark:"pf-v5-theme-dark"}},63456:(e,t,o)=>{"use strict";o.d(t,{Z:()=>c});var a=o(85893),n=o(94184),r=o.n(n),s=o(28416);const i=o.n(s)().createContext("light");var l=function(){return l=Object.assign||function(e){for(var t,o=1,a=arguments.length;o<a;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},l.apply(this,arguments)};const c=function(e){var t=e.className,o=e.children,n=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(o[a[n]]=e[a[n]])}return o}(e,["className","children"]),s=r()(t,"pf-v5-l-page-header","pf-v5-c-page-header","pf-v5-l-page__main-section","pf-v5-c-page__main-section");return(0,a.jsx)(i.Consumer,{children:function(e){var t,i;void 0===e&&(e="light");var c=r()(((t={})["pf-m-".concat(e,"-200")]="dark"===e,t),((i={})["pf-m-light"]="light"===e,i));return(0,a.jsx)("section",l({},n,{className:"".concat(s," ").concat(c),"widget-type":"InsightsPageHeader",children:o}))}})}},84414:(e,t,o)=>{"use strict";o.d(t,{Z:()=>r});var a=o(62012),n=o(64756);const r=e=>{const t=(0,a.useNavigate)();return(o,a)=>t((0,n.n)(o,e),a)}},82617:(e,t,o)=>{"use strict";o.d(t,{Z:()=>m});var a=o(28416),n=o.n(a),r=o(45697),s=o.n(r),i=o(62012),l=o(75629),c=o(12849);const p=e=>e?n().createElement(l.Breadcrumb,null,Object.values(e).map(((e,t)=>e.title?n().createElement(l.BreadcrumbItem,{key:e.title,isActive:e.isActive},e.to&&n().createElement(i.NavLink,{end:!0,to:e.to},e.title)||e.title):n().createElement(c.Vj,{key:t})))):null;p.propTypes={breadcrumbs:s().object};const m=p},2086:(e,t,o)=>{"use strict";o.d(t,{Q:()=>u,y:()=>f});var a=o(28416),n=o.n(a),r=o(45697),s=o.n(r),i=o(64380),l=o(86304),c=o(12849),p=o(82617),m=o(63456),d=o(39173);const u=({children:e,breadcrumbs:t})=>n().createElement(a.Fragment,null,t&&n().createElement("section",{className:"pf-v5-c-page__main-breadcrumb"},n().createElement(p.Z,{...t})),n().createElement(m.Z,{className:"rbac-page-header"},e));u.propTypes={children:s().oneOfType([s().arrayOf(s().node),s().node]).isRequired,breadcrumbs:s().array,paddingBottom:s().bool},u.defaultProps={paddingBottom:!1};const f=({title:e,renderTitleTag:t,description:o,children:r})=>n().createElement(a.Fragment,null,n().createElement(l.Flex,null,n().createElement(l.FlexItem,{className:"pf-v5-u-mb-sm"},n().createElement(d.Z,{title:e||n().createElement(c.h2,null),className:"rbac-page-header__title"})),n().createElement(l.FlexItem,{alignSelf:{modifier:"alignSelfCenter"}},t&&t())),o&&n().createElement(i.TextContent,{className:"rbac-page-header__description"},"string"==typeof o?n().createElement(i.Text,{component:i.TextVariants.p},o):o),r);f.propTypes={title:s().node,renderTitleTag:s().func,description:s().node,children:s().oneOfType([s().node,s().arrayOf(s().node)])}},16920:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>te});var a=o(28416),n=o.n(a),r=o(45697),s=o.n(r),i=o(25387),l=o(62012),c=o(86706),p=o(31055),m=o(91848),d=o(64380),u=o(85044),f=o(79332),g=o(30120),b=o(39173),v=o(55140),h=o(13563),y=o(2086),E=o(77044),Z=o(12849),k=o(75614),I=o(29301),_=o(84414),M=o(74982),O=o(86379),x=o(1082),R=o(12913),T=o(55218),P=o(64756),B=o(97246),L=o(62410),C=o(85564),w=o.n(C),N=o(2550),S=o(14289);const D=(e,t,o,r,s=[])=>o.reduce(((o,{resourceDefinitions:i,permission:l,modified:c})=>{const[p,m,d]=l.split(":");return[...o,{uuid:l,cells:[p,m,d,...e?[(l.includes("cost-management")||l.includes("inventory"))&&i.length>0?n().createElement(a.Fragment,{key:"resource-definitions"},n().createElement(P.Z,{to:S.Z["role-detail-permission"].link.replace(":roleId",t).replace(":permissionId",l)},w()(i.map((e=>e.attributeFilter.value))).length)):n().createElement("span",{className:"rbac-c-text__disabled"},r.formatMessage(N.Z.notApplicable))]:[],n().createElement(a.Fragment,{key:`${p}-modified`},n().createElement(L.Z,{date:c,type:(0,I.mh)(c)}))],selected:Boolean(s?.find((({uuid:e})=>e===l)))}]}),[]),j={pagination:M.he,selectedPermissions:[],showRemoveModal:!1,confirmDelete:()=>null,deleteInfo:{},filters:{applications:[],resources:[],operations:[]},isToggled:!1,resources:[],operations:[]},A="SET_PAGINATION",F="SELECT_PERMISSIONS",V="SHOW_REMOVE_MODAL",G="SUBMIT_REMOVE_MODAL",W="INITIATE_REMOVE_PERMISSION",$="SET_FILTERS",z="SET_TOGGLED",H="INITIALIZE_ROLE",K={[A]:(e,t)=>({...e,pagination:{...e.pagination,...t}}),[F]:(e,{selection:t})=>({...e,selectedPermissions:t}),[V]:(e,{showRemoveModal:t})=>({...e,showRemoveModal:t}),[G]:e=>({...e,selectedPermissions:[],showRemoveModal:!1}),[W]:(e,{confirmDelete:t,deleteInfo:o})=>({...e,confirmDelete:t,showRemoveModal:!0,deleteInfo:o}),[$]:(e,t)=>({...e,filters:{...e.filters,...t}}),[z]:e=>({...e,isToggled:!e.isToggled}),[H]:(e,{count:t,...o})=>({...e,...o,pagination:{...e.pagination,count:t}})},Q=(e,{type:t,...o})=>K[t]?K[t](e,o):e,q=(e,t,o)=>n().createElement(i._H,{...o?N.Z.permissionsWillNotBeGrantedThroughRole:N.Z.permissionWillNotBeGrantedThroughRole,values:{b:e=>n().createElement("b",null,e),...o?{permissions:e}:{permission:e},role:t.name}}),U=({cantAddPermissions:e,isLoading:t})=>{const o=(0,i.YB)(),{role:r,isRecordLoading:s}=(0,c.useSelector)((e=>({role:e.roleReducer.selectedRole,isRecordLoading:e.roleReducer.isRecordLoading})),c.shallowEqual),l=(0,_.Z)(),[{pagination:m,selectedPermissions:d,showRemoveModal:u,confirmDelete:f,deleteInfo:g,filters:b,isToggled:v,resources:y,operations:E},Z]=(0,a.useReducer)(Q,j),[k,I]=(0,a.useState)(!0),M=(0,c.useDispatch)(),L=[{title:o.formatMessage(N.Z.application)},{title:o.formatMessage(N.Z.resourceType)},{title:o.formatMessage(N.Z.operation)},{title:o.formatMessage(N.Z.resourceDefinitions),transforms:[(0,O.u)({popover:o.formatMessage(N.Z.resourceDefinitionsApplyToCostAndInventory),ariaLabel:o.formatMessage(N.Z.resourceDefinitionsApplyToCostAndInventory)})]},{title:o.formatMessage(N.Z.lastModified),transforms:[(0,x.d)(15)]}],C=e?[""]:["To configure user access to applications,","add at least one permission to this role.",""];(0,a.useEffect)((()=>{if(Object.keys(r||{}).length>0){const{resources:e,operations:t}=Object.entries(r.access.reduce((({resources:e,operations:t},{permission:o})=>{const[,a,n]=o.split(":");return{resources:e.includes(a)?e:[...e,a],operations:t.includes(n)?t:[...t,n]}}),{resources:[],operations:[]})).reduce(((e,[t,o])=>({...e,[t]:o.map((e=>({label:e,value:e})))})),{});Z({type:H,resources:e,operations:t,count:r.access?r.access.length:0})}I(r?.access?.find((e=>e.permission.includes("cost-management")||e.permission.includes("inventory"))))}),[r]);const w=r&&r.access?(r.access||[]).filter((({permission:e})=>{const[t,o,a]=e.split(":"),{applications:n,resources:r,operations:s}=b;return(!(n.length>0)||n.includes(t))&&(!(r.length>0)||r.includes(o))&&(!(s.length>0)||s.includes(a))})).map((e=>({uuid:e.permission,...e,modified:r.modified}))):[],K=e=>{const t=e.reduce(((e,t)=>[...e,t.uuid]),[]);return M((0,h.lq)(r,t)).then((()=>{M((0,h.fp)(r.uuid)),Z({type:F,selection:[]})}))},U=e=>e.reduce(((e,t)=>({"":{...e?.[""],[t]:!0}})),{"":{}}),Y={label:n().createElement("div",null," ",o.formatMessage(N.Z.noResultsFound)),isDisabled:!0},X={access:[],applications:[],...r},J=Object.values({applications:X.applications,operations:E,resources:y}).find((e=>e.length>10)),ee=w.slice(m.offset,m.offset+m.limit);return n().createElement("section",{className:"pf-v5-c-page__main-section rbac-c-role__permissions"},n().createElement(T.Z,{title:g.title,isOpen:u,confirmButtonLabel:g.confirmButtonLabel,confirmButtonVariant:p.ButtonVariant.danger,onClose:()=>Z({type:V,showRemoveModal:!1}),onConfirm:()=>{f(),Z({type:G})},"aria-label":"Remove role permissions modal"},g.text),t?n().createElement(R.Z,{rows:m.limit,columns:L.map((e=>e.title))}):n().createElement(B.M,{columns:k?L:L.filter((e=>e.title!==o.formatMessage(N.Z.resourceDefinitions))),rows:D(k,r?.uuid,ee,o,d),actionResolver:r.system?void 0:()=>[{title:o.formatMessage(N.Z.remove),onClick:(e,t,a)=>Z({type:W,confirmDelete:()=>K([a]),deleteInfo:{title:o.formatMessage(N.Z.removePermissionQuestion),text:q(a.uuid,r,!1),confirmButtonLabel:o.formatMessage(N.Z.removePermission)}})}],data:ee,filterValue:"",ouiaId:"role-permissions-table",fetchData:({limit:e,offset:t})=>Z({type:A,limit:e,offset:t}),isSelectable:!r.system,setCheckedItems:e=>{Z({type:F,selection:e(d).map((({uuid:e})=>({uuid:e})))})},checkedRows:d,onShowMore:J?()=>{Z({type:z})}:void 0,setFilterValue:({applications:e,resources:t,operations:o})=>{Z({type:$,...e?{applications:e}:b.applications,...t?{resources:t}:b.resources,...o?{operations:o}:b.operations})},toolbarButtons:()=>e?[]:[n().createElement(P.Z,{to:S.Z["role-add-permission"].link.replace(":roleId",r.uuid),key:"role-add-permission",className:"rbac-m-hide-on-sm"},n().createElement(p.Button,{variant:"primary","aria-label":"Add Permission"},o.formatMessage(N.Z.addPermissions))),{label:o.formatMessage(N.Z.addPermission),props:{className:"rbac-m-hide-on-md"},onClick:()=>{l(S.Z["role-add-permission"].link.replace(":roleId",r.uuid))}},{label:o.formatMessage(N.Z.remove),props:{isDisabled:!d.length>0},onClick:()=>{const e=d.length>1;Z({type:W,confirmDelete:()=>K([...d]),deleteInfo:{title:o.formatMessage(e?N.Z.removePermissionsQuestion:N.Z.removePermissionQuestion),text:q(e?d.length:d[0].uuid,r,d.length>1),confirmButtonLabel:o.formatMessage(e?N.Z.removePermissions:N.Z.removePermission)}})}}],isLoading:s,pagination:{...m,count:w.length},titlePlural:o.formatMessage(N.Z.permissions),titleSingular:o.formatMessage(N.Z.permission),emptyProps:{title:o.formatMessage(N.Z.noRolePermissions),description:C},filters:[{key:"applications",value:0===b.applications.length?"":b.applications,placeholder:o.formatMessage(N.Z.filterByKey,{key:o.formatMessage(N.Z.application).toLowerCase()}),type:"group",selected:U(b.applications),groups:[{type:X.applications.length>0?"checkbox":"plain",items:X.applications.length>0?X.applications.slice(0,v?void 0:10).map((e=>({label:e,value:e}))):[Y]}]},{key:"resources",value:0===b.resources.length?"":b.resources,placeholder:o.formatMessage(N.Z.filterByKey,{key:o.formatMessage(N.Z.resourceType).toLowerCase()}),type:"group",selected:U(b.resources),groups:[{type:y.length>0?"checkbox":"plain",items:y.length>0?y.slice(0,v?void 0:10):[Y]}]},{key:"operations",value:0===b.operations.length?"":b.operations,placeholder:o.formatMessage(N.Z.filterByKey,{key:o.formatMessage(N.Z.operation).toLowerCase()}),type:"group",selected:U(b.operations),groups:[{type:E.length>0?"checkbox":"plain",items:E.length>0?E.slice(0,v?void 0:10):[Y]}]}],tableId:"role-permissions"}))};U.propTypes={cantAddPermissions:s().bool,isLoading:s().bool};const Y=U;var X=o(66180),J=o(82617);const ee=({onDelete:e})=>{const t=(0,i.YB)(),o=(0,v.Z)(),r=(0,_.Z)(),s=(0,l.useNavigationType)(),[O,x]=(0,a.useState)(!1),[R,T]=(0,a.useState)(!1),{roleId:B,groupId:L}=(0,l.useParams)(),{role:C,group:w,isLoading:D,rolesPagination:j,rolesFilters:A,groupsPagination:F,groupsFilters:V,systemGroupUuid:G}=(0,c.useSelector)((e=>({role:e.roleReducer.selectedRole,isLoading:e.roleReducer.isRecordLoading,...L&&{group:e.groupReducer.selectedGroup},systemGroupUuid:e.groupReducer.systemGroup?.uuid,rolesPagination:e.roleReducer?.roles?.pagination||M.he,rolesFilters:e.roleReducer?.roles?.filters||{},groupsPagination:e.groupReducer?.groups?.pagination||M.he,groupsFilters:e.groupReducer?.groups?.filters||{}})),c.shallowEqual),W=(0,c.useSelector)((e=>{const{roleReducer:{error:t}}=e;return t!==I.VG})),$=(0,c.useSelector)((e=>{const{groupReducer:{error:t}}=e;return t!==I.VG})),z=(0,c.useDispatch)(),H=()=>{if(z((0,h.fp)(B)),L)if(L!==k.Cn)z((0,E.yi)(L));else{if(G)return z((0,E.nV)(G,{})),o.appObjectId(G),()=>o.appObjectId(void 0);z((0,E.WD)({chrome:o}))}};(0,a.useEffect)((()=>(H(),o.appObjectId(B),()=>o.appObjectId(void 0))),[B,L,G]),(0,a.useEffect)((()=>{0===C?.accessCount&&""!==C?.external_tenant&&""!==C?.external_role_id&&C?.system&&T(!0)}),[C]);const K=()=>[L?{title:t.formatMessage(N.Z.groups),to:(0,I.zk)((0,P.n)(S.Z.groups.link),F,V)}:{title:t.formatMessage(N.Z.roles),to:(0,I.zk)((0,P.n)(S.Z.roles.link),j,A)},...$&&L&&(L===k.Cn?G:$)?w?[{title:w&&w.name,to:(0,P.n)(S.Z["group-detail-roles"].link).replace(":groupId",L),isLoading:w&&w.loaded}]:[void 0]:$||!L?[]:[{title:t.formatMessage(N.Z.invalidGroup),isActive:!0}],...$||!L?[{title:D?void 0:W?C?.display_name||C?.name:t.formatMessage(N.Z.invalidRole),isActive:!0}]:[]],Q=!D&&C?C.display_name||C.name:void 0,q=!D&&C?C.description:void 0,U=[n().createElement(u.h,{component:n().createElement(P.Z,{onClick:()=>x(!1),to:S.Z["role-detail-edit"].link.replace(":roleId",B)},t.formatMessage(N.Z.edit)),key:"edit-role"}),n().createElement(u.h,{component:n().createElement(P.Z,{onClick:e,to:S.Z["role-detail-remove"].link.replace(":roleId",B)},t.formatMessage(N.Z.delete)),className:"rbac-c-role__action",key:"delete-role"})];return n().createElement(a.Fragment,null,!$&&L||!W?n().createElement(a.Fragment,null,n().createElement("section",{className:"pf-v5-c-page__main-breadcrumb pf-v5-u-pb-md"},n().createElement(J.Z,{...K()})),n().createElement(X.Z,{title:($?"Role":"Group")+" not found",description:[`${$?"Role":"Group"} with ID ${$?B:L} does not exist.`],actions:[n().createElement(p.Button,{key:"back-button",className:"pf-v5-u-mt-xl",ouiaId:"back-button",variant:"primary","aria-label":"Back to previous page",onClick:()=>r("POP"!==s?-1:S.Z.roles.link)},t.formatMessage(N.Z.backToPreviousPage))]})):n().createElement(a.Fragment,null,n().createElement(y.Q,{breadcrumbs:K()},n().createElement(m.Level,null,n().createElement(m.LevelItem,null,n().createElement(b.Z,{title:Q||n().createElement(Z.h2,null),className:"rbac-page-header__title"})),!D&&C&&!C.system&&n().createElement(m.LevelItem,null,n().createElement(f.L,{ouiaId:"role-title-actions-dropdown",toggle:n().createElement(g.a,{onToggle:(e,t)=>x(t),id:"role-actions-dropdown"}),isOpen:O,isPlain:!0,position:"right",dropdownItems:U}))),q&&n().createElement(d.TextContent,{className:"rbac-page-header__description"},n().createElement(d.Text,{component:"p"},q))),n().createElement(Y,{cantAddPermissions:R,isLoading:D||!C}),n().createElement(a.Suspense,null,n().createElement(l.Outlet,{context:{[S.Z["role-detail-remove"].path]:{afterSubmit:()=>{z((0,h.Kt)({...j,offset:0,filters:A,usesMetaInURL:!0,chrome:o}))},cancelRoute:S.Z["role-detail"].link.replace(":roleId",B),submitRoute:(0,I.zk)(S.Z.roles.link,{...j,offset:0},A),isLoading:D},[S.Z["role-detail-edit"].path]:{afterSubmit:H,cancelRoute:S.Z["role-detail"].link.replace(":roleId",B),isLoading:D},[S.Z["role-add-permission"].path]:{isOpen:!0,role:C}}}))))};ee.propTypes={onDelete:s().func};const te=ee},70347:()=>{},30187:()=>{},25238:()=>{}}]);
//# sourceMappingURL=../sourcemaps/1939.26ebe06793a539db796e79718154eae4.js.map