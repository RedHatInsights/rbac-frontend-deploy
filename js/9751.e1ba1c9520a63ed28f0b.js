(self.webpackChunkrbac=self.webpackChunkrbac||[]).push([[9751,6710],{30445:(e,t,a)=>{"use strict";a.d(t,{A:()=>m});var r=a(79994),s=a(44914),n=a.n(s),o=a(5556),i=a.n(o),l=(a(58156),a(81558));i().oneOfType([i().string,i().func,i().object]),i().func.isRequired,i().node.isRequired,i().bool,i().func.isRequired,i().node.isRequired,i().func.isRequired;const c=({renderNextButton:e,disableBack:t,handlePrev:a,buttonLabels:{cancel:o,back:i},context:c})=>{const m=(0,l.default)(),{success:d,error:p,submitting:u}=(0,s.useContext)(c);return d||void 0===p||p||u?null:n().createElement(s.Fragment,null,e(),n().createElement(r.Button,{type:"button",variant:"secondary",isDisabled:t,onClick:a},i),n().createElement(r.Button,{type:"button",variant:"link",onClick:m.onCancel},o))};c.propTypes={disableBack:i().bool,handlePrev:i().func.isRequired,handleNext:i().func.isRequired,nextStep:i().oneOfType([i().string,i().shape({when:i().string.isRequired,stepMapper:i().object.isRequired}),i().func]),buttonLabels:i().shape({submit:i().node.isRequired,cancel:i().node.isRequired,back:i().node.isRequired,next:i().node.isRequired}).isRequired,context:i().object.isRequired,renderNextButton:i().func};const m=c},43386:(e,t,a)=>{"use strict";a.d(t,{A:()=>u});var r=a(44914),s=a.n(r),n=a(79994),o=a(76347),i=a(6442),l=a(5556),c=a.n(l),m=a(40335),d=a(50644);const p=({context:e,title:t,text:a,customFooter:l})=>{const c=(0,i.A)(),{jumpToStep:p}=(0,r.useContext)(o.default),{setWizardError:u}=(0,r.useContext)(e);return s().createElement(d.W5,{errorTitle:t,errorDescription:a,customFooter:l||s().createElement(n.Button,{onClick:()=>{u(void 0),p(0)},variant:n.ButtonVariant.primary},c.formatMessage(m.A.returnToStepNumber,{number:1}))})};p.propTypes={context:c().object.isRequired,title:c().string.isRequired,text:c().string.isRequired,customFooter:c().element};const u=p},2695:(e,t,a)=>{"use strict";a.r(t),a.d(t,{AddRoleWizardContext:()=>Ae,default:()=>Re,mapperExtension:()=>xe});var r=a(44914),s=a.n(r),n=a(5556),o=a.n(n),i=a(69733),l=a(6442),c=a(70763),m=a(79371),d=a(63537),p=a(42655),u=a(67655),g=a(42134),f=a(20881),y=a(95658),E=a(1621),h=a(71436),A=a(29068),v=a(40748),b=a(7248),x=a(31237),M=a(73356),R=a(81558),T=a(25970),C=a(87683),S=a(18857),k=a(40335),w=a(67169);const q=async e=>{const t=(0,C.MT)(),a=(0,S.E)({locale:T.H,messages:w},t);if(!e)return;const r=await(0,x.kN)({limit:10,offset:0,name:e,nameMatch:"exact"}).catch((e=>{console.error(e)})),s=await(0,x.kN)({limit:10,offset:0,displayName:e,nameMatch:"exact"}).catch((e=>{console.error(e)}));if(r?.data?.length>0||s?.data?.length>0)throw a.formatMessage(k.A.nameAlreadyTaken)},F=(0,M.A)(q),I=({name:e})=>{const t=(0,R.default)();return(0,r.useEffect)((()=>(setTimeout((()=>t.change(e,"1"))),()=>t.change(e,""))),[]),null};I.propTypes={name:o().string.isRequired};var N=a(43386);const G=({formFields:e})=>{const t=(0,l.A)(),{submitting:a,error:n,setWizardError:o}=(0,r.useContext)(Ae),{getState:i}=(0,R.default)();return(0,r.useEffect)((()=>{o(void 0),q(i().values["role-name"]).then((()=>o(!1))).catch((()=>o(!0)))}),[]),void 0===n||a?s().createElement(h.Bullseye,null,s().createElement(A.Spinner,{size:"xl"})):!0===n?s().createElement(N.A,{context:Ae,title:t.formatMessage(k.A.roleNameTakenTitle),text:t.formatMessage(k.A.roleNameTakenText)}):s().createElement("div",{className:"rbac"},s().createElement(b.Title,{headingLevel:"h1",size:"xl",className:"pf-v5-u-mb-sm"},t.formatMessage(k.A.reviewDetails)),s().createElement(v.TextContent,{className:"pf-v5-u-mb-md"},s().createElement(v.Text,null,t.formatMessage(k.A.reviewRoleDetails))),e?.[0]?.[0])};G.propTypes={formFields:o().array};const D=G,B=({formFields:e})=>{const t=(0,l.A)();return s().createElement("div",{className:"rbac"},s().createElement(b.Title,{headingLevel:"h1",size:"xl",className:"pf-v5-u-mb-lg"},t.formatMessage(k.A.defineCostResources)),e)};B.propTypes={formFields:o().array};const L=B;var z=a(30445),W=a(1481),H=a(72245),V=a(8582),_=a(74459),P=a(41939),$=a(79994),j=a(55086),O=a(60123),Q=a.n(O),U=a(58471),X=a(49573);const K=({onClose:e})=>{const{setHideForm:t,setWizardSuccess:a}=(0,r.useContext)(Ae),n=(0,l.A)();return s().createElement(j.EmptyState,{variant:j.EmptyStateVariant.lg},s().createElement(j.EmptyStateHeader,{titleText:s().createElement(s().Fragment,null,n.formatMessage(k.A.roleCreatedSuccessfully)),icon:s().createElement(j.EmptyStateIcon,{color:"green",icon:Q()}),headingLevel:"h4"}),s().createElement(j.EmptyStateBody,null),s().createElement(j.EmptyStateFooter,null,s().createElement($.Button,{onClick:e,variant:"primary"},n.formatMessage(k.A.exit)),s().createElement(j.EmptyStateActions,null,s().createElement($.Button,{onClick:()=>{t(!1),a(!1)},variant:"link"},n.formatMessage(k.A.createAnotherRole)),s().createElement($.Button,{component:e=>s().createElement(U.A,{to:X.A.groups.link,...e}),variant:"link"},n.formatMessage(k.A.addRoleToGroup)))))};K.propTypes={onClose:o().func.isRequired};const Y=K;var Z=a(93932),J=a(62448),ee=a(38694),te=a(11522),ae=a(73317);const re=({roleReducer:{rolesForWizard:e,isWizardLoading:t}})=>({roles:e.data,pagination:e.meta,isWizardLoading:t});var se=a(11882),ne=a(79300),oe=a(76260);const ie=(e,t)=>s().createElement("div",{className:"rbac-c-sticky"},s().createElement(oe.Grid,{className:"rbac-c-sticky--title"},e.map((t=>s().createElement(oe.GridItem,{span:12/e.length,key:t},t)))),s().createElement(oe.Grid,{className:"rbac-c-sticky--data"},t.map((t=>t.cells.map((t=>s().createElement(oe.GridItem,{span:12/e.length,key:t},t)))))));var le=a(18390),ce=a(79255);var me=a(13614),de=a(83484),pe=a(86662),ue=a(55308);const ge=e=>{const t=(0,l.A)(),{input:a}=(0,te.A)(e),n=(0,R.default)(),{"role-name":o,"role-description":i}=n.getState().values,[c,m]=(0,r.useState)(o||""),[d,p]=(0,r.useState)(),[u,f]=(0,r.useState)(i),y=e=>{const t=(0,g.KA)(e);a.onChange(void 0),F(t).then((()=>{a.onChange(t),p(void 0)})).catch((e=>{p(e),a.onChange(void 0)})),m(e)};(0,r.useEffect)((()=>{c?.length>0&&y(c)}),[]);const E=((e,t)=>void 0===e||t||e?.length>150?"error":"default")(c,d),h=(e=>e?.length>150?"error":"default")(u);return s().createElement(ne.Stack,{hasGutter:!0},s().createElement(ne.StackItem,{className:"rbac-l-stack__item-summary"},s().createElement(me.FormGroup,{label:t.formatMessage(k.A.roleName),isRequired:!0},s().createElement(ue.TextInput,{id:"role-name",value:c,type:"text",validated:E,onBlur:()=>""===c&&m(void 0),onChange:(e,t)=>y(t),"aria-label":"Role name"}),"error"===E&&s().createElement(me.FormHelperText,null,s().createElement(de.HelperText,null,s().createElement(de.HelperTextItem,{variant:E},c?d:t.formatMessage(k.A.required)))))),s().createElement(ne.StackItem,null,s().createElement(me.FormGroup,{label:t.formatMessage(k.A.roleDescription)},s().createElement(pe.TextArea,{id:"role-description",value:u,validated:h,onChange:(e,t)=>{f(t),n.change("role-description",t)},"aria-label":"Role description",resizeOrientation:"vertical"}),"error"===h&&s().createElement(me.FormHelperText,null,s().createElement(de.HelperText,null,s().createElement(de.HelperTextItem,{variant:h},t.formatMessage(k.A.maxCharactersWarning,{number:150})))))))};ge.propTypes={name:o().string,description:o().string};const fe=ge;var ye=a(44419);class Ee extends s().Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e){if(!e.message.includes(this.props.silentErrorString))throw this.setState({hasError:!1}),e}render(){return this.state.hasError?null:this.props.children}}Ee.propTypes={children:o().node.isRequired,silentErrorString:o().string.isRequired};const he=Ee,Ae=(0,r.createContext)({success:!1,submitting:!1,error:void 0}),ve=e=>s().createElement(d.Ay,{...e,showFormControls:!1}),be=({Content:e,...t})=>s().createElement(e,{...t});be.propTypes={Content:o().elementType.isRequired};const xe={"set-name":fe,"base-role-table":e=>{const t=(0,l.A)(),a=(0,i.useDispatch)(),n=e=>a((0,V.WQ)(e)),[o,c]=(0,r.useState)(""),{roles:m,pagination:d,isWizardLoading:p}=(0,i.useSelector)(re,i.shallowEqual),{input:u}=(0,te.A)(e),f=(0,R.default)(),y=[{title:""},{title:t.formatMessage(k.A.name),key:"display_name",transforms:[ae.X]},{title:t.formatMessage(k.A.description)}],[E,h]=(0,r.useState)({index:1,direction:"asc"}),A=`${"desc"===E?.direction?"-":""}${y[E?.index].key}`;return(0,r.useEffect)((()=>{n({limit:50,offset:0,itemCount:0,orderBy:A})}),[]),s().createElement("div",null,s().createElement(J.Alert,{variant:"info",isInline:!0,title:t.formatMessage(k.A.granularPermissionsWillBeCopied)}),s().createElement(ee.Z,{columns:y,rows:(e=>e.map((e=>({cells:[{title:s().createElement(Z.Radio,{id:`${e.uuid}-radio`,name:`${e.name}-radio`,"aria-label":`${e.name}-radio`,ouiaId:`${e.name}-radio`,value:e.uuid,isChecked:u.value.uuid===e.uuid,onChange:()=>{f.batch((()=>{u.onChange(e),f.change("role-copy-name",`Copy of ${e.display_name||e.name}`),f.change("role-copy-description",e.description),f.change("add-permissions-table",[]),f.change("base-permissions-loaded",!1),f.change("not-allowed-permissions",[])}))}}),props:{className:"pf-v5-c-table__check"}},e.display_name||e.name,e.description]}))))(m),data:m,fetchData:e=>{n((0,g.YP)(e))},filterValue:o,setFilterValue:({name:e})=>c(e),isLoading:p,sortBy:E,onSort:(e,t,a)=>{const r=`${"desc"===a?"-":""}${y[t].key}`;h({index:t,direction:a}),n({...d,offset:0,orderBy:r})},pagination:d,titlePlural:t.formatMessage(k.A.roles),titleSingular:t.formatMessage(k.A.role),filterPlaceholder:t.formatMessage(k.A.roleName).toLowerCase(),ouiaId:"roles-table",isCompact:!0,tableId:"base-role"}))},"add-permissions-table":se.A,"cost-resources":ce.A,"inventory-groups-role":le.A,review:()=>{const e=(0,l.A)(),t=(0,_.useFlag)("platform.rbac.groups-to-workspaces-rename"),a=(0,R.default)(),{"role-name":r,"role-description":n,"role-copy-name":o,"role-copy-description":i,"add-permissions-table":c,"resource-definitions":m,"has-cost-resources":d,"inventory-group-permissions":p,"role-type":u}=a.getState().values,g=[e.formatMessage(k.A.application),e.formatMessage(k.A.resourceType),e.formatMessage(k.A.operation)],f=c.map((e=>({cells:e.uuid.split(":")}))),y=(m||[]).map((({permission:e,resources:t})=>({cells:[e,t.join(", ")]}))),E=(p||[]).map((({permission:t,groups:a})=>({cells:[t,a?.map((t=>null===t?.id?e.formatMessage(k.A.ungroupedSystems):t?.name)).join(", ")]})));return s().createElement(s().Fragment,null,s().createElement(ne.Stack,null,s().createElement(ne.StackItem,{className:"rbac-l-stack__item-summary"},s().createElement(oe.Grid,null,s().createElement(oe.GridItem,{sm:12,md:2},s().createElement(v.Text,{component:v.TextVariants.h4,className:"rbac-bold-text"},e.formatMessage(k.A.name))),s().createElement(oe.GridItem,{sm:12,md:10},s().createElement(v.Text,{component:v.TextVariants.p},"create"===u?r:o))),s().createElement(oe.Grid,null,s().createElement(oe.GridItem,{sm:12,md:2},s().createElement(v.Text,{component:v.TextVariants.h4,className:"rbac-bold-text"},e.formatMessage(k.A.description))),s().createElement(oe.GridItem,{sm:12,md:10},s().createElement(v.Text,{component:v.TextVariants.p},"create"===u?n:i))),s().createElement(oe.Grid,null,s().createElement(oe.GridItem,{sm:12,md:2},s().createElement(v.Text,{component:v.TextVariants.h4,className:"rbac-bold-text"},e.formatMessage(k.A.permissions))),s().createElement(oe.GridItem,{sm:12,md:10},ie(g,f))),p&&s().createElement(oe.Grid,null,s().createElement(oe.GridItem,{sm:12,md:2},s().createElement(v.Text,{component:v.TextVariants.h4,className:"rbac-bold-text"},e.formatMessage(k.A.resourceDefinitions))),s().createElement(oe.GridItem,{sm:12,md:10},ie([e.formatMessage(k.A.permission),e.formatMessage(t?k.A.workspacesDefinition:k.A.groupDefinition)],E))),d&&s().createElement(oe.Grid,null,s().createElement(oe.GridItem,{sm:12,md:2},s().createElement(v.Text,{component:v.TextVariants.h4,className:"rbac-bold-text"},e.formatMessage(k.A.resourceDefinitions))),s().createElement(oe.GridItem,{sm:12,md:10},ie([e.formatMessage(k.A.permission),e.formatMessage(k.A.resourceDefinitions)],y))))))},description:be,"type-selector":e=>{const t=(0,l.A)(),{input:a}=(0,te.A)(e),n=(0,R.default)(),[o,i]=(0,r.useState)(n.getState().values["role-type"]),c=e=>{i(e),a.onChange(e),n.change("add-permissions-table",[]),n.change("base-permissions-loaded",!1),n.change("not-allowed-permissions",[])};return s().createElement("div",null,s().createElement(Z.Radio,{isChecked:"create"===o,className:"pf-v5-u-mb-sm",name:"role-type-create",onChange:()=>c("create"),label:t.formatMessage(k.A.createRoleFromScratch),id:"role-type-create",value:"create"}),s().createElement(Z.Radio,{isChecked:"copy"===o,name:"role-type-copy",onChange:()=>c("copy"),label:t.formatMessage(k.A.copyAnExistingRole),id:"role-type-copy",value:"copy"}))}},Me=({pagination:e,filters:t,orderBy:a})=>{const n=(0,l.A)(),o=(0,i.useDispatch)(),d=(0,ye.A)(),h=(0,f.A)(),A=(0,_.useFlag)("platform.rbac.groups-to-workspaces-rename"),[v,b]=(0,r.useState)({success:!1,submitting:!1,error:void 0,hideForm:!1}),[x,M]=(0,r.useState)(!1),R=(0,r.useRef)(document.createElement("div")),[q,N]=(0,r.useState)();(0,r.useEffect)((()=>{N(((e,t)=>{const a=(0,C.MT)(),r=(0,S.E)({locale:T.H,messages:w},a);return{fields:[{component:"wizard",name:"wizard",isDynamic:!0,inModal:!0,showTitles:!0,crossroads:["role-type"],title:r.formatMessage(k.A.createRole),style:{overflow:"hidden"},container:e,fields:[{title:r.formatMessage(k.A.createRole),name:"step-1",nextStep:{when:"role-type",stepMapper:{copy:"name-and-description",create:"add-permissions"}},fields:[{component:"type-selector",name:"role-type",isRequired:!0,validate:[{type:y.A.REQUIRED}]},{component:"set-name",name:"role-name",type:"text",validate:[{type:y.A.REQUIRED},{type:y.A.MAX_LENGTH,threshold:150}],condition:{when:"role-type",is:"create"}},{component:"text-field",name:"role-description",hideField:!0},{component:"base-role-table",name:"copy-base-role",label:r.formatMessage(k.A.baseRole),isRequired:!0,condition:{when:"role-type",is:"copy"},validate:[{type:y.A.REQUIRED}]},{condition:{when:"role-type",is:"create"},component:"description",name:"fixasyncvalidation",Content:I},{condition:{when:"role-type",is:"copy"},component:"description",name:"fixasyncvalidation2",Content:I}]},{title:r.formatMessage(k.A.nameAndDescription),name:"name-and-description",nextStep:"add-permissions",fields:[{component:"text-field",name:"role-copy-name",type:"text",label:r.formatMessage(k.A.roleName),isRequired:!0,validate:[F,{type:y.A.REQUIRED},{type:"max-length",threshold:150}]},{component:"text-field",name:"role-copy-description",type:"text",label:r.formatMessage(k.A.roleDescription),validate:[{type:"max-length",threshold:150}]}]},{name:"add-permissions",title:r.formatMessage(k.A.addPermissions),StepTemplate:E.A,nextStep:({values:e})=>(0,W.Q)("add-permissions",e),fields:[{component:"add-permissions-table",name:"add-permissions-table"}]},{title:r.formatMessage(t?k.A.workspacesAccessTitle:k.A.inventoryGroupsAccessTitle),name:"inventory-groups-role",StepTemplate:H.A,nextStep:({values:e})=>(0,W.Q)("inventory-groups-role",e),fields:[{component:"plain-text",name:"cost-resources",label:s().createElement("p",{className:"pf-v5-u-mb-md"},r.formatMessage(t?k.A.applyWorkspacesRolePermission:k.A.applyInventoryGroupsRolePermission))},{component:"inventory-groups-role",name:"inventory-groups-role",validate:[(e=[])=>e?.every((({groups:e,permission:t})=>e?.length>0&&t))?void 0:r.formatMessage(k.A.assignAtLeastOneInventoryGroup)]}]},{name:"cost-resources-definition",title:r.formatMessage(k.A.defineCostResources),nextStep:"review",StepTemplate:L,fields:[{component:"plain-text",name:"text-description",label:s().createElement("p",{className:"pf-v5-u-mb-md"},r.formatMessage(k.A.applyCostPermissionText))},{component:"cost-resources",name:"cost-resources",validate:[(e=[])=>e?.every((({resources:e})=>e?.length>0))?void 0:r.formatMessage(k.A.assignAtLeastOneResource)]}]},{name:"review",title:r.formatMessage(k.A.reviewDetails),buttons:e=>s().createElement(z.A,{...e,context:Ae}),StepTemplate:D,fields:[{component:"review",name:"review"}]}]}]}})(R.current,A))}),[]);const G=()=>d({pathname:X.A.roles.link,search:(0,g.pg)({page:1,per_page:e.limit,...t})}),B=()=>{v.success||o((0,c.addNotification)({variant:"warning",title:n.formatMessage(k.A.creatingRoleCanceled),dismissDelay:8e3})),M(!1),d({pathname:X.A.roles.link,search:(0,g.pg)({page:1,per_page:e.limit,...t})})};return q?s().createElement(Ae.Provider,{value:{...v,setWizardError:e=>b((t=>({...t,error:e}))),setWizardSuccess:e=>b((t=>({...t,success:e}))),setHideForm:e=>b((t=>({...t,hideForm:e})))}},s().createElement(he,{silentErrorString:"focus-trap"},s().createElement(P.A,{title:n.formatMessage(k.A.exitItemCreation,{item:n.formatMessage(k.A.role).toLocaleLowerCase()}),confirmButtonLabel:n.formatMessage(k.A.discard),isOpen:x,onClose:()=>{R.current.hidden=!1,M(!1)},onConfirm:B},n.formatMessage(k.A.discardedInputsWarning))),v.hideForm?v.success?s().createElement(u.s,{title:n.formatMessage(k.A.createRole),isOpen:!0,onClose:G,steps:[{name:"success",component:s().createElement(Y,{onClose:G}),isFinishedStep:!0}]}):null:s().createElement(m.A,{schema:q,container:R,subscription:{values:!0},FormTemplate:ve,initialValues:{"role-type":"create"},componentMapper:{...p.Ay,...xe},onSubmit:t=>{const{"role-name":r,"role-description":s,"role-copy-name":n,"role-copy-description":i,"add-permissions-table":l,"inventory-groups-role":c,"cost-resources":m,"role-type":d}=t,p=l.map((e=>e.uuid)),u={applications:[...new Set(l.map((({uuid:e})=>e.split(":")[0])))],description:("create"===d?s:i)||null,name:"create"===d?r:n,access:l.reduce(((e,{uuid:t,requires:a=[]})=>[...e,...[t,...a.filter((e=>!p.includes(e)))].map((e=>{let t;return e.includes("cost-management")?t={key:`cost-management.${e.split(":")[1]}`,operation:"in",value:m?.find((t=>t.permission===e))?.resources}:e.includes("inventory")&&(t={key:"group.id",operation:"in",value:c?.find((t=>t.permission===e))?.groups?.map((e=>e?.id))}),{permission:e,resourceDefinitions:t?[{attributeFilter:t}]:[]}}))]),[])};return o((0,V.rd)(u)).then((()=>{b((e=>({...e,submitting:!1,success:!0,hideForm:!0}))),o((0,V.ip)({limit:e.limit,orderBy:a,usesMetaInURL:!0,chrome:h}))})).catch((()=>{b((e=>({...e,submitting:!1,success:!1,hideForm:!0}))),o((0,V.ip)({limit:e.limit,orderBy:a,usesMetaInURL:!0,chrome:h})),G()}))},onCancel:e=>{Boolean(e&&e["role-name"]||e["role-description"]||e["copy-base-role"])?(R.current.hidden=!0,M(!0)):B()}})):null};Me.propTypes={pagination:o().shape({limit:o().number.isRequired}).isRequired,filters:o().shape({name:o().string}).isRequired,orderBy:o().string};const Re=Me},73356:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(10476);const s=(e,t=250,a={onlyResolvesLast:!1})=>(0,r.A)(e,t,a)},50545:()=>{},36752:()=>{},83696:()=>{}}]);
//# sourceMappingURL=../sourcemaps/9751.6e08b783a10fc3777cd52a494f491ac4.js.map