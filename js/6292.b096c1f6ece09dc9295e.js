/*! For license information please see 6292.b096c1f6ece09dc9295e.js.LICENSE.txt */
"use strict";(self.webpackChunkinsights_rbac_frontend=self.webpackChunkinsights_rbac_frontend||[]).push([[6292,7664],{77782:(e,t,r)=>{r.r(t),r.d(t,{AddRolePermissionWizardContext:()=>K,default:()=>U,mapperExtension:()=>J});var n=r(71002),o=r(93433),i=r(15861),a=r(4942),s=r(29439),c=r(87462),u=r(92950),l=r.n(u),p=r(50533),f=r(45697),m=r.n(f),d=r(86896),h=r(25864),v=r(93025),y=r(67850),g=r(47836),b=r(67768),E=r(73943),w=r(28090),x=r(16544),Z=r(48880),O=r(30893);var j=r(68778),T=r(65126),L=r(4682),P=function(e){var t=e.currentRoleID,r=(0,d.Z)(),n=(0,p.useDispatch)();return l().createElement(l().Fragment,null,l().createElement(h.EmptyState,null,l().createElement(h.EmptyStateIcon,{color:"green",icon:j.ZP}),l().createElement(h.Title,{headingLevel:"h4",size:"lg"},r.formatMessage(O.Z.permissionsAddedSuccessfully)),l().createElement(h.EmptyStateBody,null),l().createElement(T.Z,{to:L.Z["role-detail"].link.replace(":roleId",t)},l().createElement(h.Button,{onClick:function(){return n((0,w.fp)(t))}},r.formatMessage(O.Z.exit)))))};const S=P;P.propTypes={currentRoleID:m().string.isRequired};var k=r(91710),G=r(80709),M=r(27979);function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var I=function(e){var t,r=e.formFields;return(0,u.useContext)(K).submitting?l().createElement(h.Bullseye,null,l().createElement(h.Spinner,{size:"xl"})):l().createElement("div",{className:"rbac"},[[F({},null==r||null===(t=r[0])||void 0===t?void 0:t[0])]])};I.propTypes={formFields:m().array};const C=I;var D=r(28412),N=r(82644),z=r(29558),R=r(2034),V=r(9599),A=r(58854),W=r(93736);function B(){B=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),a=new O(n||[]);return i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=l(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),i}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p={};function f(){}function m(){}function d(){}var h={};c(h,i,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(j([])));y&&y!==t&&r.call(y,i)&&(h=y);var g=d.prototype=f.prototype=Object.create(h);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function o(i,a,s,c){var u=l(e[i],e,a);if("throw"!==u.type){var p=u.arg,f=p.value;return f&&"object"==(0,n.Z)(f)&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){o("next",e,s,c)}),(function(e){o("throw",e,s,c)})):t.resolve(f).then((function(e){p.value=e,s(p)}),(function(e){return o("throw",e,s,c)}))}c(u.arg)}var i;this._invoke=function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=l(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function Z(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function j(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return m.prototype=d,c(g,"constructor",d),c(d,"constructor",m),m.displayName=c(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},b(E.prototype),c(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new E(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(g),c(g,s,"Generator"),c(g,i,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(Z),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),Z(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;Z(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:j(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var H=function(e){return l().createElement(y.ZP,(0,c.Z)({},e,{showFormControls:!1}))},J={"add-permissions-table":x.Z,"inventory-groups-role":G.Z,"cost-resources":k.Z,review:function(){var e=(0,d.Z)(),t=(0,Z.default)().getState().values,r=t["role-name"],n=t["role-description"],o=t["add-permissions-table"],i=t["resource-definitions"],a=t["has-cost-resources"];return l().createElement(h.Stack,{hasGutter:!0},l().createElement(h.StackItem,null,l().createElement(h.TextContent,null,l().createElement(h.Title,{headingLevel:"h1",size:"xl",className:"pf-u-mb-sm"},e.formatMessage(O.Z.reviewDetails)))),l().createElement(h.StackItem,{className:"rbac-l-stack__item-summary"},l().createElement(h.Grid,{hasGutter:!0},l().createElement(h.GridItem,{span:3},l().createElement(h.Text,{className:"pf-c-title",component:h.TextVariants.h6},e.formatMessage(O.Z.roleName))),l().createElement(h.GridItem,{span:9},l().createElement(h.Text,{component:h.TextVariants.p},r)),l().createElement(h.GridItem,{span:3},l().createElement(h.Text,{className:"pf-c-title",component:h.TextVariants.h6},e.formatMessage(O.Z.roleDescription))),l().createElement(h.GridItem,{span:9},l().createElement(h.Text,{component:h.TextVariants.p},n)),l().createElement(h.GridItem,{span:3},l().createElement(h.Text,{className:"pf-c-title",component:h.TextVariants.h6},e.formatMessage(O.Z.addedPermissions))),l().createElement(h.GridItem,{span:9},l().createElement(h.TextContent,{component:h.TextVariants.p},o.map((function(e,t){return l().createElement(h.Text,{key:t}," ",e.uuid," ")})))),a&&l().createElement(l().Fragment,null,l().createElement(h.GridItem,{span:3},l().createElement(h.Text,{className:"pf-c-title",component:h.TextVariants.h6},e.formatMessage(O.Z.resourceDefinitions))),l().createElement(h.GridItem,{span:9},l().createElement(h.TextContent,{component:h.TextVariants.p},i.map((function(e){return e.resources.map((function(e,t){return l().createElement(h.Text,{key:t}," ",e," ")}))}))))))))}},K=(0,u.createContext)({success:!1,submitting:!1,error:void 0}),Q=function(e){var t=e.role,r=(0,b.useFlag)("hbi.api.inventory-groups"),n=(0,d.Z)(),a=(0,u.useState)(!1),c=(0,s.Z)(a,2),f=c[0],m=c[1],y=(0,u.useState)(""),x=(0,s.Z)(y,2),Z=x[0],j=x[1],T=(0,W.Z)(),P=(0,p.useDispatch)(),k=(0,u.useState)({success:!1,submitting:!1,error:void 0,hideForm:!1}),G=(0,s.Z)(k,2),_=G[0],F=G[1],I=(0,u.useRef)(document.createElement("div")),q=(0,u.useMemo)((function(){return function(e,t){var r=(0,N.Sn)(),n=(0,z.d)({locale:D.S,messages:R},r);return{fields:[{component:"wizard",name:"wizard",isDynamic:!0,inModal:!0,showTitles:!0,crossroads:["role-type"],title:n.formatMessage(O.Z.addPermissions),container:e,fields:[{name:"add-permissions",title:n.formatMessage(O.Z.addPermissions),StepTemplate:M.Z,nextStep:function(e){var r=e.values;return(0,V.j)("add-permissions",r,t)},fields:[{component:"add-permissions-table",name:"add-permissions-table"}]},{name:"inventory-groups-role",title:n.formatMessage(O.Z.inventoryGroupsAccessTitle),StepTemplate:A.Z,nextStep:function(e){var t=e.values;return(0,V.j)("inventory-groups-role",t)},fields:[{component:"plain-text",name:"text-description",label:l().createElement("p",null,n.formatMessage(O.Z.inventoryGroupsAccessDescription))},{component:"inventory-groups-role",name:"inventory-groups-role",validate:[function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return null!=e&&e.every((function(e){var t=e.groups,r=e.permission;return(null==t?void 0:t.length)>0&&r}))?void 0:n.formatMessage(O.Z.assignAtLeastOneInventoryGroup)}]}]},{name:"cost-resources-definition",title:n.formatMessage(O.Z.defineCostResources),nextStep:"review",fields:[{component:"plain-text",name:"text-description",label:l().createElement("p",null,n.formatMessage(O.Z.applyCostPermissionText))},{component:"cost-resources",name:"cost-resources",validate:[function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).every((function(e){var t=e.resources;return t&&t.length>0}))?void 0:n.formatMessage(O.Z.assignAtLeastOneResource)}]}]},{name:"review",title:n.formatMessage(O.Z.reviewDetails),StepTemplate:C,fields:[{component:"review",name:"review"}]}]}]}}(I.current,r)}),[]);(0,u.useEffect)((function(){j(t.uuid)})),(0,u.useEffect)((function(){I.current.hidden=f}),[f]);var Q=function(){T(L.Z["role-detail"].link.replace(":roleId",t.uuid))},U=function(){var e=(0,i.Z)(B().mark((function e(n){var i,a,s,c,u,l,p;return B().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=n["add-permissions-table"],a=n["cost-resources"],s=void 0===a?[]:a,c=n["inventory-groups-role"],u=void 0===c?[]:c,l=[].concat((0,o.Z)(t.access.map((function(e){return e.permission}))),(0,o.Z)(i.map((function(e){return e.uuid})))),p=Y(Y({},t),{},{access:(0,o.Z)(i.reduce((function(e,t){var n=t.uuid,i=t.requires;return[].concat((0,o.Z)(e),(0,o.Z)([n].concat((0,o.Z)(i.filter((function(e){return!l.includes(e)})))).map((function(e){var t,n,i;return{permission:e,resourceDefinitions:null!==(t=[].concat((0,o.Z)(s),(0,o.Z)(u)))&&void 0!==t&&t.find((function(t){return t.permission===e}))?e.includes("inventory")&&r?[{attributeFilter:{key:"group.id",operation:"in",value:null==u||null===(n=u.find((function(t){return t.permission===e})))||void 0===n||null===(i=n.groups)||void 0===i?void 0:i.map((function(e){return null==e?void 0:e.id}))}}]:e.includes("cost-management")?[{attributeFilter:{key:"cost-management.".concat(e.split(":")[1]),operation:"in",value:null==s?void 0:s.find((function(t){return t.permission===e})).resources}}]:[]:[]}}))))}),t.access)),accessCount:t.accessCount+i.length}),F((function(e){return Y(Y({},e),{},{submitting:!0})})),P((0,w.ul)(Z,p)).then((function(){return F((function(e){return Y(Y({},e),{},{submitting:!1,success:!0,hideForm:!0})}))})).catch((function(){F((function(e){return Y(Y({},e),{},{submitting:!1,success:!1,hideForm:!0})})),T(L.Z["role-detail"].link.replace(":roleId",t.uuid))}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return l().createElement(K.Provider,{value:Y(Y({},_),{},{setWizardError:function(e){return F((function(t){return Y(Y({},t),{},{error:e})}))},setWizardSuccess:function(e){return F((function(t){return Y(Y({},t),{},{success:e})}))},setHideForm:function(e){return F((function(t){return Y(Y({},t),{},{hideForm:e})}))},rolePermissions:t.access})},l().createElement(E.R,{type:n.formatMessage(O.Z.permission).toLocaleLowerCase(),isOpen:f,onModalCancel:function(){return m(!1)},onConfirmCancel:Q}),_.hideForm?_.success?l().createElement(h.Wizard,{title:n.formatMessage(O.Z.addPermissions),isOpen:!0,steps:[{name:"success",component:new S({currentRoleID:Z}),isFinishedStep:!0}],onClose:Q}):null:l().createElement(v.Z,{container:I,schema:q,subscription:{values:!0},FormTemplate:H,initialValues:{"role-uuid":t.uuid,"role-type":"create","role-name":t.display_name,"role-description":t.description},componentMapper:Y(Y({},g.ZP),J),onSubmit:U,onCancel:function(e){var t;e&&(null===(t=e["add-permissions-table"])||void 0===t?void 0:t.length)>0?m(!0):Q()}}))};Q.defaultProps={role:{}},Q.propTypes={role:m().object};const U=Q}}]);
//# sourceMappingURL=../sourcemaps/6292.efc216dd7318d69ef253572b2beb3cd2.js.map