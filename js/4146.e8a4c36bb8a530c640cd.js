"use strict";(self.webpackChunkrbac=self.webpackChunkrbac||[]).push([[4146,1789],{41939:(e,t,n)=>{n.d(t,{A:()=>c});var s=n(93345),r=n.n(s),a=n(16165),o=n(72583),i=n(83873);const c=e=>{var{isOpen:t,onConfirm:n,onClose:c,children:l,confirmButtonLabel:m="Confirm",cancelButtonLabel:p="Cancel",variant:u=a.d.small,titleIconVariant:d="warning",withCheckbox:f=!1,checkboxLabel:g="I understand that this action cannot be undone",confirmButtonVariant:E=o.Ak.primary,ouiaId:v="WarningModal"}=e,b=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n}(e,["isOpen","onConfirm","onClose","children","confirmButtonLabel","cancelButtonLabel","variant","titleIconVariant","withCheckbox","checkboxLabel","confirmButtonVariant","ouiaId"]);const[y,A]=(0,s.useState)(!1);return r().createElement(a.a,Object.assign({variant:u,isOpen:t,onClose:c,onEscapePress:c,titleIconVariant:d,actions:[r().createElement(o.$n,{ouiaId:`${v}-confirm-button`,key:"confirm",variant:E,onClick:()=>{null==n||n(),A(!1)},isDisabled:f&&!y},m),r().createElement(o.$n,{ouiaId:`${v}-cancel-button`,key:"cancel",variant:o.Ak.link,onClick:c},p)],ouiaId:v},b),l,f?r().createElement(i.S,{isChecked:y,onChange:(e,t)=>A(t),label:g,id:"warning-modal-check",className:"pf-v5-u-mt-lg",ouiaId:`${v}-confirm-checkbox`}):null)}},31721:(e,t,n)=>{n.r(t),n.d(t,{AddRolePermissionWizardContext:()=>_,default:()=>Q,mapperExtension:()=>H});var s=n(93345),r=n.n(s),a=n(69733),o=n(5556),i=n.n(o),c=n(8604),l=n(67655),m=n(79371),p=n(63537),u=n(42655),d=n(41939),f=n(63219),g=n(8582),E=n(11882),v=n(76260),b=n(79300),y=n(40748),A=n(7248),h=n(81558),x=n(40335);var k=n(79994),T=n(55086),C=n(60123),I=n.n(C),S=n(58471),M=n(49573);const w=({currentRoleID:e})=>{const t=(0,c.tz)(),n=(0,a.useDispatch)();return r().createElement(r().Fragment,null,r().createElement(T.EmptyState,null,r().createElement(T.EmptyStateHeader,{titleText:r().createElement(r().Fragment,null,t.formatMessage(x.A.permissionsAddedSuccessfully)),icon:r().createElement(T.EmptyStateIcon,{color:"green",icon:I()}),headingLevel:"h4"}),r().createElement(T.EmptyStateBody,null),r().createElement(T.EmptyStateFooter,null,r().createElement(S.A,{to:M.A["role-detail"].link.replace(":roleId",e)},r().createElement(k.Button,{onClick:()=>n((0,g.rM)(e))},t.formatMessage(x.A.exit))))))},F=w;w.propTypes={currentRoleID:i().string.isRequired};var O=n(79255),D=n(18390),G=n(1621),V=n(71436),L=n(29068);const P=({formFields:e})=>{const{submitting:t}=(0,s.useContext)(_);return t?r().createElement(V.Bullseye,null,r().createElement(L.Spinner,{size:"xl"})):r().createElement("div",{className:"rbac"},[[{...e?.[0]?.[0]}]])};P.propTypes={formFields:i().array};const z=P;var B=n(25970),N=n(67169),R=n(1481),j=n(72245),$=n(44419);const W=e=>r().createElement(p.Ay,{...e,showFormControls:!1}),H={"add-permissions-table":E.A,"inventory-groups-role":D.A,"cost-resources":O.A,review:()=>{const e=(0,c.tz)(),t=(0,h.default)(),{"role-name":n,"role-description":s,"add-permissions-table":a,"resource-definitions":o,"has-cost-resources":i}=t.getState().values;return r().createElement(b.Stack,{hasGutter:!0},r().createElement(b.StackItem,null,r().createElement(y.TextContent,null,r().createElement(A.Title,{headingLevel:"h1",size:"xl",className:"pf-v5-u-mb-sm"},e.formatMessage(x.A.reviewDetails)))),r().createElement(b.StackItem,{className:"rbac-l-stack__item-summary"},r().createElement(v.Grid,{hasGutter:!0},r().createElement(v.GridItem,{span:3},r().createElement(y.Text,{className:"pf-v5-c-title",component:y.TextVariants.h6},e.formatMessage(x.A.roleName))),r().createElement(v.GridItem,{span:9},r().createElement(y.Text,{component:y.TextVariants.p},n)),r().createElement(v.GridItem,{span:3},r().createElement(y.Text,{className:"pf-v5-c-title",component:y.TextVariants.h6},e.formatMessage(x.A.roleDescription))),r().createElement(v.GridItem,{span:9},r().createElement(y.Text,{component:y.TextVariants.p},s)),r().createElement(v.GridItem,{span:3},r().createElement(y.Text,{className:"pf-v5-c-title",component:y.TextVariants.h6},e.formatMessage(x.A.addedPermissions))),r().createElement(v.GridItem,{span:9},r().createElement(y.TextContent,{component:y.TextVariants.p},a.map(((e,t)=>r().createElement(y.Text,{key:t}," ",e.uuid," "))))),i&&r().createElement(r().Fragment,null,r().createElement(v.GridItem,{span:3},r().createElement(y.Text,{className:"pf-v5-c-title",component:y.TextVariants.h6},e.formatMessage(x.A.resourceDefinitions))),r().createElement(v.GridItem,{span:9},r().createElement(y.TextContent,{component:y.TextVariants.p},o.map((({resources:e})=>e.map(((e,t)=>r().createElement(y.Text,{key:t}," ",e," ")))))))))))}},_=(0,s.createContext)({success:!1,submitting:!1,error:void 0}),q=({role:e})=>{const t=(0,c.tz)(),[n,o]=(0,s.useState)(!1),[i,p]=(0,s.useState)(""),E=(0,$.A)(),v=(0,a.useDispatch)(),b=(0,f.useFlag)("platform.rbac.groups-to-workspaces-rename"),[y,A]=(0,s.useState)({success:!1,submitting:!1,error:void 0,hideForm:!1}),h=(0,s.useRef)(document.createElement("div")),k=(0,s.useMemo)((()=>((e,t)=>{const n=(0,c.MT)(),s=(0,c.EY)({locale:B.H,messages:N},n);return{fields:[{component:"wizard",name:"wizard",isDynamic:!0,inModal:!0,showTitles:!0,crossroads:["role-type"],title:s.formatMessage(x.A.addPermissions),container:e,fields:[{name:"add-permissions",title:s.formatMessage(x.A.addPermissions),StepTemplate:G.A,nextStep:({values:e})=>(0,R.Q)("add-permissions",e),fields:[{component:"add-permissions-table",name:"add-permissions-table"}]},{name:"inventory-groups-role",title:s.formatMessage(t?x.A.workspacesAccessTitle:x.A.inventoryGroupsAccessTitle),StepTemplate:j.A,nextStep:({values:e})=>(0,R.Q)("inventory-groups-role",e),fields:[{component:"plain-text",name:"text-description",label:r().createElement("p",null,s.formatMessage(t?x.A.workspacesAccessDescription:x.A.inventoryGroupsAccessDescription))},{component:"inventory-groups-role",name:"inventory-groups-role",validate:[(e=[])=>e?.every((({groups:e,permission:t})=>e?.length>0&&t))?void 0:s.formatMessage(x.A.assignAtLeastOneInventoryGroup)]}]},{name:"cost-resources-definition",title:s.formatMessage(x.A.defineCostResources),nextStep:"review",fields:[{component:"plain-text",name:"text-description",label:r().createElement("p",null,s.formatMessage(x.A.applyCostPermissionText))},{component:"cost-resources",name:"cost-resources",validate:[(e=[])=>e.every((({resources:e})=>e&&e.length>0))?void 0:s.formatMessage(x.A.assignAtLeastOneResource)]}]},{name:"review",title:s.formatMessage(x.A.reviewDetails),StepTemplate:z,fields:[{component:"review",name:"review"}]}]}]}})(h.current,b)),[]);(0,s.useEffect)((()=>{p(e.uuid)})),(0,s.useEffect)((()=>{h.current.hidden=n}),[n]);const T=()=>{E(M.A["role-detail"].link.replace(":roleId",e.uuid))};return r().createElement(_.Provider,{value:{...y,setWizardError:e=>A((t=>({...t,error:e}))),setWizardSuccess:e=>A((t=>({...t,success:e}))),setHideForm:e=>A((t=>({...t,hideForm:e}))),rolePermissions:e.access}},r().createElement(d.A,{title:t.formatMessage(x.A.exitItemAdding,{item:t.formatMessage(x.A.permissions).toLocaleLowerCase()}),isOpen:n,onClose:()=>o(!1),confirmButtonLabel:t.formatMessage(x.A.discard),onConfirm:T},t.formatMessage(x.A.discardedInputsWarning)),y.hideForm?y.success?r().createElement(l.s,{title:t.formatMessage(x.A.addPermissions),isOpen:!0,steps:[{name:"success",component:r().createElement(F,{currentRoleID:i}),isFinishedStep:!0}],onClose:T}):null:r().createElement(m.A,{container:h,schema:k,subscription:{values:!0},FormTemplate:W,initialValues:{"role-uuid":e.uuid,"role-type":"create","role-name":e.display_name,"role-description":e.description},componentMapper:{...u.Ay,...H},onSubmit:async t=>{const{"add-permissions-table":n,"cost-resources":s=[],"inventory-groups-role":r=[]}=t,a=[...e.access.map((e=>e.permission)),...n.map((e=>e.uuid))],o={...e,access:[...n.reduce(((e,{uuid:t,requires:n})=>[...e,...[t,...n.filter((e=>!a.includes(e)))].map((e=>({permission:e,resourceDefinitions:[...s,...r]?.find((t=>t.permission===e))?e.includes("inventory")?[{attributeFilter:{key:"group.id",operation:"in",value:r?.find((t=>t.permission===e))?.groups?.map((e=>e?.id))}}]:e.includes("cost-management")?[{attributeFilter:{key:`cost-management.${e.split(":")[1]}`,operation:"in",value:s?.find((t=>t.permission===e)).resources}}]:[]:[]})))]),e.access)],accessCount:e.accessCount+n.length};A((e=>({...e,submitting:!0}))),v((0,g.S0)(i,o)).then((()=>A((e=>({...e,submitting:!1,success:!0,hideForm:!0}))))).catch((()=>{A((e=>({...e,submitting:!1,success:!1,hideForm:!0}))),E(M.A["role-detail"].link.replace(":roleId",e.uuid))}))},onCancel:e=>{e&&e["add-permissions-table"]?.length>0?o(!0):T()}}))};q.defaultProps={role:{}},q.propTypes={role:i().object};const Q=q}}]);