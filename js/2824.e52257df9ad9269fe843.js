(self.webpackChunkrbac=self.webpackChunkrbac||[]).push([[2824,5467,209],{84414:(e,t,s)=>{"use strict";s.d(t,{Z:()=>o});var a=s(62012),r=s(64756);const o=e=>{const t=(0,a.useNavigate)();return(s,a)=>t((0,r.n)(s,e),a)}},66180:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var a=s(28416),r=s.n(a),o=s(95376),i=s(58826),n=s.n(i);const l=({title:e,icon:t,description:s,actions:a,...i})=>r().createElement(o.EmptyState,{variant:o.EmptyStateVariant.sm,...i},r().createElement(o.EmptyStateHeader,{titleText:r().createElement(r().Fragment,null,e),icon:r().createElement(o.EmptyStateIcon,{icon:t||n()}),headingLevel:"h4"}),r().createElement(o.EmptyStateBody,{className:"pf-v5-u-mb-md"},s.map(((e,t)=>r().createElement(r().Fragment,{key:t},e," ",r().createElement("br",null))))),r().createElement(o.EmptyStateFooter,null,a))},97246:(e,t,s)=>{"use strict";s.d(t,{M:()=>Z});var a=s(28416),r=s.n(a),o=s(25387),i=s(45697),n=s.n(i),l=s(2550),c=s(75863),p=s(21081),u=s(49004),m=s(34844),d=s(15433),g=s(31055),f=s(93297),y=s(95376),h=s(12849),b=s(47826),v=s.n(b),E=s(29301),k=s(68572),S=s(66180);const Z=({isCompact:e,borders:t,columns:s,rows:i,toolbarButtons:n,data:b,actionResolver:Z,areActionsDisabled:C,routes:M,titlePlural:w,titleSingular:T,pagination:F,paginationProps:R,filterValue:x,isLoading:P,emptyFilters:B,setFilterValue:I,checkedRows:A,isSelectable:O,isRowSelectable:L,fetchData:D,setCheckedItems:V,emptyProps:N,filterPlaceholder:j,rowWrapper:G,filters:$,isFilterable:q,onShowMore:_,showMoreTitle:W,onFilter:Y,onChange:z,value:H,sortBy:K,onSort:Q,isExpandable:U,onExpand:X,hideFilterChips:J,hideHeader:ee,noData:te,noDataDescription:se,ouiaId:ae,tableId:re,containerRef:oe,textFilterRef:ie})=>{const ne=(0,o.YB)();return r().createElement(a.Fragment,null,M(),!P&&0===i?.length&&0===x?.length&&$.every((({value:e})=>!e))?r().createElement(S.Z,{title:ne.formatMessage(l.Z.configureItems,{items:w}),icon:v(),description:[ne.formatMessage(l.Z.toConfigureUserAccess),ne.formatMessage(l.Z.createAtLeastOneItem,{item:T})],actions:n()[0],...N}):(()=>{const o=`${"desc"===K?.direction?"-":""}${s[K?.index]?.key}`;return r().createElement(a.Fragment,null,r().createElement(k.ZP,{isSelectable:O,isRowSelectable:L,checkedRows:A,setCheckedItems:V,isLoading:P||te,data:b,titleSingular:T,filterValue:x,setFilterValue:I,sortBy:o,pagination:F,paginationProps:R,fetchData:D,toolbarButtons:n,filterPlaceholder:j,filters:$,isFilterable:q,onShowMore:_,showMoreTitle:W,onFilter:Y,onChange:z,value:H,hideFilterChips:J,tableId:re,containerRef:oe,textFilterRef:ie}),P?r().createElement(h.Wi,{isCompact:e,items:F?.limit}):r().createElement(p.i,{canSelectAll:!1,"aria-label":`${w.toLowerCase()} table`,variant:e?c.B.compact:null,borders:t,...O&&i?.length>0&&{onSelect:(e,t,s,{uuid:a,cells:[r],requires:o})=>V((0,E.ZQ)([{uuid:a,name:r,requires:o}],t))},...U&&{onExpand:X},rows:i?.length>0?i:[{fullWidth:!0,cells:[{title:r().createElement(S.Z,{title:ne.formatMessage(l.Z.noMatchingItemsFound,{items:w}),description:te&&se?se:[ne.formatMessage(l.Z.filterMatchesNoItems,{items:w}),ne.formatMessage(l.Z.tryChangingFilters)],actions:te&&se?void 0:[r().createElement(y.EmptyStateActions,{key:"clear-filters"},r().createElement(g.Button,{variant:"link",ouiaId:"clear-filters-button",onClick:()=>{I(B),D({...F,offset:0,...B||{name:""}})}},ne.formatMessage(l.Z.clearAllFilters)))]}),props:{colSpan:s.length}}]}],cells:s,...i?.length>0&&{actionResolver:Z},className:0==i?.length?"ins-c-table-empty-state":"",areActionsDisabled:C,rowWrapper:G,sortBy:K,ouiaId:ae,onSort:(e,t,s,a)=>Q(e,t,s,a)},!ee&&r().createElement(u.x,null),r().createElement(m.R,null)),!F.noBottom&&r().createElement(d.Z,null,!P&&r().createElement(f.Pagination,{...(0,k.Wz)(F,D,x,K,R),variant:"bottom",dropDirection:"up"})))})())};Z.propTypes={...k.ZP.propTypes,sortBy:n().shape({directions:n().string,index:n().number}),rowWrapper:n().any,isCompact:n().bool,isRowSelectable:n().func,borders:n().bool,emptyFilters:n().object,checkedRows:n().array,columns:n().array.isRequired,rows:n().array.isRequired,titlePlural:n().string,routes:n().func,actionResolver:n().func,areActionsDisabled:n().func,pagination:n().shape({noBottom:n().bool,limit:n().number,offset:n().number,count:n().number}),paginationProps:n().shape({toggleTemplate:n().func,isCompact:n().bool}),isExpandable:n().bool,onExpand:n().func,onSort:n().func,containerRef:n().node,noData:n().bool,hideFilterChips:n().bool,hideHeader:n().bool,noDataDescription:n().arrayOf(n().node),filters:n().array,tableId:n().string.isRequired},Z.defaultProps={...k.ZP.defaultProps,emptyFilters:{},isCompact:!1,borders:!0,routes:()=>null,hideFilterChips:!1,checkedRows:[],hideHeader:!1}},68572:(e,t,s)=>{"use strict";s.d(t,{Wz:()=>d,ZP:()=>b});var a=s(28416),r=s.n(a),o=s(31611),i=s(25387),n=s(45697),l=s.n(n),c=s(2550),p=s(96486),u=s(29301),m=s(74982);const d=(e={},t,s="",a="",r)=>({...r,itemCount:e.count,perPage:e.limit,page:(0,m.wy)(e.limit,e.offset),onSetPage:(r,o)=>{t({...e,offset:(0,m.vE)(o,e.limit),name:s,orderBy:a})},perPageOptions:[{title:"5",value:5},{title:"10",value:10},{title:"20",value:20},{title:"50",value:50},{title:"100",value:100}],onPerPageSelect:(e,r)=>{t({offset:0,limit:r,name:s,orderBy:a})}}),g=(e,t=[],s=(()=>{}),a=[],r,o=(()=>!0))=>{const n=(0,i.YB)();return{count:t.length,items:[{title:n.formatMessage(c.Z.selectNone),onClick:()=>{s((()=>[]))}},{...!e&&a&&a.length>0?{title:n.formatMessage(c.Z.selectPage,{length:a.filter(o).length}),onClick:()=>{s((0,u.ZQ)(a,!0))}}:{}}],checked:(0,u.um)(a,t,o),onSelect:t=>{!e&&s((0,u.ZQ)(a,t))},id:r}},f=(e,t=(()=>{}),s=(()=>{}),a="",r={},o="",n,l,m,d,g,f,y,h,b,v,E)=>{const k=(0,i.YB)();return{onChange:h,value:b,items:[...m&&m.length>0?m.map((({key:o,label:i,value:n,selected:l,placeholder:h,type:b="text",groups:E,items:S,innerRef:Z})=>({label:i||(0,u.RI)(o),type:b??"text",filterValues:{innerRef:Z,id:`filter-by-${o}`,key:`filter-by-${o}`,placeholder:h||k.formatMessage(c.Z.filterByKey,{key:o}),value:n,selected:l,..."text"!==b?{isFilterable:d,onShowMore:g,showMoreTitle:f,onFilter:y}:{},groups:E,items:S,onChange:(e,i)=>{const n="string"==typeof i||Array.isArray(i)?i:Object.keys((0,p.pickBy)(i[""],(e=>e)));t({...a,...r,offset:0,[o]:n}),(0,u.Aq)((()=>s({...r,offset:0,orderBy:v,...m.reduce(((e,t)=>({...e,[t.key]:t.value})),{}),[o]:n}))).then((e=>(Z?.current?.focus(),e)))},isDisabled:e}}))):[{label:(0,u.RI)(n||o),type:"text",filterValues:{innerRef:E,id:"filter-by-string",key:"filter-by-string",placeholder:k.formatMessage(c.Z.filterByKey,{key:n||o}),value:a,onChange:(e,a)=>{t({...r,offset:0,name:a}),(0,u.Aq)((()=>s({...r,offset:0,name:a,orderBy:v}))).then((e=>(E?.current?.focus(),e)))},isDisabled:e}}],...l||[]]}},y=(e="",t,s={},a=(()=>{}),r=(()=>{}),o)=>({filters:t&&t.length>0?t.map((({key:e,value:t})=>t&&0!==t.length&&{category:(0,u.RI)(e),type:e,chips:Array.isArray(t)?t.map((e=>({name:e}))):[{name:t}]})).filter(Boolean):[{name:e}],onDelete:(e,[i],n)=>{const l=(e,t,s)=>n?"group"===t||"checkbox"===t?[]:"":s!==i.type?e:"checkbox"===t||"group"===t?e.filter((e=>e!==i.chips[0]?.name)):Array.isArray(e)?[]:"",c=t.reduce(((e,{key:t,value:s,type:a})=>({...e,[t]:l(s,a,t)})),{});a({...s,offset:0,name:"",...c}),r({...s,offset:0,orderBy:o,name:"",...c})}}),h=({isSelectable:e,isRowSelectable:t,checkedRows:s,setCheckedItems:a,isLoading:i,data:n,titleSingular:l,filterValue:c,setFilterValue:p,pagination:u,paginationProps:m,fetchData:h,sortBy:b,toolbarButtons:v,filterPlaceholder:E,filterItems:k,filters:S,isFilterable:Z,onShowMore:C,showMoreTitle:M,onFilter:w,onChange:T,value:F,hideFilterChips:R,tableId:x,textFilterRef:P})=>r().createElement(o.Z,{...e&&{bulkSelect:g(i,s,a,n,x,t)},filterConfig:f(i,p,h,c,u,l,E,k,S,Z,C,M,w,T,F,b,P),actionsConfig:{actions:v()},...!i&&{pagination:d(u,h,c,b,m)},...(c.length>0||S&&S.length>0)&&!R&&{activeFiltersConfig:y(c,S,u,p,h,b)}});h.propTypes={isSelectable:l().bool,isRowSelectable:l().func,checkedRows:l().array,setCheckedItems:l().func,isLoading:l().bool,data:l().array,titleSingular:l().string,filterValue:l().oneOfType([l().array,l().string]),setFilterValue:l().func,filters:l().arrayOf(l().shape({value:l().oneOfType([l().string,l().number,l().array]),key:l().string,placeholder:l().string})),isFilterable:l().bool,onShowMore:l().func,showMoreTitle:l().string,onFilter:l().func,onChange:l().func,value:l().any,pagination:l().shape({limit:l().number,offset:l().number,count:l().number}),paginationProps:l().shape({toggleTemplate:l().func,isCompact:l().bool}),sortBy:l().string,filterItems:l().arrayOf(l().object),filterPlaceholder:l().string,isCollapsible:l().bool,fetchData:l().func.isRequired,toolbarButtons:l().func,hideFilterChips:l().bool,tableId:l().string,textFilterRef:l().object},h.defaultProps={isCollapsible:!1,isSelectable:!1,isLoading:!1,data:[],titleSingular:"",filterValue:[],pagination:m.he,setCheckedItems:()=>{},setFilterValue:()=>{},sortBy:void 0,toolbarButtons:()=>[],filterItems:[],filters:[],isFilterable:!1,hideFilterChips:!1};const b=h},19862:(e,t,s)=>{"use strict";s.d(t,{R:()=>l,A:()=>n});var a=s(71079);const r=(0,s(75465).i$)();async function o(e){return await r.getResourceTypes(e)}async function i(e){return await r.getResource(e)}const n=e=>({type:a.s6,payload:o(e)}),l=e=>({type:a.ZX,payload:i(e)})},45030:(e,t,s)=>{"use strict";s.d(t,{R:()=>g});var a=s(28416),r=s.n(a),o=s(45697),i=s.n(o),n=s(94229),l=s(31055),c=s(18444),p=s(70214),u=s.n(p),m=s(25387),d=s(2550);const g=({type:e,isOpen:t,onModalCancel:s,onModalConfirm:a,customTitle:o,customDescription:i,customPrimaryButtonTitle:p,customSecondaryButtonTitle:g})=>{const f=(0,m.YB)();return r().createElement(n.Modal,{"data-testid":"warning-modal",title:r().createElement("span",{className:"rbac-c-wizard__cancel-warning-header"},r().createElement(c.Icon,{size:"lg",className:"pf-v5-u-mr-md"},r().createElement(u(),{className:"rbac-c-wizard__cancel-warning-header--icon"})),o||f.formatMessage(d.Z.exitItemCreation,{item:e})),variant:n.ModalVariant.small,className:"rbac rbac-c-wizard__cancel-warning",isOpen:t,onClose:s,actions:[r().createElement(l.Button,{ouiaId:"primary-exit-button",key:"confirm",variant:"primary",onClick:a},p??f.formatMessage(d.Z.exit)),r().createElement(l.Button,{ouiaId:"secondary-cancel-button",key:"cancel",variant:"link",onClick:s},g??f.formatMessage(d.Z.stay))]},r().createElement("span",null,i||f.formatMessage(d.Z.discardedInputsWarning)," "))};g.propTypes={type:i().string,customTitle:i().node,customDescription:i().node,customPrimaryButtonTitle:i().string,customSecondaryButtonTitle:i().string,isOpen:i().bool,onModalCancel:i().func,onModalConfirm:i().func}},52229:(e,t,s)=>{"use strict";s.d(t,{Z:()=>b});var a=s(28416),r=s.n(a),o=s(45697),i=s.n(o),n=s(43189),l=s(64380),c=s(72232),p=s(31055),u=s(78972),m=s(5904),d=s(48880),g=s(21873),f=s(25387),y=s(2550);const h=({formFields:e})=>{const t=(0,d.default)(),[s,o]=(0,a.useState)(t.getState().values["add-permissions-table"]||[]),[i,h]=(0,a.useState)(!1),b=t.getState().values["not-allowed-permissions"],v=(0,f.YB)(),E=t.getState().values?.["copy-base-role"]?.applications?.filter((e=>!s?.find((({uuid:t})=>t.includes(e)))))||[],k=e[0][0];return r().createElement("div",{className:"rbac"},s.length>0?r().createElement("div",{className:"rbac-c-selected-chips"},r().createElement(n.ChipGroup,{categoryName:v.formatMessage(y.Z.selectedPermissions)},s.reduce(((e,t)=>[t,...e]),[]).map((({uuid:e})=>r().createElement(n.Chip,{key:e,color:"blue",isTruncated:!0,onClick:()=>o(s.filter((t=>t.uuid!==e)))},e))))):null,r().createElement(c.Title,{headingLevel:"h1",size:"xl",className:"rbac-c-add-permission-title"},v.formatMessage(y.Z.addPermissions)),r().createElement(l.TextContent,null,r().createElement(l.Text,null,v.formatMessage(y.Z.selectPermissionsForRole),0!==E.length&&r().createElement(u.Popover,{headerContent:v.formatMessage(y.Z.onlyGranularPermissions),bodyContent:v.formatMessage(y.Z.noWildcardPermissions)},r().createElement(p.Button,{variant:"link"},v.formatMessage(y.Z.whyNotSeeingAllPermissions)," ",r().createElement(g.ZP,null))))),b?.length>0&&!i?r().createElement(m.Alert,{variant:"custom",isInline:!0,title:`${v.formatMessage(y.Z.followingPermissionsCannotBeAdded)} ${b.join(", ")}`,actionClose:r().createElement(m.AlertActionCloseButton,{onClose:()=>h(!0)})}):null,[[{...k,props:{...k.props,selectedPermissions:s,setSelectedPermissions:o}}]])};h.propTypes={formFields:i().array};const b=h},55594:(e,t,s)=>{"use strict";s.d(t,{Z:()=>R});var a=s(28416),r=s.n(a),o=s(45697),i=s.n(o),n=s(86706),l=s(55140),c=s(81169),p=s(48880),u=s(48623),m=s(43707),d=s(97246),g=s(71079);const f=(0,s(75465).Y3)();async function y(e,t,s,a,r,o,i,n,l,c,p){return await f.listPermissions(e,t,s,a,r,o,i,n,l,c,p)}async function h(e,t,s,a,r,o,i,n){return await f.listPermissionOptions(e,t,s,a,r,o,void 0,i,n)}const b={application:g.KD,resource_type:g.vf,verb:g.E2};var v=s(19862),E=s(13563),k=s(50247),S=s(55573);const Z=({row:e,...t})=>e.disableSelection?r().createElement(k.Tooltip,{content:e.disabledContent,exitDelay:1500,entryDelay:1500},r().createElement(S.e,{className:"rbac-c-disabled-row",row:e,...t})):r().createElement(S.e,{row:e,...t});Z.propTypes={props:i().object,row:i().object};var C=s(96486),M=s(25387),w=s(2550);const T=({permissionReducer:{permission:e,isLoading:t,options:{application:s,operation:a,resource:r},expandSplats:o,isLoadingExpandSplats:i},roleReducer:{isRecordLoading:n,selectedRole:l},costReducer:{resourceTypes:c}})=>({permissions:e.data.map((({application:e,resource_type:t,verb:s,permission:a,requires:r}={})=>({application:e,resource:t,operation:s,uuid:a,requires:r}))),pagination:e.meta,isLoading:t||n,baseRole:l,applicationOptions:s.data.filter((e=>"*"!==e)),resourceOptions:r.data.filter((e=>"*"!==e)),operationOptions:a.data.filter((e=>"*"!==e)),expandedPermissions:o.data.map((({permission:e})=>e)),isLoadingExpandSplats:i,resourceTypes:c.data}),F=({selectedPermissions:e,setSelectedPermissions:t,...s})=>{const[o,i]=(0,a.useState)(null),{auth:f}=(0,l.Z)(),k=(0,n.useDispatch)(),S=(0,M.YB)(),{hasAccess:F}=(0,m.ZP)("cost-management",["cost-management:*:*"]),{hasAccess:R}=(0,m.ZP)("rbac",["rbac:*:*"]),x=[S.formatMessage(w.Z.application),S.formatMessage(w.Z.resourceType),S.formatMessage(w.Z.operation)];(0,a.useEffect)((()=>{f&&(async()=>{const{identity:{user:e}}=await f.getUser();i(e.is_org_admin)})()}),[f]);const P=e=>k((({limit:e,offset:t,orderBy:s,application:a,resourceType:r,verb:o,permission:i,exclude_globals:n=!0,exclude_roles:l,allowed_only:c,options:p})=>({type:g.wI,payload:y(e,t,s,a,r,o,i,n,l,c,p)}))({...e,...H?{exclude_roles:H}:{},allowed_only:!0})),B=e=>k((({field:e,limit:t,offset:s,application:a,resourceType:r,verb:o,allowedOnly:i,options:n})=>({type:b[e],payload:h(e,t,s,a,r,o,i,n)}))({...e,allowedOnly:!0})),{permissions:I,isLoading:A,pagination:O,baseRole:L,applicationOptions:D,resourceOptions:V,operationOptions:N,expandedPermissions:j,isLoadingExpandSplats:G,resourceTypes:$}=(0,n.useSelector)(T,n.shallowEqual),{input:q}=(0,c.Z)(s),_=(0,p.default)(),[W,Y]=(0,a.useState)({applications:[],resources:[],operations:[]}),z=_.getState().values["role-type"],H=_.getState().values["role-uuid"],[K,Q]=(0,a.useState)(!1),[U,X]=(0,a.useState)(""),[J,ee]=(0,a.useState)(),te=(0,a.useMemo)((()=>o||(R??!1)),[R,o]),se=e=>$.find((t=>t.value===e.split(":")?.[1])),ae=(0,a.useCallback)((0,u.Z)((({applications:e,resources:t,operations:s})=>B({field:"application",limit:50,application:e.join(),resourceType:t.join(),verb:s.join()})),2e3),[]),re=(0,a.useCallback)((0,u.Z)((({applications:e,resources:t,operations:s})=>B({field:"resource_type",limit:50,application:e.join(),resourceType:t.join(),verb:s.join()})),2e3),[]),oe=(0,a.useCallback)((0,u.Z)((({applications:e,resources:t,operations:s})=>B({field:"verb",limit:50,application:e.join(),resourceType:t.join(),verb:s.join()})),2e3),[]);(0,a.useEffect)((()=>{const e=_.getState().values["copy-base-role"]?.uuid;return"copy"===z&&e&&k((0,E.fp)(e)),_.change("has-cost-resources",!1),P(O),B({field:"application",limit:50}),B({field:"resource_type",limit:50}),B({field:"verb",limit:50}),()=>k({type:g.e0,payload:{data:[]}})}),[]),(0,a.useEffect)((()=>{F&&k((0,v.A)())}),[F]),(0,a.useEffect)((()=>{re(W),oe(W)}),[W.applications]),(0,a.useEffect)((()=>{ae(W),oe(W)}),[W.resources]),(0,a.useEffect)((()=>{ae(W),re(W)}),[W.operations]),(0,a.useEffect)((()=>{q.onChange(e)}),[e]),(0,a.useEffect)((()=>{if(!L||"copy"!==z||_.getState().values["base-permissions-loaded"]||e.length>0||_.getState().values["copy-base-role"]?.uuid!==L?.uuid||G||A)return;let s=[];const a=L?.access.filter((e=>!!D.includes(e?.permission?.split(":")[0])||(s.push(e),!1)))||[];if(_.change("not-allowed-permissions",s.map((({permission:e})=>e))),0===j.length&&void 0===G){const e=[...new Set(a.map((({permission:e})=>e.split(":")[0])))];k((({limit:e=1e3,offset:t=0,orderBy:s,application:a,resourceType:r,verb:o,permission:i,exclude_globals:n=!0,options:l})=>({type:g.e,payload:y(e,t,s,a,r,o,i,n,l)}))({application:e.join()}))}else{const e=a.map((({permission:e})=>e.replace("*",".*")));t((()=>j.filter((e=>"cost-management"!==e.split(":")[0]||0!==(se(e)||{count:0}).count)).filter((t=>e.some((e=>t.match(e))))).map((e=>({uuid:e}))))),_.change("base-permissions-loaded",!0)}}),[I,L]);const ie=e=>e.reduce(((e,t)=>({"":{...e?.[""],[t]:!0}})),{"":{}}),ne={applications:[...D].filter((e=>e.includes(U))).map((e=>({label:e,value:e}))),resources:[...V].filter((e=>e.includes(U))).map((e=>({label:e,value:e}))),operations:[...N].filter((e=>e.includes(U))).map((e=>({label:e,value:e})))},le={label:r().createElement("div",null,S.formatMessage(w.Z.noResultsFound)),isDisabled:!0},ce=ne[Object.keys(ne)[J||0]].length>10;return r().createElement("div",{className:"rbac-c-permissions-table"},r().createElement(d.M,{columns:x,isSelectable:!0,isCompact:!0,borders:!1,rows:(t=>t.map((({application:t,resource:s,operation:a,uuid:o,requires:i})=>({uuid:`${t}:${s}:${a}`,requires:i,cells:[{title:t},s,a],selected:Boolean(e&&e.find((e=>e.uuid===o))),disableSelection:"cost-management"===t&&(0===(se(o)||{count:0}).count||!F)||"inventory"===t&&!te,disabledContent:"cost-management"===t?r().createElement("div",null,S.formatMessage(F?w.Z.configureResourcesForPermission:w.Z.noCostManagementPermissions)," ",F?r().createElement("a",{href:"./settings/sources"},S.formatMessage(w.Z.configureCostSources)):null):r().createElement("div",null,S.formatMessage(w.Z.noRbacPermissions))}))))(I),data:I,filterValue:"",noData:0===I?.length,noDataDescription:[S.formatMessage(w.Z.permissionNotDisplayedDescription)],fetchData:({limit:e,offset:t,applications:s,resources:a,operations:r})=>{P({limit:e,offset:t,application:(s||W.applications).join(),resourceType:(a||W.resources).join(),verb:(r||W.operations).join()})},setFilterValue:({applications:e,resources:t,operations:s})=>{Y({...W,...e?{applications:e}:W.applications,...t?{resources:t}:W.resources,...s?{operations:s}:W.operations})},isLoading:A||G,pagination:{...O,count:O.count},checkedRows:e,setCheckedItems:s=>{const a=s(e).filter((({uuid:e,application:t})=>"cost-management"!==t||se(e)?.count>0)).map((({uuid:e,requires:t})=>({uuid:e,requires:t})));t((0,C.isEqual)(a,e)?[]:a)},titlePlural:S.formatMessage(w.Z.permissions).toLowerCase(),titleSingular:S.formatMessage(w.Z.permission).toLowerCase(),showMoreTitle:S.formatMessage(K?w.Z.seeLess:w.Z.seeMore),onFilter:e=>X(e),onShowMore:ce?()=>{Q((()=>!K))}:void 0,onChange:(e,t)=>{X(""),ee(t)},value:J,filters:[{key:"applications",value:W.applications,placeholder:S.formatMessage(w.Z.filterByKey,{key:S.formatMessage(w.Z.application).toLowerCase()}),type:"group",selected:ie(W.applications),groups:[{type:ne.applications.length>0?"checkbox":"plain",items:ne.applications.length>0?[...ne.applications].slice(0,K?void 0:10):[le]}]},{key:"resources",value:W.resources,placeholder:S.formatMessage(w.Z.filterByKey,{key:S.formatMessage(w.Z.resourceType).toLowerCase()}),type:"group",selected:ie(W.resources),groups:[{type:ne.resources.length>0?"checkbox":"plain",items:ne.resources.length>0?[...ne.resources].slice(0,K?void 0:10):[le]}]},{key:"operations",value:W.operations,placeholder:S.formatMessage(w.Z.filterByKey,{key:S.formatMessage(w.Z.operation).toLowerCase()}),type:"group",selected:ie(W.operations),groups:[{type:ne.operations.length>0?"checkbox":"plain",items:ne.operations.length>0?[...ne.operations].slice(0,K?void 0:10):[le]}]}],isFilterable:!0,rowWrapper:Z,tableId:"add-role-permissions",...s}))};F.propTypes={selectedPermissions:i().array,setSelectedPermissions:i().func};const R=F},47108:(e,t,s)=>{"use strict";s.d(t,{Z:()=>E});var a=s(28416),r=s.n(a),o=s(86706),i=s(9545),n=s(64380),l=s(16987),c=s(50247),p=s(46361),u=s(47189),m=s(27730),d=s(81169),g=s(48880),f=s(19862),y=s(25387),h=s(2550);const b=({costReducer:{resourceTypes:e,isLoading:t,loadingResources:s,resources:a}})=>({resourceTypes:e.data,resources:a,isLoading:t,isLoadingResources:s>0}),v=(e,t)=>{const s=e[t.key];switch(t.type){case"toggle":return{...e,[t.key]:{...s,isOpen:!s.isOpen}};case"select":return{...e,[t.key]:{...s,selected:s.selected.includes(t.selection)?s.selected.filter((e=>e!==t.selection)):[...s.selected,t.selection]}};case"selectAll":return{...e,[t.key]:{...s,selected:s.options.map((e=>e.value))}};case"clear":return{...e,[t.key]:{...s,selected:[]}};case"setOptions":return{...e,[t.key]:{...s,options:t.options,filteredOptions:t.options}};case"setFilter":return{...e,[t.key]:{...s,filteredOptions:s.options.filter((({value:e})=>e.includes(t.filtervalue)))}};default:return e}},E=e=>{const t=(0,y.YB)(),s=(0,o.useDispatch)(),{resourceTypes:E,isLoading:k,isLoadingResources:S,resources:Z}=(0,o.useSelector)(b,o.shallowEqual),{input:C}=(0,d.Z)(e),M=(0,g.default)(),w=M.getState().values["add-permissions-table"].filter((({uuid:e})=>e.split(":")[0].includes("cost-management"))),[T,F]=(0,a.useReducer)(v,w.reduce(((e,t)=>({...e,[t.uuid]:{selected:[],options:[],filteredOptions:[],isOpen:!1}})),{}));return(0,a.useEffect)((()=>{(M.getState().values["resource-definitions"]||[]).map((({permission:e,resources:t})=>t.map((t=>w.find((t=>t?.uuid===e))&&F({type:"select",selection:t,key:e}))))),s((0,f.A)(undefined)),M.change("has-cost-resources",!0)}),[]),(0,a.useEffect)((()=>{k||[...new Set(w.map((e=>E.find((t=>t.value===e.uuid.split(":")?.[1]))?.path)))].filter((e=>e)).map((e=>{return t=e,s((0,f.R)(t));var t}))}),[E]),(0,a.useEffect)((()=>{S||w.map((e=>{return F({type:"setOptions",key:e.uuid,options:Z[(t=e.uuid,E.find((e=>e.value===t.split(":")?.[1]))?.path.split("/")?.[5])]||[]});var t}))}),[S]),(0,a.useEffect)((()=>{const e=Object.entries(T).map((([e,t])=>({permission:e,resources:t.selected})));C.onChange(e),M.change("resource-definitions",e)}),[T]),r().createElement(i.Grid,{hasGutter:!0},r().createElement(i.GridItem,{md:4,className:"rbac-m-hide-on-sm"},r().createElement(n.Text,{component:n.TextVariants.h4,className:"rbac-bold-text"},t.formatMessage(h.Z.permissions))),r().createElement(i.GridItem,{md:8,className:"rbac-m-hide-on-sm"},r().createElement(n.Text,{component:n.TextVariants.h4,className:"rbac-bold-text"},t.formatMessage(h.Z.resourceDefinitions))),w.map((({uuid:e})=>{const s=T[e].filteredOptions;return r().createElement(r().Fragment,null,r().createElement(i.GridItem,{md:4,sm:12},r().createElement(c.Tooltip,{content:r().createElement("div",null,e)},r().createElement(l.FormGroup,{label:e.replace(/^cost-management:/,""),isRequired:!0}))),r().createElement(i.GridItem,{md:8,sm:12},r().createElement(p.P,{className:"rbac-m-resource-type-select",variant:u.TM.checkbox,typeAheadAriaLabel:t.formatMessage(h.Z.selectState),onToggle:(t,s)=>{F({type:"setFilter",key:e,filtervalue:""}),((e,t)=>{F({type:"toggle",key:e,isOpen:t})})(e,s)},onSelect:(a,r)=>{((e,t,s,a)=>{F(s?{type:"selectAll",selection:t,key:a}:{type:"select",selection:t,key:a})})(0,r,r===t.formatMessage(h.Z.selectAll,{length:s.length}),e)},onClear:()=>F({type:"clear",key:e}),selections:T[e].selected,isOpen:T[e].isOpen,onFilter:t=>t&&F({type:"setFilter",key:e,filtervalue:t.target.value}),"aria-labelledby":e,placeholderText:t.formatMessage(h.Z.selectResources),hasInlineFilter:!0},[r().createElement(m.$,{key:0,value:t.formatMessage(h.Z.selectAll,{length:s.length})}),...s.map(((e,t)=>r().createElement(m.$,{key:t+1,value:e.value})))])))})))}},68539:(e,t,s)=>{"use strict";s.d(t,{Z:()=>u});var a=s(28416),r=s.n(a),o=s(45697),i=s.n(o),n=s(72232),l=s(25387),c=s(2550);const p=({formFields:e})=>{const t=(0,l.YB)();return r().createElement("div",{className:"rbac"},r().createElement(n.Title,{headingLevel:"h1",size:"xl",className:"pf-v5-u-mb-lg"},t.formatMessage(c.Z.inventoryGroupsAccessTitle)),e)};p.propTypes={formFields:i().array};const u=p},64645:(e,t,s)=>{"use strict";s.d(t,{Z:()=>M});var a=s(28416),r=s.n(a),o=s(31055),i=s(9545),n=s(64380),l=s(16987),c=s(50247),p=s(42508),u=s(27730),m=s(46361),d=s(47189),g=s(86706),f=s(81169),y=s(48880),h=s(25387),b=s(71079);const v=(0,s(75465).bD)(),E=async e=>await v.getInventoryGroups(e);var k=s(29301),S=s(2550);const Z=({inventoryReducer:{resourceTypes:e,total:t,isLoading:s}})=>({resourceTypes:e,totalCount:t,isLoading:s}),C=(e,t)=>{const s=e[t.key];switch(t.type){case"toggle":return{...e,[t.key]:{...s,isOpen:t.isOpen,filterValue:t.filterValue??s.filterValue,page:t.page??s.page}};case"select":return s.selected.some((e=>e?.id===t.processedSelection?.id))?{...e,[t.key]:{...s,selected:s.selected.filter((e=>e.id!==t.processedSelection?.id))}}:void 0!==t.processedSelection?.id&&void 0!==t.processedSelection?.name?{...e,[t.key]:{...s,selected:[...s.selected,t.processedSelection]}}:e;case"copyToAll":{const s=e[t.permissions[0]].selected;return{...e,...t.permissions.reduce(((t,a)=>(t[a]={...e[a],selected:a.includes("inventory:hosts")?s:s.filter((({id:e})=>null!==e))},t)),{})}}case"selectAll":return{...e,[t.key]:{...s,selected:t.selectionArray}};case"setFilter":return{...e,[t.key]:{...s,filterValue:t.filterValue,page:1}};case"setPage":return{...e,[t.key]:{...s,page:t.page}};case"clear":return{...e,[t.key]:{...s,selected:[]}};default:return e}},M=e=>{const t=(0,h.YB)(),s=(0,g.useDispatch)(),{input:v}=(0,f.Z)(e),M=(0,y.default)(),{resourceTypes:w,totalCount:T,isLoading:F}=(0,g.useSelector)(Z,g.shallowEqual),R=M.getState().values["add-permissions-table"].filter((({uuid:e})=>e.split(":")[0].includes("inventory"))).map((({uuid:e})=>e))||[],x=(e,t)=>s(((e,t)=>({type:b.rF,meta:{permissions:e,config:t},payload:E(t)}))(e,t)),[P,B]=(0,a.useReducer)(C,R.reduce(((e,t)=>({...e,[t]:{page:1,selected:[],filterValue:"",isOpen:!1}})),{}));return(0,a.useEffect)((()=>{x(R,{}),M.change("inventory-group-permissions",[])}),[]),(0,a.useEffect)((()=>{const e=Object.entries(P).map((([e,{selected:t}])=>({permission:e,groups:t})));v.onChange(e),M.change("inventory-group-permissions",e)}),[P]),r().createElement(i.Grid,{hasGutter:!0},r().createElement(i.GridItem,{lg:3,md:6,className:"rbac-m-hide-on-sm"},r().createElement(n.Text,{component:n.TextVariants.h4,className:"rbac-bold-text pf-v5-u-mt-sm"},t.formatMessage(S.Z.permissions))),r().createElement(i.GridItem,{lg:9,md:6,className:"rbac-m-hide-on-sm"},r().createElement(n.Text,{component:n.TextVariants.h4,className:"rbac-bold-text pf-v5-u-mt-sm"},t.formatMessage(S.Z.groupDefinition))),R.map(((e,s)=>{const a=t.formatMessage(S.Z.ungroupedSystems).toLocaleLowerCase().includes(P[e].filterValue.toLocaleLowerCase())?[r().createElement(u.$,{key:`${e}-ungrouped`,value:"null"},r().createElement(h._H,{...S.Z.ungroupedSystems})),r().createElement(p.Divider,{component:"li",key:`${e}-divider`})]:[],n=Object.values(w?.[e]??{});return r().createElement(r().Fragment,{key:e},r().createElement(i.Grid,null,r().createElement(i.GridItem,{lg:3,md:3,sm:4},r().createElement(l.FormGroup,{label:e?.replace("inventory:",""),isRequired:!0})),r().createElement(i.GridItem,{lg:7,md:6,sm:5},r().createElement(c.Tooltip,{content:r().createElement("div",null,t.formatMessage(S.Z.inventoryGroupsTooltip))},r().createElement(m.P,{className:"rbac-m-resource-type-select",variant:d.TM.checkbox,typeAheadAriaLabel:t.formatMessage(S.Z.inventoryGroupsTypeAheadLabel),"aria-labelledby":e,selections:P[e].selected.map((({name:e})=>e)),placeholderText:t.formatMessage(S.Z.selectGroups),onSelect:(t,s)=>((e,t,s,a)=>{const r={id:null,name:"null"};return s&&B({type:"selectAll",selectionArray:[r,...Object.values(w[a])],key:a})||B({type:"select",processedSelection:"null"===t?r:w[a][t],key:a})})(0,s,"select-all"===s,e),onToggle:(t,s)=>{!s&&P[e].filterValue?.length>0&&x([e]),B({type:"toggle",key:e,filterValue:"",page:1,isOpen:s})},onClear:()=>B({type:"clear",key:e}),onFilter:t=>{t&&(B({type:"setFilter",key:e,filterValue:t.target.value}),(0,k.Aq)((()=>x([e],{name:t.target.value})),2e3))},isOpen:P[e].isOpen,hasInlineFilter:!0,...!F&&w[e]&&Object.values(w[e]).length<T&&{loadingVariant:{text:t.formatMessage(S.Z.seeMore),onClick:()=>{x([e],{page:P[e].page+1,name:P[e].filterValue}),B({type:"setPage",key:e,page:P[e].page++})}}},...F&&{loadingVariant:"spinner"}},[...n?.length>0?[r().createElement(u.$,{key:`${e}-all`,value:"select-all"},r().createElement(h._H,{...S.Z.selectAll,values:{length:n?.length}}))]:[],...e.includes("hosts:")?a:[],...n?.map(((t,s)=>r().createElement(u.$,{key:`${e}-${s+1}`,value:t?.name},t.children)))||[]]))),r().createElement(i.GridItem,{lg:2,md:4,sm:2},s<=0&&r().createElement(o.Button,{key:`${e}-copy`,variant:"link",isInLink:!0,onClick:()=>B({type:"copyToAll",permissions:R})},t.formatMessage(S.Z.copyToAll)))))})))}},92884:(e,t,s)=>{"use strict";s.d(t,{j:()=>a});const a=(e,t)=>{const s=t&&t["add-permissions-table"]||[],a=s.some((({uuid:e})=>e.split(":")[0].includes("cost-management"))),r=s.some((({uuid:e})=>e.split(":")[0].includes("inventory")));return"inventory-groups-role"===e&&a?"cost-resources-definition":"add-permissions"===e&&r?"inventory-groups-role":"add-permissions"===e&&a?"cost-resources-definition":"review"}},82472:()=>{},97890:()=>{},17657:()=>{},22972:()=>{},43389:()=>{},45467:()=>{},70347:()=>{},32857:()=>{},1580:()=>{},94498:()=>{},28992:()=>{},80897:()=>{},30187:()=>{},90479:()=>{},78752:()=>{},21626:()=>{},8572:()=>{},98379:()=>{},25238:()=>{},91993:()=>{},36974:()=>{},54994:()=>{},44690:()=>{},37494:()=>{},67761:()=>{},49854:()=>{},40209:()=>{},87234:()=>{}}]);
//# sourceMappingURL=../sourcemaps/2824.fcde7f669669d796ebad1bfed1213daa.js.map