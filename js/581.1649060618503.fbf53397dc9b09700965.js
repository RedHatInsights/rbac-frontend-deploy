"use strict";(self.webpackChunkinsights_rbac_frontend=self.webpackChunkinsights_rbac_frontend||[]).push([[581,664],{40472:(e,t)=>{t.DT={name:"--pf-global--breakpoint--2xl",value:"1450px",var:"var(--pf-global--breakpoint--2xl)"},t.ZP=t.DT},92732:(e,t)=>{t.s6={name:"--pf-global--breakpoint--lg",value:"992px",var:"var(--pf-global--breakpoint--lg)"},t.ZP=t.s6},60144:(e,t)=>{t.A4={name:"--pf-global--breakpoint--sm",value:"576px",var:"var(--pf-global--breakpoint--sm)"},t.ZP=t.A4},63242:(e,t)=>{t.yk={name:"--pf-global--breakpoint--xl",value:"1200px",var:"var(--pf-global--breakpoint--xl)"},t.ZP=t.yk},79995:(e,t)=>{t.U6={name:"--pf-global--breakpoint--xs",value:"0",var:"var(--pf-global--breakpoint--xs)"},t.ZP=t.U6},85127:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Ee});var n=r(93433),o=r(29439),a=r(4942),i=r(96985),l=r.n(i),s=r(28216),c=r(92818),u=r(8351),p=r(75857),d=r(64107),f=r(11107),m=function(e){return e.reduce((function(e,t){var r=t.uuid,o=t.display_name,a=t.name,s=t.description,u=t.system,p=t.accessCount,m=t.groups_in_count,b=t.modified;return[].concat((0,n.Z)(e),[{uuid:r,system:u,cells:[l().createElement(i.Fragment,{key:"".concat(r,"-name")},l().createElement(c.Link,{to:"/roles/detail/".concat(r)},o||a)),s,l().createElement(i.Fragment,{key:"".concat(r,"-accessCount")},l().createElement(c.Link,{to:"/roles/detail/".concat(r)},p)),m,l().createElement(i.Fragment,{key:"".concat(r,"-modified")},l().createElement(d.Z,{date:b,type:(0,f.mh)(b)}))]}])}),[])},b=r(28090),v=r(38376),g=r(41800),y=r(13063),h=r(44873),E=r(15608),O=r(4682),Z=r(88040),P=r(93327),R=function(e){return e.reduce((function(e,t){return[].concat((0,n.Z)(e),[{cells:[t]}])}),[])},j=r(39173),w=r(19571),k=r(61338),S=r(87462),D=r(45697),_=r.n(D),x=r(96354),L=r(36457),C=r(29215),I=r(46966),F=r(73943),T=r(45987),M=r(40483),A=r(48880),V=["ModalProps"];function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var q=function(e){var t=e.ModalProps,r=(0,T.Z)(e,V),n=(0,A.default)().getState().values;return l().createElement(M.Z,(0,S.Z)({},r,{ModalProps:z(z({},t),{},{onClose:function(){return t.onClose(n)}}),alert:n["dual-list-select"]?void 0:function(){return l().createElement("div",{className:"rbac-m-resource-definitions"},l().createElement(p.Alert,{className:"pf-c-modal__alert",variant:"danger",isInline:!0,title:"At least one resource must be defined for this permission"}))}}))};q.propTypes={ModalProps:_().object};const B=q;var W=r(42348),G=r.n(W);function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Q={changedResources:void 0,cancelWarningVisible:!1,resourcesPath:void 0,loadingStateVisible:!0};function X(e,t){if("update"===t.type)return U(U({},e),t.payload);throw new Error}var K=function(e,t,r){return{fields:[{component:x.Z.DUAL_LIST_SELECT,name:"dual-list-select",leftTitle:"Resources available for the permission",rightTitle:"Resources defined for the permission",filterOptionsTitle:"Filter by resource...",filterValueTitle:"Filter by resource...",options:(0,n.Z)(t&&e?r:[]),validate:[{type:"validate-resources"}]}]}},J={"validate-resources":function(){return function(e){return e&&e.length>0?void 0:"At least one resource must be defined for this permission"}}},Y=function(e){var t=e.cancelRoute,r=(0,c.useRouteMatch)(O.Z["role-detail-permission-edit"]),a=(0,c.useRouteMatch)(r).params,u=a.permissionId,d=a.roleId,f=(0,c.useHistory)(),m=f.replace,v=f.push,g=(0,s.useDispatch)(),y=(0,i.useReducer)(X,Q),h=(0,o.Z)(y,2),E=h[0],Z=h[1],P=(0,s.useSelector)((function(e){var t;return{role:e.roleReducer.selectedRole,definedResources:null!==(t=e.roleReducer.selectedRole)&&void 0!==t&&t.access?G()(e.roleReducer.selectedRole.access.filter((function(e){return e.permission===u})).map((function(e){return e.resourceDefinitions.map((function(e){return e.attributeFilter.value}))}))):[],isRecordLoading:e.roleReducer.isRecordLoading}}),s.shallowEqual),R=P.definedResources,j=P.role,w=(0,s.useSelector)((function(e){return function(e,t){var r=e.costReducer,n=r.resourceTypes,o=r.isLoading,a=r.loadingResources,i=r.resources;return{resourceTypes:n.data,resources:i[t]?{resourcesPath:i[t]}:i,isLoading:o,isLoadingResources:a>0}}(e,E.resourcesPath)}),s.shallowEqual),k=w.resourceTypes,D=w.isLoading,_=w.isLoadingResources,x=w.resources;(0,i.useEffect)((function(){g((0,C.A)())}),[u]),(0,i.useEffect)((function(){if(!D){var e,t=null===(e=k.find((function(e){var t;return e.value===(null===(t=u.split(":"))||void 0===t?void 0:t[1])})))||void 0===e?void 0:e.path;t&&(Z({type:"update",payload:{resourcesPath:t.split("/")[5]}}),g((0,C.R)(t)))}}),[k]);var T=function(){return m(t)},M=function(e){e["dual-list-select"]===R?T():Z({type:"update",payload:{changedResources:e["dual-list-select"],cancelWarningVisible:!0}})},A=function(e){return Object.entries(e).reduce((function(e,t){var r=(0,o.Z)(t,2),a=r[0],i=r[1];return[].concat((0,n.Z)(e),(0,n.Z)(i.map((function(e){return{value:e.value,path:a,label:e.value}}))))}),[])}(x);return l().createElement(l().Fragment,null,l().createElement(F.R,{customTitle:"Exit edit resource definitions?",customDescription:"All changes will be lost.",isOpen:E.cancelWarningVisible,onModalCancel:function(){return Z({type:"update",payload:{cancelWarningVisible:!1}})},onConfirmCancel:T}),(D||_)&&E.loadingStateVisible?l().createElement(p.Modal,{className:"rbac-m-resource-definitions",isOpen:!0,title:"Edit resource definitions",onClose:function(){Z({type:"update",payload:{loadingStateVisible:!1}}),T()}},l().createElement(p.Spinner,null)):l().createElement(L.Z,{schema:K(x,E.resourcesPath,A),componentMapper:I.ZP,initialValues:{"dual-list-select":E.changedResources||R||[]},onSubmit:function(e){var r;Z({type:"update",payload:{changedResources:e["dual-list-select"]}});var o={permission:u,resourceDefinitions:[{attributeFilter:{key:"cost-management.".concat(null===(r=u.split(":"))||void 0===r?void 0:r[1]),operation:1===e["dual-list-select"].length?"equal":"in",value:1===e["dual-list-select"].length?e["dual-list-select"][0]:e["dual-list-select"]}}]};g((0,b.ul)(d,U(U({},j),{},{access:[].concat((0,n.Z)(j.access.filter((function(e){return e.permission!==u}))),[o])})),!0).then((function(){g((0,b.fp)(d)),v(t)}))},onCancel:function(e){return M(e)},validatorMapper:J,FormTemplate:function(e){return l().createElement(B,(0,S.Z)({},e,{ModalProps:{onClose:M,isOpen:!E.cancelWarningVisible,variant:"large",title:"Edit resource definitions",description:"Give or remove permissions to specific resources using the arrows below."}}))}}))};Y.propTypes={cancelRoute:_().string.isRequired};const $=Y;var ee=r(85564),te=r.n(ee);function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const oe=function(){var e=(0,i.useState)({pagination:ne(ne({},k.he),{},{filter:""})}),t=(0,o.Z)(e,2),r=t[0],n=t[1],a=r.pagination,u=r.filter,d=(0,s.useDispatch)(),m=(0,c.useParams)(),y=m.roleId,h=m.permissionId,E=(0,s.useSelector)((function(e){var t,r,n,o,a;return{role:e.roleReducer.selectedRole,permission:e.roleReducer.selectedRole.access?ne({},null===(t=e.roleReducer.selectedRole)||void 0===t?void 0:t.access.find((function(e){return e.permission===h}))):{},isRecordLoading:e.roleReducer.isRecordLoading,rolesPagination:(null===(r=e.roleReducer)||void 0===r||null===(n=r.roles)||void 0===n?void 0:n.pagination)||k.he,rolesFilters:(null===(o=e.roleReducer)||void 0===o||null===(a=o.roles)||void 0===a?void 0:a.filters)||{}}}),s.shallowEqual),Z=E.role,P=E.permission,S=E.isRecordLoading,D=E.rolesPagination,_=E.rolesFilters;(0,i.useEffect)((function(){d((0,b.fp)(y))}),[y]),(0,i.useEffect)((function(){n(ne(ne({},r),{},{pagination:ne(ne({},r.pagination),{},{count:Z.access?Z.access.length:0})}))}),[Z]);var x=P.resourceDefinitions?te()(P.resourceDefinitions.map((function(e){return e.attributeFilter.value}))).filter((function(e){return!u||e.includes(u)})):[],L=function(){return l().createElement(i.Fragment,null,l().createElement(c.Route,{exact:!0,path:O.Z["role-detail-permission-edit"]},l().createElement($,{cancelRoute:O.Z["role-detail-permission"].replace(":roleId",y).replace(":permissionId",h)})))};return l().createElement(i.Fragment,null,l().createElement(v.Q,{breadcrumbs:[{title:"Roles",to:(0,f.zk)(L.roles,D,_)},{title:S?void 0:Z&&(Z.display_name||Z.name),to:"/roles/detail/".concat(y)},{title:h,isActive:!0}]},l().createElement(p.Level,null,l().createElement(p.LevelItem,null,l().createElement(j.Z,{title:h||l().createElement(w.h2,null),className:"rbac-page-header__title"})))),l().createElement("section",{className:"pf-c-page__main-section rbac-c-role__permissions"},l().createElement(p.TextContent,null,l().createElement(p.Text,{component:p.TextVariants.h1},"Defined resources")),l().createElement(g.M,{columns:[{}],createRows:R,data:x.slice(a.offset,a.offset+a.limit),filterValue:u,fetchData:function(e){var t=e.limit,o=e.offset,a=e.name;return n(ne(ne({},r),{},{filter:a,pagination:ne(ne({},r.pagination),{},{limit:t,offset:o})}))},isCompact:!0,routes:L,setFilterValue:function(e){var t=e.name;return n(ne(ne({},r),{},{filter:t}))},toolbarButtons:function(){return Z.system?[]:[l().createElement(i.Fragment,{key:"edit-resource-definitions"},l().createElement(c.Link,{to:"/roles/detail/".concat(y,"/permission/").concat(h,"/edit")},l().createElement(p.Button,{variant:"primary","aria-label":"Edit"},"Edit")))]},isLoading:S,pagination:ne(ne({},a),{},{count:x.length}),titlePlural:"resources",titleSingular:"resource",hideHeader:!0,tableId:"role-resource-definitions"})))};var ae=r(92758),ie=r(79995),le=r(60144),se=r(78236),ce=r(92732),ue=r(63242),pe=r(40472);const de={xs:parseInt(ie.ZP.value.replace("px","")),sm:parseInt(le.ZP.value.replace("px","")),md:parseInt(se.ZP.value.replace("px","")),lg:parseInt(ce.ZP.value.replace("px","")),xl:parseInt(ue.ZP.value.replace("px","")),"2xl":parseInt(pe.ZP.value.replace("px",""))},fe=function(){for(var e,t=window.innerWidth,r=0,n=Object.entries(de);r<n.length;r++){var o=n[r],a=o[0];if(o[1]>=t)break;e=a}return e};var me=r(26794);function be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?be(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ge=(0,i.lazy)((function(){return r.e(607).then(r.bind(r,68607))})),ye=[{title:"Name",key:"display_name",transforms:[(0,u.cellWidth)(20),u.sortable]},{title:"Description"},{title:"Permissions",transforms:[u.nowrap]},{title:"Groups",transforms:[u.nowrap]},{title:"Last modified",key:"modified",transforms:[u.nowrap,u.sortable]}],he=function(e){var t=e.roleReducer,r=t.roles,n=t.isLoading;return{roles:r.data,filters:r.filters,meta:r.pagination,isLoading:n}};const Ee=function(){var e,t,r,a,u=(0,s.useDispatch)(),d=(0,c.useHistory)().push,R=(0,s.useSelector)(he,s.shallowEqual),j=R.roles,w=R.isLoading,S=R.filters,D=R.meta,_=function(e){return u((0,b.Kt)(ve(ve({},e),{},{inModal:!1})))},x=(0,c.useHistory)(),L=(0,i.useContext)(me.Z),C=L.userAccessAdministrator,I=L.orgAdmin,F=(0,i.useState)(D),T=(0,o.Z)(F,2),M=T[0],A=T[1],V=(0,i.useState)(S.display_name||""),N=(0,o.Z)(V,2),z=N[0],q=N[1],B=(e=(0,i.useState)((function(){return fe()})),t=e[0],r=e[1],a=(0,i.useRef)(t),(0,i.useEffect)((function(){function e(){var e=fe();e!==a.current&&(a.current=e,r(e))}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),t);(0,i.useEffect)((function(){var e=(0,k.rj)(x,M);A(e);var t=(0,ae.aX)(x,["display_name"],{display_name:z}).display_name;q(t),insights.chrome.appNavClick({id:"roles",secondaryNav:!0}),_(ve(ve({},e),{},{filters:{display_name:t}}))}),[]),(0,i.useEffect)((function(){q(S.display_name),A(D)}),[S,D]),(0,i.useEffect)((function(){D.redirected&&(0,k.oG)(x,D.limit,D.offset)}),[D.redirected]),(0,i.useEffect)((function(){(0,k.Zc)(x)||(0,k.oG)(x,M.limit,M.offset),(null==z?void 0:z.length)>0&&!(0,ae.qF)(x,["display_name"])&&(0,ae.aX)(x,["display_name"],{display_name:z})}));var W=function(){return l().createElement(i.Suspense,{fallback:l().createElement(i.Fragment,null)},l().createElement(c.Route,{exact:!0,path:O.Z["add-role"]},l().createElement(ge,{pagination:M,filters:{display_name:z}})),l().createElement(c.Route,{exact:!0,path:O.Z["remove-role"]},!w&&l().createElement(y.Z,{afterSubmit:function(){return _(ve(ve({},M),{},{offset:0,filters:{display_name:z}}))},routeMatch:O.Z["remove-role"],cancelRoute:(0,f.zk)(O.Z.roles,M,S),submitRoute:(0,f.zk)(O.Z.roles,ve(ve({},M),{},{offset:0}),S)})),l().createElement(c.Route,{exact:!0,path:O.Z["edit-role"]},!w&&l().createElement(Z.Z,{afterSubmit:function(){return _(ve(ve({},M),{},{offset:0,filters:{display_name:z}}))},routeMatch:O.Z["edit-role"],cancelRoute:(0,f.zk)(O.Z.roles,M,S),submitRoute:(0,f.zk)(O.Z.roles,ve(ve({},M),{},{offset:0}),S)})))},G=function(e){return e.system?[]:[{title:"Edit",onClick:function(e,t,r){return d("/roles/edit/".concat(r.uuid))}},{title:"Delete",onClick:function(e,t,r){return d("/roles/remove/".concat(r.uuid))}}]},H=function(){return I||C?[l().createElement(c.Link,{to:O.Z["add-role"],key:"add-role",className:"rbac-m-hide-on-sm"},l().createElement(p.Button,{ouiaId:"create-role-button",variant:"primary","aria-label":"Create role"},"Create role"))].concat((0,n.Z)(function(e){return(null==de?void 0:de[e])<=de.sm}(B)?[{label:"Create role",onClick:function(){x.push(O.Z["add-role"])}}]:[])):[]};return l().createElement(c.Switch,null,l().createElement(P.Z,{pageAction:"role-detail-permission",path:O.Z["role-detail-permission"]},l().createElement(oe,null)),l().createElement(P.Z,{pageAction:"role-detail",path:O.Z["role-detail"]},l().createElement(E.Z,{onDelete:function(){return q("")}})),l().createElement(P.Z,{pageAction:"roles-list",path:O.Z.roles,render:function(){return l().createElement(p.Stack,{className:"rbac-c-roles"},l().createElement(p.StackItem,null,l().createElement(v.Q,null,l().createElement(v.y,{title:"Roles"}))),l().createElement(p.StackItem,null,l().createElement(h.Z,{type:"content",id:"tab-roles"},l().createElement(g.M,{actionResolver:G,sortBy:{index:0,direction:"asc"},columns:ye,createRows:m,data:j,filterValue:z,fetchData:function(e){var t=e.name,r=e.count,n=e.limit,o=e.offset,a=e.orderBy;return(0,k.oG)(x,n,o),(0,ae.MS)(x,{display_name:t}),_((0,f.jl)({count:r,limit:n,offset:o,orderBy:a,filters:{display_name:t}}))},setFilterValue:function(e){var t=e.name;return q(t)},isLoading:!w&&0===(null==j?void 0:j.length)&&0===(null==z?void 0:z.length)||w,pagination:M,routes:W,ouiaId:"roles-table",titlePlural:"roles",titleSingular:"role",toolbarButtons:H,filterPlaceholder:"name",tableId:"roles"}))))}}))}}}]);
//# sourceMappingURL=../sourcemaps/581.55c3cedeb5e49ffc14bac0202b714ece.js.map