(self.webpackChunkinsights_rbac_frontend=self.webpackChunkinsights_rbac_frontend||[]).push([[5205],{66369:(e,t,n)=>{(t=n(23645)(!1)).push([e.id,".rbac .pf-c-form .pf-c-form__group .pf-c-radio,.my-user-access .pf-c-form .pf-c-form__group .pf-c-radio{padding-bottom:8px}.rbac .pf-c-form .pf-c-form__group .pf-c-radio:last-child,.my-user-access .pf-c-form .pf-c-form__group .pf-c-radio:last-child{padding-bottom:0px}.rbac .pf-c-select__menu .ins-c-select__scrollable-section,.my-user-access .pf-c-select__menu .ins-c-select__scrollable-section{max-height:365px;overflow:auto}.rbac .ins-c-rbac-add-permission-title,.my-user-access .ins-c-rbac-add-permission-title{display:block}.rbac .pf-c-wizard__main-body .ins-c-rbac-seleted-chips,.my-user-access .pf-c-wizard__main-body .ins-c-rbac-seleted-chips{padding-bottom:var(--pf-global--spacer--md)}.rbac .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group,.my-user-access .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group{background-color:var(--pf-global--BackgroundColor--100)}.rbac .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip,.my-user-access .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip{background-color:var(--pf-global--palette--blue-50);border-radius:var(--pf-global--BorderRadius--lg)}.rbac .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip .pf-c-chip__text,.my-user-access .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip .pf-c-chip__text{font-size:var(--pf-global--FontSize--sm)}.rbac .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip::before,.my-user-access .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip::before{border-style:none}@media only screen and (max-width: 815px){.rbac .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content,.my-user-access .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content{padding:0px}.rbac .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group,.my-user-access .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:30em}}@media only screen and (max-width: 895px){.rbac .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group,.my-user-access .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:32em}}@media only screen and (min-width: 992px){.rbac .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content,.my-user-access .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content{padding:0px}.rbac .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group,.my-user-access .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:25em}}@media only screen and (min-width: 1055px){.rbac .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group,.my-user-access .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:32em}}@media only screen and (min-width: 1150px){.rbac .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group,.my-user-access .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:35em}}.rbac .ins-c-rbac-cost-resource-select .pf-c-select__menu .pf-c-select__menu-item:nth-child(3) .pf-c-check__input,.my-user-access .ins-c-rbac-cost-resource-select .pf-c-select__menu .pf-c-select__menu-item:nth-child(3) .pf-c-check__input{display:none}.rbac .ins-c-rbac-cost-resource-select .pf-c-select__menu .pf-c-select__menu-item:nth-child(3) .pf-c-check__label,.my-user-access .ins-c-rbac-cost-resource-select .pf-c-select__menu .pf-c-select__menu-item:nth-child(3) .pf-c-check__label{color:var(--pf-global--link--Color)}.rbac .ins-c-rbac-disabled-row,.my-user-access .ins-c-rbac-disabled-row{background-color:var(--pf-global--disabled-color--300)}\n",""]),e.exports=t},20387:(e,t,n)=>{(t=n(23645)(!1)).push([e.id,".rbac .ins-c-rbac__sticky .ins-c-rbac__sticky--title,.my-user-access .ins-c-rbac__sticky .ins-c-rbac__sticky--title{margin-bottom:var(--pf-global--spacer--sm);border-bottom:1px solid var(--pf-global--palette--black-300)}.rbac .ins-c-rbac__sticky .ins-c-rbac__sticky--title .pf-l-grid__item,.my-user-access .ins-c-rbac__sticky .ins-c-rbac__sticky--title .pf-l-grid__item{font-weight:var(--pf-global--FontWeight--bold);margin-bottom:var(--pf-global--spacer--sm) !important}.rbac .ins-c-rbac__sticky .ins-c-rbac__sticky--data,.my-user-access .ins-c-rbac__sticky .ins-c-rbac__sticky--data{max-height:240px;overflow:auto;-ms-overflow-style:none;scrollbar-width:none}.rbac .ins-c-rbac__sticky .data::-webkit-scrollbar,.my-user-access .ins-c-rbac__sticky .data::-webkit-scrollbar{display:none}.rbac .ins-c-rbac__gutter-sm,.my-user-access .ins-c-rbac__gutter-sm{margin-bottom:var(--pf-global--spacer--sm)}.rbac .ins-c-rbac__gutter-md,.my-user-access .ins-c-rbac__gutter-md{margin-bottom:var(--pf-global--spacer--md)}\n",""]),e.exports=t},5205:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AddRoleWizardContext:()=>Be,default:()=>Ue,mapperExtension:()=>Ye});var r=n(319),o=n.n(r),i=n(59713),c=n.n(i),a=n(63038),s=n.n(a),l=n(6479),u=n.n(l),p=n(67154),d=n.n(p),m=n(80150),f=n.n(m),b=n(45697),y=n.n(b),h=n(70983),v=n(71355),g=n(98917),_=n(81554),E=n(86106),w=n(77583),O=n(24154),x=n(21899),k=n(26391),P=n(68340),j=n(68774),S=n(60485),C=n(47173),R=n(22210),D=n(58860),N=n(55795);function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}n(12236);var Z=function(e){var t,n,r,i=e.formFields,c=(0,D.Z)(),a=(0,m.useState)(c.getState().values["add-permissions-table"]||[]),l=s()(a,2),u=l[0],p=l[1],d=(null===(t=c.getState().values)||void 0===t||null===(n=t["copy-base-role"])||void 0===n||null===(r=n.applications)||void 0===r?void 0:r.filter((function(e){return!(null==u?void 0:u.find((function(t){return t.uuid.includes(e)})))})))||[],b=i[0][0];return f().createElement("div",{className:"rbac"},u.length>0?f().createElement("div",{className:"ins-c-rbac-seleted-chips"},f().createElement(k.Z,{categoryName:"Selected permissions"},u.reduce((function(e,t){return[t].concat(o()(e))}),[]).map((function(e){var t=e.uuid;return f().createElement(x.A,{key:t,color:"blue",isTruncated:!0,onClick:function(){return p(u.filter((function(e){return e.uuid!==t})))}},t)})))):null,f().createElement(S.D,{headingLevel:"h1",size:"xl",className:"ins-c-rbac-add-permission-title"},"Add permissions"),f().createElement(j.D,null,f().createElement(P.x,null,"Select permissions to add to your role",0!==d.length&&f().createElement(R.J,{headerContent:"Custom roles only support granular permissions",bodyContent:"Wildcard permissions (for example, approval:*:*) aren’t included in this table and can’t be added to your custom role."},f().createElement(C.zx,{variant:"link"},"Why am I not seeing all of my permissions? ",f().createElement(N.ZP,null))))),[[T(T({},b),{},{props:T(T({},b.props),{},{selectedPermissions:u,setSelectedPermissions:p})})]])};Z.propTypes={formFields:y().array};const z=Z;var L=n(52643),q=n(2372),A=n(87757),M=n.n(A),I=n(48926),W=n.n(I),B=n(45139),Q=n(39379),V=function(){var e=W()(M().mark((function e(t){var n,r;return M().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.next=4,(0,B.vd)({limit:10,offset:0,name:t,nameMatch:"exact"}).catch((function(e){console.error(e)}));case 4:if(!((null==(r=e.sent)||null===(n=r.data)||void 0===n?void 0:n.length)>0)){e.next=7;break}throw"Name has already been taken";case 7:return e.abrupt("return",void 0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Y=(0,Q.Z)(V),H=function(e){var t=e.name,n=(0,D.Z)();return(0,m.useEffect)((function(){return setTimeout((function(){return n.change(t,"1")})),function(){return n.change(t,"")}}),[]),null},U=(n(50486),n(95817));function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var K=function(e){var t,n=e.formFields,r=(0,m.useContext)(Be),o=r.submitting,i=r.error,c=r.setWizardError,a=(0,D.Z)().getState;return(0,m.useEffect)((function(){c(void 0),V(a().values["role-name"]).then((function(){return c(!1)})).catch((function(){return c(!0)}))}),[]),void 0===i||o?f().createElement(L.b,null,f().createElement(q.$,{size:"xl"})):!0===i?f().createElement(U.Z,{context:Be,title:"Role name already taken",text:"Please return to Step 1: Create role and choose a unique role name for your custom role."}):f().createElement("div",{className:"rbac"},f().createElement(S.D,{headingLevel:"h1",size:"xl",className:"ins-c-rbac__gutter-sm"},"Review details"),f().createElement(j.D,{className:"ins-c-rbac__gutter-md"},f().createElement(P.x,null,"Review and confirm the details for your role, or click Back to revise.")),[[G({},null==n||null===(t=n[0])||void 0===t?void 0:t[0])]])};K.propTypes={formFields:y().array};const J=K;var X=n(73952),ee=n(89531),te=n(2485),ne=n(9947),re=n(38424),oe=n(75106),ie=n(35293),ce=n(68778),ae=n(47194);const se=function(){var e=(0,m.useContext)(Be).setHideForm;return f().createElement(ne.u,{variant:ne.I.large},f().createElement(re.k,{color:"green",icon:ce.ZP}),f().createElement(S.D,{headingLevel:"h4",size:"lg"},"You have successfully created a new role"),f().createElement(oe.B,null),f().createElement(C.zx,{component:function(e){return f().createElement(ae.Link,d()({to:"/roles"},e))},variant:"primary"},"Exit"),f().createElement(ie.i,null,f().createElement(C.zx,{onClick:function(){e(!1)},variant:"link"},"Create another role"),f().createElement(C.zx,{component:function(e){return f().createElement(ae.Link,d()({to:"/groups"},e))},variant:"link"},"Add role to group")))};var le=n(92504),ue=n(35540),pe=n(17721),de=n(12830),me=n(8785),fe=n(12460),be=["",{title:"Name",key:"display_name",transforms:[fe.sortable]},"Description"],ye=function(e){var t=e.roleReducer,n=t.rolesForWizard,r=t.isLoading;return{roles:n.data,pagination:n.meta,isLoading:r}};var he=n(48623),ve=n(55004),ge=n(26701),_e=n(44479),Ee=function(e){var t=e.row,n=u()(e,["row"]);return t.disableSelection?f().createElement(_e.u,{content:f().createElement("div",null,"To add this permission to your role and define specific resources for it, at least one data source must be connected."," ",f().createElement("a",{href:"./settings/sources"},"Configure sources for Cost Management")),exitDelay:1500,entryDelay:1500},f().createElement(fe.RowWrapper,d()({className:"ins-c-rbac-disabled-row",row:t},n))):f().createElement(fe.RowWrapper,d()({row:t},n))};function we(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?we(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Ee.propTypes={props:y().object,row:y().object};var xe=["Application","Resource type","Operation"],ke=function(e){var t=e.permissionReducer,n=t.permission,r=t.isLoading,o=t.options,i=o.application,c=o.operation,a=o.resource,s=t.expandSplats,l=t.isLoadingExpandSplats,u=e.roleReducer,p=u.isRecordLoading,d=u.selectedRole,m=e.costReducer.resourceTypes;return{permissions:n.data.map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.application,n=e.resource_type,r=e.verb,o=e.permission;return{application:t,resource:n,operation:r,uuid:o}})),pagination:n.meta,isLoading:r||p,baseRole:d,applicationOptions:i.data.filter((function(e){return"*"!==e})),resourceOptions:a.data.filter((function(e){return"*"!==e})),operationOptions:c.data.filter((function(e){return"*"!==e})),expandedPermissions:s.data.map((function(e){return e.permission})),isLoadingExpandSplats:l,resourceTypes:m.data}},Pe=function(e){var t=e.selectedPermissions,n=e.setSelectedPermissions,r=u()(e,["selectedPermissions","setSelectedPermissions"]),i=(0,h.useDispatch)(),a=function(e){return i((0,ve.Hk)(e))},l=function(e){return i((0,ve.Qi)(e))},p=(0,h.useSelector)(ke,h.shallowEqual),b=p.permissions,y=p.isLoading,v=p.pagination,g=p.baseRole,_=p.applicationOptions,E=p.resourceOptions,w=p.operationOptions,O=p.expandedPermissions,x=p.isLoadingExpandSplats,k=p.resourceTypes,P=(0,me.Z)(r).input,j=(0,D.Z)(),S=(0,m.useState)({applications:[],resources:[],operations:[]}),C=s()(S,2),R=C[0],N=C[1],F=j.getState().values["role-type"],T=(0,m.useState)(!1),Z=s()(T,2),z=Z[0],L=Z[1],q=(0,m.useState)(""),A=s()(q,2),M=A[0],I=A[1],W=(0,m.useState)(),B=s()(W,2),Q=B[0],V=B[1],Y=function(e){return k.find((function(t){var n;return t.value===(null===(n=e.split(":"))||void 0===n?void 0:n[1])}))},H=(0,m.useCallback)((0,he.Z)((function(e){var t=e.applications,n=e.resources,r=e.operations;return l({field:"application",limit:50,application:t.join(),resourceType:n.join(),verb:r.join()})}),3e3),[]),U=(0,m.useCallback)((0,he.Z)((function(e){var t=e.applications,n=e.resources,r=e.operations;return l({field:"resource_type",limit:50,application:t.join(),resourceType:n.join(),verb:r.join()})}),3e3),[]),$=(0,m.useCallback)((0,he.Z)((function(e){var t=e.applications,n=e.resources,r=e.operations;return l({field:"verb",limit:50,application:t.join(),resourceType:n.join(),verb:r.join()})}),3e3),[]);(0,m.useEffect)((function(){var e,t=null===(e=j.getState().values["copy-base-role"])||void 0===e?void 0:e.uuid;return"copy"===F&&t&&i((0,ee.fp)(t)),i((0,ge.A)()),j.change("has-cost-resources",!1),a(v),l({field:"application",limit:50}),l({field:"resource_type",limit:50}),l({field:"verb",limit:50}),function(){return i((0,ve.AL)())}}),[]),(0,m.useEffect)((function(){U(R),$(R)}),[R.applications]),(0,m.useEffect)((function(){H(R),$(R)}),[R.resources]),(0,m.useEffect)((function(){H(R),U(R)}),[R.operations]),(0,m.useEffect)((function(){P.onChange(t)}),[t]),(0,m.useEffect)((function(){var e;if(!(!g||"copy"!==F||j.getState().values["base-permissions-loaded"]||t.length>0||(null===(e=j.getState().values["copy-base-role"])||void 0===e?void 0:e.uuid)!==(null==g?void 0:g.uuid)||x||y)){var r=(null==g?void 0:g.access)||[];if(0===O.length&&void 0===x){var c=o()(new Set(r.map((function(e){return e.permission.split(":")[0]}))));i((0,ve.tL)({application:c.join()}))}else{var a=r.map((function(e){return e.permission.replace("*",".*")}));n((function(){return O.filter((function(e){return"cost-management"!==e.split(":")[0]||0!==(Y(e)||{count:0}).count})).filter((function(e){return a.some((function(t){return e.match(t)}))})).map((function(e){return{uuid:e}}))})),j.change("base-permissions-loaded",!0)}}}),[b,g]);var G=function(e){return e.reduce((function(e,t){return{0:Oe(Oe({},null==e?void 0:e[0]),{},c()({},t,!0))}}),{0:{}})},K={applications:o()(_).filter((function(e){return e.includes(M)})).map((function(e){return{label:e,value:e}})),resources:o()(E).filter((function(e){return e.includes(M)})).map((function(e){return{label:e,value:e}})),operations:o()(w).filter((function(e){return e.includes(M)})).map((function(e){return{label:e,value:e}}))},J={label:f().createElement("div",null," No results found"),isDisabled:!0},X=K[Object.keys(K)[Q||0]].length>10;return f().createElement("div",{className:"ins-c-rbac-permissions-table"},f().createElement(pe.M,d()({columns:xe,isSelectable:!0,isCompact:!0,borders:!1,createRows:function(e){return e.map((function(e){var n=e.application,r=e.resource,o=e.operation,i=e.uuid;return{uuid:"".concat(n,":").concat(r,":").concat(o),cells:[{title:n},r,o],selected:Boolean(t&&t.find((function(e){return e.uuid===i}))),disableSelection:"cost-management"===n&&0===(Y(i)||{count:0}).count}}))},data:b,filterValue:"",noData:0===(null==b?void 0:b.length),noDataDescription:["Adjust your filters and try again. Note: Applications that only have wildcard           permissions (for example, patch:*:*) aren’t included in this table and can’t be           added to your custom role."],fetchData:function(e){var t=e.limit,n=e.offset,r=e.applications,o=e.resources,i=e.operations;a({limit:t,offset:n,application:(r||R.applications).join(),resourceType:(o||R.resources).join(),verb:(i||R.operations).join()})},setFilterValue:function(e){var t=e.applications,n=e.resources,r=e.operations;N(Oe(Oe(Oe(Oe({},R),t?{applications:t}:R.applications),n?{resources:n}:R.resources),r?{operations:r}:R.operations))},isLoading:y||x,pagination:Oe(Oe({},v),{},{count:v.count}),checkedRows:t,setCheckedItems:function(e){n(e(t).map((function(e){return{uuid:e.uuid}})))},titlePlural:"permissions",titleSingular:"permission",showMoreTitle:z?"See less":"See more",onFilter:function(e){return I(e)},onShowMore:X?function(){L((function(){return!z}))}:void 0,onChange:function(e,t){I(""),V(t)},value:Q,filters:[{key:"applications",value:R.applications,placeholder:"Filter by application",type:"group",selected:G(R.applications),groups:[{type:K.applications.length>0?"checkbox":"plain",items:K.applications.length>0?o()(K.applications).slice(0,z?void 0:10):[J]}]},{key:"resources",value:R.resources,placeholder:"Filter by resource type",type:"group",selected:G(R.resources),groups:[{type:K.resources.length>0?"checkbox":"plain",items:K.resources.length>0?o()(K.resources).slice(0,z?void 0:10):[J]}]},{key:"operations",value:R.operations,placeholder:"Filter by operation",type:"group",selected:G(R.operations),groups:[{type:K.operations.length>0?"checkbox":"plain",items:K.operations.length>0?o()(K.operations).slice(0,z?void 0:10):[J]}]}],isFilterable:!0,rowWrapper:Ee,tableId:"add-role-permissions"},r)))};Pe.propTypes={selectedPermissions:y().array,setSelectedPermissions:y().func};const je=Pe;var Se=n(49739),Ce=n(83826),Re=n(50693),De=n(16475),Ne=function(e,t){return f().createElement("div",{className:"ins-c-rbac__sticky"},f().createElement(Re.r,{className:"ins-c-rbac__sticky--title"},e.map((function(t){return f().createElement(De.P,{span:12/e.length,key:t},t)}))),f().createElement(Re.r,{className:"ins-c-rbac__sticky--data"},t.map((function(t){return t.cells.map((function(t){return f().createElement(De.P,{span:12/e.length,key:t},t)}))}))))};var Fe=n(54680),Te=n(92694),Ze=n(64403),ze=n(59775);function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ae=function(e){var t=e.costReducer,n=t.resourceTypes,r=t.isLoading,o=t.loadingResources,i=t.resources;return{resourceTypes:n.data,resources:i,isLoading:r,isLoadingResources:o>0}},Me=function(e,t){var n=e[t.key];switch(t.type){case"toggle":return qe(qe({},e),{},c()({},t.key,qe(qe({},n),{},{isOpen:!n.isOpen})));case"select":return qe(qe({},e),{},c()({},t.key,qe(qe({},n),{},{selected:n.selected.includes(t.selection)?n.selected.filter((function(e){return e!==t.selection})):[].concat(o()(n.selected),[t.selection])})));case"selectAll":return qe(qe({},e),{},c()({},t.key,qe(qe({},n),{},{selected:n.options.map((function(e){return e.value}))})));case"clear":return qe(qe({},e),{},c()({},t.key,qe(qe({},n),{},{selected:[]})));case"setOptions":return qe(qe({},e),{},c()({},t.key,qe(qe({},n),{},{options:t.options,filteredOptions:t.options})));case"setFilter":return qe(qe({},e),{},c()({},t.key,qe(qe({},n),{},{filteredOptions:n.options.filter((function(e){return e.value.includes(t.filtervalue)}))})));default:return e}};function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function We(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Be=(0,m.createContext)({success:!1,submitting:!1,error:void 0}),Qe=function(e){return f().createElement(_.ZP,d()({},e,{showFormControls:!1}))},Ve=function(e){var t=e.Content,n=u()(e,["Content"]);return f().createElement(t,n)};Ve.propTypes={Content:y().elementType.isRequired};var Ye={"base-role-table":function(e){var t=(0,h.useDispatch)(),n=function(e){return t((0,ee.hs)(e))},r=(0,m.useState)(""),o=s()(r,2),i=o[0],c=o[1],a=(0,h.useSelector)(ye,h.shallowEqual),l=a.roles,u=a.pagination,p=(0,me.Z)(e).input,d=(0,D.Z)();return(0,m.useEffect)((function(){n({limit:50,offset:0,itemCount:0,orderBy:"display_name"})}),[]),f().createElement("div",null,f().createElement(ue.b,{variant:"info",isInline:!0,title:"Only granular permissions will be copied into a custom role         (for example, approval:requests:read). Wildcard permissions will not         be copied into a custom role (for example, approval:*:read).\n        "}),f().createElement(pe.M,{columns:be,createRows:function(e){return e.map((function(e){return{cells:[{title:f().createElement(le.Y,{id:"".concat(e.uuid,"-radio"),name:"".concat(e.name,"-radio"),"aria-label":"".concat(e.name,"-radio"),ouiaId:"".concat(e.name,"-radio"),value:e.uuid,isChecked:p.value.uuid===e.uuid,onChange:function(){d.batch((function(){p.onChange(e),d.change("role-copy-name","Copy of ".concat(e.display_name||e.name)),d.change("role-copy-description",e.description),d.change("add-permissions-table",[]),d.change("base-permissions-loaded",!1)}))}}),props:{className:"pf-c-table__check"}},e.display_name||e.name,e.description]}}))},data:l,fetchData:function(e){return n((0,de.jl)(e))},filterValue:i,setFilterValue:function(e){var t=e.name;return c(t)},isLoading:!1,pagination:u,titlePlural:"roles",titleSingular:"role",filterPlaceholder:"role name",ouiaId:"roles-table",isCompact:!0,tableId:"base-role"}))},"add-permissions-table":je,"cost-resources":function(e){var t=(0,h.useDispatch)(),n=(0,h.useSelector)(Ae,h.shallowEqual),r=n.resourceTypes,i=n.isLoading,a=n.isLoadingResources,l=n.resources,u=(0,me.Z)(e).input,p=(0,D.Z)(),d=p.getState().values["add-permissions-table"].filter((function(e){return e.uuid.split(":")[0].includes("cost-management")})),b=(0,m.useReducer)(Me,d.reduce((function(e,t){return qe(qe({},e),{},c()({},t.uuid,{selected:[],options:[],filteredOptions:[],isOpen:!1}))}),{})),y=s()(b,2),v=y[0],g=y[1];return(0,m.useEffect)((function(){(p.getState().values["resource-definitions"]||[]).map((function(e){var t=e.permission;return e.resources.map((function(e){return d.includes(t)&&g({type:"select",selection:e,key:t})}))})),t((0,ge.A)(undefined)),p.change("has-cost-resources",!0)}),[]),(0,m.useEffect)((function(){i||o()(new Set(d.map((function(e){var t;return null===(t=r.find((function(t){var n;return t.value===(null===(n=e.uuid.split(":"))||void 0===n?void 0:n[1])})))||void 0===t?void 0:t.path})))).filter((function(e){return e})).map((function(e){return n=e,t((0,ge.R)(n));var n}))}),[r]),(0,m.useEffect)((function(){a||d.map((function(e){return g({type:"setOptions",key:e.uuid,options:l[(t=e.uuid,null===(n=r.find((function(e){var n;return e.value===(null===(n=t.split(":"))||void 0===n?void 0:n[1])})))||void 0===n||null===(o=n.path.split("/"))||void 0===o?void 0:o[5])]||[]});var t,n,o}))}),[a]),(0,m.useEffect)((function(){var e=Object.entries(v).map((function(e){var t=s()(e,2);return{permission:t[0],resources:t[1].selected}}));u.onChange(e),p.change("resource-definitions",e)}),[v]),f().createElement(Re.r,{hasGutter:!0},f().createElement(De.P,{md:4,className:"ins-m-hide-on-sm"},f().createElement(P.x,{component:P.q.h4,className:"ins-c-rbac__bold-text"},"Cost management permissions")),f().createElement(De.P,{md:8,className:"ins-m-hide-on-sm"},f().createElement(P.x,{component:P.q.h4,className:"ins-c-rbac__bold-text"},"Resource definitions")),d.map((function(e){var t=e.uuid,n=v[t].filteredOptions;return f().createElement(f().Fragment,null,f().createElement(De.P,{md:4,sm:12},f().createElement(ze.c,{label:t,isRequired:!0})),f().createElement(De.P,{md:8,sm:12},f().createElement(Fe.P,{className:"ins-c-rbac-cost-resource-select",variant:Ze.TM.checkbox,typeAheadAriaLabel:"Select a state",onToggle:function(e){g({type:"setFilter",key:t,filtervalue:""}),function(e,t){g({type:"toggle",key:e,isOpen:t})}(t,e)},onSelect:function(e,r){!function(e,t,n,r){g(n?{type:"selectAll",selection:t,key:r}:{type:"select",selection:t,key:r})}(0,r,r==="Select All (".concat(n.length,")"),t)},onClear:function(){return g({type:"clear",key:t})},selections:v[t].selected,isOpen:v[t].isOpen,onFilter:function(e){return g({type:"setFilter",key:t,filtervalue:e.target.value})},"aria-labelledby":t,placeholderText:"Select resources",hasInlineFilter:!0},[f().createElement(Te.$,{key:0,value:"Select All (".concat(n.length,")")})].concat(o()(n.map((function(e,t){return f().createElement(Te.$,{key:t+1,value:e.value})})))))))})))},review:function(){var e=(0,D.Z)().getState().values,t=e["role-name"],n=e["role-description"],r=e["role-copy-name"],o=e["role-copy-description"],i=e["add-permissions-table"],c=e["resource-definitions"],a=e["has-cost-resources"],s=e["role-type"],l=i.map((function(e){return{cells:e.uuid.split(":")}})),u=(c||[]).map((function(e){return{cells:[e.permission,e.resources.join(", ")]}}));return f().createElement(f().Fragment,null,f().createElement(Se.K,null,f().createElement(Ce.v,{className:"ins-c-rbac__summary"},f().createElement(Re.r,null,f().createElement(De.P,{sm:12,md:2},f().createElement(P.x,{component:P.q.h4,className:"ins-c-rbac__bold-text"},"Name")),f().createElement(De.P,{sm:12,md:10},f().createElement(P.x,{component:P.q.p},"create"===s?t:r))),f().createElement(Re.r,null,f().createElement(De.P,{sm:12,md:2},f().createElement(P.x,{component:P.q.h4,className:"ins-c-rbac__bold-text"},"Description")),f().createElement(De.P,{sm:12,md:10},f().createElement(P.x,{component:P.q.p},"create"===s?n:o))),f().createElement(Re.r,null,f().createElement(De.P,{sm:12,md:2},f().createElement(P.x,{component:P.q.h4,className:"ins-c-rbac__bold-text"},"Permissions")),f().createElement(De.P,{sm:12,md:10},Ne(["Application","Resource type","Operation"],l))),a&&f().createElement(Re.r,null,f().createElement(De.P,{sm:12,md:2},f().createElement(P.x,{component:P.q.h4,className:"ins-c-rbac__bold-text"},"Resource definitions")),f().createElement(De.P,{sm:12,md:10},Ne(["Permission","Resource definitions"],u))))))},description:Ve,"type-selector":function(e){var t=(0,me.Z)(e).input,n=(0,D.Z)(),r=(0,m.useState)(n.getState().values["role-type"]),o=s()(r,2),i=o[0],c=o[1],a=function(e){c(e),t.onChange(e),n.change("add-permissions-table",[]),n.change("base-permissions-loaded",!1)};return f().createElement("div",null,f().createElement(le.Y,{isChecked:"create"===i,className:"pf-u-mb-sm",name:"role-type-create",onChange:function(){return a("create")},label:"Create a role from scratch",id:"role-type-create",value:"create"}),f().createElement(le.Y,{isChecked:"copy"===i,name:"role-type-copy",onChange:function(){return a("copy")},label:"Copy an existing role",id:"role-type-copy",value:"copy"}))}},He=function(e){var t=e.history.push,n=(0,h.useDispatch)(),r=(0,m.useState)({success:!1,submitting:!1,error:void 0,hideForm:!1}),i=s()(r,2),c=i[0],a=i[1],l=(0,m.useState)(!1),u=s()(l,2),p=u[0],b=u[1],y=(0,m.useRef)(document.createElement("div")),_=(0,m.useState)({}),x=s()(_,2),k=x[0],P=x[1];(0,m.useEffect)((function(){P(function(e){return{fields:[{component:"wizard",name:"wizard",isDynamic:!0,inModal:!0,showTitles:!0,crossroads:["role-type"],title:"Create role",container:e,fields:[{title:"Create role",name:"step-1",nextStep:{when:"role-type",stepMapper:{copy:"name-and-description",create:"add-permissions"}},fields:[{component:"type-selector",name:"role-type",isRequired:!0,validate:[{type:O.Z.REQUIRED}]},{component:"text-field",name:"role-name",type:"text",label:"Role name",isRequired:!0,condition:{when:"role-type",is:"create"},validate:[Y,{type:O.Z.REQUIRED},{type:O.Z.MAX_LENGTH,threshold:150}]},{component:"text-field",name:"role-description",type:"text",label:"Role description",condition:{when:"role-type",is:"create"},validate:[{type:"max-length",threshold:150}]},{component:"base-role-table",name:"copy-base-role",label:"Base role",isRequired:!0,condition:{when:"role-type",is:"copy"},validate:[{type:O.Z.REQUIRED}]},{condition:{when:"role-type",is:"create"},component:"description",name:"fixasyncvalidation",Content:H},{condition:{when:"role-type",is:"copy"},component:"description",name:"fixasyncvalidation2",Content:H}]},{title:"Name and description",name:"name-and-description",nextStep:"add-permissions",fields:[{component:"text-field",name:"role-copy-name",type:"text",label:"Role name",isRequired:!0,validate:[Y,{type:O.Z.REQUIRED},{type:"max-length",threshold:150}]},{component:"text-field",name:"role-copy-description",type:"text",label:"Role description",validate:[{type:"max-length",threshold:150}]}]},{name:"add-permissions",title:"Add permissions",StepTemplate:z,nextStep:function(e){var t=e.values;return t&&t["add-permissions-table"]&&t["add-permissions-table"].some((function(e){return e.uuid.split(":")[0].includes("cost-management")}))?"cost-resources-definition":"review"},fields:[{component:"add-permissions-table",name:"add-permissions-table"}]},{name:"cost-resources-definition",title:"Define Cost Management resources",nextStep:"review",fields:[{component:"plain-text",name:"text-description",label:f().createElement("p",null,"Specify where you would like to apply each cost permission selected in the previous step, using the dropdown below.")},{component:"cost-resources",name:"cost-resources",validate:[function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).every((function(e){return e.resources.length>0}))?void 0:"You need to assign at least one resource to each permission."}]}]},{name:"review",title:"Review details",buttons:function(e){return f().createElement(X.Z,d()({},e,{context:Be}))},StepTemplate:J,fields:[{component:"review",name:"review"}]}]}]}}(y.current))}),[]),(0,m.useEffect)((function(){y.current.hidden=p}),[p]);var j=function(){c.success||n((0,v.wN)({variant:"warning",title:"Creating role was canceled by the user",dismissDelay:8e3,dismissable:!1})),t("/roles")};return f().createElement(Be.Provider,{value:We(We({},c),{},{setWizardError:function(e){return a((function(t){return We(We({},t),{},{error:e})}))},setWizardSuccess:function(e){return a((function(t){return We(We({},t),{},{success:e})}))},setHideForm:function(e){return a((function(t){return We(We({},t),{},{hideForm:e})}))}})},f().createElement(te.R,{type:"role",isOpen:p,onModalCancel:function(){return b(!1)},onConfirmCancel:j}),c.hideForm?f().createElement(w.e,{title:"Create role",isOpen:!0,onClose:function(){return t("/roles")},steps:[{name:"success",component:f().createElement(se,null),isFinishedStep:!0}]}):f().createElement(g.Z,{schema:k,container:y,subscription:{values:!0},FormTemplate:Qe,initialValues:{"role-type":"create"},componentMapper:We(We({},E.ZP),Ye),onSubmit:function(e){var t=e["role-name"],r=e["role-description"],i=e["role-copy-name"],c=e["role-copy-description"],s=e["add-permissions-table"],l=e["cost-resources"],u=e["role-type"];a((function(e){return We(We({},e),{},{submitting:!0})}));var p={applications:o()(new Set(s.map((function(e){return e.uuid.split(":")[0]})))),description:("create"===u?r:c)||null,name:"create"===u?t:i,access:s.map((function(e){var t=e.uuid;return{permission:t,resourceDefinitions:(null==l?void 0:l.find((function(e){return e.permission===t})))?[{attributeFilter:{key:"cost-management.".concat(t.split(":")[1]),operation:"in",value:null==l?void 0:l.find((function(e){return e.permission===t})).resources}}]:[]}}))};return n((0,ee.fA)(p)).then((function(){a((function(e){return We(We({},e),{},{submitting:!1,success:!0,hideForm:!0})})),n((0,ee.Kt)())}))},onCancel:function(e){Boolean(e&&e["role-name"]||e["role-description"]||e["copy-base-role"])?b(!0):j()}}))};He.propTypes={history:y().shape({push:y().func.isRequired}).isRequired};const Ue=He},12236:(e,t,n)=>{var r=n(93379),o=n(66369);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.id,o,""]]);var i=r(o,{insert:"head",singleton:!1});if(!o.locals||e.hot.invalidate){var c=o.locals;e.hot.accept(66369,(function(){"string"==typeof(o=(o=n(66369)).__esModule?o.default:o)&&(o=[[e.id,o,""]]),function(e,t){if(!e&&t||e&&!t)return!1;var n;for(n in e)if(e[n]!==t[n])return!1;for(n in t)if(!e[n])return!1;return!0}(c,o.locals)?(c=o.locals,i(o)):e.hot.invalidate()}))}e.hot.dispose((function(){i()})),e.exports=o.locals||{}},50486:(e,t,n)=>{var r=n(93379),o=n(20387);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.id,o,""]]);var i=r(o,{insert:"head",singleton:!1});if(!o.locals||e.hot.invalidate){var c=o.locals;e.hot.accept(20387,(function(){"string"==typeof(o=(o=n(20387)).__esModule?o.default:o)&&(o=[[e.id,o,""]]),function(e,t){if(!e&&t||e&&!t)return!1;var n;for(n in e)if(e[n]!==t[n])return!1;for(n in t)if(!e[n])return!1;return!0}(c,o.locals)?(c=o.locals,i(o)):e.hot.invalidate()}))}e.hot.dispose((function(){i()})),e.exports=o.locals||{}}}]);
//# sourceMappingURL=5205.9a1bf327f64b4fb30a7c.js.map