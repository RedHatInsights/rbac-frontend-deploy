"use strict";(self.webpackChunkrbac=self.webpackChunkrbac||[]).push([[345,459],{48701:(e,t,s)=>{s.r(t),s.d(t,{AddRolePermissionWizardContext:()=>_,default:()=>H,mapperExtension:()=>Y});var r=s(28416),n=s.n(r),a=s(86706),o=s(45697),i=s.n(o),c=s(25387),l=s(9820),m=s(51912),p=s(67850),u=s(8340),d=s(55218),f=s(65220),g=s(13563),E=s(55594),v=s(9545),Z=s(23539),x=s(64380),y=s(72232),h=s(48880),T=s(2550);var b=s(31055),S=s(95376),M=s(71214),I=s.n(M),k=s(64756),C=s(14289);const F=({currentRoleID:e})=>{const t=(0,c.YB)(),s=(0,a.useDispatch)();return n().createElement(n().Fragment,null,n().createElement(S.EmptyState,null,n().createElement(S.EmptyStateHeader,{titleText:n().createElement(n().Fragment,null,t.formatMessage(T.Z.permissionsAddedSuccessfully)),icon:n().createElement(S.EmptyStateIcon,{color:"green",icon:I()}),headingLevel:"h4"}),n().createElement(S.EmptyStateBody,null),n().createElement(S.EmptyStateFooter,null,n().createElement(k.Z,{to:C.Z["role-detail"].link.replace(":roleId",e)},n().createElement(b.Button,{onClick:()=>s((0,g.fp)(e))},t.formatMessage(T.Z.exit))))))},w=F;F.propTypes={currentRoleID:i().string.isRequired};var G=s(47108),D=s(51880),P=s(52229),A=s(74503),V=s(15950);const N=({formFields:e})=>{const{submitting:t}=(0,r.useContext)(_);return t?n().createElement(A.Bullseye,null,n().createElement(V.Spinner,{size:"xl"})):n().createElement("div",{className:"rbac"},[[{...e?.[0]?.[0]}]])};N.propTypes={formFields:i().array};const R=N;var z=s(60167),B=s(2034),L=s(92884),O=s(68539),W=s(84414);const j=e=>n().createElement(p.ZP,{...e,showFormControls:!1}),Y={"add-permissions-table":E.Z,"inventory-groups-role":D.Z,"cost-resources":G.Z,review:()=>{const e=(0,c.YB)(),t=(0,h.default)(),{"role-name":s,"role-description":r,"add-permissions-table":a,"resource-definitions":o,"has-cost-resources":i}=t.getState().values;return n().createElement(Z.Stack,{hasGutter:!0},n().createElement(Z.StackItem,null,n().createElement(x.TextContent,null,n().createElement(y.Title,{headingLevel:"h1",size:"xl",className:"pf-v5-u-mb-sm"},e.formatMessage(T.Z.reviewDetails)))),n().createElement(Z.StackItem,{className:"rbac-l-stack__item-summary"},n().createElement(v.Grid,{hasGutter:!0},n().createElement(v.GridItem,{span:3},n().createElement(x.Text,{className:"pf-v5-c-title",component:x.TextVariants.h6},e.formatMessage(T.Z.roleName))),n().createElement(v.GridItem,{span:9},n().createElement(x.Text,{component:x.TextVariants.p},s)),n().createElement(v.GridItem,{span:3},n().createElement(x.Text,{className:"pf-v5-c-title",component:x.TextVariants.h6},e.formatMessage(T.Z.roleDescription))),n().createElement(v.GridItem,{span:9},n().createElement(x.Text,{component:x.TextVariants.p},r)),n().createElement(v.GridItem,{span:3},n().createElement(x.Text,{className:"pf-v5-c-title",component:x.TextVariants.h6},e.formatMessage(T.Z.addedPermissions))),n().createElement(v.GridItem,{span:9},n().createElement(x.TextContent,{component:x.TextVariants.p},a.map(((e,t)=>n().createElement(x.Text,{key:t}," ",e.uuid," "))))),i&&n().createElement(n().Fragment,null,n().createElement(v.GridItem,{span:3},n().createElement(x.Text,{className:"pf-v5-c-title",component:x.TextVariants.h6},e.formatMessage(T.Z.resourceDefinitions))),n().createElement(v.GridItem,{span:9},n().createElement(x.TextContent,{component:x.TextVariants.p},o.map((({resources:e})=>e.map(((e,t)=>n().createElement(x.Text,{key:t}," ",e," ")))))))))))}},_=(0,r.createContext)({success:!1,submitting:!1,error:void 0}),q=({role:e})=>{const t=(0,c.YB)(),[s,o]=(0,r.useState)(!1),[i,p]=(0,r.useState)(""),E=(0,W.Z)(),v=(0,a.useDispatch)(),Z=(0,f.useFlag)("platform.rbac.groups-to-workspaces-rename"),[x,y]=(0,r.useState)({success:!1,submitting:!1,error:void 0,hideForm:!1}),h=(0,r.useRef)(document.createElement("div")),b=(0,r.useMemo)((()=>((e,t)=>{const s=(0,c.Sn)(),r=(0,c.dp)({locale:z.S,messages:B},s);return{fields:[{component:"wizard",name:"wizard",isDynamic:!0,inModal:!0,showTitles:!0,crossroads:["role-type"],title:r.formatMessage(T.Z.addPermissions),container:e,fields:[{name:"add-permissions",title:r.formatMessage(T.Z.addPermissions),StepTemplate:P.Z,nextStep:({values:e})=>(0,L.j)("add-permissions",e),fields:[{component:"add-permissions-table",name:"add-permissions-table"}]},{name:"inventory-groups-role",title:r.formatMessage(t?T.Z.workspacesAccessTitle:T.Z.inventoryGroupsAccessTitle),StepTemplate:O.Z,nextStep:({values:e})=>(0,L.j)("inventory-groups-role",e),fields:[{component:"plain-text",name:"text-description",label:n().createElement("p",null,r.formatMessage(t?T.Z.workspacesAccessDescription:T.Z.inventoryGroupsAccessDescription))},{component:"inventory-groups-role",name:"inventory-groups-role",validate:[(e=[])=>e?.every((({groups:e,permission:t})=>e?.length>0&&t))?void 0:r.formatMessage(T.Z.assignAtLeastOneInventoryGroup)]}]},{name:"cost-resources-definition",title:r.formatMessage(T.Z.defineCostResources),nextStep:"review",fields:[{component:"plain-text",name:"text-description",label:n().createElement("p",null,r.formatMessage(T.Z.applyCostPermissionText))},{component:"cost-resources",name:"cost-resources",validate:[(e=[])=>e.every((({resources:e})=>e&&e.length>0))?void 0:r.formatMessage(T.Z.assignAtLeastOneResource)]}]},{name:"review",title:r.formatMessage(T.Z.reviewDetails),StepTemplate:R,fields:[{component:"review",name:"review"}]}]}]}})(h.current,Z)),[]);(0,r.useEffect)((()=>{p(e.uuid)})),(0,r.useEffect)((()=>{h.current.hidden=s}),[s]);const S=()=>{E(C.Z["role-detail"].link.replace(":roleId",e.uuid))};return n().createElement(_.Provider,{value:{...x,setWizardError:e=>y((t=>({...t,error:e}))),setWizardSuccess:e=>y((t=>({...t,success:e}))),setHideForm:e=>y((t=>({...t,hideForm:e}))),rolePermissions:e.access}},n().createElement(d.Z,{title:t.formatMessage(T.Z.exitItemAdding,{item:t.formatMessage(T.Z.permissions).toLocaleLowerCase()}),isOpen:s,onClose:()=>o(!1),confirmButtonLabel:t.formatMessage(T.Z.discard),onConfirm:S},t.formatMessage(T.Z.discardedInputsWarning)),x.hideForm?x.success?n().createElement(l.e,{title:t.formatMessage(T.Z.addPermissions),isOpen:!0,steps:[{name:"success",component:n().createElement(w,{currentRoleID:i}),isFinishedStep:!0}],onClose:S}):null:n().createElement(m.Z,{container:h,schema:b,subscription:{values:!0},FormTemplate:j,initialValues:{"role-uuid":e.uuid,"role-type":"create","role-name":e.display_name,"role-description":e.description},componentMapper:{...u.ZP,...Y},onSubmit:async t=>{const{"add-permissions-table":s,"cost-resources":r=[],"inventory-groups-role":n=[]}=t,a=[...e.access.map((e=>e.permission)),...s.map((e=>e.uuid))],o={...e,access:[...s.reduce(((e,{uuid:t,requires:s})=>[...e,...[t,...s.filter((e=>!a.includes(e)))].map((e=>({permission:e,resourceDefinitions:[...r,...n]?.find((t=>t.permission===e))?e.includes("inventory")?[{attributeFilter:{key:"group.id",operation:"in",value:n?.find((t=>t.permission===e))?.groups?.map((e=>e?.id))}}]:e.includes("cost-management")?[{attributeFilter:{key:`cost-management.${e.split(":")[1]}`,operation:"in",value:r?.find((t=>t.permission===e)).resources}}]:[]:[]})))]),e.access)],accessCount:e.accessCount+s.length};y((e=>({...e,submitting:!0}))),v((0,g.ul)(i,o)).then((()=>y((e=>({...e,submitting:!1,success:!0,hideForm:!0}))))).catch((()=>{y((e=>({...e,submitting:!1,success:!1,hideForm:!0}))),E(C.Z["role-detail"].link.replace(":roleId",e.uuid))}))},onCancel:e=>{e&&e["add-permissions-table"]?.length>0?o(!0):S()}}))};q.defaultProps={role:{}},q.propTypes={role:i().object};const H=q}}]);
//# sourceMappingURL=../sourcemaps/345.5e3a1fa20248d9278c1057edf7fc9f18.js.map