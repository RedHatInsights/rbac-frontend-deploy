(self.webpackChunkinsights_rbac_frontend=self.webpackChunkinsights_rbac_frontend||[]).push([[9480],{66369:(e,t,n)=>{(t=n(23645)(!1)).push([e.id,".rbac .pf-c-form .pf-c-form__group .pf-c-radio,.my-user-access .pf-c-form .pf-c-form__group .pf-c-radio{padding-bottom:8px}.rbac .pf-c-form .pf-c-form__group .pf-c-radio:last-child,.my-user-access .pf-c-form .pf-c-form__group .pf-c-radio:last-child{padding-bottom:0px}.rbac .pf-c-select__menu .ins-c-select__scrollable-section,.my-user-access .pf-c-select__menu .ins-c-select__scrollable-section{max-height:365px;overflow:auto}.rbac .ins-c-rbac-add-permission-title,.my-user-access .ins-c-rbac-add-permission-title{display:block}.rbac .pf-c-wizard__main-body .ins-c-rbac-seleted-chips,.my-user-access .pf-c-wizard__main-body .ins-c-rbac-seleted-chips{padding-bottom:var(--pf-global--spacer--md)}.rbac .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group,.my-user-access .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group{background-color:var(--pf-global--BackgroundColor--100)}.rbac .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip,.my-user-access .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip{background-color:var(--pf-global--palette--blue-50);border-radius:var(--pf-global--BorderRadius--lg)}.rbac .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip .pf-c-chip__text,.my-user-access .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip .pf-c-chip__text{font-size:var(--pf-global--FontSize--sm)}.rbac .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip::before,.my-user-access .pf-c-wizard__main-body .ins-c-rbac-seleted-chips .pf-c-chip-group .pf-c-chip-group__list .pf-c-chip-group__list-item .pf-c-chip::before{border-style:none}@media only screen and (max-width: 815px){.rbac .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content,.my-user-access .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content{padding:0px}.rbac .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group,.my-user-access .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:30em}}@media only screen and (max-width: 895px){.rbac .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group,.my-user-access .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:32em}}@media only screen and (min-width: 992px){.rbac .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content,.my-user-access .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content{padding:0px}.rbac .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group,.my-user-access .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:25em}}@media only screen and (min-width: 1055px){.rbac .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group,.my-user-access .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:32em}}@media only screen and (min-width: 1150px){.rbac .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group,.my-user-access .ins-c-rbac-permissions-table .ins-c-primary-toolbar .pf-c-toolbar__content .pf-c-toolbar__content-section .pf-m-filter-group{max-width:35em}}.rbac .ins-c-rbac-cost-resource-select .pf-c-select__menu .pf-c-select__menu-item:nth-child(3) .pf-c-check__input,.my-user-access .ins-c-rbac-cost-resource-select .pf-c-select__menu .pf-c-select__menu-item:nth-child(3) .pf-c-check__input{display:none}.rbac .ins-c-rbac-cost-resource-select .pf-c-select__menu .pf-c-select__menu-item:nth-child(3) .pf-c-check__label,.my-user-access .ins-c-rbac-cost-resource-select .pf-c-select__menu .pf-c-select__menu-item:nth-child(3) .pf-c-check__label{color:var(--pf-global--link--Color)}.rbac .ins-c-rbac-disabled-row,.my-user-access .ins-c-rbac-disabled-row{background-color:var(--pf-global--disabled-color--300)}\n",""]),e.exports=t},20387:(e,t,n)=>{(t=n(23645)(!1)).push([e.id,".rbac .ins-c-rbac__sticky .ins-c-rbac__sticky--title,.my-user-access .ins-c-rbac__sticky .ins-c-rbac__sticky--title{margin-bottom:var(--pf-global--spacer--sm);border-bottom:1px solid var(--pf-global--palette--black-300)}.rbac .ins-c-rbac__sticky .ins-c-rbac__sticky--title .pf-l-grid__item,.my-user-access .ins-c-rbac__sticky .ins-c-rbac__sticky--title .pf-l-grid__item{font-weight:var(--pf-global--FontWeight--bold);margin-bottom:var(--pf-global--spacer--sm) !important}.rbac .ins-c-rbac__sticky .ins-c-rbac__sticky--data,.my-user-access .ins-c-rbac__sticky .ins-c-rbac__sticky--data{max-height:240px;overflow:auto;-ms-overflow-style:none;scrollbar-width:none}.rbac .ins-c-rbac__sticky .data::-webkit-scrollbar,.my-user-access .ins-c-rbac__sticky .data::-webkit-scrollbar{display:none}.rbac .ins-c-rbac__gutter-sm,.my-user-access .ins-c-rbac__gutter-sm{margin-bottom:var(--pf-global--spacer--sm)}.rbac .ins-c-rbac__gutter-md,.my-user-access .ins-c-rbac__gutter-md{margin-bottom:var(--pf-global--spacer--md)}\n",""]),e.exports=t},59480:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AddRoleWizardContext:()=>Ke,default:()=>nt,mapperExtension:()=>et});var r=n(319),i=n.n(r),o=n(59713),c=n.n(o),a=n(63038),s=n.n(a),l=n(6479),u=n.n(l),p=n(67154),d=n.n(p),m=n(80150),f=n.n(m),b=n(45697),y=n.n(b),h=n(70983),v=n(71355),g=n(98917),_=n(81554),E=n(74837),x=n(77583),w=n(24154),O=n(21899),k=n(26391),S=n(68340),P=n(68774),j=n(60485),R=n(47173),C=n(37377),D=n(58860),q=n(55795);function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}n(12236);var L=function(e){var t,n,r,o=e.formFields,c=(0,D.Z)(),a=(0,m.useState)(c.getState().values["add-permissions-table"]||[]),l=s()(a,2),u=l[0],p=l[1],d=(null===(t=c.getState().values)||void 0===t||null===(n=t["copy-base-role"])||void 0===n||null===(r=n.applications)||void 0===r?void 0:r.filter((function(e){return!(null==u?void 0:u.find((function(t){return t.uuid.includes(e)})))})))||[],b=o[0][0];return f().createElement(f().Fragment,null,u.length>0?f().createElement("div",{className:"ins-c-rbac-seleted-chips"},f().createElement(k.Z,{categoryName:"Selected permissions"},u.reduce((function(e,t){return[t].concat(i()(e))}),[]).map((function(e){var t=e.uuid;return f().createElement(O.A,{key:t,color:"blue",isTruncated:!0,onClick:function(){return p(u.filter((function(e){return e.uuid!==t})))}},t)})))):null,f().createElement(j.D,{headingLevel:"h1",size:"xl",className:"ins-c-rbac-add-permission-title"},"Add permissions"),f().createElement(P.D,null,f().createElement(S.x,null,"Select permissions to add to your role",0!==d.length&&f().createElement(C.J,{headerContent:"Custom roles only support granular permissions",bodyContent:"Wildcard permissions (for example, approval:*:*) aren’t included in this table and can’t be added to your custom role."},f().createElement(R.zx,{variant:"link"},"Why am I not seeing all of my permissions? ",f().createElement(q.ZP,null))))),[[F(F({},b),{},{props:F(F({},b.props),{},{selectedPermissions:u,setSelectedPermissions:p})})]])};L.propTypes={formFields:y().array};const N=L;var T=n(50008),Z=n.n(T),A=n(27361),M=n.n(A),I=function(e){var t=e.nextStep,n=e.valid,r=e.handleNext,i=e.nextLabel,o=e.getState,c=e.handleSubmit,a=e.submitLabel;return f().createElement(R.zx,{variant:"primary",type:"button",isDisabled:!n||o().validating,onClick:function(){return t?r(function(e,t){var n,r;return(null===(n={string:e,function:e({values:t().values})})||void 0===n?void 0:n[Z()(e)])||(null===(r=e.stepMapper)||void 0===r?void 0:r[M()(t().values,e.when)])}(t,o)):c()}},t?i:a)};I.propTypes={nextStep:y().oneOfType([y().string,y().func,y().object]),handleSubmit:y().func.isRequired,submitLabel:y().node.isRequired,valid:y().bool,handleNext:y().func.isRequired,nextLabel:y().node.isRequired,getState:y().func.isRequired};var W=function(e){var t=e.disableBack,n=e.handlePrev,r=e.nextStep,i=e.handleNext,o=e.buttonLabels,c=o.cancel,a=o.submit,s=o.back,l=o.next,u=(0,D.Z)(),p=(0,m.useContext)(Ke),b=p.success,y=p.error,h=p.submitting;return b||void 0===y||y||h?null:f().createElement(m.Fragment,null,f().createElement(I,d()({},u,{handleNext:i,nextStep:r,nextLabel:l,submitLabel:a})),f().createElement(R.zx,{type:"button",variant:"secondary",isDisabled:t,onClick:n},s),f().createElement(R.zx,{type:"button",variant:"link",onClick:u.onCancel},c))};W.propTypes={disableBack:y().bool,handlePrev:y().func.isRequired,handleNext:y().func.isRequired,nextStep:y().oneOfType([y().string,y().shape({when:y().string.isRequired,stepMapper:y().object.isRequired}),y().func]),buttonLabels:y().shape({submit:y().node.isRequired,cancel:y().node.isRequired,back:y().node.isRequired,next:y().node.isRequired}).isRequired};const B=W;var Q=n(52643),Y=n(2372),H=n(87757),U=n.n(H),V=n(48926),$=n.n(V),G=n(45139),K=n(39379),J=function(){var e=$()(U().mark((function e(t){var n,r;return U().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.next=4,(0,G.vd)({limit:10,offset:0,name:t,nameMatch:"exact"}).catch((function(e){console.error(e)}));case 4:if(!((null==(r=e.sent)||null===(n=r.data)||void 0===n?void 0:n.length)>0)){e.next=7;break}throw"Name has already been taken";case 7:return e.abrupt("return",void 0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X=(0,K.Z)(J),ee=function(e){var t=e.name,n=(0,D.Z)();return(0,m.useEffect)((function(){return setTimeout((function(){return n.change(t,"1")})),function(){return n.change(t,"")}}),[]),null},te=(n(50486),n(9947)),ne=n(38424),re=n(75106),ie=n(18004),oe=n(43047);const ce=function(){var e=(0,m.useContext)(ie.Z).jumpToStep,t=(0,m.useContext)(Ke).setWizardError;return f().createElement(te.u,{variant:te.I.large},f().createElement(ne.k,{color:"red",icon:oe.ZP}),f().createElement(j.D,{headingLevel:"h4",size:"lg"},"Role name already taken"),f().createElement(re.B,null,"Please return to Step 1: Create role and choose a unique role name for your custom role."),f().createElement(R.zx,{onClick:function(){t(void 0),e(0)},variant:"primary"},"Return to Step 1"))};function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var le=function(e){var t,n=e.formFields,r=(0,m.useContext)(Ke),i=r.submitting,o=r.error,c=r.setWizardError,a=(0,D.Z)().getState;return(0,m.useEffect)((function(){c(void 0),J(a().values["role-name"]).then((function(){return c(!1)})).catch((function(){return c(!0)}))}),[]),void 0===o||i?f().createElement(Q.b,null,f().createElement(Y.$,{size:"xl"})):!0===o?f().createElement(ce,null):f().createElement(f().Fragment,null,f().createElement(j.D,{headingLevel:"h1",size:"xl",className:"ins-c-rbac__gutter-sm"},"Review details"),f().createElement(P.D,{className:"ins-c-rbac__gutter-md"},f().createElement(S.x,null,"Review and confirm the details for your role, or click Back to revise.")),[[se({},null==n||null===(t=n[0])||void 0===t?void 0:t[0])]])};le.propTypes={formFields:y().array};const ue=le;var pe=n(89531),de=n(2485),me=n(35293),fe=n(68778),be=n(47194);const ye=function(){var e=(0,m.useContext)(Ke).setHideForm;return f().createElement(te.u,{variant:te.I.large},f().createElement(ne.k,{color:"green",icon:fe.ZP}),f().createElement(j.D,{headingLevel:"h4",size:"lg"},"You have successfully created a new role"),f().createElement(re.B,null),f().createElement(R.zx,{component:function(e){return f().createElement(be.Link,d()({to:"/roles"},e))},variant:"primary"},"Exit"),f().createElement(me.i,null,f().createElement(R.zx,{onClick:function(){e(!1)},variant:"link"},"Create another role"),f().createElement(R.zx,{component:function(e){return f().createElement(be.Link,d()({to:"/groups"},e))},variant:"link"},"Add role to group")))};var he=n(92504),ve=n(43547),ge=n(17721),_e=n(12830),Ee=n(8785),xe=n(12460),we=["",{title:"Name",key:"display_name",transforms:[xe.sortable]},"Description"],Oe=function(e){var t=e.roleReducer,n=t.rolesForWizard,r=t.isLoading;return{roles:n.data,pagination:n.meta,isLoading:r}};var ke=n(48623),Se=n(55004),Pe=n(26701),je=n(35224),Re=function(e){var t=e.row,n=u()(e,["row"]);return t.disableSelection?f().createElement(je.u,{content:f().createElement("div",null,"To add this permission to your role and define specific resources for it, at least one data source must be connected."," ",f().createElement("a",{href:"./settings/sources"},"Configure sources for Cost Management")),exitDelay:1500,entryDelay:1500},f().createElement(xe.RowWrapper,d()({className:"ins-c-rbac-disabled-row",row:t},n))):f().createElement(xe.RowWrapper,d()({row:t},n))};function Ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Re.propTypes={props:y().object,row:y().object};var qe=["Application","Resource type","Operation"],ze=function(e){var t=e.permissionReducer,n=t.permission,r=t.isLoading,i=t.options,o=i.application,c=i.operation,a=i.resource,s=t.expandSplats,l=t.isLoadingExpandSplats,u=e.roleReducer,p=u.isRecordLoading,d=u.selectedRole,m=e.costReducer.resourceTypes;return{permissions:n.data.map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.application,n=e.resource_type,r=e.verb,i=e.permission;return{application:t,resource:n,operation:r,uuid:i}})),pagination:n.meta,isLoading:r||p,baseRole:d,applicationOptions:o.data.filter((function(e){return"*"!==e})),resourceOptions:a.data.filter((function(e){return"*"!==e})),operationOptions:c.data.filter((function(e){return"*"!==e})),expandedPermissions:s.data.map((function(e){return e.permission})),isLoadingExpandSplats:l,resourceTypes:m.data}},Fe=function(e){var t=e.selectedPermissions,n=e.setSelectedPermissions,r=u()(e,["selectedPermissions","setSelectedPermissions"]),o=(0,h.useDispatch)(),a=function(e){return o((0,Se.Hk)(e))},l=function(e){return o((0,Se.Qi)(e))},p=(0,h.useSelector)(ze,h.shallowEqual),b=p.permissions,y=p.isLoading,v=p.pagination,g=p.baseRole,_=p.applicationOptions,E=p.resourceOptions,x=p.operationOptions,w=p.expandedPermissions,O=p.isLoadingExpandSplats,k=p.resourceTypes,S=(0,Ee.Z)(r).input,P=(0,D.Z)(),j=(0,m.useState)({applications:[],resources:[],operations:[]}),R=s()(j,2),C=R[0],q=R[1],z=P.getState().values["role-type"],F=(0,m.useState)(!1),L=s()(F,2),N=L[0],T=L[1],Z=(0,m.useState)(""),A=s()(Z,2),M=A[0],I=A[1],W=(0,m.useState)(),B=s()(W,2),Q=B[0],Y=B[1],H=function(e){return k.find((function(t){var n;return t.value===(null===(n=e.split(":"))||void 0===n?void 0:n[1])}))},U=(0,m.useCallback)((0,ke.Z)((function(e){var t=e.applications,n=e.resources,r=e.operations;return l({field:"application",limit:50,application:t.join(),resourceType:n.join(),verb:r.join()})}),3e3),[]),V=(0,m.useCallback)((0,ke.Z)((function(e){var t=e.applications,n=e.resources,r=e.operations;return l({field:"resource_type",limit:50,application:t.join(),resourceType:n.join(),verb:r.join()})}),3e3),[]),$=(0,m.useCallback)((0,ke.Z)((function(e){var t=e.applications,n=e.resources,r=e.operations;return l({field:"verb",limit:50,application:t.join(),resourceType:n.join(),verb:r.join()})}),3e3),[]);(0,m.useEffect)((function(){var e,t=null===(e=P.getState().values["copy-base-role"])||void 0===e?void 0:e.uuid;return"copy"===z&&t&&o((0,pe.fp)(t)),o((0,Pe.A)()),P.change("has-cost-resources",!1),a(v),l({field:"application",limit:50}),l({field:"resource_type",limit:50}),l({field:"verb",limit:50}),function(){return o((0,Se.AL)())}}),[]),(0,m.useEffect)((function(){V(C),$(C)}),[C.applications]),(0,m.useEffect)((function(){U(C),$(C)}),[C.resources]),(0,m.useEffect)((function(){U(C),V(C)}),[C.operations]),(0,m.useEffect)((function(){S.onChange(t)}),[t]),(0,m.useEffect)((function(){var e;if(!(!g||"copy"!==z||P.getState().values["base-permissions-loaded"]||t.length>0||(null===(e=P.getState().values["copy-base-role"])||void 0===e?void 0:e.uuid)!==(null==g?void 0:g.uuid)||O||y)){var r=(null==g?void 0:g.access)||[];if(0===w.length&&void 0===O){var c=i()(new Set(r.map((function(e){return e.permission.split(":")[0]}))));o((0,Se.tL)({application:c.join()}))}else{var a=r.map((function(e){return e.permission.replace("*",".*")}));n((function(){return w.filter((function(e){return"cost-management"!==e.split(":")[0]||0!==(H(e)||{count:0}).count})).filter((function(e){return a.some((function(t){return e.match(t)}))})).map((function(e){return{uuid:e}}))})),P.change("base-permissions-loaded",!0)}}}),[b,g]);var G=function(e){return e.reduce((function(e,t){return{0:De(De({},null==e?void 0:e[0]),{},c()({},t,!0))}}),{0:{}})},K={applications:i()(_).filter((function(e){return e.includes(M)})).map((function(e){return{label:e,value:e}})),resources:i()(E).filter((function(e){return e.includes(M)})).map((function(e){return{label:e,value:e}})),operations:i()(x).filter((function(e){return e.includes(M)})).map((function(e){return{label:e,value:e}}))},J={label:f().createElement("div",null," No results found"),isDisabled:!0},X=K[Object.keys(K)[Q||0]].length>10;return f().createElement("div",{className:"ins-c-rbac-permissions-table"},f().createElement(ge.M,d()({columns:qe,isSelectable:!0,isCompact:!0,borders:!1,createRows:function(e){return e.map((function(e){var n=e.application,r=e.resource,i=e.operation,o=e.uuid;return{uuid:"".concat(n,":").concat(r,":").concat(i),cells:[{title:n},r,i],selected:Boolean(t&&t.find((function(e){return e.uuid===o}))),disableSelection:"cost-management"===n&&0===(H(o)||{count:0}).count}}))},data:b,filterValue:"",noData:0===(null==b?void 0:b.length),noDataDescription:["Adjust your filters and try again. Note: Applications that only have wildcard           permissions (for example, patch:*:*) aren’t included in this table and can’t be           added to your custom role."],fetchData:function(e){var t=e.limit,n=e.offset,r=e.applications,i=e.resources,o=e.operations;a({limit:t,offset:n,application:(r||C.applications).join(),resourceType:(i||C.resources).join(),verb:(o||C.operations).join()})},setFilterValue:function(e){var t=e.applications,n=e.resources,r=e.operations;q(De(De(De(De({},C),t?{applications:t}:C.applications),n?{resources:n}:C.resources),r?{operations:r}:C.operations))},isLoading:y||O,pagination:De(De({},v),{},{count:v.count}),checkedRows:t,setCheckedItems:function(e){n(e(t).map((function(e){return{uuid:e.uuid}})))},titlePlural:"permissions",titleSingular:"permission",showMoreTitle:N?"See less":"See more",onFilter:function(e){return I(e)},onShowMore:X?function(){T((function(){return!N}))}:void 0,onChange:function(e,t){I(""),Y(t)},value:Q,filters:[{key:"applications",value:C.applications,placeholder:"Filter by application",type:"group",selected:G(C.applications),groups:[{type:K.applications.length>0?"checkbox":"plain",items:K.applications.length>0?i()(K.applications).slice(0,N?void 0:10):[J]}]},{key:"resources",value:C.resources,placeholder:"Filter by resource type",type:"group",selected:G(C.resources),groups:[{type:K.resources.length>0?"checkbox":"plain",items:K.resources.length>0?i()(K.resources).slice(0,N?void 0:10):[J]}]},{key:"operations",value:C.operations,placeholder:"Filter by operation",type:"group",selected:G(C.operations),groups:[{type:K.operations.length>0?"checkbox":"plain",items:K.operations.length>0?i()(K.operations).slice(0,N?void 0:10):[J]}]}],isFilterable:!0,rowWrapper:Re,tableId:"add-role-permissions"},r)))};Fe.propTypes={selectedPermissions:y().array,setSelectedPermissions:y().func};const Le=Fe;var Ne=n(49739),Te=n(83826),Ze=n(50693),Ae=n(16475),Me=function(e,t){return f().createElement("div",{className:"ins-c-rbac__sticky"},f().createElement(Ze.r,{className:"ins-c-rbac__sticky--title"},e.map((function(t){return f().createElement(Ae.P,{span:12/e.length,key:t},t)}))),f().createElement(Ze.r,{className:"ins-c-rbac__sticky--data"},t.map((function(t){return t.cells.map((function(t){return f().createElement(Ae.P,{span:12/e.length,key:t},t)}))}))))};var Ie=n(2644),We=n(92694),Be=n(64403),Qe=n(59775);function Ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function He(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ye(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ue=function(e){var t=e.costReducer,n=t.resourceTypes,r=t.isLoading,i=t.loadingResources,o=t.resources;return{resourceTypes:n.data,resources:o,isLoading:r,isLoadingResources:i>0}},Ve=function(e,t){var n=e[t.key];switch(t.type){case"toggle":return He(He({},e),{},c()({},t.key,He(He({},n),{},{isOpen:!n.isOpen})));case"select":return He(He({},e),{},c()({},t.key,He(He({},n),{},{selected:n.selected.includes(t.selection)?n.selected.filter((function(e){return e!==t.selection})):[].concat(i()(n.selected),[t.selection])})));case"selectAll":return He(He({},e),{},c()({},t.key,He(He({},n),{},{selected:n.options.map((function(e){return e.value}))})));case"clear":return He(He({},e),{},c()({},t.key,He(He({},n),{},{selected:[]})));case"setOptions":return He(He({},e),{},c()({},t.key,He(He({},n),{},{options:t.options,filteredOptions:t.options})));case"setFilter":return He(He({},e),{},c()({},t.key,He(He({},n),{},{filteredOptions:n.options.filter((function(e){return e.value.includes(t.filtervalue)}))})));default:return e}};function $e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ke=(0,m.createContext)({success:!1,submitting:!1,error:void 0}),Je=function(e){return f().createElement(_.ZP,d()({},e,{showFormControls:!1}))},Xe=function(e){var t=e.Content,n=u()(e,["Content"]);return f().createElement(t,n)};Xe.propTypes={Content:y().elementType.isRequired};var et={"base-role-table":function(e){var t=(0,h.useDispatch)(),n=function(e){return t((0,pe.hs)(e))},r=(0,m.useState)(""),i=s()(r,2),o=i[0],c=i[1],a=(0,h.useSelector)(Oe,h.shallowEqual),l=a.roles,u=a.pagination,p=(0,Ee.Z)(e).input,d=(0,D.Z)();return(0,m.useEffect)((function(){n({limit:50,offset:0,itemCount:0,orderBy:"display_name"})}),[]),f().createElement("div",null,f().createElement(ve.b,{variant:"info",isInline:!0,title:"Only granular permissions will be copied into a custom role         (for example, approval:requests:read). Wildcard permissions will not         be copied into a custom role (for example, approval:*:read).\n        "}),f().createElement(ge.M,{columns:we,createRows:function(e){return e.map((function(e){return{cells:[{title:f().createElement(he.Y,{id:"".concat(e.uuid,"-radio"),name:"".concat(e.name,"-radio"),"aria-label":"".concat(e.name,"-radio"),ouiaId:"".concat(e.name,"-radio"),value:e.uuid,isChecked:p.value.uuid===e.uuid,onChange:function(){d.batch((function(){p.onChange(e),d.change("role-copy-name","Copy of ".concat(e.display_name||e.name)),d.change("role-copy-description",e.description),d.change("add-permissions-table",[]),d.change("base-permissions-loaded",!1)}))}}),props:{className:"pf-c-table__check"}},e.display_name||e.name,e.description]}}))},data:l,fetchData:function(e){return n((0,_e.jl)(e))},filterValue:o,setFilterValue:function(e){var t=e.name;return c(t)},isLoading:!1,pagination:u,titlePlural:"roles",titleSingular:"role",filterPlaceholder:"role name",ouiaId:"roles-table",isCompact:!0,tableId:"base-role"}))},"add-permissions-table":Le,"cost-resources":function(e){var t=(0,h.useDispatch)(),n=(0,h.useSelector)(Ue,h.shallowEqual),r=n.resourceTypes,o=n.isLoading,a=n.isLoadingResources,l=n.resources,u=(0,Ee.Z)(e).input,p=(0,D.Z)(),d=p.getState().values["add-permissions-table"].filter((function(e){return e.uuid.split(":")[0].includes("cost-management")})),b=(0,m.useReducer)(Ve,d.reduce((function(e,t){return He(He({},e),{},c()({},t.uuid,{selected:[],options:[],filteredOptions:[],isOpen:!1}))}),{})),y=s()(b,2),v=y[0],g=y[1];return(0,m.useEffect)((function(){(p.getState().values["resource-definitions"]||[]).map((function(e){var t=e.permission;return e.resources.map((function(e){return d.includes(t)&&g({type:"select",selection:e,key:t})}))})),t((0,Pe.A)(undefined)),p.change("has-cost-resources",!0)}),[]),(0,m.useEffect)((function(){o||i()(new Set(d.map((function(e){var t;return null===(t=r.find((function(t){var n;return t.value===(null===(n=e.uuid.split(":"))||void 0===n?void 0:n[1])})))||void 0===t?void 0:t.path})))).filter((function(e){return e})).map((function(e){return n=e,t((0,Pe.R)(n));var n}))}),[r]),(0,m.useEffect)((function(){a||d.map((function(e){return g({type:"setOptions",key:e.uuid,options:l[(t=e.uuid,null===(n=r.find((function(e){var n;return e.value===(null===(n=t.split(":"))||void 0===n?void 0:n[1])})))||void 0===n||null===(i=n.path.split("/"))||void 0===i?void 0:i[5])]||[]});var t,n,i}))}),[a]),(0,m.useEffect)((function(){var e=Object.entries(v).map((function(e){var t=s()(e,2);return{permission:t[0],resources:t[1].selected}}));u.onChange(e),p.change("resource-definitions",e)}),[v]),f().createElement(Ze.r,{hasGutter:!0},f().createElement(Ae.P,{md:4,className:"ins-m-hide-on-sm"},f().createElement(S.x,{component:S.q.h4,className:"ins-c-rbac__bold-text"},"Cost management permissions")),f().createElement(Ae.P,{md:8,className:"ins-m-hide-on-sm"},f().createElement(S.x,{component:S.q.h4,className:"ins-c-rbac__bold-text"},"Resource definitions")),d.map((function(e){var t=e.uuid,n=v[t].filteredOptions;return f().createElement(f().Fragment,null,f().createElement(Ae.P,{md:4,sm:12},f().createElement(Qe.c,{label:t,isRequired:!0})),f().createElement(Ae.P,{md:8,sm:12},f().createElement(Ie.P,{className:"ins-c-rbac-cost-resource-select",variant:Be.TM.checkbox,typeAheadAriaLabel:"Select a state",onToggle:function(e){g({type:"setFilter",key:t,filtervalue:""}),function(e,t){g({type:"toggle",key:e,isOpen:t})}(t,e)},onSelect:function(e,r){!function(e,t,n,r){g(n?{type:"selectAll",selection:t,key:r}:{type:"select",selection:t,key:r})}(0,r,r==="Select All (".concat(n.length,")"),t)},onClear:function(){return g({type:"clear",key:t})},selections:v[t].selected,isOpen:v[t].isOpen,onFilter:function(e){return g({type:"setFilter",key:t,filtervalue:e.target.value})},"aria-labelledby":t,placeholderText:"Select resources",hasInlineFilter:!0},[f().createElement(We.$,{key:0,value:"Select All (".concat(n.length,")")})].concat(i()(n.map((function(e,t){return f().createElement(We.$,{key:t+1,value:e.value})})))))))})))},review:function(){var e=(0,D.Z)().getState().values,t=e["role-name"],n=e["role-description"],r=e["role-copy-name"],i=e["role-copy-description"],o=e["add-permissions-table"],c=e["resource-definitions"],a=e["has-cost-resources"],s=e["role-type"],l=o.map((function(e){return{cells:e.uuid.split(":")}})),u=(c||[]).map((function(e){return{cells:[e.permission,e.resources.join(", ")]}}));return f().createElement(f().Fragment,null,f().createElement(Ne.K,null,f().createElement(Te.v,{className:"ins-c-rbac__summary"},f().createElement(Ze.r,null,f().createElement(Ae.P,{sm:12,md:2},f().createElement(S.x,{component:S.q.h4,className:"ins-c-rbac__bold-text"},"Name")),f().createElement(Ae.P,{sm:12,md:10},f().createElement(S.x,{component:S.q.p},"create"===s?t:r))),f().createElement(Ze.r,null,f().createElement(Ae.P,{sm:12,md:2},f().createElement(S.x,{component:S.q.h4,className:"ins-c-rbac__bold-text"},"Description")),f().createElement(Ae.P,{sm:12,md:10},f().createElement(S.x,{component:S.q.p},"create"===s?n:i))),f().createElement(Ze.r,null,f().createElement(Ae.P,{sm:12,md:2},f().createElement(S.x,{component:S.q.h4,className:"ins-c-rbac__bold-text"},"Permissions")),f().createElement(Ae.P,{sm:12,md:10},Me(["Application","Resource type","Operation"],l))),a&&f().createElement(Ze.r,null,f().createElement(Ae.P,{sm:12,md:2},f().createElement(S.x,{component:S.q.h4,className:"ins-c-rbac__bold-text"},"Resource definitions")),f().createElement(Ae.P,{sm:12,md:10},Me(["Permission","Resource definitions"],u))))))},description:Xe,"type-selector":function(e){var t=(0,Ee.Z)(e).input,n=(0,D.Z)(),r=(0,m.useState)(n.getState().values["role-type"]),i=s()(r,2),o=i[0],c=i[1],a=function(e){c(e),t.onChange(e),n.change("add-permissions-table",[]),n.change("base-permissions-loaded",!1)};return f().createElement("div",null,f().createElement(he.Y,{isChecked:"create"===o,name:"role-type-create",onChange:function(){return a("create")},label:"Create a role from scratch",id:"role-type-create",value:"create"}),f().createElement(he.Y,{isChecked:"copy"===o,name:"role-type-copy",onChange:function(){return a("copy")},label:"Copy an existing role",id:"role-type-copy",value:"copy"}))}},tt=function(e){var t=e.history.push,n=(0,h.useDispatch)(),r=(0,m.useState)({success:!1,submitting:!1,error:void 0,hideForm:!1}),o=s()(r,2),c=o[0],a=o[1],l=(0,m.useState)(!1),u=s()(l,2),p=u[0],d=u[1],b=(0,m.useRef)(document.createElement("div")),y=(0,m.useState)({}),_=s()(y,2),O=_[0],k=_[1];(0,m.useEffect)((function(){k(function(e){return{fields:[{component:"wizard",name:"wizzard",isDynamic:!0,inModal:!0,showTitles:!0,title:"Create role",container:e,fields:[{title:"Create role",name:"step-1",nextStep:{when:"role-type",stepMapper:{copy:"name-and-description",create:"add-permissions"}},fields:[{component:"type-selector",name:"role-type",isRequired:!0,validate:[{type:w.Z.REQUIRED}]},{component:"text-field",name:"role-name",type:"text",label:"Role name",isRequired:!0,condition:{when:"role-type",is:"create"},validate:[X,{type:w.Z.REQUIRED},{type:w.Z.MAX_LENGTH,threshold:150}]},{component:"text-field",name:"role-description",type:"text",label:"Role description",condition:{when:"role-type",is:"create"},validate:[{type:"max-length",threshold:150}]},{component:"base-role-table",name:"copy-base-role",label:"Base role",isRequired:!0,condition:{when:"role-type",is:"copy"},validate:[{type:w.Z.REQUIRED}]},{condition:{when:"role-type",is:"create"},component:"description",name:"fixasyncvalidation",Content:ee},{condition:{when:"role-type",is:"copy"},component:"description",name:"fixasyncvalidation2",Content:ee}]},{title:"Name and description",name:"name-and-description",nextStep:"add-permissions",fields:[{component:"text-field",name:"role-copy-name",type:"text",label:"Role name",isRequired:!0,validate:[X,{type:w.Z.REQUIRED},{type:"max-length",threshold:150}]},{component:"text-field",name:"role-copy-description",type:"text",label:"Role description",validate:[{type:"max-length",threshold:150}]}]},{name:"add-permissions",title:"Add permissions",StepTemplate:N,nextStep:function(e){var t=e.values;return t&&t["add-permissions-table"]&&t["add-permissions-table"].some((function(e){return e.uuid.split(":")[0].includes("cost-management")}))?"cost-resources-definition":"review"},fields:[{component:"add-permissions-table",name:"add-permissions-table"}]},{name:"cost-resources-definition",title:"Define Cost Management resources",nextStep:"review",fields:[{component:"plain-text",name:"text-description",label:f().createElement("p",null,"Specify where you would like to apply each cost permission selected in the previous step, using the dropdown below.")},{component:"cost-resources",name:"cost-resources",validate:[function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).every((function(e){return e.resources.length>0}))?void 0:"You need to assign at least one resource to each permission."}]}]},{name:"review",title:"Review details",buttons:B,StepTemplate:ue,fields:[{component:"review",name:"review"}]}]}]}}(b.current))}),[]),(0,m.useEffect)((function(){b.current.hidden=p}),[p]);var S=function(){c.success||n((0,v.wN)({variant:"warning",title:"Creating role was canceled by the user",dismissDelay:8e3,dismissable:!1})),t("/roles")};return f().createElement(Ke.Provider,{value:Ge(Ge({},c),{},{setWizardError:function(e){return a((function(t){return Ge(Ge({},t),{},{error:e})}))},setWizardSuccess:function(e){return a((function(t){return Ge(Ge({},t),{},{success:e})}))},setHideForm:function(e){return a((function(t){return Ge(Ge({},t),{},{hideForm:e})}))}})},f().createElement(de.R,{type:"role",isOpen:p,onModalCancel:function(){return d(!1)},onConfirmCancel:S}),c.hideForm?f().createElement(x.e,{title:"Create role",isOpen:!0,onClose:function(){return t("/roles")},steps:[{name:"success",component:f().createElement(ye,null),isFinishedStep:!0}]}):f().createElement(g.Z,{schema:O,container:b,subscription:{values:!0},FormTemplate:Je,componentMapper:Ge(Ge({},E.ZP),et),onSubmit:function(e){var t=e["role-name"],r=e["role-description"],o=e["role-copy-name"],c=e["role-copy-description"],s=e["add-permissions-table"],l=e["cost-resources"],u=e["role-type"];a((function(e){return Ge(Ge({},e),{},{submitting:!0})}));var p={applications:i()(new Set(s.map((function(e){return e.uuid.split(":")[0]})))),description:("create"===u?r:c)||null,name:"create"===u?t:o,access:s.map((function(e){var t=e.uuid;return{permission:t,resourceDefinitions:(null==l?void 0:l.find((function(e){return e.permission===t})))?[{attributeFilter:{key:"cost-management.".concat(t.split(":")[1]),operation:"in",value:null==l?void 0:l.find((function(e){return e.permission===t})).resources}}]:[]}}))};return n((0,pe.fA)(p)).then((function(){a((function(e){return Ge(Ge({},e),{},{submitting:!1,success:!0,hideForm:!0})})),n((0,pe.Kt)())}))},onCancel:function(e){Boolean(e&&e["role-name"]||e["role-description"]||e["copy-base-role"])?d(!0):S()}}))};tt.propTypes={history:y().shape({push:y().func.isRequired}).isRequired};const nt=tt},12236:(e,t,n)=>{var r=n(93379),i=n(66369);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.id,i,""]]);var o=r(i,{insert:"head",singleton:!1});if(!i.locals||e.hot.invalidate){var c=i.locals;e.hot.accept(66369,(function(){"string"==typeof(i=(i=n(66369)).__esModule?i.default:i)&&(i=[[e.id,i,""]]),function(e,t){if(!e&&t||e&&!t)return!1;var n;for(n in e)if(e[n]!==t[n])return!1;for(n in t)if(!e[n])return!1;return!0}(c,i.locals)?(c=i.locals,o(i)):e.hot.invalidate()}))}e.hot.dispose((function(){o()})),e.exports=i.locals||{}},50486:(e,t,n)=>{var r=n(93379),i=n(20387);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.id,i,""]]);var o=r(i,{insert:"head",singleton:!1});if(!i.locals||e.hot.invalidate){var c=i.locals;e.hot.accept(20387,(function(){"string"==typeof(i=(i=n(20387)).__esModule?i.default:i)&&(i=[[e.id,i,""]]),function(e,t){if(!e&&t||e&&!t)return!1;var n;for(n in e)if(e[n]!==t[n])return!1;for(n in t)if(!e[n])return!1;return!0}(c,i.locals)?(c=i.locals,o(i)):e.hot.invalidate()}))}e.hot.dispose((function(){o()})),e.exports=i.locals||{}}}]);
//# sourceMappingURL=9480.d1d3feba15485f6b3665.js.map