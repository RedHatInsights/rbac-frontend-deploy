"use strict";(self.webpackChunkrbac=self.webpackChunkrbac||[]).push([[345,459],{55218:(e,t,n)=>{n.d(t,{Z:()=>c});var s=n(66029),r=n.n(s),a=n(80236),o=n(47173),i=n(93149);const c=e=>{var{isOpen:t,onConfirm:n,onClose:c,children:l,confirmButtonLabel:m="Confirm",cancelButtonLabel:u="Cancel",variant:p=a.v.small,titleIconVariant:d="warning",withCheckbox:f=!1,checkboxLabel:g="I understand that this action cannot be undone",confirmButtonVariant:v=o.Wu.primary,ouiaId:E="WarningModal"}=e,b=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n}(e,["isOpen","onConfirm","onClose","children","confirmButtonLabel","cancelButtonLabel","variant","titleIconVariant","withCheckbox","checkboxLabel","confirmButtonVariant","ouiaId"]);const[h,y]=(0,s.useState)(!1);return r().createElement(a.u,Object.assign({variant:p,isOpen:t,onClose:c,onEscapePress:c,titleIconVariant:d,actions:[r().createElement(o.zx,{ouiaId:`${E}-confirm-button`,key:"confirm",variant:v,onClick:()=>{null==n||n(),y(!1)},isDisabled:f&&!h},m),r().createElement(o.zx,{ouiaId:`${E}-cancel-button`,key:"cancel",variant:o.Wu.link,onClick:c},u)],ouiaId:E},b),l,f?r().createElement(i.X,{isChecked:h,onChange:(e,t)=>y(t),label:g,id:"warning-modal-check",className:"pf-v5-u-mt-lg",ouiaId:`${E}-confirm-checkbox`}):null)}},68774:(e,t,n)=>{n.d(t,{D:()=>i});var s=n(65353),r=n(66029),a=n(62873),o=n(38296);const i=e=>{var{children:t,className:n="",isVisited:i=!1}=e,c=(0,s.__rest)(e,["children","className","isVisited"]);return r.createElement("div",Object.assign({},c,{className:(0,o.css)(a.Z.content,i&&a.Z.modifiers.visited,n)}),t)};i.displayName="TextContent"},48701:(e,t,n)=>{n.r(t),n.d(t,{AddRolePermissionWizardContext:()=>J,default:()=>U,mapperExtension:()=>X});var s=n(66029),r=n.n(s),a=n(86706),o=n(45697),i=n.n(o),c=n(25387),l=n(46985),m=n(51912),u=n(67850),p=n(8340),d=n(55218),f=n(79083),g=n(13563),v=n(55594),E=n(49739),b=n(83826),h=n(68774),y=n(38779),Z=n(50693),x=n(16475),C=n(68340),k=n(48880),M=n(2550);var w=n(9947),P=n(67880),I=n(43049),D=n(75106),O=n(80315),S=n(47173),F=n(68778),L=n(64756),N=n(14289);const T=({currentRoleID:e})=>{const t=(0,c.YB)(),n=(0,a.useDispatch)();return r().createElement(r().Fragment,null,r().createElement(w.u,null,r().createElement(P.t,{titleText:r().createElement(r().Fragment,null,t.formatMessage(M.Z.permissionsAddedSuccessfully)),icon:r().createElement(I.k,{color:"green",icon:F.rE}),headingLevel:"h4"}),r().createElement(D.B,null),r().createElement(O.O,null,r().createElement(L.Z,{to:N.Z["role-detail"].link.replace(":roleId",e)},r().createElement(S.zx,{onClick:()=>n((0,g.fp)(e))},t.formatMessage(M.Z.exit))))))},B=T;T.propTypes={currentRoleID:i().string.isRequired};var q=n(47108),z=n(51880),j=n(52229),A=n(52643),R=n(83133);const V=({formFields:e})=>{const{submitting:t}=(0,s.useContext)(J);return t?r().createElement(A.b,null,r().createElement(R.$,{size:"xl"})):r().createElement("div",{className:"rbac"},[[{...e?.[0]?.[0]}]])};V.propTypes={formFields:i().array};const W=V;var G=n(60167),$=n(2034),_=n(92884),Y=n(68539),H=n(84414);const K=e=>r().createElement(u.ZP,{...e,showFormControls:!1}),X={"add-permissions-table":v.Z,"inventory-groups-role":z.Z,"cost-resources":q.Z,review:()=>{const e=(0,c.YB)(),t=(0,k.default)(),{"role-name":n,"role-description":s,"add-permissions-table":a,"resource-definitions":o,"has-cost-resources":i}=t.getState().values;return r().createElement(E.K,{hasGutter:!0},r().createElement(b.v,null,r().createElement(h.D,null,r().createElement(y.D,{headingLevel:"h1",size:"xl",className:"pf-v5-u-mb-sm"},e.formatMessage(M.Z.reviewDetails)))),r().createElement(b.v,{className:"rbac-l-stack__item-summary"},r().createElement(Z.r,{hasGutter:!0},r().createElement(x.P,{span:3},r().createElement(C.x,{className:"pf-v5-c-title",component:C.q.h6},e.formatMessage(M.Z.roleName))),r().createElement(x.P,{span:9},r().createElement(C.x,{component:C.q.p},n)),r().createElement(x.P,{span:3},r().createElement(C.x,{className:"pf-v5-c-title",component:C.q.h6},e.formatMessage(M.Z.roleDescription))),r().createElement(x.P,{span:9},r().createElement(C.x,{component:C.q.p},s)),r().createElement(x.P,{span:3},r().createElement(C.x,{className:"pf-v5-c-title",component:C.q.h6},e.formatMessage(M.Z.addedPermissions))),r().createElement(x.P,{span:9},r().createElement(h.D,{component:C.q.p},a.map(((e,t)=>r().createElement(C.x,{key:t}," ",e.uuid," "))))),i&&r().createElement(r().Fragment,null,r().createElement(x.P,{span:3},r().createElement(C.x,{className:"pf-v5-c-title",component:C.q.h6},e.formatMessage(M.Z.resourceDefinitions))),r().createElement(x.P,{span:9},r().createElement(h.D,{component:C.q.p},o.map((({resources:e})=>e.map(((e,t)=>r().createElement(C.x,{key:t}," ",e," ")))))))))))}},J=(0,s.createContext)({success:!1,submitting:!1,error:void 0}),Q=({role:e})=>{const t=(0,c.YB)(),[n,o]=(0,s.useState)(!1),[i,u]=(0,s.useState)(""),v=(0,H.Z)(),E=(0,a.useDispatch)(),b=(0,f.useFlag)("platform.rbac.groups-to-workspaces-rename"),[h,y]=(0,s.useState)({success:!1,submitting:!1,error:void 0,hideForm:!1}),Z=(0,s.useRef)(document.createElement("div")),x=(0,s.useMemo)((()=>((e,t)=>{const n=(0,c.Sn)(),s=(0,c.dp)({locale:G.S,messages:$},n);return{fields:[{component:"wizard",name:"wizard",isDynamic:!0,inModal:!0,showTitles:!0,crossroads:["role-type"],title:s.formatMessage(M.Z.addPermissions),container:e,fields:[{name:"add-permissions",title:s.formatMessage(M.Z.addPermissions),StepTemplate:j.Z,nextStep:({values:e})=>(0,_.j)("add-permissions",e),fields:[{component:"add-permissions-table",name:"add-permissions-table"}]},{name:"inventory-groups-role",title:s.formatMessage(t?M.Z.workspacesAccessTitle:M.Z.inventoryGroupsAccessTitle),StepTemplate:Y.Z,nextStep:({values:e})=>(0,_.j)("inventory-groups-role",e),fields:[{component:"plain-text",name:"text-description",label:r().createElement("p",null,s.formatMessage(t?M.Z.workspacesAccessDescription:M.Z.inventoryGroupsAccessDescription))},{component:"inventory-groups-role",name:"inventory-groups-role",validate:[(e=[])=>e?.every((({groups:e,permission:t})=>e?.length>0&&t))?void 0:s.formatMessage(M.Z.assignAtLeastOneInventoryGroup)]}]},{name:"cost-resources-definition",title:s.formatMessage(M.Z.defineCostResources),nextStep:"review",fields:[{component:"plain-text",name:"text-description",label:r().createElement("p",null,s.formatMessage(M.Z.applyCostPermissionText))},{component:"cost-resources",name:"cost-resources",validate:[(e=[])=>e.every((({resources:e})=>e&&e.length>0))?void 0:s.formatMessage(M.Z.assignAtLeastOneResource)]}]},{name:"review",title:s.formatMessage(M.Z.reviewDetails),StepTemplate:W,fields:[{component:"review",name:"review"}]}]}]}})(Z.current,b)),[]);(0,s.useEffect)((()=>{u(e.uuid)})),(0,s.useEffect)((()=>{Z.current.hidden=n}),[n]);const C=()=>{v(N.Z["role-detail"].link.replace(":roleId",e.uuid))};return r().createElement(J.Provider,{value:{...h,setWizardError:e=>y((t=>({...t,error:e}))),setWizardSuccess:e=>y((t=>({...t,success:e}))),setHideForm:e=>y((t=>({...t,hideForm:e}))),rolePermissions:e.access}},r().createElement(d.Z,{title:t.formatMessage(M.Z.exitItemAdding,{item:t.formatMessage(M.Z.permissions).toLocaleLowerCase()}),isOpen:n,onClose:()=>o(!1),confirmButtonLabel:t.formatMessage(M.Z.discard),onConfirm:C},t.formatMessage(M.Z.discardedInputsWarning)),h.hideForm?h.success?r().createElement(l.e,{title:t.formatMessage(M.Z.addPermissions),isOpen:!0,steps:[{name:"success",component:r().createElement(B,{currentRoleID:i}),isFinishedStep:!0}],onClose:C}):null:r().createElement(m.Z,{container:Z,schema:x,subscription:{values:!0},FormTemplate:K,initialValues:{"role-uuid":e.uuid,"role-type":"create","role-name":e.display_name,"role-description":e.description},componentMapper:{...p.ZP,...X},onSubmit:async t=>{const{"add-permissions-table":n,"cost-resources":s=[],"inventory-groups-role":r=[]}=t,a=[...e.access.map((e=>e.permission)),...n.map((e=>e.uuid))],o={...e,access:[...n.reduce(((e,{uuid:t,requires:n})=>[...e,...[t,...n.filter((e=>!a.includes(e)))].map((e=>({permission:e,resourceDefinitions:[...s,...r]?.find((t=>t.permission===e))?e.includes("inventory")?[{attributeFilter:{key:"group.id",operation:"in",value:r?.find((t=>t.permission===e))?.groups?.map((e=>e?.id))}}]:e.includes("cost-management")?[{attributeFilter:{key:`cost-management.${e.split(":")[1]}`,operation:"in",value:s?.find((t=>t.permission===e)).resources}}]:[]:[]})))]),e.access)],accessCount:e.accessCount+n.length};y((e=>({...e,submitting:!0}))),E((0,g.ul)(i,o)).then((()=>y((e=>({...e,submitting:!1,success:!0,hideForm:!0}))))).catch((()=>{y((e=>({...e,submitting:!1,success:!1,hideForm:!0}))),v(N.Z["role-detail"].link.replace(":roleId",e.uuid))}))},onCancel:e=>{e&&e["add-permissions-table"]?.length>0?o(!0):C()}}))};Q.defaultProps={role:{}},Q.propTypes={role:i().object};const U=Q}}]);
//# sourceMappingURL=../sourcemaps/345.1e5ef4a017bc013d0fbf2c9b07e026de.js.map