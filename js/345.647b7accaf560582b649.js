"use strict";(self.webpackChunkrbac=self.webpackChunkrbac||[]).push([[345,459],{48701:(e,t,s)=>{s.r(t),s.d(t,{AddRolePermissionWizardContext:()=>Y,default:()=>q,mapperExtension:()=>j});var r=s(28416),n=s.n(r),a=s(86706),o=s(45697),i=s.n(o),l=s(25387),c=s(9820),m=s(51912),p=s(67850),u=s(8340),d=s(55218),f=s(13563),g=s(55594),E=s(9545),v=s(23539),x=s(64380),y=s(72232),Z=s(48880),h=s(2550);var T=s(31055),b=s(95376),S=s(71214),M=s.n(S),I=s(64756),C=s(14289);const F=({currentRoleID:e})=>{const t=(0,l.YB)(),s=(0,a.useDispatch)();return n().createElement(n().Fragment,null,n().createElement(b.EmptyState,null,n().createElement(b.EmptyStateHeader,{titleText:n().createElement(n().Fragment,null,t.formatMessage(h.Z.permissionsAddedSuccessfully)),icon:n().createElement(b.EmptyStateIcon,{color:"green",icon:M()}),headingLevel:"h4"}),n().createElement(b.EmptyStateBody,null),n().createElement(b.EmptyStateFooter,null,n().createElement(I.Z,{to:C.Z["role-detail"].link.replace(":roleId",e)},n().createElement(T.Button,{onClick:()=>s((0,f.fp)(e))},t.formatMessage(h.Z.exit))))))},k=F;F.propTypes={currentRoleID:i().string.isRequired};var w=s(47108),G=s(51880),D=s(52229),P=s(74503),V=s(15950);const N=({formFields:e})=>{const{submitting:t}=(0,r.useContext)(Y);return t?n().createElement(P.Bullseye,null,n().createElement(V.Spinner,{size:"xl"})):n().createElement("div",{className:"rbac"},[[{...e?.[0]?.[0]}]])};N.propTypes={formFields:i().array};const R=N;var z=s(60167),A=s(2034),B=s(92884),L=s(68539),O=s(84414);const W=e=>n().createElement(p.ZP,{...e,showFormControls:!1}),j={"add-permissions-table":g.Z,"inventory-groups-role":G.Z,"cost-resources":w.Z,review:()=>{const e=(0,l.YB)(),t=(0,Z.default)(),{"role-name":s,"role-description":r,"add-permissions-table":a,"resource-definitions":o,"has-cost-resources":i}=t.getState().values;return n().createElement(v.Stack,{hasGutter:!0},n().createElement(v.StackItem,null,n().createElement(x.TextContent,null,n().createElement(y.Title,{headingLevel:"h1",size:"xl",className:"pf-v5-u-mb-sm"},e.formatMessage(h.Z.reviewDetails)))),n().createElement(v.StackItem,{className:"rbac-l-stack__item-summary"},n().createElement(E.Grid,{hasGutter:!0},n().createElement(E.GridItem,{span:3},n().createElement(x.Text,{className:"pf-v5-c-title",component:x.TextVariants.h6},e.formatMessage(h.Z.roleName))),n().createElement(E.GridItem,{span:9},n().createElement(x.Text,{component:x.TextVariants.p},s)),n().createElement(E.GridItem,{span:3},n().createElement(x.Text,{className:"pf-v5-c-title",component:x.TextVariants.h6},e.formatMessage(h.Z.roleDescription))),n().createElement(E.GridItem,{span:9},n().createElement(x.Text,{component:x.TextVariants.p},r)),n().createElement(E.GridItem,{span:3},n().createElement(x.Text,{className:"pf-v5-c-title",component:x.TextVariants.h6},e.formatMessage(h.Z.addedPermissions))),n().createElement(E.GridItem,{span:9},n().createElement(x.TextContent,{component:x.TextVariants.p},a.map(((e,t)=>n().createElement(x.Text,{key:t}," ",e.uuid," "))))),i&&n().createElement(n().Fragment,null,n().createElement(E.GridItem,{span:3},n().createElement(x.Text,{className:"pf-v5-c-title",component:x.TextVariants.h6},e.formatMessage(h.Z.resourceDefinitions))),n().createElement(E.GridItem,{span:9},n().createElement(x.TextContent,{component:x.TextVariants.p},o.map((({resources:e})=>e.map(((e,t)=>n().createElement(x.Text,{key:t}," ",e," ")))))))))))}},Y=(0,r.createContext)({success:!1,submitting:!1,error:void 0}),_=({role:e})=>{const t=(0,l.YB)(),[s,o]=(0,r.useState)(!1),[i,p]=(0,r.useState)(""),g=(0,O.Z)(),E=(0,a.useDispatch)(),[v,x]=(0,r.useState)({success:!1,submitting:!1,error:void 0,hideForm:!1}),y=(0,r.useRef)(document.createElement("div")),Z=(0,r.useMemo)((()=>(e=>{const t=(0,l.Sn)(),s=(0,l.dp)({locale:z.S,messages:A},t);return{fields:[{component:"wizard",name:"wizard",isDynamic:!0,inModal:!0,showTitles:!0,crossroads:["role-type"],title:s.formatMessage(h.Z.addPermissions),container:e,fields:[{name:"add-permissions",title:s.formatMessage(h.Z.addPermissions),StepTemplate:D.Z,nextStep:({values:e})=>(0,B.j)("add-permissions",e),fields:[{component:"add-permissions-table",name:"add-permissions-table"}]},{name:"inventory-groups-role",title:s.formatMessage(h.Z.inventoryGroupsAccessTitle),StepTemplate:L.Z,nextStep:({values:e})=>(0,B.j)("inventory-groups-role",e),fields:[{component:"plain-text",name:"text-description",label:n().createElement("p",null,s.formatMessage(h.Z.inventoryGroupsAccessDescription))},{component:"inventory-groups-role",name:"inventory-groups-role",validate:[(e=[])=>e?.every((({groups:e,permission:t})=>e?.length>0&&t))?void 0:s.formatMessage(h.Z.assignAtLeastOneInventoryGroup)]}]},{name:"cost-resources-definition",title:s.formatMessage(h.Z.defineCostResources),nextStep:"review",fields:[{component:"plain-text",name:"text-description",label:n().createElement("p",null,s.formatMessage(h.Z.applyCostPermissionText))},{component:"cost-resources",name:"cost-resources",validate:[(e=[])=>e.every((({resources:e})=>e&&e.length>0))?void 0:s.formatMessage(h.Z.assignAtLeastOneResource)]}]},{name:"review",title:s.formatMessage(h.Z.reviewDetails),StepTemplate:R,fields:[{component:"review",name:"review"}]}]}]}})(y.current)),[]);(0,r.useEffect)((()=>{p(e.uuid)})),(0,r.useEffect)((()=>{y.current.hidden=s}),[s]);const T=()=>{g(C.Z["role-detail"].link.replace(":roleId",e.uuid))};return n().createElement(Y.Provider,{value:{...v,setWizardError:e=>x((t=>({...t,error:e}))),setWizardSuccess:e=>x((t=>({...t,success:e}))),setHideForm:e=>x((t=>({...t,hideForm:e}))),rolePermissions:e.access}},n().createElement(d.Z,{title:t.formatMessage(h.Z.exitItemAdding,{item:t.formatMessage(h.Z.permissions).toLocaleLowerCase()}),isOpen:s,onClose:()=>o(!1),confirmButtonLabel:t.formatMessage(h.Z.discard),onConfirm:T},t.formatMessage(h.Z.discardedInputsWarning)),v.hideForm?v.success?n().createElement(c.e,{title:t.formatMessage(h.Z.addPermissions),isOpen:!0,steps:[{name:"success",component:n().createElement(k,{currentRoleID:i}),isFinishedStep:!0}],onClose:T}):null:n().createElement(m.Z,{container:y,schema:Z,subscription:{values:!0},FormTemplate:W,initialValues:{"role-uuid":e.uuid,"role-type":"create","role-name":e.display_name,"role-description":e.description},componentMapper:{...u.ZP,...j},onSubmit:async t=>{const{"add-permissions-table":s,"cost-resources":r=[],"inventory-groups-role":n=[]}=t,a=[...e.access.map((e=>e.permission)),...s.map((e=>e.uuid))],o={...e,access:[...s.reduce(((e,{uuid:t,requires:s})=>[...e,...[t,...s.filter((e=>!a.includes(e)))].map((e=>({permission:e,resourceDefinitions:[...r,...n]?.find((t=>t.permission===e))?e.includes("inventory")?[{attributeFilter:{key:"group.id",operation:"in",value:n?.find((t=>t.permission===e))?.groups?.map((e=>e?.id))}}]:e.includes("cost-management")?[{attributeFilter:{key:`cost-management.${e.split(":")[1]}`,operation:"in",value:r?.find((t=>t.permission===e)).resources}}]:[]:[]})))]),e.access)],accessCount:e.accessCount+s.length};x((e=>({...e,submitting:!0}))),E((0,f.ul)(i,o)).then((()=>x((e=>({...e,submitting:!1,success:!0,hideForm:!0}))))).catch((()=>{x((e=>({...e,submitting:!1,success:!1,hideForm:!0}))),g(C.Z["role-detail"].link.replace(":roleId",e.uuid))}))},onCancel:e=>{e&&e["add-permissions-table"]?.length>0?o(!0):T()}}))};_.defaultProps={role:{}},_.propTypes={role:i().object};const q=_}}]);
//# sourceMappingURL=../sourcemaps/345.818006abdaf5aee5c2cbbe8245877dd3.js.map