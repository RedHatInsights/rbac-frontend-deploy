"use strict";(self.webpackChunkrbac=self.webpackChunkrbac||[]).push([[345,459],{55218:(e,t,n)=>{n.d(t,{Z:()=>c});var s=n(66029),r=n.n(s),a=n(80236),o=n(47173),i=n(93149);const c=e=>{var{isOpen:t,onConfirm:n,onClose:c,children:l,confirmButtonLabel:m="Confirm",cancelButtonLabel:u="Cancel",variant:p=a.v.small,titleIconVariant:d="warning",withCheckbox:f=!1,checkboxLabel:g="I understand that this action cannot be undone",confirmButtonVariant:E=o.Wu.primary,ouiaId:v="WarningModal"}=e,b=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]])}return n}(e,["isOpen","onConfirm","onClose","children","confirmButtonLabel","cancelButtonLabel","variant","titleIconVariant","withCheckbox","checkboxLabel","confirmButtonVariant","ouiaId"]);const[h,y]=(0,s.useState)(!1);return r().createElement(a.u,Object.assign({variant:p,isOpen:t,onClose:c,onEscapePress:c,titleIconVariant:d,actions:[r().createElement(o.zx,{ouiaId:`${v}-confirm-button`,key:"confirm",variant:E,onClick:()=>{null==n||n(),y(!1)},isDisabled:f&&!h},m),r().createElement(o.zx,{ouiaId:`${v}-cancel-button`,key:"cancel",variant:o.Wu.link,onClick:c},u)],ouiaId:v},b),l,f?r().createElement(i.X,{isChecked:h,onChange:(e,t)=>y(t),label:g,id:"warning-modal-check",className:"pf-v5-u-mt-lg",ouiaId:`${v}-confirm-checkbox`}):null)}},48701:(e,t,n)=>{n.r(t),n.d(t,{AddRolePermissionWizardContext:()=>Y,default:()=>q,mapperExtension:()=>$});var s=n(66029),r=n.n(s),a=n(86706),o=n(45697),i=n.n(o),c=n(25387),l=n(9820),m=n(51912),u=n(67850),p=n(8340),d=n(55218),f=n(79083),g=n(13563),E=n(55594),v=n(9545),b=n(23539),h=n(64380),y=n(72232),x=n(48880),Z=n(2550);var C=n(31055),T=n(95376),k=n(71214),I=n.n(k),S=n(64756),M=n(14289);const w=({currentRoleID:e})=>{const t=(0,c.YB)(),n=(0,a.useDispatch)();return r().createElement(r().Fragment,null,r().createElement(T.EmptyState,null,r().createElement(T.EmptyStateHeader,{titleText:r().createElement(r().Fragment,null,t.formatMessage(Z.Z.permissionsAddedSuccessfully)),icon:r().createElement(T.EmptyStateIcon,{color:"green",icon:I()}),headingLevel:"h4"}),r().createElement(T.EmptyStateBody,null),r().createElement(T.EmptyStateFooter,null,r().createElement(S.Z,{to:M.Z["role-detail"].link.replace(":roleId",e)},r().createElement(C.Button,{onClick:()=>n((0,g.fp)(e))},t.formatMessage(Z.Z.exit))))))},F=w;w.propTypes={currentRoleID:i().string.isRequired};var O=n(47108),P=n(51880),D=n(52229),G=n(74503),V=n(15950);const B=({formFields:e})=>{const{submitting:t}=(0,s.useContext)(Y);return t?r().createElement(G.Bullseye,null,r().createElement(V.Spinner,{size:"xl"})):r().createElement("div",{className:"rbac"},[[{...e?.[0]?.[0]}]])};B.propTypes={formFields:i().array};const L=B;var z=n(60167),A=n(2034),N=n(92884),j=n(68539),R=n(84414);const W=e=>r().createElement(u.ZP,{...e,showFormControls:!1}),$={"add-permissions-table":E.Z,"inventory-groups-role":P.Z,"cost-resources":O.Z,review:()=>{const e=(0,c.YB)(),t=(0,x.default)(),{"role-name":n,"role-description":s,"add-permissions-table":a,"resource-definitions":o,"has-cost-resources":i}=t.getState().values;return r().createElement(b.Stack,{hasGutter:!0},r().createElement(b.StackItem,null,r().createElement(h.TextContent,null,r().createElement(y.Title,{headingLevel:"h1",size:"xl",className:"pf-v5-u-mb-sm"},e.formatMessage(Z.Z.reviewDetails)))),r().createElement(b.StackItem,{className:"rbac-l-stack__item-summary"},r().createElement(v.Grid,{hasGutter:!0},r().createElement(v.GridItem,{span:3},r().createElement(h.Text,{className:"pf-v5-c-title",component:h.TextVariants.h6},e.formatMessage(Z.Z.roleName))),r().createElement(v.GridItem,{span:9},r().createElement(h.Text,{component:h.TextVariants.p},n)),r().createElement(v.GridItem,{span:3},r().createElement(h.Text,{className:"pf-v5-c-title",component:h.TextVariants.h6},e.formatMessage(Z.Z.roleDescription))),r().createElement(v.GridItem,{span:9},r().createElement(h.Text,{component:h.TextVariants.p},s)),r().createElement(v.GridItem,{span:3},r().createElement(h.Text,{className:"pf-v5-c-title",component:h.TextVariants.h6},e.formatMessage(Z.Z.addedPermissions))),r().createElement(v.GridItem,{span:9},r().createElement(h.TextContent,{component:h.TextVariants.p},a.map(((e,t)=>r().createElement(h.Text,{key:t}," ",e.uuid," "))))),i&&r().createElement(r().Fragment,null,r().createElement(v.GridItem,{span:3},r().createElement(h.Text,{className:"pf-v5-c-title",component:h.TextVariants.h6},e.formatMessage(Z.Z.resourceDefinitions))),r().createElement(v.GridItem,{span:9},r().createElement(h.TextContent,{component:h.TextVariants.p},o.map((({resources:e})=>e.map(((e,t)=>r().createElement(h.Text,{key:t}," ",e," ")))))))))))}},Y=(0,s.createContext)({success:!1,submitting:!1,error:void 0}),_=({role:e})=>{const t=(0,c.YB)(),[n,o]=(0,s.useState)(!1),[i,u]=(0,s.useState)(""),E=(0,R.Z)(),v=(0,a.useDispatch)(),b=(0,f.useFlag)("platform.rbac.groups-to-workspaces-rename"),[h,y]=(0,s.useState)({success:!1,submitting:!1,error:void 0,hideForm:!1}),x=(0,s.useRef)(document.createElement("div")),C=(0,s.useMemo)((()=>((e,t)=>{const n=(0,c.Sn)(),s=(0,c.dp)({locale:z.S,messages:A},n);return{fields:[{component:"wizard",name:"wizard",isDynamic:!0,inModal:!0,showTitles:!0,crossroads:["role-type"],title:s.formatMessage(Z.Z.addPermissions),container:e,fields:[{name:"add-permissions",title:s.formatMessage(Z.Z.addPermissions),StepTemplate:D.Z,nextStep:({values:e})=>(0,N.j)("add-permissions",e),fields:[{component:"add-permissions-table",name:"add-permissions-table"}]},{name:"inventory-groups-role",title:s.formatMessage(t?Z.Z.workspacesAccessTitle:Z.Z.inventoryGroupsAccessTitle),StepTemplate:j.Z,nextStep:({values:e})=>(0,N.j)("inventory-groups-role",e),fields:[{component:"plain-text",name:"text-description",label:r().createElement("p",null,s.formatMessage(t?Z.Z.workspacesAccessDescription:Z.Z.inventoryGroupsAccessDescription))},{component:"inventory-groups-role",name:"inventory-groups-role",validate:[(e=[])=>e?.every((({groups:e,permission:t})=>e?.length>0&&t))?void 0:s.formatMessage(Z.Z.assignAtLeastOneInventoryGroup)]}]},{name:"cost-resources-definition",title:s.formatMessage(Z.Z.defineCostResources),nextStep:"review",fields:[{component:"plain-text",name:"text-description",label:r().createElement("p",null,s.formatMessage(Z.Z.applyCostPermissionText))},{component:"cost-resources",name:"cost-resources",validate:[(e=[])=>e.every((({resources:e})=>e&&e.length>0))?void 0:s.formatMessage(Z.Z.assignAtLeastOneResource)]}]},{name:"review",title:s.formatMessage(Z.Z.reviewDetails),StepTemplate:L,fields:[{component:"review",name:"review"}]}]}]}})(x.current,b)),[]);(0,s.useEffect)((()=>{u(e.uuid)})),(0,s.useEffect)((()=>{x.current.hidden=n}),[n]);const T=()=>{E(M.Z["role-detail"].link.replace(":roleId",e.uuid))};return r().createElement(Y.Provider,{value:{...h,setWizardError:e=>y((t=>({...t,error:e}))),setWizardSuccess:e=>y((t=>({...t,success:e}))),setHideForm:e=>y((t=>({...t,hideForm:e}))),rolePermissions:e.access}},r().createElement(d.Z,{title:t.formatMessage(Z.Z.exitItemAdding,{item:t.formatMessage(Z.Z.permissions).toLocaleLowerCase()}),isOpen:n,onClose:()=>o(!1),confirmButtonLabel:t.formatMessage(Z.Z.discard),onConfirm:T},t.formatMessage(Z.Z.discardedInputsWarning)),h.hideForm?h.success?r().createElement(l.e,{title:t.formatMessage(Z.Z.addPermissions),isOpen:!0,steps:[{name:"success",component:r().createElement(F,{currentRoleID:i}),isFinishedStep:!0}],onClose:T}):null:r().createElement(m.Z,{container:x,schema:C,subscription:{values:!0},FormTemplate:W,initialValues:{"role-uuid":e.uuid,"role-type":"create","role-name":e.display_name,"role-description":e.description},componentMapper:{...p.ZP,...$},onSubmit:async t=>{const{"add-permissions-table":n,"cost-resources":s=[],"inventory-groups-role":r=[]}=t,a=[...e.access.map((e=>e.permission)),...n.map((e=>e.uuid))],o={...e,access:[...n.reduce(((e,{uuid:t,requires:n})=>[...e,...[t,...n.filter((e=>!a.includes(e)))].map((e=>({permission:e,resourceDefinitions:[...s,...r]?.find((t=>t.permission===e))?e.includes("inventory")?[{attributeFilter:{key:"group.id",operation:"in",value:r?.find((t=>t.permission===e))?.groups?.map((e=>e?.id))}}]:e.includes("cost-management")?[{attributeFilter:{key:`cost-management.${e.split(":")[1]}`,operation:"in",value:s?.find((t=>t.permission===e)).resources}}]:[]:[]})))]),e.access)],accessCount:e.accessCount+n.length};y((e=>({...e,submitting:!0}))),v((0,g.ul)(i,o)).then((()=>y((e=>({...e,submitting:!1,success:!0,hideForm:!0}))))).catch((()=>{y((e=>({...e,submitting:!1,success:!1,hideForm:!0}))),E(M.Z["role-detail"].link.replace(":roleId",e.uuid))}))},onCancel:e=>{e&&e["add-permissions-table"]?.length>0?o(!0):T()}}))};_.defaultProps={role:{}},_.propTypes={role:i().object};const q=_}}]);
//# sourceMappingURL=../sourcemaps/345.8b998f1c340a6063aa0331bda0ab57d1.js.map