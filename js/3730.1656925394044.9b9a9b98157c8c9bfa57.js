(self.webpackChunkinsights_rbac_frontend=self.webpackChunkinsights_rbac_frontend||[]).push([[3730],{92758:(e,t,n)=>{"use strict";n.d(t,{MS:()=>l,aX:()=>s,qF:()=>c});var r=n(93433),o=n(4942);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=new URLSearchParams(e.location.search),s=t.reduce((function(e,t){var n=i.getAll(t);return a(a({},e),{},(0,o.Z)({},t,n.length>1?n:n[0]))}),{});return Object.keys(n).forEach((function(e){var t=n[e];s=a(a({},s),{},(0,o.Z)({},e,Array.isArray(s[e])?(0,r.Z)(new Set([].concat((0,r.Z)(s[e]),(0,r.Z)(Array.isArray(t)?t:[t])))):(null==t?void 0:t.length)>0&&t||s[e])),Array.isArray(t)?t.forEach((function(t){return i.getAll(e).includes(t)||i.append(e,t)})):i.get(e)||t&&i.set(e,t)})),e.replace({pathname:e.location.pathname,search:i.toString()}),s},c=function(e,t){var n=new URLSearchParams(e.location.search);return t.some((function(e){return n.get(e)}))},l=function(e,t){var n=new URLSearchParams(e.location.search);Object.keys(t).forEach((function(e){return n.delete(e)})),Object.keys(t).forEach((function(e){var r=t[e];Array.isArray(r)?r.forEach((function(t){return t&&n.append(e,t)})):r&&n.set(e,r)})),e.replace({pathname:e.location.pathname,search:n.toString()})}},67115:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(92950);const o=function(){var e=(0,r.useRef)(!1);return(0,r.useEffect)((function(){return e.current=!0,function(){e.current=!1}}),[]),e}},1227:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(29439),o=n(92950),i=n.n(o),a=n(45697),s=n.n(a),c=n(69957),l=n(57262),u=function(e){var t=e.title,n=e.text,a=e.onClose,s=e.onSubmit,u=e.isOpen,p=e.confirmButtonLabel,d=e.withCheckbox,m=(0,o.useState)(!1),f=(0,r.Z)(m,2),v=f[0],b=f[1];return i().createElement(l.Modal,{className:"rbac",title:i().createElement("div",null,i().createElement(c.ZP,{className:"ins-m-alert rbac-c__delete-icon"})," ",t),isOpen:u,variant:l.ModalVariant.small,onClose:a,actions:[i().createElement(l.Button,{key:"confirm",ouiaId:"primary-confirm-button",isDisabled:d&&!v,variant:"danger",onClick:s},p),i().createElement(l.Button,{key:"cancel",ouiaId:"secondary-cancel-button",variant:"link",onClick:a},"Cancel")]},i().createElement(l.Split,{hasGutter:!0},i().createElement(l.SplitItem,{isFilled:!0},i().createElement(l.Stack,{hasGutter:!0},i().createElement(l.TextContent,null,n)))),d?i().createElement(l.Checkbox,{isChecked:v,onChange:function(){return b(!v)},label:"I understand, and I want to continue.",id:"remove-modal-check",className:"pf-u-mt-lg"}):null)};u.propTypes={text:s().any,title:s().string,confirmButtonLabel:s().string,onSubmit:s().func,onClose:s().func,isOpen:s().bool,withCheckbox:s().bool},u.defaultProps={withCheckbox:!1};const p=u},16796:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(92950),o=n.n(r),i=n(45697),a=n.n(i),s=n(334),c=n(57262),l=n(19571),u=function(e){return e?o().createElement(c.Breadcrumb,null,Object.values(e).map((function(e,t){return e.title?o().createElement(c.BreadcrumbItem,{key:e.title,isActive:e.isActive},e.to&&o().createElement(s.NavLink,{exact:!0,to:e.to},e.title)||e.title):o().createElement(l.Vj,{key:t})}))):null};u.propTypes={breadcrumbs:a().object};const p=u},38376:(e,t,n)=>{"use strict";n.d(t,{Q:()=>d,y:()=>m});var r=n(92950),o=n.n(r),i=n(45697),a=n.n(i),s=n(57262),c=n(19571),l=n(16796),u=n(80123),p=n(39173),d=function(e){var t=e.children,n=e.breadcrumbs;return o().createElement(r.Fragment,null,n&&o().createElement("section",{className:"pf-c-page__main-breadcrumb"},o().createElement(l.Z,n)),o().createElement(u.Z,{className:"rbac-page-header"},t))};d.propTypes={children:a().oneOfType([a().arrayOf(a().node),a().node]).isRequired,breadcrumbs:a().array,paddingBottom:a().bool},d.defaultProps={paddingBottom:!1};var m=function(e){var t=e.title,n=e.renderTitleTag,i=e.description,a=e.children;return o().createElement(r.Fragment,null,o().createElement(s.Flex,null,o().createElement(s.FlexItem,{className:"pf-u-mb-sm"},o().createElement(p.Z,{title:t||o().createElement(c.h2,null),className:"rbac-page-header__title"})),o().createElement(s.FlexItem,{alignSelf:{modifier:"alignSelfCenter"}},n&&n())),i&&o().createElement(s.TextContent,{className:"rbac-page-header__description"},"string"==typeof i?o().createElement(s.Text,{component:s.TextVariants.p},i):i),a)};m.propTypes={title:a().node,renderTitleTag:a().func,description:a().node,children:a().oneOfType([a().node,a().arrayOf(a().node)])}},29215:(e,t,n)=>{"use strict";n.d(t,{R:()=>m,A:()=>d});var r=n(36580),o=n(15861),i=n(87757),a=n.n(i),s=(0,n(89400).i$)();function c(e){return l.apply(this,arguments)}function l(){return(l=(0,o.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.getResourceTypes(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(e){return p.apply(this,arguments)}function p(){return(p=(0,o.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.getResource(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var d=function(e){return{type:r.s6,payload:c(e)}},m=function(e){return{type:r.ZX,payload:u(e)}}},40483:(e,t,n)=>{"use strict";n.d(t,{Z:()=>w});var r=n(4942),o=n(45987),i=n(87462),a=n(92950),s=n.n(a),c=n(45697),l=n.n(c),u=n(76429),p=n(67850),d=n(48880),m=n(74219),f=n(57820),v=n(16396),b=n(4853),y=["ModalProps","saveLabel","cancelLabel","alert"];function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var g="modal-form",E=function(e){return s().createElement(b.l,(0,i.Z)({},e,{id:g}))},O=function(e){var t=e.saveLabel,n=e.cancelLabel,r=(0,d.default)().onCancel;return s().createElement(u.Z,null,(function(e){var o=e.pristine,i=e.invalid,a=e.validating,c=e.submitting;return s().createElement("div",{className:"pf-c-form"},s().createElement(f.W,{className:"pf-u-mt-0"},s().createElement(v.Button,{ouiaId:"primary-save-button",variant:"primary",form:g,type:"submit",isDisabled:o||a||c||i},t),s().createElement(v.Button,{ouiaId:"secondary-cancel-button",variant:"link",onClick:r,id:"cancel-modal"},n)))}))};O.propTypes={saveLabel:l().node,cancelLabel:l().node},O.defaultProps={saveLabel:"Save",cancelLabel:"Cancel"};var Z=function(e){var t=e.ModalProps,n=e.saveLabel,r=e.cancelLabel,a=e.alert,c=(0,o.Z)(e,y);return s().createElement(m.Modal,(0,i.Z)({},t,{footer:s().createElement(O,{saveLabel:n,cancelLabel:r})}),null==a?void 0:a(),s().createElement(p.ZP,(0,i.Z)({},c,{showFormControls:!1,FormWrapper:E})))};Z.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({ModalProps:l().object},O.propTypes);const w=Z},36457:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var r=n(87462),o=n(4942),i=n(45987),a=n(92950),s=n.n(a),c=n(45697),l=n.n(c),u=n(93433),p=n(57262),d=["input","options","isReadOnly","isDisabled","isRequired"],m=["label","isRequired","helperText","meta","description","hideLabel"],f=function(e){var t=e.input,n=e.options,o=e.isReadOnly,a=e.isDisabled,c=e.isRequired,l=(0,i.Z)(e,d);return s().createElement(p.FormSelect,(0,r.Z)({},t,l,{isDisabled:a||o}),function(e,t,n){if(t&&n)return e;var r=(0,u.Z)(e);return r.find((function(e){return void 0===e.value}))?(0,u.Z)(r):[{label:n?"Please choose":"None"}].concat((0,u.Z)(r))}(n,t.value,c).map((function(e){return s().createElement(p.FormSelectOption,(0,r.Z)({key:e.value||e.label},e,{label:e.label.toString()}))})))};f.propTypes={input:l().object.isRequired,options:l().arrayOf(l().shape({value:l().any,label:l().string.isRequired})).isRequired,isReadOnly:l().bool,isDisabled:l().bool,isRequired:l().bool,FieldProvider:l().any};var v=function(e){var t=e.label,n=e.isRequired,o=e.helperText,a=e.meta,c=e.description,l=e.hideLabel,u=(0,i.Z)(e,m),d=a.error,v=a.touched&&d;return s().createElement(p.FormGroup,{isRequired:n,label:!l&&t,fieldId:u.id,isValid:!v,helperText:o,helperTextInvalid:a.error},c&&s().createElement(p.TextContent,null,s().createElement(p.Text,{component:p.TextVariants.small},c)),s().createElement(f,(0,r.Z)({label:t,isValid:!v,isRequired:n},u)))};v.propTypes={componentType:l().string,label:l().string,isRequired:l().bool,helperText:l().string,meta:l().object,description:l().string,hideLabel:l().bool};const b=v;var y=n(41609),h=n.n(y),g=n(48880),E=n(76429),O=function(e){var t=e.dirtyFieldsSinceLastSubmit,n=e.submitSucceeded,r=e.pristine,o=(0,g.default)().onCancel,i=h()(t)||!n&&r;return s().createElement(p.ActionGroup,{className:"pf-u-mt-0"},s().createElement(p.Button,{ouiaId:"primary-submit-button",type:"submit",isDisabled:i,variant:"primary"},"Save"),s().createElement(p.Button,{ouiaId:"secondary-cancel-button",variant:"link",onClick:function(){return o()}},"Cancel"))};O.propTypes={dirtyFieldsSinceLastSubmit:l().shape((0,o.Z)({},l().string,l().oneOfType([l().string,l().number,l().bool]))),submitSucceeded:l().bool,pristine:l().bool,onCancel:l().func};const Z=function(e){return s().createElement(E.Z,{subscription:{pristine:!0,submitSucceeded:!0,dirtyFieldsSinceLastSubmit:!0}},(function(t){return s().createElement(O,(0,r.Z)({},t,e))}))};var w=n(67850),S=n(65412),j=n(75747),T=n(93025),P=n(96354),R=["formTemplateProps"],k=function(e){var t,n=e.formTemplateProps,a=(0,i.Z)(e,R);return s().createElement(T.Z,(0,r.Z)({componentMapper:(t={},(0,o.Z)(t,P.Z.TEXT_FIELD,S.Z),(0,o.Z)(t,P.Z.TEXTAREA,j.Z),(0,o.Z)(t,P.Z.SELECT,b),t),FormTemplate:function(e){return s().createElement(w.ZP,(0,r.Z)({},n,e,{FormButtons:Z}))}},a))};k.propTypes={formTemplateProps:l().object};const x=k},93327:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(45987),o=n(92950),i=n.n(o),a=n(45697),s=n.n(a),c=n(334),l=["pageAction"],u=function(e){var t=e.pageAction,n=(0,r.Z)(e,l);return(0,o.useEffect)((function(){return insights.chrome.appAction(t),function(){return insights.chrome.appAction(void 0)}}),[t]),i().createElement(c.Route,n)};u.propTypes={pageAction:s().string.isRequired};const p=u},73943:(e,t,n)=>{"use strict";n.d(t,{R:()=>l});var r=n(92950),o=n.n(r),i=n(45697),a=n.n(i),s=n(57262),c=n(69957),l=function(e){var t=e.type,n=e.isOpen,r=e.onModalCancel,i=e.onConfirmCancel,a=e.customTitle,l=e.customDescription;return o().createElement(s.Modal,{title:o().createElement("span",{className:"rbac-c-wizard__cancel-warning-header"},o().createElement(c.ZP,{size:"md",className:"rbac-c-wizard__cancel-warning-header--icon"}),a||"Exit ".concat(t," creation?")),variant:s.ModalVariant.small,className:"rbac rbac-c-wizard__cancel-warning",isOpen:n,onClose:r,actions:[o().createElement(s.Button,{ouiaId:"primary-exit-button",key:"confirm",variant:"primary",onClick:i},"Exit"),o().createElement(s.Button,{ouiaId:"secondary-cancel-button",key:"cancel",variant:"link",onClick:r},"Stay")]},o().createElement("span",null,l||"All inputs will be discarded."," "))};l.propTypes={type:a().string,customTitle:a().node,customDescription:a().node,isOpen:a().bool,onModalCancel:a().func,onConfirmCancel:a().func}},94852:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(4942),o=n(93433),i=n(29439),a=n(92950),s=n.n(a),c=n(45697),l=n.n(c),u=n(57262),p=n(48880),d=n(55795);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v=function(e){var t,n,r,c=e.formFields,l=(0,p.default)(),m=(0,a.useState)(l.getState().values["add-permissions-table"]||[]),v=(0,i.Z)(m,2),b=v[0],y=v[1],h=(0,a.useState)(!1),g=(0,i.Z)(h,2),E=g[0],O=g[1],Z=l.getState().values["not-allowed-permissions"],w=(null===(t=l.getState().values)||void 0===t||null===(n=t["copy-base-role"])||void 0===n||null===(r=n.applications)||void 0===r?void 0:r.filter((function(e){return!(null!=b&&b.find((function(t){return t.uuid.includes(e)})))})))||[],S=c[0][0];return s().createElement("div",{className:"rbac"},b.length>0?s().createElement("div",{className:"rbac-c-selected-chips"},s().createElement(u.ChipGroup,{categoryName:"Selected permissions"},b.reduce((function(e,t){return[t].concat((0,o.Z)(e))}),[]).map((function(e){var t=e.uuid;return s().createElement(u.Chip,{key:t,color:"blue",isTruncated:!0,onClick:function(){return y(b.filter((function(e){return e.uuid!==t})))}},t)})))):null,s().createElement(u.Title,{headingLevel:"h1",size:"xl",className:"rbac-c-add-permission-title"},"Add permissions"),s().createElement(u.TextContent,null,s().createElement(u.Text,null,"Select permissions to add to your role",0!==w.length&&s().createElement(u.Popover,{headerContent:"Custom roles only support granular permissions",bodyContent:"Wildcard permissions (for example, approval:*:*) aren’t included in this table and can’t be added to your custom role."},s().createElement(u.Button,{variant:"link"},"Why am I not seeing all of my permissions? ",s().createElement(d.ZP,null))))),(null==Z?void 0:Z.length)>0&&!E?s().createElement(u.Alert,{variant:"default",isInline:!0,title:"The following permissions can not be added to a custom role and were removed from the copied role: ".concat(Z.join(", ")),actionClose:s().createElement(u.AlertActionCloseButton,{onClose:function(){return O(!0)}})}):null,[[f(f({},S),{},{props:f(f({},S.props),{},{selectedPermissions:b,setSelectedPermissions:y})})]])};v.propTypes={formFields:l().array};const b=v},94487:(e,t,n)=>{"use strict";n.d(t,{Z:()=>B});var r=n(87462),o=n(93433),i=n(29439),a=n(4942),s=n(45987),c=n(18446),l=n.n(c),u=n(92950),p=n.n(u),d=n(45697),m=n.n(d),f=n(28216),v=n(41693),b=n(48880),y=n(48623),h=n(41800),g=n(36580),E=n(15861),O=n(87757),Z=n.n(O),w=(0,n(89400).Y3)();function S(e,t,n,r,o,i,a,s,c,l,u){return j.apply(this,arguments)}function j(){return(j=(0,E.Z)(Z().mark((function e(t,n,r,o,i,a,s,c,l,u,p){return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.listPermissions(t,n,r,o,i,a,s,c,l,u,p);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t,n,r,o,i,a,s){return P.apply(this,arguments)}function P(){return(P=(0,E.Z)(Z().mark((function e(t,n,r,o,i,a,s,c){return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.listPermissionOptions(t,n,r,o,i,a,void 0,s,c);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var R={application:g.KD,resource_type:g.vf,verb:g.E2},k=n(29215),x=n(28090),C=n(57262),D=n(1936),I=["row"],L=function(e){var t=e.row,n=(0,s.Z)(e,I);return t.disableSelection?p().createElement(C.Tooltip,{content:t.disabledContent,exitDelay:1500,entryDelay:1500},p().createElement(D.RowWrapper,(0,r.Z)({className:"rbac-c-disabled-row",row:t},n))):p().createElement(D.RowWrapper,(0,r.Z)({row:t},n))};L.propTypes={props:m().object,row:m().object};var F=["selectedPermissions","setSelectedPermissions"];function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A=["Application","Resource type","Operation"],M=function(e){var t=e.permissionReducer,n=t.permission,r=t.isLoading,o=t.options,i=o.application,a=o.operation,s=o.resource,c=t.expandSplats,l=t.isLoadingExpandSplats,u=e.roleReducer,p=u.isRecordLoading,d=u.selectedRole,m=e.costReducer.resourceTypes;return{permissions:n.data.map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.application,n=e.resource_type,r=e.verb,o=e.permission,i=e.requires;return{application:t,resource:n,operation:r,uuid:o,requires:i}})),pagination:n.meta,isLoading:r||p,baseRole:d,applicationOptions:i.data.filter((function(e){return"*"!==e})),resourceOptions:s.data.filter((function(e){return"*"!==e})),operationOptions:a.data.filter((function(e){return"*"!==e})),expandedPermissions:c.data.map((function(e){return e.permission})),isLoadingExpandSplats:l,resourceTypes:m.data}},q=function(e){var t=e.selectedPermissions,n=e.setSelectedPermissions,c=(0,s.Z)(e,F),d=(0,f.useDispatch)(),m=function(e){return d((n=(t=N(N(N({},e),K?{exclude_roles:K}:{}),{},{allowed_only:!0})).limit,r=t.offset,o=t.orderBy,i=t.application,a=t.resourceType,s=t.verb,c=t.permission,u=void 0===(l=t.exclude_globals)||l,p=t.exclude_roles,m=t.allowed_only,f=t.options,{type:g.wI,payload:S(n,r,o,i,a,s,c,u,p,m,f)}));var t,n,r,o,i,a,s,c,l,u,p,m,f},E=function(e){return d((n=(t=N(N({},e),{},{allowedOnly:!0})).field,r=t.limit,o=t.offset,i=t.application,a=t.resourceType,s=t.verb,c=t.allowedOnly,l=t.options,{type:R[n],payload:T(n,r,o,i,a,s,c,l)}));var t,n,r,o,i,a,s,c,l},O=(0,f.useSelector)(M,f.shallowEqual),Z=O.permissions,w=O.isLoading,j=O.pagination,P=O.baseRole,C=O.applicationOptions,D=O.resourceOptions,I=O.operationOptions,_=O.expandedPermissions,q=O.isLoadingExpandSplats,B=O.resourceTypes,G=(0,v.Z)(c).input,V=(0,b.default)(),z=(0,u.useState)({applications:[],resources:[],operations:[]}),W=(0,i.Z)(z,2),H=W[0],U=W[1],X=V.getState().values["role-type"],K=V.getState().values["role-uuid"],Y=(0,u.useState)(!1),Q=(0,i.Z)(Y,2),$=Q[0],J=Q[1],ee=(0,u.useState)(""),te=(0,i.Z)(ee,2),ne=te[0],re=te[1],oe=(0,u.useState)(),ie=(0,i.Z)(oe,2),ae=ie[0],se=ie[1],ce=function(e){return B.find((function(t){var n;return t.value===(null===(n=e.split(":"))||void 0===n?void 0:n[1])}))},le=(0,u.useCallback)((0,y.Z)((function(e){var t=e.applications,n=e.resources,r=e.operations;return E({field:"application",limit:50,application:t.join(),resourceType:n.join(),verb:r.join()})}),2e3),[]),ue=(0,u.useCallback)((0,y.Z)((function(e){var t=e.applications,n=e.resources,r=e.operations;return E({field:"resource_type",limit:50,application:t.join(),resourceType:n.join(),verb:r.join()})}),2e3),[]),pe=(0,u.useCallback)((0,y.Z)((function(e){var t=e.applications,n=e.resources,r=e.operations;return E({field:"verb",limit:50,application:t.join(),resourceType:n.join(),verb:r.join()})}),2e3),[]);(0,u.useEffect)((function(){var e,t=null===(e=V.getState().values["copy-base-role"])||void 0===e?void 0:e.uuid;return"copy"===X&&t&&d((0,x.fp)(t)),d((0,k.A)()),V.change("has-cost-resources",!1),m(j),E({field:"application",limit:50}),E({field:"resource_type",limit:50}),E({field:"verb",limit:50}),function(){return d({type:g.e0,payload:{data:[]}})}}),[]),(0,u.useEffect)((function(){ue(H),pe(H)}),[H.applications]),(0,u.useEffect)((function(){le(H),pe(H)}),[H.resources]),(0,u.useEffect)((function(){le(H),ue(H)}),[H.operations]),(0,u.useEffect)((function(){G.onChange(t)}),[t]),(0,u.useEffect)((function(){var e;if(!(!P||"copy"!==X||V.getState().values["base-permissions-loaded"]||t.length>0||(null===(e=V.getState().values["copy-base-role"])||void 0===e?void 0:e.uuid)!==(null==P?void 0:P.uuid)||q||w)){var r,i,a,s,c,l,u,p,m,f,v,b,y,h=[],E=(null==P?void 0:P.access.filter((function(e){var t;return!!C.includes(null==e||null===(t=e.permission)||void 0===t?void 0:t.split(":")[0])||(h.push(e),!1)})))||[];if(V.change("not-allowed-permissions",h.map((function(e){return e.permission}))),0===_.length&&void 0===q){var O=(0,o.Z)(new Set(E.map((function(e){return e.permission.split(":")[0]}))));d((a=void 0===(i=(r={application:O.join()}).limit)?1e3:i,c=void 0===(s=r.offset)?0:s,l=r.orderBy,u=r.application,p=r.resourceType,m=r.verb,f=r.permission,b=void 0===(v=r.exclude_globals)||v,y=r.options,{type:g.e,payload:S(a,c,l,u,p,m,f,b,y)}))}else{var Z=E.map((function(e){return e.permission.replace("*",".*")}));n((function(){return _.filter((function(e){return"cost-management"!==e.split(":")[0]||0!==(ce(e)||{count:0}).count})).filter((function(e){return Z.some((function(t){return e.match(t)}))})).map((function(e){return{uuid:e}}))})),V.change("base-permissions-loaded",!0)}}}),[Z,P]);var de=function(e){return e.reduce((function(e,t){return{"":N(N({},null==e?void 0:e[""]),{},(0,a.Z)({},t,!0))}}),{"":{}})},me={applications:(0,o.Z)(C).filter((function(e){return e.includes(ne)})).map((function(e){return{label:e,value:e}})),resources:(0,o.Z)(D).filter((function(e){return e.includes(ne)})).map((function(e){return{label:e,value:e}})),operations:(0,o.Z)(I).filter((function(e){return e.includes(ne)})).map((function(e){return{label:e,value:e}}))},fe={label:p().createElement("div",null," No results found"),isDisabled:!0},ve=me[Object.keys(me)[ae||0]].length>10;return p().createElement("div",{className:"rbac-c-permissions-table"},p().createElement(h.M,(0,r.Z)({columns:A,isSelectable:!0,isCompact:!0,borders:!1,createRows:function(e){return e.map((function(e){var n=e.application,r=e.resource,o=e.operation,i=e.uuid,a=e.requires;return{uuid:"".concat(n,":").concat(r,":").concat(o),requires:a,cells:[{title:n},r,o],selected:Boolean(t&&t.find((function(e){return e.uuid===i}))),disableSelection:"cost-management"===n&&0===(ce(i)||{count:0}).count,disabledContent:p().createElement("div",null,"To add this permission to your role and define specific resources for it, at least one data source must be connected."," ",p().createElement("a",{href:"./settings/sources"},"Configure sources for Cost Management"))}}))},data:Z,filterValue:"",noData:0===(null==Z?void 0:Z.length),noDataDescription:["The permission either does not exist or has already been added to this role. Adjust your filters and try again. Note: Applications that only have wildcard permissions (for example, compliance:*:*) aren't included in this table and can't be added to your custom role."],fetchData:function(e){var t=e.limit,n=e.offset,r=e.applications,o=e.resources,i=e.operations;m({limit:t,offset:n,application:(r||H.applications).join(),resourceType:(o||H.resources).join(),verb:(i||H.operations).join()})},setFilterValue:function(e){var t=e.applications,n=e.resources,r=e.operations;U(N(N(N(N({},H),t?{applications:t}:H.applications),n?{resources:n}:H.resources),r?{operations:r}:H.operations))},isLoading:w||q,pagination:N(N({},j),{},{count:j.count}),checkedRows:t,setCheckedItems:function(e){var r=e(t).filter((function(e){var t,n=e.uuid;return"cost-management"!==e.application||(null===(t=ce(n))||void 0===t?void 0:t.count)>0})).map((function(e){return{uuid:e.uuid,requires:e.requires}}));n(l()(r,t)?[]:r)},titlePlural:"permissions",titleSingular:"permission",showMoreTitle:$?"See less":"See more",onFilter:function(e){return re(e)},onShowMore:ve?function(){J((function(){return!$}))}:void 0,onChange:function(e,t){re(""),se(t)},value:ae,filters:[{key:"applications",value:H.applications,placeholder:"Filter by application",type:"group",selected:de(H.applications),groups:[{type:me.applications.length>0?"checkbox":"plain",items:me.applications.length>0?(0,o.Z)(me.applications).slice(0,$?void 0:10):[fe]}]},{key:"resources",value:H.resources,placeholder:"Filter by resource type",type:"group",selected:de(H.resources),groups:[{type:me.resources.length>0?"checkbox":"plain",items:me.resources.length>0?(0,o.Z)(me.resources).slice(0,$?void 0:10):[fe]}]},{key:"operations",value:H.operations,placeholder:"Filter by operation",type:"group",selected:de(H.operations),groups:[{type:me.operations.length>0?"checkbox":"plain",items:me.operations.length>0?(0,o.Z)(me.operations).slice(0,$?void 0:10):[fe]}]}],isFilterable:!0,rowWrapper:L,tableId:"add-role-permissions"},c)))};q.propTypes={selectedPermissions:m().array,setSelectedPermissions:m().func};const B=q},64105:(e,t,n)=>{"use strict";n.d(t,{Z:()=>y});var r=n(29439),o=n(93433),i=n(4942),a=n(92950),s=n.n(a),c=n(28216),l=n(57262),u=n(41693),p=n(48880),d=n(29215);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v=function(e){var t=e.costReducer,n=t.resourceTypes,r=t.isLoading,o=t.loadingResources,i=t.resources;return{resourceTypes:n.data,resources:i,isLoading:r,isLoadingResources:o>0}},b=function(e,t){var n=e[t.key];switch(t.type){case"toggle":return f(f({},e),{},(0,i.Z)({},t.key,f(f({},n),{},{isOpen:!n.isOpen})));case"select":return f(f({},e),{},(0,i.Z)({},t.key,f(f({},n),{},{selected:n.selected.includes(t.selection)?n.selected.filter((function(e){return e!==t.selection})):[].concat((0,o.Z)(n.selected),[t.selection])})));case"selectAll":return f(f({},e),{},(0,i.Z)({},t.key,f(f({},n),{},{selected:n.options.map((function(e){return e.value}))})));case"clear":return f(f({},e),{},(0,i.Z)({},t.key,f(f({},n),{},{selected:[]})));case"setOptions":return f(f({},e),{},(0,i.Z)({},t.key,f(f({},n),{},{options:t.options,filteredOptions:t.options})));case"setFilter":return f(f({},e),{},(0,i.Z)({},t.key,f(f({},n),{},{filteredOptions:n.options.filter((function(e){return e.value.includes(t.filtervalue)}))})));default:return e}};const y=function(e){var t=(0,c.useDispatch)(),n=(0,c.useSelector)(v,c.shallowEqual),m=n.resourceTypes,y=n.isLoading,h=n.isLoadingResources,g=n.resources,E=(0,u.Z)(e).input,O=(0,p.default)(),Z=O.getState().values["add-permissions-table"].filter((function(e){return e.uuid.split(":")[0].includes("cost-management")})),w=(0,a.useReducer)(b,Z.reduce((function(e,t){return f(f({},e),{},(0,i.Z)({},t.uuid,{selected:[],options:[],filteredOptions:[],isOpen:!1}))}),{})),S=(0,r.Z)(w,2),j=S[0],T=S[1];return(0,a.useEffect)((function(){(O.getState().values["resource-definitions"]||[]).map((function(e){var t=e.permission;return e.resources.map((function(e){return Z.find((function(e){return(null==e?void 0:e.uuid)===t}))&&T({type:"select",selection:e,key:t})}))})),t((0,d.A)(undefined)),O.change("has-cost-resources",!0)}),[]),(0,a.useEffect)((function(){y||(0,o.Z)(new Set(Z.map((function(e){var t;return null===(t=m.find((function(t){var n;return t.value===(null===(n=e.uuid.split(":"))||void 0===n?void 0:n[1])})))||void 0===t?void 0:t.path})))).filter((function(e){return e})).map((function(e){return n=e,t((0,d.R)(n));var n}))}),[m]),(0,a.useEffect)((function(){h||Z.map((function(e){return T({type:"setOptions",key:e.uuid,options:g[(t=e.uuid,null===(n=m.find((function(e){var n;return e.value===(null===(n=t.split(":"))||void 0===n?void 0:n[1])})))||void 0===n||null===(r=n.path.split("/"))||void 0===r?void 0:r[5])]||[]});var t,n,r}))}),[h]),(0,a.useEffect)((function(){var e=Object.entries(j).map((function(e){var t=(0,r.Z)(e,2);return{permission:t[0],resources:t[1].selected}}));E.onChange(e),O.change("resource-definitions",e)}),[j]),s().createElement(l.Grid,{hasGutter:!0},s().createElement(l.GridItem,{md:4,className:"rbac-m-hide-on-sm"},s().createElement(l.Text,{component:l.TextVariants.h4,className:"rbac-bold-text"},"Permissions")),s().createElement(l.GridItem,{md:8,className:"rbac-m-hide-on-sm"},s().createElement(l.Text,{component:l.TextVariants.h4,className:"rbac-bold-text"},"Resource definitions")),Z.map((function(e){var t=e.uuid,n=j[t].filteredOptions;return s().createElement(s().Fragment,null,s().createElement(l.GridItem,{md:4,sm:12},s().createElement(l.Tooltip,{content:s().createElement("div",null,t)},s().createElement(l.FormGroup,{label:t.replace(/^cost-management:/,""),isRequired:!0}))),s().createElement(l.GridItem,{md:8,sm:12},s().createElement(l.Select,{className:"rbac-m-cost-resource-select",variant:l.SelectVariant.checkbox,typeAheadAriaLabel:"Select a state",onToggle:function(e){T({type:"setFilter",key:t,filtervalue:""}),function(e,t){T({type:"toggle",key:e,isOpen:t})}(t,e)},onSelect:function(e,r){!function(e,t,n,r){T(n?{type:"selectAll",selection:t,key:r}:{type:"select",selection:t,key:r})}(0,r,r==="Select All (".concat(n.length,")"),t)},onClear:function(){return T({type:"clear",key:t})},selections:j[t].selected,isOpen:j[t].isOpen,onFilter:function(e){return e&&T({type:"setFilter",key:t,filtervalue:e.target.value})},"aria-labelledby":t,placeholderText:"Select resources",hasInlineFilter:!0},[s().createElement(l.SelectOption,{key:0,value:"Select All (".concat(n.length,")")})].concat((0,o.Z)(n.map((function(e,t){return s().createElement(l.SelectOption,{key:t+1,value:e.value})})))))))})))}},88040:(e,t,n)=>{"use strict";n.d(t,{Z:()=>j});var r=n(87462),o=n(29439),i=n(92950),a=n.n(i),s=n(45697),c=n.n(s),l=n(96354),u=n(64124),p=n(40483),d=n(36457),m=n(67115),f=n(334),v=n(28216),b=n(76254),y=n(71355),h=n(43115),g=n(57666),E=n(28090),O=function(e,t,n){return e.length<150?(0,h.vd)({name:e}).then((function(r){var o=r.data;if(0!==o.length&&o.some((function(r){return r[t]!==n&&r.display_name===e})))throw"Role with this name already exists."})):Promise.reject("Can have maximum of 150 characters.")},Z=function(e){return{fields:[{name:"name",component:l.Z.TEXT_FIELD,label:"Name",isRequired:!0,validate:[{type:"validate-role-name",id:e,idKey:"uuid",validationPromise:O}]},{name:"description",component:l.Z.TEXTAREA,label:"Description",validate:[{type:u.Z.MAX_LENGTH,threshold:150}]}]}},w=(0,g.Z)((function(e,t,n,r){return e&&0!==e.length?r(e,t,n):Promise.reject("Required")})),S=function(e){var t=e.routeMatch,n=e.cancelRoute,s=e.submitRoute,c=void 0===s?n:s,l=e.afterSubmit,u=(0,m.Z)(),g=(0,f.useRouteMatch)(t).params.id,O=(0,f.useHistory)(),S=O.replace,j=O.push,T=(0,v.useDispatch)(),P={"validate-role-name":function(e){var t=e.idKey,n=e.id,r=e.validationPromise;return function(e){return w(e,t,n,r)}}},R=(0,v.useSelector)((function(e){return(0,b.z)(e,g)})),k=(0,i.useState)(R),x=(0,o.Z)(k,2),C=x[0],D=x[1],I=function(){T((0,y.wN)({variant:"warning",dismissDelay:8e3,dismissable:!1,title:"Editing role",description:"Edit role was canceled by the user."})),S(n)};return(0,i.useEffect)((function(){!C&&(0,h.fp)(g).then((function(e){u.current&&D(e)}))}),[g]),C?a().createElement(d.Z,{schema:Z(g),initialValues:C,onSubmit:function(e){return T((0,E.sZ)(g,{name:e.name,display_name:e.name,description:e.description})).then((function(){l(),j(c)}))},onCancel:I,validatorMapper:P,FormTemplate:function(e){return a().createElement(p.Z,(0,r.Z)({},e,{ModalProps:{onClose:I,isOpen:!0,variant:"small",title:"Edit role information"}}))}}):null};S.propTypes={routeMatch:c().string.isRequired,cancelRoute:c().oneOfType([c().string,c().shape({pathname:c().string.isRequired,search:c().string,hash:c().string})]).isRequired,submitRoute:c().oneOfType([c().string,c().shape({pathname:c().string.isRequired,search:c().string,hash:c().string})]),afterSubmit:c().func.isRequired};const j=S},13063:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r=n(29439),o=n(92950),i=n.n(o),a=n(45697),s=n.n(a),c=n(28216),l=n(334),u=n(69957),p=n(57262),d=n(83215),m=n(28090),f=n(43115),v=n(67115),b=n(76254),y=function(e){var t=e.routeMatch,n=e.cancelRoute,a=e.submitRoute,s=void 0===a?n:a,y=e.afterSubmit,h=(0,v.Z)(),g=(0,l.useRouteMatch)(t).params.id,E=(0,c.useSelector)((function(e){return(0,b.B)(e,g)})),O=(0,o.useState)(!0),Z=(0,r.Z)(O,2),w=Z[0],S=Z[1],j=(0,o.useState)(E),T=(0,r.Z)(j,2),P=T[0],R=T[1],k=(0,c.useDispatch)(),x=(0,l.useHistory)(),C=x.push,D=x.replace;(0,o.useEffect)((function(){!P&&(0,f.fp)(g).then((function(e){h.current&&R(e.display_name)})).catch((function(e){var t,n;return k((0,d.wN)({variant:"danger",title:"Could not get role",description:null==e||null===(t=e.errors)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.detail}))}))}),[]);var I=function(){return D(n)};return P?i().createElement(p.Modal,{className:"rbac","aria-label":"remove-role",header:i().createElement(p.TextContent,null,i().createElement(p.Split,{hasGutter:!0},i().createElement(p.SplitItem,null,i().createElement(u.ZP,{size:"lg",style:{fill:"#f0ab00"}})),i().createElement(p.SplitItem,null,i().createElement(p.Text,{component:"h1"},"Delete role?")))),isOpen:!0,variant:"small",onClose:I,actions:[i().createElement(p.Button,{isDisabled:w,key:"submit",variant:"danger",type:"button",id:"confirm-delete-portfolio",onClick:function(){return k((0,m.l5)(g)).then((function(){return C(s),y()}))}},"Confirm"),i().createElement(p.Button,{key:"cancel",variant:"link",type:"button",onClick:I},"Cancel")]},i().createElement(p.TextContent,null,i().createElement(p.Text,{component:p.TextVariants.p},"The ",i().createElement("strong",null,P)," role will be removed from any group it’s in, and members in the groups will no longer be granted the permissions in the role."),i().createElement(p.Checkbox,{id:"remove-role-checkbox",label:"I understand that this action cannot be undone.",isChecked:!w,onChange:function(){return S((function(e){return!e}))}}))):null};y.propTypes={routeMatch:s().string.isRequired,cancelRoute:s().oneOfType([s().string,s().shape({pathname:s().string.isRequired,search:s().string,hash:s().string})]).isRequired,submitRoute:s().oneOfType([s().string,s().shape({pathname:s().string.isRequired,search:s().string,hash:s().string})]),afterSubmit:s().func.isRequired};const h=y},76254:(e,t,n)=>{"use strict";n.d(t,{B:()=>o,z:()=>r});var r=function(e,t){var n=e.roleReducer,r=n.roles,o=void 0===r?{data:[]}:r,i=n.selectedRole;return(null==i?void 0:i.uuid)===t?i:o.data.find((function(e){return e.uuid===t}))},o=function(e,t){var n;return null===(n=r(e,t))||void 0===n?void 0:n.display_name}},15608:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Re});var r,o=n(93433),i=n(4942),a=n(29439),s=n(92950),c=n.n(s),l=n(45697),u=n.n(l),p=n(334),d=n(28216),m=n(57262),f=n(39173),v=n(4682),b=n(28090),y=n(38376),h=n(19571),g=n(41800),E=n(45987),O=n(64107),Z=n(11107),w=n(61338),S=n(85564),j=n.n(S),T=["count"],P=["type"];function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x={pagination:w.he,selectedPermissions:[],showRemoveModal:!1,confirmDelete:function(){return null},deleteInfo:{},filters:{applications:[],resources:[],operations:[]},isToggled:!1,resources:[],operations:[]},C="SET_PAGINATION",D="SELECT_PERMISSIONS",I="SHOW_REMOVE_MODAL",L="SUBMIT_REMOVE_MODAL",F="INITIATE_REMOVE_PERMISSION",_="SET_FILTERS",N="SET_TOGGLED",A="INITIALIZE_ROLE",M=(r={},(0,i.Z)(r,C,(function(e,t){return k(k({},e),{},{pagination:k(k({},e.pagination),t)})})),(0,i.Z)(r,D,(function(e,t){var n=t.selection;return k(k({},e),{},{selectedPermissions:n})})),(0,i.Z)(r,I,(function(e,t){var n=t.showRemoveModal;return k(k({},e),{},{showRemoveModal:n})})),(0,i.Z)(r,L,(function(e){return k(k({},e),{},{selectedPermissions:[],showRemoveModal:!1})})),(0,i.Z)(r,F,(function(e,t){var n=t.confirmDelete,r=t.deleteInfo;return k(k({},e),{},{confirmDelete:n,showRemoveModal:!0,deleteInfo:r})})),(0,i.Z)(r,_,(function(e,t){return k(k({},e),{},{filters:k(k({},e.filters),t)})})),(0,i.Z)(r,N,(function(e){return k(k({},e),{},{isToggled:!e.isToggled})})),(0,i.Z)(r,A,(function(e,t){var n=t.count,r=(0,E.Z)(t,T);return k(k(k({},e),r),{},{pagination:k(k({},e.pagination),{},{count:n})})})),r),q=function(e,t){var n=t.type,r=(0,E.Z)(t,P);return M[n]?M[n](e,r):e},B=n(1936),G=n(15861),V=n(87462),z=n(87757),W=n.n(z),H=n(48880);var U=n(68778),X=function(e){var t=e.currentRoleID,n=(0,d.useDispatch)();return c().createElement(c().Fragment,null,c().createElement(m.EmptyState,null,c().createElement(m.EmptyStateIcon,{color:"green",icon:U.ZP}),c().createElement(m.Title,{headingLevel:"h4",size:"lg"},"You have successfully added permissions to the role"),c().createElement(m.EmptyStateBody,null),c().createElement(p.Link,{to:"/roles/detail/".concat(t)},c().createElement(m.Button,{onClick:function(){return n((0,b.fp)(t))}},"Exit"))))};const K=X;X.propTypes={currentRoleID:u().string.isRequired};var Y=n(73943),Q=n(93025),$=n(67850),J=n(46966),ee=n(94487),te=n(64105),ne=n(94852);function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ie=function(e){var t,n=e.formFields;return(0,s.useContext)(pe).submitting?c().createElement(m.Bullseye,null,c().createElement(m.Spinner,{size:"xl"})):c().createElement("div",{className:"rbac"},[[oe({},null==n||null===(t=n[0])||void 0===t?void 0:t[0])]])};ie.propTypes={formFields:u().array};const ae=ie;function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var le=function(e){return c().createElement($.ZP,(0,V.Z)({},e,{showFormControls:!1}))},ue={"add-permissions-table":ee.Z,"cost-resources":te.Z,review:function(){var e=(0,H.default)().getState().values,t=e["role-name"],n=e["role-description"],r=e["add-permissions-table"],o=e["resource-definitions"],i=e["has-cost-resources"];return c().createElement(m.Stack,{hasGutter:!0},c().createElement(m.StackItem,null,c().createElement(m.TextContent,null,c().createElement(m.Title,{headingLevel:"h1",size:"xl",className:"pf-u-mb-sm"},"Review details"))),c().createElement(m.StackItem,{className:"rbac-l-stack__item-summary"},c().createElement(m.Grid,{hasGutter:!0},c().createElement(m.GridItem,{span:3},c().createElement(m.Text,{className:"pf-c-title",component:m.TextVariants.h6},"Role name")),c().createElement(m.GridItem,{span:9},c().createElement(m.Text,{component:m.TextVariants.p},t)),c().createElement(m.GridItem,{span:3},c().createElement(m.Text,{className:"pf-c-title",component:m.TextVariants.h6},"Role description")),c().createElement(m.GridItem,{span:9},c().createElement(m.Text,{component:m.TextVariants.p},n)),c().createElement(m.GridItem,{span:3},c().createElement(m.Text,{className:"pf-c-title",component:m.TextVariants.h6},"Added permissions")),c().createElement(m.GridItem,{span:9},c().createElement(m.TextContent,{component:m.TextVariants.p},r.map((function(e,t){return c().createElement(m.Text,{key:t}," ",e.uuid," ")})))),i&&c().createElement(c().Fragment,null,c().createElement(m.GridItem,{span:3},c().createElement(m.Text,{className:"pf-c-title",component:m.TextVariants.h6},"Resource definitions")),c().createElement(m.GridItem,{span:9},c().createElement(m.TextContent,{component:m.TextVariants.p},o.map((function(e){return e.resources.map((function(e,t){return c().createElement(m.Text,{key:t}," ",e," ")}))}))))))))}},pe=(0,s.createContext)({success:!1,submitting:!1,error:void 0}),de=function(e){var t=e.role,n=(0,s.useState)(!1),r=(0,a.Z)(n,2),i=r[0],l=r[1],u=(0,s.useState)(""),f=(0,a.Z)(u,2),v=f[0],y=f[1],h=(0,s.useState)({}),g=(0,a.Z)(h,2),E=g[0],O=g[1],Z=(0,p.useHistory)(),w=(0,d.useDispatch)(),S=(0,s.useState)({success:!1,submitting:!1,error:void 0,hideForm:!1}),j=(0,a.Z)(S,2),T=j[0],P=j[1],R=(0,s.useRef)(document.createElement("div"));(0,s.useEffect)((function(){O(function(e){return{fields:[{component:"wizard",name:"wizard",isDynamic:!0,inModal:!0,showTitles:!0,crossroads:["role-type"],title:"Add permissions",container:e,fields:[{name:"add-permissions",title:"Add permissions",StepTemplate:ne.Z,nextStep:function(e){var t=e.values;return t&&t["add-permissions-table"]&&t["add-permissions-table"].some((function(e){return e.uuid.split(":")[0].includes("cost-management")}))?"cost-resources-definition":"review"},fields:[{component:"add-permissions-table",name:"add-permissions-table"}]},{name:"cost-resources-definition",title:"Define Cost Management resources",nextStep:"review",fields:[{component:"plain-text",name:"text-description",label:c().createElement("p",null,"Specify where you would like to apply each cost permission selected in the previous step, using the dropdown below.")},{component:"cost-resources",name:"cost-resources",validate:[function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).every((function(e){return e.resources.length>0}))?void 0:"You need to assign at least one resource to each permission."}]}]},{name:"review",title:"Review details",StepTemplate:ae,fields:[{component:"review",name:"review"}]}]}]}}(R.current))}),[]),(0,s.useEffect)((function(){y(t.uuid)})),(0,s.useEffect)((function(){R.current.hidden=i}),[i]);var k=function(){Z.push("/roles/detail/".concat(t.uuid))},x=function(){var e=(0,G.Z)(W().mark((function e(n){var r,i,a,s;return W().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n["add-permissions-table"],i=n["cost-resources"],a=[].concat((0,o.Z)(t.access.map((function(e){return e.permission}))),(0,o.Z)(r.map((function(e){return e.uuid})))),s=ce(ce({},t),{},{access:(0,o.Z)(r.reduce((function(e,t){var n=t.uuid,r=t.requires;return[].concat((0,o.Z)(e),(0,o.Z)([n].concat((0,o.Z)(r.filter((function(e){return!a.includes(e)})))).map((function(e){return{permission:e,resourceDefinitions:null!=i&&i.find((function(t){return t.permission===e}))?[{attributeFilter:{key:"cost-management.".concat(e.split(":")[1]),operation:"in",value:null==i?void 0:i.find((function(t){return t.permission===e})).resources}}]:[]}}))))}),t.access)),accessCount:t.accessCount+r.length}),P((function(e){return ce(ce({},e),{},{submitting:!0})})),w((0,b.ul)(v,s)).then((function(){return P((function(e){return ce(ce({},e),{},{submitting:!1,success:!0,hideForm:!0})}))})).catch((function(){P((function(e){return ce(ce({},e),{},{submitting:!1,success:!1,hideForm:!0})})),Z.push("/roles/detail/".concat(t.uuid))}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return c().createElement(pe.Provider,{value:ce(ce({},T),{},{setWizardError:function(e){return P((function(t){return ce(ce({},t),{},{error:e})}))},setWizardSuccess:function(e){return P((function(t){return ce(ce({},t),{},{success:e})}))},setHideForm:function(e){return P((function(t){return ce(ce({},t),{},{hideForm:e})}))},rolePermissions:t.access})},c().createElement(Y.R,{type:"Permission",isOpen:i,onModalCancel:function(){return l(!1)},onConfirmCancel:k}),T.hideForm?T.success?c().createElement(m.Wizard,{title:"Add permissions",isOpen:!0,steps:[{name:"success",component:new K({currentRoleID:v}),isFinishedStep:!0}]}):null:c().createElement(Q.Z,{container:R,schema:E,subscription:{values:!0},FormTemplate:le,initialValues:{"role-uuid":t.uuid,"role-type":"create","role-name":t.display_name,"role-description":t.description},componentMapper:ce(ce({},J.ZP),ue),onSubmit:x,onCancel:function(e){var t;e&&(null===(t=e["add-permissions-table"])||void 0===t?void 0:t.length)>0?l(!0):k()}}))};de.defaultProps={role:{}},de.propTypes={role:u().object};const me=de;var fe=n(1227);function ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ye=[{title:"Application"},{title:"Resource type"},{title:"Operation"},{title:"Resource definitions",transforms:[(0,B.info)({popover:"Resource definitions only apply to Cost Management permissions",ariaLabel:"Resource definitions only apply to Cost Management permissions"})]},{title:"Last commit",transforms:[(0,B.cellWidth)(15)]}],he=function(e,t,n){return n?c().createElement("p",null,"The ",c().createElement("b",null," ","".concat(e))," selected permissions will no longer be granted through the ",c().createElement("b",null,"".concat(t.name))," role."):c().createElement("p",null,"The ",c().createElement("b",null,"".concat(e))," permission will no longer be granted through the ",c().createElement("b",null," ","".concat(t.name))," role.")};const ge=function(){var e=(0,d.useSelector)((function(e){return{role:e.roleReducer.selectedRole,isRecordLoading:e.roleReducer.isRecordLoading}}),d.shallowEqual),t=e.role,n=e.isRecordLoading,r=(0,p.useHistory)(),l=(0,s.useReducer)(q,x),u=(0,a.Z)(l,2),f=u[0],y=f.pagination,h=f.selectedPermissions,E=f.showRemoveModal,w=f.confirmDelete,S=f.deleteInfo,T=f.filters,P=f.isToggled,R=f.resources,k=f.operations,M=u[1],B=(0,s.useState)(!0),G=(0,a.Z)(B,2),V=G[0],z=G[1],W=(0,d.useDispatch)();(0,s.useEffect)((function(){var e;if(Object.keys(t).length>0){var n=Object.entries(t.access.reduce((function(e,t){var n=e.resources,r=e.operations,i=t.permission.split(":"),s=(0,a.Z)(i,3),c=s[1],l=s[2];return{resources:n.includes(c)?n:[].concat((0,o.Z)(n),[c]),operations:r.includes(l)?r:[].concat((0,o.Z)(r),[l])}}),{resources:[],operations:[]})).reduce((function(e,t){var n=(0,a.Z)(t,2),r=n[0],o=n[1];return be(be({},e),{},(0,i.Z)({},r,o.map((function(e){return{label:e,value:e}}))))}),{}),r=n.resources,s=n.operations;M({type:A,resources:r,operations:s,count:t.access?t.access.length:0})}z(null==t||null===(e=t.access)||void 0===e?void 0:e.find((function(e){return e.permission.includes("cost-management")})))}),[t]);var H,U,X=t&&t.access?(t.access||[]).filter((function(e){var t=e.permission.split(":"),n=(0,a.Z)(t,3),r=n[0],o=n[1],i=n[2],s=T.applications,c=T.resources,l=T.operations;return(!(s.length>0)||s.includes(r))&&(!(c.length>0)||c.includes(o))&&(!(l.length>0)||l.includes(i))})).map((function(e){return be(be({uuid:e.permission},e),{},{modified:t.modified})})):[],K=function(e){var n=e.reduce((function(e,t){return[].concat((0,o.Z)(e),[t.uuid])}),[]);return W((0,b.lq)(t,n)).then((function(){W((0,b.fp)(t.uuid)),M({type:D,selection:[]})}))},Y=function(e){return e.reduce((function(e,t){return{"":be(be({},null==e?void 0:e[""]),{},(0,i.Z)({},t,!0))}}),{"":{}})},Q={label:c().createElement("div",null," No results found"),isDisabled:!0},$=be({access:[],applications:[]},t),J=Object.values({applications:$.applications,operations:k,resources:R}).find((function(e){return e.length>10}));return c().createElement("section",{className:"pf-c-page__main-section rbac-c-role__permissions"},E&&c().createElement(fe.Z,{text:S.text,title:S.title,isOpen:E,confirmButtonLabel:S.confirmButtonLabel,onClose:function(){return M({type:I,showRemoveModal:!1})},onSubmit:function(){w(),M({type:L})}}),c().createElement(g.M,{columns:V?ye:ye.filter((function(e){return"Resource definitions"!==e.title})),createRows:(H=V,U=null==t?void 0:t.uuid,function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.reduce((function(e,t){var r=t.resourceDefinitions,i=t.permission,l=t.modified,u=i.split(":"),d=(0,a.Z)(u,3),m=d[0],f=d[1],v=d[2];return[].concat((0,o.Z)(e),[{uuid:i,cells:[m,f,v].concat((0,o.Z)(H?[i.includes("cost-management")&&r.length>0?c().createElement(s.Fragment,{key:"resource-definitions"},c().createElement(p.Link,{to:"/roles/detail/".concat(U,"/permission/").concat(i)},j()(r.map((function(e){return e.attributeFilter.value}))).length)):c().createElement("span",{className:"rbac-c-text__disabled"},"N/A")]:[]),[c().createElement(s.Fragment,{key:"".concat(m,"-modified")},c().createElement(O.Z,{date:l,type:(0,Z.mh)(l)}))]),selected:Boolean(null==n?void 0:n.find((function(e){return e.uuid===i})))}])}),[])}),actionResolver:t.system?void 0:function(){return[{title:"Remove",onClick:function(e,n,r){return M({type:F,confirmDelete:function(){return K([r])},deleteInfo:{title:"Remove permission?",text:he(r.uuid,t,!1),confirmButtonLabel:"Remove permission"}})}}]},data:X.slice(y.offset,y.offset+y.limit),filterValue:"",ouiaId:"role-permissions-table",fetchData:function(e){var t=e.limit,n=e.offset;return M({type:C,limit:t,offset:n})},isSelectable:!t.system,setCheckedItems:function(e){M({type:D,selection:e(h).map((function(e){return{uuid:e.uuid}}))})},checkedRows:h,onShowMore:J?function(){M({type:N})}:void 0,setFilterValue:function(e){var t=e.applications,n=e.resources,r=e.operations;M(be(be(be({type:_},t?{applications:t}:T.applications),n?{resources:n}:T.resources),r?{operations:r}:T.operations))},toolbarButtons:function(){return[c().createElement(p.Link,{to:"/roles/detail/".concat(t.uuid,"/role-add-permission"),key:"role-add-permission",className:"rbac-m-hide-on-sm"},c().createElement(m.Button,{variant:"primary","aria-label":"Add Permission"},"Add permissions")),{label:"Add Permission",props:{className:"rbac-m-hide-on-md"},onClick:function(){r.push("/roles/detail/".concat(t.uuid,"/role-add-permission"))}},{label:"Remove",props:{isDisabled:!h.length>0},onClick:function(){var e=h.length>1;M({type:F,confirmDelete:function(){return K((0,o.Z)(h))},deleteInfo:{title:e?"Remove permissions?":"Remove permission?",text:he(e?h.length:h[0].uuid,t,h.length>1),confirmButtonLabel:e?"Remove permissions":"Remove permission"}})}}]},isLoading:n,pagination:be(be({},y),{},{count:X.length}),titlePlural:"permissions",titleSingular:"permission",routes:function(){return c().createElement(p.Route,{exact:!0,path:v.Z["role-add-permission"].path},c().createElement(me,{isOpen:!0,role:t}))},emptyProps:{title:"There are no permissions in this role",description:["To configure user access to applications,","add at least one permission to this role.",""]},filters:[{key:"applications",value:0===T.applications.length?"":T.applications,placeholder:"Filter by application",type:"group",selected:Y(T.applications),groups:[{type:$.applications.length>0?"checkbox":"plain",items:$.applications.length>0?$.applications.slice(0,P?void 0:10).map((function(e){return{label:e,value:e}})):[Q]}]},{key:"resources",value:0===T.resources.length?"":T.resources,placeholder:"Filter by resource type",type:"group",selected:Y(T.resources),groups:[{type:R.length>0?"checkbox":"plain",items:R.length>0?R.slice(0,P?void 0:10):[Q]}]},{key:"operations",value:0===T.operations.length?"":T.operations,placeholder:"Filter by operation",type:"group",selected:Y(T.operations),groups:[{type:k.length>0?"checkbox":"plain",items:k.length>0?k.slice(0,P?void 0:10):[Q]}]}]}))};var Ee=n(19756),Oe=n(13063),Ze=n(88040),we=n(67643),Se=n(16796);function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pe=function(e){var t=e.onDelete,n=(0,p.useHistory)(),r=(0,s.useState)(!1),i=(0,a.Z)(r,2),l=i[0],u=i[1],g=(0,p.useParams)(),E=g.uuid,O=g.groupUuid,S=(0,d.useSelector)((function(e){var t,n,r,o,i,a,s,c,l;return Te(Te({role:e.roleReducer.selectedRole,isRecordLoading:e.roleReducer.isRecordLoading},O&&{group:e.groupReducer.selectedGroup}),{},{systemGroupUuid:null===(t=e.groupReducer.systemGroup)||void 0===t?void 0:t.uuid,rolesPagination:(null===(n=e.roleReducer)||void 0===n||null===(r=n.roles)||void 0===r?void 0:r.pagination)||w.he,rolesFilters:(null===(o=e.roleReducer)||void 0===o||null===(i=o.roles)||void 0===i?void 0:i.filters)||{},groupsPagination:(null===(a=e.groupReducer)||void 0===a||null===(s=a.groups)||void 0===s?void 0:s.pagination)||w.he,groupsFilters:(null===(c=e.groupReducer)||void 0===c||null===(l=c.groups)||void 0===l?void 0:l.filters)||{}})}),d.shallowEqual),j=S.role,T=S.group,P=S.isRecordLoading,R=S.rolesPagination,k=S.rolesFilters,x=S.groupsPagination,C=S.groupsFilters,D=S.systemGroupUuid,I=(0,d.useSelector)((function(e){return e.roleReducer.error!==Z.VG})),L=(0,d.useSelector)((function(e){return e.groupReducer.error!==Z.VG})),F=(0,d.useDispatch)(),_=function e(){if(F((0,b.fp)(E)),O)if("default-access"!==O)F((0,Ee.yi)(O));else{if(D)return e(),insights.chrome.appObjectId(D),function(){return insights.chrome.appObjectId(void 0)};F((0,Ee.WD)())}};(0,s.useEffect)((function(){return _(),insights.chrome.appObjectId(E),function(){return insights.chrome.appObjectId(void 0)}}),[E,O,D]);var N=function(){return[O?{title:"Groups",to:(0,Z.zk)(v.Z.groups.path,x,C)}:{title:"Roles",to:(0,Z.zk)(v.Z.roles.path,R,k)}].concat((0,o.Z)(L&&O&&("default-access"===O?D:L)?T?[{title:T&&T.name,to:"/groups/detail/".concat(O,"/roles"),isLoading:T&&T.loaded}]:[void 0]:L||!O?[]:[{title:"Invalid group",isActive:!0}]),(0,o.Z)(L||!O?[{title:P?void 0:I?(null==j?void 0:j.display_name)||(null==j?void 0:j.name):"Invalid role",isActive:!0}]:[]))},A=!P&&j?j.display_name||j.name:void 0,M=!P&&j?j.description:void 0,q=[c().createElement(m.DropdownItem,{component:c().createElement(p.Link,{onClick:function(){return u(!1)},to:v.Z["role-detail-edit"].path.replace(":id",E)},"Edit"),key:"edit-role"}),c().createElement(m.DropdownItem,{component:c().createElement(p.Link,{onClick:t,to:v.Z["role-detail-remove"].path.replace(":id",E)},"Delete"),className:"rbac-c-role__action",key:"delete-role"})];return c().createElement(s.Fragment,null,!L&&O||!I?c().createElement(s.Fragment,null,c().createElement("section",{className:"pf-c-page__main-breadcrumb pf-u-pb-md"},c().createElement(Se.Z,N())),c().createElement(we.Z,{title:"".concat(L?"Role":"Group"," not found"),description:["".concat(L?"Role":"Group"," with ID ").concat(L?E:O," does not exist.")],actions:[c().createElement(m.Button,{key:"back-button",className:"pf-u-mt-xl",ouiaId:"back-button",variant:"primary","aria-label":"Back to previous page",onClick:function(){return n.goBack()}},"Back to previous page")]})):c().createElement(s.Fragment,null,c().createElement(y.Q,{breadcrumbs:N()},c().createElement(m.Level,null,c().createElement(m.LevelItem,null,c().createElement(f.Z,{title:A||c().createElement(h.h2,null),className:"rbac-page-header__title"})),!P&&j&&!j.system&&c().createElement(m.LevelItem,null,c().createElement(m.Dropdown,{ouiaId:"role-title-actions-dropdown",toggle:c().createElement(m.KebabToggle,{onToggle:function(e){return u(e)},id:"role-actions-dropdown"}),isOpen:l,isPlain:!0,position:"right",dropdownItems:q}))),M&&c().createElement(m.TextContent,{className:"rbac-page-header__description"},c().createElement(m.Text,{component:"p"},M))),P||!j?c().createElement(h.Wi,null):c().createElement(ge,null),c().createElement(p.Route,{path:v.Z["role-detail-remove"].path},!P&&c().createElement(Oe.Z,{afterSubmit:function(){F((0,b.Kt)(Te(Te({},R),{},{offset:0,filters:k,inModal:!1})))},cancelRoute:v.Z["role-detail"].path.replace(":uuid",E),submitRoute:(0,Z.zk)(v.Z.roles.path,Te(Te({},R),{},{offset:0}),k),routeMatch:v.Z["role-detail-remove"].path})),c().createElement(p.Route,{path:v.Z["role-detail-edit"].path},!P&&c().createElement(Ze.Z,{afterSubmit:_,cancelRoute:v.Z["role-detail"].path.replace(":uuid",E),routeMatch:v.Z["role-detail-edit"].path}))))};Pe.propTypes={onDelete:u().func};const Re=Pe},57666:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(99166);const o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{onlyResolvesLast:!1};return(0,r.Z)(e,t,n)}},97890:()=>{},44370:()=>{},17657:()=>{},22972:()=>{},65088:()=>{},70347:()=>{},11452:()=>{},10497:()=>{},32857:()=>{},93818:()=>{},94498:()=>{},54476:()=>{},28992:()=>{},40837:()=>{},90479:()=>{},78752:()=>{},74282:()=>{},98379:()=>{},25238:()=>{},91993:()=>{},99624:()=>{},36974:()=>{},27479:()=>{},93661:()=>{},56024:()=>{},43390:()=>{},314:()=>{},40209:()=>{},87234:()=>{},38299:()=>{},72816:()=>{}}]);
//# sourceMappingURL=../sourcemaps/3730.31616035d3c772f8e481282d65f36f5d.js.map