{"version":3,"sources":["webpack:///./src/smart-components/user/user.js","webpack:///./src/smart-components/user/users.js"],"names":["debouncedFetch","columns","title","cellTransforms","compoundExpand","User","username","match","params","fetchRoles","fetchRoleForUser","fetchUsers","roles","isLoading","rolesWithAccess","user","useState","filter","setFilter","expanded","setExpanded","userExists","useSelector","state","roleReducer","error","BAD_UUID","useEffect","defaultSettings","limit","filters","insights","chrome","appObjectId","undefined","history","useHistory","offset","addFields","debounce","name","breadcrumbsList","to","isActive","Fragment","Stack","StackItem","paddingBottm","breadcrumbs","renderTitleTag","Label","color","is_active","Skeleton","size","className","description","Section","type","id","isCompact","isExpandable","onExpand","_event","_rowIndex","colIndex","isOpen","rowData","uuid","createRows","data","reduce","acc","i","groups_in","modified","accessCount","cells","props","component","length","DateFormat","date","parent","compoundParent","colSpan","Table","ouiaId","aria-label","variant","TableVariant","rows","map","g","Link","TableHeader","TableBody","access","permission","split","filterValue","fetchData","setFilterValue","pagination","meta","filterPlaceholder","titlePlural","titleSingular","tableId","actions","Button","key","onClick","goBack","propTypes","PropTypes","withRouter","connect","userReducer","users","dispatch","apiProps","Users","appNavClick","secondaryNav","Switch","pageAction","exact","path","paths","render","userLinks","isSelectable","defaultProps"],"mappings":"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","file":"js/791.ffea0d8c693b88a73883.js","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect, useSelector } from 'react-redux';\nimport { Link, useHistory, withRouter } from 'react-router-dom';\nimport debounce from 'lodash/debounce';\nimport { Button, Label, Stack, StackItem } from '@patternfly/react-core';\nimport { TopToolbar, TopToolbarTitle } from '../../presentational-components/shared/top-toolbar';\nimport { TableToolbarView } from '../../presentational-components/shared/table-toolbar-view';\nimport Section from '@redhat-cloud-services/frontend-components/Section';\nimport DateFormat from '@redhat-cloud-services/frontend-components/DateFormat';\nimport Skeleton from '@redhat-cloud-services/frontend-components/Skeleton';\nimport { fetchRoles, fetchRoleForUser } from '../../redux/actions/role-actions';\nimport { fetchUsers } from '../../redux/actions/user-actions';\nimport { ListLoader } from '../../presentational-components/shared/loader-placeholders';\nimport { defaultSettings } from '../../helpers/shared/pagination';\nimport { Table, TableHeader, TableBody, TableVariant, compoundExpand } from '@patternfly/react-table';\nimport { Fragment } from 'react';\nimport EmptyWithAction from '../../presentational-components/shared/empty-state';\nimport RbacBreadcrumbs from '../../presentational-components/shared/breadcrubms';\nimport { BAD_UUID } from '../../helpers/shared/helpers';\nimport './user.scss';\n\nconst columns = [\n  'Roles',\n  {\n    title: 'Groups',\n    cellTransforms: [compoundExpand],\n  },\n  {\n    title: 'Permissions',\n    cellTransforms: [compoundExpand],\n  },\n  {\n    title: 'Last commit',\n  },\n];\n\nlet debouncedFetch;\n\nconst User = ({\n  match: {\n    params: { username },\n  },\n  fetchRoles,\n  fetchRoleForUser,\n  fetchUsers,\n  roles,\n  isLoading,\n  rolesWithAccess,\n  user,\n}) => {\n  const [filter, setFilter] = useState('');\n  const [expanded, setExpanded] = useState({});\n\n  const userExists = useSelector((state) => {\n    const {\n      roleReducer: { error },\n    } = state;\n    return error !== BAD_UUID;\n  });\n\n  useEffect(() => {\n    fetchUsers({ ...defaultSettings, limit: 0, filters: { username } });\n    insights.chrome.appObjectId(username);\n    return () => insights.chrome.appObjectId(undefined);\n  }, []);\n\n  const history = useHistory();\n\n  const createRows = (data) => {\n    return data\n      ? data.reduce(\n          (acc, { uuid, name, groups_in = [], modified, accessCount }, i) => [\n            ...acc,\n            {\n              uuid,\n              cells: [\n                { title: name, props: { component: 'th', isOpen: false } },\n                { title: `${groups_in.length}`, props: { isOpen: expanded[uuid] === 1 } },\n                { title: accessCount, props: { isOpen: expanded[uuid] === 2 } },\n                { title: <DateFormat type=\"exact\" date={modified} /> },\n              ],\n            },\n            {\n              uuid: `${uuid}-groups`,\n              parent: 3 * i,\n              compoundParent: 1,\n              cells: [\n                {\n                  props: { colSpan: 4, className: 'pf-m-no-padding' },\n                  title: (\n                    <Table\n                      ouiaId=\"groups-in-role-nested-table\"\n                      aria-label=\"Simple Table\"\n                      variant={TableVariant.compact}\n                      cells={['Name', 'Description']}\n                      rows={groups_in.map((g) => ({ cells: [{ title: <Link to={`/groups/detail/${g.uuid}`}>{g.name}</Link> }, g.description] }))}\n                    >\n                      <TableHeader />\n                      <TableBody />\n                    </Table>\n                  ),\n                },\n              ],\n            },\n            {\n              uuid: `${uuid}-groups`,\n              parent: 3 * i,\n              compoundParent: 2,\n              cells: [\n                {\n                  props: { colSpan: 4, className: 'pf-m-no-padding' },\n                  title:\n                    rolesWithAccess && rolesWithAccess[uuid] ? (\n                      <Table\n                        aria-label=\"Simple Table\"\n                        ouiaId=\"permissions-in-role-nested-table\"\n                        variant={TableVariant.compact}\n                        cells={['Application', 'Resource type', 'Operation']}\n                        rows={rolesWithAccess[uuid].access.map((access) => ({ cells: access.permission.split(':') }))}\n                      >\n                        <TableHeader />\n                        <TableBody />\n                      </Table>\n                    ) : (\n                      <ListLoader />\n                    ),\n                },\n              ],\n            },\n          ],\n          []\n        )\n      : [];\n  };\n\n  useEffect(() => {\n    fetchRoles({ limit: 20, offset: 0, addFields: ['groups_in'], username });\n    debouncedFetch = debounce((limit, offset, name, addFields, username) => fetchRoles({ limit, offset, name, addFields, username }), 500);\n  }, []);\n\n  const onExpand = (_event, _rowIndex, colIndex, isOpen, rowData) => {\n    if (!isOpen) {\n      setExpanded({ ...expanded, [rowData.uuid]: colIndex });\n      // Permissions\n      if (colIndex === 2) {\n        fetchRoleForUser(rowData.uuid);\n      }\n    } else {\n      setExpanded({ ...expanded, [rowData.uuid]: -1 });\n    }\n  };\n\n  const breadcrumbsList = () => [\n    { title: 'Users', to: '/users' },\n    { title: userExists ? username : 'Invalid user', isActive: true },\n  ];\n\n  return (\n    <Fragment>\n      {userExists ? (\n        <Stack>\n          <StackItem>\n            <TopToolbar paddingBottm={false} breadcrumbs={breadcrumbsList()}>\n              <TopToolbarTitle\n                title={username}\n                renderTitleTag={() =>\n                  user && !isLoading ? (\n                    <Label color={user?.is_active && 'green'}>{user?.is_active ? 'Active' : 'Inactive'}</Label>\n                  ) : (\n                    <Skeleton size=\"xs\" className=\"ins-c-rbac__user-label-skeleton\"></Skeleton>\n                  )\n                }\n                description={`${username}'s roles, groups and permissions.`}\n              />\n            </TopToolbar>\n          </StackItem>\n          <StackItem>\n            <Section type=\"content\" id={'user-detail'}>\n              <TableToolbarView\n                columns={columns}\n                isCompact={false}\n                isExpandable={true}\n                onExpand={onExpand}\n                createRows={createRows}\n                data={roles.data}\n                filterValue={filter}\n                ouiaId=\"user-details-table\"\n                fetchData={({ limit, offset, name }) => {\n                  debouncedFetch(limit, offset, name, ['groups_in'], username);\n                }}\n                setFilterValue={({ name }) => setFilter(name)}\n                isLoading={isLoading}\n                pagination={roles.meta}\n                filterPlaceholder=\"role name\"\n                titlePlural=\"roles\"\n                titleSingular=\"role\"\n                tableId=\"user\"\n              />\n            </Section>\n          </StackItem>\n        </Stack>\n      ) : (\n        <Fragment>\n          <section className=\"pf-c-page__main-breadcrumb pf-u-pb-md\">\n            <RbacBreadcrumbs {...breadcrumbsList()} />\n          </section>\n          <EmptyWithAction\n            title=\"User not found\"\n            description={[`User with username ${username} does not exist.`]}\n            actions={[\n              <Button\n                key=\"back-button\"\n                className=\"pf-u-mt-xl\"\n                ouiaId=\"back-button\"\n                variant=\"primary\"\n                aria-label=\"Back to previous page\"\n                onClick={() => history.goBack()}\n              >\n                Back to previous page\n              </Button>,\n            ]}\n          />\n        </Fragment>\n      )}\n    </Fragment>\n  );\n};\n\nUser.propTypes = {\n  match: PropTypes.object,\n  fetchRoles: PropTypes.func,\n  fetchRoleForUser: PropTypes.func,\n  fetchUsers: PropTypes.func,\n  roles: PropTypes.object,\n  isLoading: PropTypes.bool,\n  rolesWithAccess: PropTypes.object,\n  user: PropTypes.object,\n};\n\nconst mapStateToProps = (\n  {\n    roleReducer: { roles, isLoading, rolesWithAccess },\n    userReducer: {\n      users: { data },\n    },\n  },\n  {\n    match: {\n      params: { username },\n    },\n  }\n) => ({\n  roles,\n  isLoading,\n  rolesWithAccess,\n  user: data && data.filter((user) => user.username === username)[0],\n});\nconst mapDispatchToProps = (dispatch) => ({\n  fetchRoles: (apiProps) => dispatch(fetchRoles(apiProps)),\n  fetchRoleForUser: (uuid) => dispatch(fetchRoleForUser(uuid)),\n  fetchUsers: (apiProps) => dispatch(fetchUsers(apiProps)),\n});\n\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(User));\n","/* eslint-disable */\nimport React, { useEffect } from 'react';\nimport { Link, Route, Switch, useHistory } from 'react-router-dom';\nimport { Stack, StackItem } from '@patternfly/react-core';\nimport { TopToolbar, TopToolbarTitle } from '../../presentational-components/shared/top-toolbar';\nimport { Section } from '@redhat-cloud-services/frontend-components';\nimport UsersList from '../group/add-group/users-list';\nimport ActiveUser from '../../presentational-components/shared/ActiveUsers';\nimport User from './user';\nimport { routes as paths } from '../../../package.json';\nimport PageActionRoute from '../common/page-action-route';\n\nconst Users = () => {\n  const description = (\n    <ActiveUser\n      description=\"These are all of the users in your Red Hat organization. To add new users or manage existing users, go to your\"\n    />\n  );\n\n  useEffect(() => {\n    insights.chrome.appNavClick({ id: 'users', secondaryNav: true });\n  }, []);\n\n  const renderUsers = () => <Stack >\n    <StackItem>\n      <TopToolbar paddingBottm={ false }>\n        <TopToolbarTitle\n          title=\"Users\"\n          description={ description }\n        />\n      </TopToolbar>\n    </StackItem>\n    <StackItem>\n      <Section type=\"content\" id={ 'users' }>\n        <UsersList\n          userLinks\n          props={ {\n            isSelectable: false,\n            isCompact: false\n          } }\n        />\n      </Section>\n    </StackItem>\n  </Stack >;\n\n  return (\n    <Switch>\n      <PageActionRoute pageAction=\"user-detail\" exact path={ paths['user-detail'] } render={ props => <User {...props}/> } />\n      <PageActionRoute pageAction=\"users-list\" path={ [ paths.users, paths.rbac] } render={ () => renderUsers() } />\n    </Switch>\n\n  );\n};\n\nUsers.propTypes = {\n\n};\n\nUsers.defaultProps = {\n\n};\n\nexport default Users;\n"],"sourceRoot":""}